<!DOCTYPE html>
<!--
/*
* INTER-Mediator Ver.@@@@2@@@@ Released @@@@1@@@@
*
*   by Masayuki Nii  msyk@msyk.net Copyright (c) 2013 Masayuki Nii, All rights reserved.
*
*   This project started at the end of 2009.
*   INTER-Mediator is supplied under MIT License.
*/
-->
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <link rel="shortcut icon" href="/im-icon.png" type="image/png"/>
    <link rel="stylesheet" type="text/css" href="defedit.css"/>
    <link rel="stylesheet" href="../codemirror-3.19/lib/codemirror.css">
    <title>INTER-Mediator - Definition File Editor</title>
    <script src="pageedit.php"></script>
    <script src="../codemirror-3.19/lib/codemirror.js"></script>
    <script src="../codemirror-3.19/addon/runmode/runmode.js"></script>
    <script src="../codemirror-3.19/addon/runmode/colorize.js"></script>
    <script src="../codemirror-3.19/mode/javascript/javascript.js"></script>
    <script src="../codemirror-3.19/mode/xml/xml.js"></script>
    <script src="../codemirror-3.19/mode/css/css.js"></script>
    <script src="../codemirror-3.19/mode/htmlmixed/htmlmixed.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            var nodeUnsupport = document.getElementById('nonsupportmessage');
            if (INTERMediatorOnPage.INTERMediatorCheckBrowser(nodeUnsupport)) {
                var params = INTERMediatorOnPage.getURLParametersAsArray();
                INTERMediator.additionalCondition['pagefile']
                        = {field: 'target', value: params.target};
                INTERMediator.additionalFieldValueOnNewRecord['pagefile']
                        = {field: 'target', value: params.target};
                INTERMediator.additionalFieldValueOnUpdate['pagefile']
                        = {field: 'target', value: params.target};
                INTERMediator.additionalFieldValueOnDelete['pagefile']
                        = {field: 'target', value: params.target};

                document.getElementById('deffile').appendChild(document.createTextNode(params.target));
                INTERMediator.ignoreOptimisticLocking = true;
                INTERMediator.construct(true);
            }
        }
//        INTERMediatorOnPage.doAfterConstruct = function () {
//            var node = document.getElementById('container');
//            node.style.display = "block";
//            if (textArea) {
//                var myTextarea = document.getElementById(textArea);
//            }
//        }
//        var textArea;
//        INTERMediatorOnPage.pageContentGenerated = function (target) {
//             textArea = INTERMediatorOnPage.getNodeIdFromIMDefinition("pagefile@content", target, true);
//        }
    </script>
    <style>
        INPUT {
            font-size: 14pt;
        }

        TH {
            color: #666666;
        }
    </style>
</head>
<body>
<div id="nonsupportmessage" style="background-color:#333333">
    <div style="text-align:center;color:yellow">
        The definition file editor doesn't work initially for security reasons.<br>
        If you want to use it, remove the comment before the IM_Entry function call of the defedit.php file.<br>
        You shouldn't these files to be able to access from any client.<br>
        The authentication is suitable way.
        One typical setting is to set the .htaccess file in the INTER-Mediator-Support folder.
    </div>
    <div style="text-align:center;color:yellow">
        定義ファイルエディタは、セキュリティ上の理由から既定値では機能しないようになっています。<br>
        機能させるためには、defedit.phpファイルのIM_Entry関数の前にコメントを消してください。<br>
        その場合は、何らかの方法で、認証をかけるようにすべきです。たとえば、INTER-Mediator-Supportフォルダ内に<br>
        .htaccessファイルを配置して、Web認証を機能させるなどの手段が利用できます。<br>
    </div>
</div>
<div id="container" style="display:block;">
    <h1>Definition File Editor</h1>

    <h2>Target Page File</h2>

    <p id="deffile"></p>

    <h2>Page File</h2>

    <div class="_im_enclosure">
        <div class="_im_repeater">
            <p>キータイプする毎にほぼ自動的に保存します</p>
            <div class="IM[pagefile@content]  IM_WIDGET[codemirror]"
                 style="width: 600px; border: 1px solid gray"></div>
        </div>
    </div>
</div>
</body>
</html>





