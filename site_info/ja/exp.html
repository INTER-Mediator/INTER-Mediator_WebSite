<!DOCTYPE html>
<!--
/*
 * INTER-Mediator Ver.@@@@2@@@@ Released @@@@1@@@@
 *
 *   by Masayuki Nii  msyk@msyk.net Copyright (c) 2014 Masayuki Nii, All rights reserved.
 *
 *   This project started at the end of 2009.
 *   INTER-Mediator is supplied under MIT License.
 */
-->
<html>
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link href="../lib/pagebuilder-r2.css" rel="stylesheet" media="screen"/>
    <link rel="shortcut icon" href="../images/im-icon.png" type="image/png"/>
    <link rel="icon" href="../images/im-icon.png" type="image/png"/>
    <title>INTER-Mediator</title>
    <script type="text/javascript" language="JavaScript" src="../lib/pagebuilder-r2.js"></script>
    <script type="text/javascript" language="JavaScript" src="../lib/pagebuilder-r2.php"></script>
    <style>
    </style>
</head>
<body>
<article>
    <h2>計算式</h2>

    <h3>項</h3>
    <div class="table">
        <div class="caption"></div>
        <table>
            <tr><th>種類</th><th>例</th><th>説明</th></tr>
            <tr><td>数値リテラル</td><td>10.3</td><td></td></tr>
            <tr><td>文字列リテラル</td><td>'abc'</td><td>シングルクォートでの囲みのみ。シングルクォートは\で要エスケープ</td></tr>
            <tr><td>定数</td><td>PI</td><td>EとPIが定義されている</td></tr>
            <tr><td>ターゲット指定</td><td>person@住所</td><td>展開されている対応するノードを参照。同一のコンテキスト内ならフィールド名のみ</td></tr>
        </table>
    </div>

    <h3>定数</h3>
    <div class="table">
        <div class="caption"></div>
        <table>
            <tr><th>定数</th><th>対応するJavaScript</th><th>解説</th></tr>
            <tr><td>E</td><td>Math.E</td><td>エクスポーネンシャル</td></tr>
            <tr><td>PI</td><td>Math.PI</td><td>円周率</td></tr>
        </table>
    </div>

    <h3>演算子</h3>
    <div class="table">
        <table>
            <tr><th>対象データ</th><th>演算子</th><th>記述例</th><th>解説</th></tr>
            <tr><td>数値</td><td>^</td><td>2^3 → 8</td><td>べき乗</td></tr>
            <tr><td></td><td>+</td><td>2+3 → 5</td><td>加算</td></tr>
            <tr><td></td><td>-</td><td>3-2 → 1</td><td>減算（あるいは負の数）</td></tr>
            <tr><td></td><td>*</td><td>3*2 → 6</td><td>乗算</td></tr>
            <tr><td></td><td>/</td><td>3/2 → 1.5</td><td>除算</td></tr>
            <tr><td></td><td>%</td><td>3%2 → 1</td><td>剰余</td></tr>
            <tr><td>文字</td><td>+</td><td>'a'+'b' → 'ab'</td><td>結合</td></tr>
            <tr><td></td><td>-</td><td>'abc'-'c' → 'ab'</td><td>除去</td></tr>
            <tr><td></td><td>∩</td><td>'abcdef' ∩ 'bdfx' → 'bdf'</td><td>共通の文字</td></tr>
            <tr><td></td><td>∪</td><td>'abcdef' ∪ 'bdfx' → 'abcdefx'</td><td>両方の文字</td></tr>
            <tr><td></td><td>⊁</td><td>'abcdef' ⊁ 'bdfx' → 'ace'</td><td>文字の除去</td></tr>
            <tr><td>論理演算</td><td>=</td><td>10=9 → false</td><td>等号</td></tr>
            <tr><td></td><td>==</td><td>10==9 → false</td><td>等号</td></tr>
            <tr><td></td><td>!=</td><td>10!=9 → true</td><td>不等号</td></tr>
            <tr><td></td><td><></td><td>10<>9 → true</td><td>不等号</td></tr>
            <tr><td></td><td>></td><td>10>9 → true</td><td>より大</td></tr>
            <tr><td></td><td><</td><td>10<9 → false</td><td>より小</td></tr>
            <tr><td></td><td>>=</td><td>10>=9 → true</td><td>以上</td></tr>
            <tr><td></td><td><=</td><td>10<=9 → false</td><td>以下</td></tr>
            <tr><td></td><td>==</td><td>10==9 → false</td><td>等号</td></tr>
            <tr><td></td><td>==</td><td>10==9 → false</td><td>等号</td></tr>
            <tr><td></td><td>&&</td><td>true && false → false</td><td>論理積</td></tr>
            <tr><td></td><td>||</td><td>true || false → true</td><td>論理和</td></tr>
            <tr><td>文字リスト</td><td>⋀</td><td>'abc¶dff¶ghi' ⋀ 'dff¶stu¶' → 'dff¶'</td><td>共通項</td></tr>
            <tr><td></td><td>⋁</td><td>'abc¶dff¶ghi' ⋁ 'xyz¶stu¶' → 'abc¶dff¶ghi¶xyz¶stu¶'</td><td>合同</td></tr>
            <tr><td></td><td>⊬</td><td>'abc¶dff¶ghi' ⊬ 'ghi¶dkg¶' → 'abc¶dff¶'</td><td>差演算</td></tr>
        </table>
    </div>
    <h4>加算と減算について</h4>
    <ul>
        <li>2つの項がいずれも数値に変換できるなら、数値として計算します。</li>
        <li>2つの項がいずれかでも数値に変換できないなら、文字列として計算します。</li>
    </ul>
    <h4>文字リストの改行の扱いについて</h4>
    <ul>
        <li>引数の最後に改行があってもなくてもかまいません。</li>
        <li>結果の最後には改行が付きます。</li>
        <li>最後の改行の扱いも含めて、長さが0の項目は項目として扱わず無視します。</li>
        <li>3種類ある改行のどれも同じように扱いますが、結果の改行は最初の引数の最初に出てくる改行になります。</li>
    </ul>

    <h3>関数</h3>
    <h4>数値、集計、判断、文字列</h4>
    <div class="table">
        <table>
            <tr><th>種類</th><th>関数</th><th>例（数値は丸めています）</th><th>説明</th></tr>
            <tr><td>数値</td><td>abs(x)</td><td>abs(-3.1) → 3.1</td><td>絶対値</td></tr>
            <tr><td></td><td>ceil(x)</td><td>ceil(-3.1) → -3</td><td>引数よりも大きな整数のうちの最小値</td></tr>
            <tr><td></td><td>floor(x)</td><td>floor(-3.1) → -4</td><td>引数よりも小さな整数のうちの最大値</td></tr>
            <tr><td></td><td>round(x,y)</td><td>round(3.1415, 2) → 3.14</td><td>1つ目の引数を四捨五入、2つ目の引数は少数以下の桁数で、正の数なら10の位から上位に上がる</td></tr>
            <tr><td></td><td>format(x,y)</td><td>format(x,y)</td><td>format(12345, 0) → 12,345</td></tr>
            <tr><td></td><td>sqrt(x)</td><td>sqrt(3) → 1.73</td><td>平方根</td></tr>
            <tr><td></td><td>exp(x)</td><td>exp(0.5) → 1.65</td><td>ネイピア数eのx乗</td></tr>
            <tr><td></td><td>log(x)</td><td>log(0.5) → -0.69</td><td>ネイピア数を底とする自然対数</td></tr>
            <tr><td></td><td>random()</td><td>random() → 0.254</td><td>0〜1の範囲の乱数</td></tr>
            <tr><td></td><td>pow(x, y)</td><td>pow(2,3) → 8</td><td>べき乗、xのy乗</td></tr>
            <tr><td></td><td>fac(x)</td><td>fac(5) → 120</td><td>累乗、x!の値</td></tr>
            <tr><td></td><td>pyt(x)</td><td>pyt(3,4) → 5</td><td>x^2+y^2の平方根</td></tr>
            <tr><td>集計</td><td>sum(x,...)</td><td>sum(1,2,3,4,5) → 15</td><td>合計。引数は可変</td></tr>
            <tr><td></td><td>min(x,...)</td><td>min(3,1,2,1,5,1) → 1</td><td>引数の最小値。引数は可変</td></tr>
            <tr><td></td><td>max(x,...)</td><td>max(3,1,2,1,5,1) → 5</td><td>引数の最大値。引数は可変</td></tr>
            <tr><td>判断</td><td>if(x,y,z)</td><td>if(10 >= 1,'b','c') → 'b</td><td>最初の引数の結果がtrueなら2番目、falseなr3番目を返す</td></tr>
            <tr><td>文字列</td><td>length()</td><td>length('test') → 4</td><td>引数の文字列の長さを求める。nullが引数なら0を返す</td></tr>
            <tr><td></td><td>substr(x,y,z)</td><td>substr('abcdefg', 3, 2) → 'de'</td><td>xの文字列に対して、x番目からy文字分のみを取り出す。最初の文字は0</td></tr>
            <tr><td></td><td>substring(x,y,z)</td><td>substring('abcdefg', 3, 5) → 'de'</td><td>xの文字列に対して、x番目からy文字目までを取り出す</td></tr>
            <tr><td></td><td>indexof(x,y)</td><td>indexof('abcdefg','cd') → 2</td><td>xの文字列の最初からyの文字列を探し、最初に見つかった場所を返す</td></tr>
            <tr><td></td><td>replace(x,y,z,w)</td><td>replace('abcdefgabc', 5, 8, 'yz') → 'abcdeyzbc'</td><td>xの文字列のy番目からz文字分を、文字列wに置き換える</td></tr>
            <tr><td></td><td>substitute(x,y,z)</td><td>substitute('abcdefgabc', 'bc', 'yz') → 'ayzdefgayz'</td><td>xの文字列内にあるすべての文字列yを文字列zに置き換える</td></tr>
            <tr><td>文字リスト</td><td>items(x,y,z)</td><td>items(x,0,1) →'abc¶'</td><td>文字列リストxに対して、y番目からz項目分を文字列リストとして取り出す</td></tr>
            <tr><td>三角関数</td><td>sin(x)</td><td>sin(PI/4) → 0.71</td><td></td></tr>
            <tr><td></td><td>cos(x)</td><td>cos(PI/4) → 0.71</td><td></td></tr>
            <tr><td></td><td>tan(x)</td><td>tan(PI/4) → 1</td><td></td></tr>
            <tr><td></td><td>tan2(x,y)</td><td>atan2(0.5, 0.5) → PI/4</td><td></td></tr>
            <tr><td></td><td>asin(x)</td><td>asin(0.71) → PI/4</td><td></td></tr>
            <tr><td></td><td>acos(x)</td><td>acos(0.71) → PI/4</td><td></td></tr>
            <tr><td></td><td>atan(x)</td><td>atan(1) → PI/4</td><td></td></tr>
        </table>
    </div>
<h4>文字のカウントについて</h4>
    <ul>
        <li>最初の文字、最初の項目は0です。</li>
    </ul>

    <h4>日付時刻の関数</h4>
    <p>日付時刻の関数は、Ver.4.6での対応を目指し、Ver.4.5以降で実装します。現在、実装中であり、一部の関数しか使えません。</p>
    <div class="table">
        <table>
            <tr><th>関数</th><th>例</th><th>説明</th></tr>
            <tr><td>date(str)</td><td>date('2014-02-18') → </td><td>引数に指定した文字列の日付に対応する整数を返す。数値は1970/1/1からの日数。引数をそのままJavaScriptのDateクラスで処理をする</td></tr>
            <tr><td>datetimestr)</td><td>datetime('2014-02-17 09:00:01') → </td><td>引数に指定した文字列の日時に対応する整数を返す。数値は1970/1/1からの秒数。引数をそのままJavaScriptのDateクラスで処理をする</td></tr>
            <tr><td>datecomponents(y,m,d)</td><td>datecomponents(2014,2,17) → </td><td>引数に、年月日を指定して、その日付に対応する整数を返す。数値は1970/1/1からの日数</td></tr>
            <tr><td>datetimecomponents(y,m,d,h,i,s)</td><td>datetimecomponents(2014,2,17,9,0,0) → </td><td>引数に、年月日時分秒を指定して、その日時に対応する整数を返す。数値は1970/1/1からの秒数</td></tr>
            <tr><td>today()</td><td>today() → </td><td>今現在の日付を指定する整数を返す。数値は1970/1/1からの日数</td></tr>
            <tr><td>now()</td><td>now() → </td><td>今現在の日時を指定する整数を返す。数値は1970/1/1からの秒数</td></tr>
            <tr><td>year(x)</td><td>year(datetime('2014-02-17')) → 2014</td><td>日付ないしは日時から年を求める</td></tr>
            <tr><td>month(x)</td><td>month(datetime('2014-02-17')) → 2 2014</td><td>日付ないしは日時から月を求める</td></tr>
            <tr><td>day(x)</td><td>day(datetime('2014-02-17')) → 17 2014</td><td>日付ないしは日時から日を求める</td></tr>
            <tr><td>weekday(d)</td><td>weekdaydt(datetime('2014-02-17 09:23:49') → 17</td><td>日付ないしは日時からから曜日を求める</td></tr>
            <tr><td>hour(x)</td><td>hour(datetime('2014-02-17 09:23:49') → 9 2014</td><td>日付ないしは日時から時を求める</td></tr>
            <tr><td>minute(x)</td><td>minute(datetime('2014-02-17 09:23:49') → 23 2014</td><td>日付ないしは日時から分を求める</td></tr>
            <tr><td>second(x)</td><td>second(datetime('2014-02-17 09:23:49') → 49 2014</td><td>日付ないしは日時から秒を求める</td></tr>
            <tr><td>yeardt(d)</td><td>yeardt(datetime('2014-02-17')) → 2014 2014</td><td>日時から年を求める</td></tr>
            <tr><td>monthdt(d)</td><td>monthdt(datetime('2014-02-17')) → 2</td><td>日時から月を求める</td></tr>
            <tr><td>daydt(d)</td><td>daydt(datetime('2014-02-17')) → 17</td><td>日時から日を求める</td></tr>
            <tr><td>weekdaydt(d)</td><td>weekdaydt(datetime('2014-02-17 09:23:49') → 17</td><td>日時から曜日を求める</td></tr>
            <tr><td>hourdt(d)</td><td>hourdt(datetime('2014-02-17 09:23:49') → 9</td><td>日時から時を求める</td></tr>
            <tr><td>minutedt(d)</td><td>minutedt(datetime('2014-02-17 09:23:49') → 23</td><td>日時から分を求める</td></tr>
            <tr><td>seconddt(d)</td><td>seconddt(datetime('2014-02-17 09:23:49') → 49</td><td>日時から秒を求める</td></tr>
            <tr><td>yeard(d)</td><td>yeard(date('2014-02-17')) → 2014</td><td>日付から年を求める</td></tr>
            <tr><td>monthd(d)</td><td>monthd(date('2014-02-17') → 2</td><td>日付から月を求める</td></tr>
            <tr><td>dayd(d)</td><td>dayd(date('2014-02-17') → 17</td><td>日付から日を求める</td></tr>
            <tr><td>weekdayd(d)</td><td>weekdayd(date('2014-02-17') → 17</td><td>日付から曜日を求める</td></tr>
            <tr><td>addyear(d, x)</td><td>addyear(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した年を加える</td></tr>
            <tr><td>addmonth(d, x)</td><td>addmonth(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した月を加える</td></tr>
            <tr><td>addday(d, x)</td><td>addday(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した日を加える</td></tr>
            <tr><td>addhour(d, x)</td><td>addhour(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した時を加える</td></tr>
            <tr><td>addminute(d, x)</td><td>addminute(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した分を加える</td></tr>
            <tr><td>addsecond(d, x)</td><td>addsecond(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付ないしは日時に指定した秒を加える</td></tr>
            <tr><td>endofmonth(d)</td><td>endofmonth(datetime('2014-02-17 09:23:49') → 49</td><td>日付ないしは日時の月の最終日を求める</td></tr>
            <tr><td>startofmonth(d)</td><td>startofmonth(datetime('2014-02-17 09:23:49') → 49</td><td>日付ないしは日時の月の最初の日を求める</td></tr>
            <tr><td>addyeardt(d, x)</td><td>addyeardt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した年を加える</td></tr>
            <tr><td>addmonthdt(d, x)</td><td>addmonthdt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した月を加える</td></tr>
            <tr><td>adddaydt(d, x)</td><td>adddaydt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した日を加える</td></tr>
            <tr><td>addhourdt(d, x)</td><td>addhourdt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した時を加える</td></tr>
            <tr><td>addminutedt(d, x)</td><td>addminutedt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した分を加える</td></tr>
            <tr><td>addseconddt(d, x)</td><td>addseconddt(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日時に指定した秒を加える</td></tr>
            <tr><td>endofmonthdt(d)</td><td>endofmonthdt(datetime('2014-02-17 09:23:49') → 49</td><td>日時の月の最終日を求める</td></tr>
            <tr><td>startofmonthdt(d)</td><td>startofmonthdt(datetime('2014-02-17 09:23:49') → 49</td><td>日時の月の最初の日を求める</td></tr>
            <tr><td>addyeard(d, x)</td><td>addyeard(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付に指定した年を加える</td></tr>
            <tr><td>addmonthd(d, x)</td><td>addmonthd(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付に指定した月を加える</td></tr>
            <tr><td>adddayd(d, x)</td><td>adddayd(datetime('2014-02-17 09:23:49'), 2) → 49</td><td>日付に指定した日を加える</td></tr>
            <tr><td>endofmonthd(d)</td><td>endofmonthd(datetime('2014-02-17 09:23:49') → 49</td><td>日付の月の最終日を求める</td></tr>
            <tr><td>startofmonthd(d)</td><td>startofmonthd(datetime('2014-02-17 09:23:49') → 49</td><td>日付の月の最初の日を求める</td></tr>
        </table>
    </div>
</article>
</body>
</html>