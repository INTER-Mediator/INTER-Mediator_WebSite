<!DOCTYPE html>
<!--
/*
 * INTER-Mediator Ver.@@@@2@@@@ Released @@@@1@@@@
 *
 *   by Masayuki Nii  msyk@msyk.net Copyright (c) 2014 Masayuki Nii, All rights reserved.
 *
 *   This project started at the end of 2009.
 *   INTER-Mediator is supplied under MIT License.
 */
-->
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link href="/pagestyle.css" rel="stylesheet" media="screen"/>
    <link rel="shortcut icon" href="/im-icon.png" type="image/png"/>
    <link rel="icon" href="/im-icon.png" type="image/png"/>
    <title>INTER-Mediator</title>
    <script type="text/javascript" language="JavaScript">
        var htmlDocumentModDate = document.lastModified;
    </script>
    <script type="text/javascript" language="JavaScript" src="/pagebuilder.js"></script>
    <script type="text/javascript" language="JavaScript" src="/files/jquery-1.10.2.min.js"></script>
    <style>
        code    {
            font-size: 12pt;
        }
    </style>
</head>
<body>
<div id="navigationbox" class="graybox">
    <div id="navigation"></div>
    <div id="latestnews"></div>
</div>
<div id="page_header"></div>
<div id="page_contents">
    <div style="border: solid 2px #4444BB;margin: 8px 300px 14px 40px;padding-bottom: 10px">
        <h1 style="border:none;font-size:16pt;">INTER-Mediator: ダウンロード/インストールと稼働用システム</h1>
        <p>この文書では、リリース版のダウンロード情報と、INTER-Mediatorを使って開発をする場合のINTER-Mediatorの準備方法と、さらに作成したWebアプリケーションで使用するINTER-Mediatorを作成する方法をまとめたものです。INTER-Mediatorはgithubでソースを公開しています。通常の開発時は、レポジトリにあるものをインストールしておくのがおすすめです。そして、アプリケーション完成後は、JavaScriptに圧縮をかけた実稼働用のINTER-Mediatorを利用するのが少しの事ですが、効率よくなります。これらの方法を説明します。
        </p>
    </div>

    <h2>ダウンロード</h2>
    <p>INTER-Mediatorのリリースバージョンは、<a href="https://github.com/msyk/INTER-Mediator/releases">こちら</a>をご覧ください。日々、レポジトリはアップデートされていますが、一定の機能を組み込むごとにバージョン番号を付与して、リリース版として公開します。最新のリリースバージョンは、Ver.4.2です。<a href="https://github.com/msyk/INTER-Mediator/archive/4.4.zip">直接のダウンロードはこちら</a>です。</p>


    <h2>レポジトリから取り出したバージョンを開発時に利用する</h2>
    <p>お勧めするのは、通常の開発は、レポジトリから取り出したもので進めておき、実際にアプリケーションを配備するときに、特定のバージョン向けにビルドしたものに置き換えるということになります。gitの使い方はいろいろ難しいですが、gitを全く知らない方も、ともかく以下のようにしてみてください。また、以下はコマンドラインによる汎用的な方法ですが、GitHubアプリケーションを使っても同様に可能です。</p>

    <p>まず、あるフォルダに作成するWebアプリケーションのファイルをまとめておくとします。そのフォルダを作ります。以下は、Documentsの下にmywebappフォルダを作りました。</p>

    <div class="picture">
        <img src="../files/doc-deploy-fig1.png" />
    </div>

    <p>次に、githubのINTER-Mdiatorのページに行きます。アカウントを持ってサインインしていただくのがいいのですが、なくてもソースのダウンロードは可能です。ここで、中央右付近にあるbranchがmasterになっているのを確認してください。ブランチのmasterがその時点でのコンプリートなソースです。そして、右の方にあるHTTPS clone URLをコピーしておきます。URLが薄く見える右のボタンをクリックすれば、コピーできます。</p>

    <div class="picture">
        <img src="../files/doc-deploy-fig2.png" />
    </div>

    <p>そして、ターミナルを開いてください。次のように作業をします。#以降はコメントです。ファイルパスはもちろん、ご自分の作られているフォルダ構成に従って指定をしてください。</p>

    <div class="code">
<pre><code>cd ~/Documents/mywebapp  # Webアプリケーションのフォルダをカレントにする
git clone https://github.com/msyk/INTER-Mediator.git  # サーバからレポジトリを複製する</code></pre>
</div>

    <p>これだけでOKです。すると、mywebappフォルダに、INTER-Mediatorフォルダが作られます。このINTER-Mediatorフォルダがフレームワーク本体となります。この階層に、たとえば、index.htmlファイルやら、アプリケーションのhtml/phpファイルを作って行けばOKです。後はこれをサーバにコピーして稼働を確認します。</p>

    <div class="picture"><img src="../files/doc-deploy-fig3.png" /></div>

    <p>ここで、レポジトリからクローンしたINTER-Mediatorを参照するには、定義ファイルのcontext.phpはたとえば、次のように記述をします。</p>

    <div class="code">
<pre><code>&lt;?php
require_once('INTER-Mediator/INTER-Mediator.php');
IM_Entry( .... );
?&gt;</code></pre>
    </div>

    <p>なお、サンプルファイルは、INTER-Mediatorフォルダ内のSamplesフォルダにあります。</p>

    <p>もし、レポジトリ側に新しいソースコードが加わっていれば、以下のようにコマンドを入れれば、最新版を取得できます。INTER-Mediatorフォルダをカレントにして、git pullとすればいいです。</p>

    <div class="code">
<pre><code>cd ~/Documents/mywebapp/INTER-Mediator
git pull</code></pre>
    </div>

    <p>念のために説明しておきますが、pullは最新版に更新するという使い方は非常に稀で、正しくは別のレポジトリの修正を取り込むという意味合いがあります。ソースコードをメンテする上では単なる更新ではないのですが、ソースを利用する側の方から見れば更新コマンドと思っていただいて概ねいいかと思います。もし、自分でフレームワーク側のソースを修正された場合には、単純ではありませんので、ここではソースは参照だけでタッチしないという前提で、説明をここまでとします。</p>

    <p>gitには実に多彩な機能があり、ここまでに説明した手順はほんとうにその一端でしかないのですが、これだけを知っていれば、とりあえず大丈夫かと思います。もし、フレームワーク側の修正結果をコミットしていただけるなら、それなりにコマンドを打ち込むか、あるいはアプリケーションを使うことになるかと思いますが、取り出すだけなら上記の手順以上はほとんどないと思います。</p>

    <p>もし、開発中に、フレームワーク側のバグが見つかったなら、もちろん、報告をしてください。なるべく早く対処します。レポジトリのクローンを作って作業をしていれば、対処が終われば、git pullをするだけで済みます。</p>

    <h2>OS XでGitHubアプリケーションを使う場合</h2>
    <p>コマンドラインがどうしても苦手だという方は、GitHubのアプリケーションを入手してインストールをしてください。そして、セットアップを一通りすませます。GitHubへのログインが必要なのですが、通常はアカウントを持っていると思われるので、そのアカウントでログインをしておきます。</p>

    <p>GitHubのページには、「Clone in Desktop」というボタンがあるので、それをクリックするとGitHubアプリケーションが起動して、いきなりINTER-Mediatorフォルダを作る場所を聞いてきます。そこで、配置した場所を選択してCloneボタンを押せばOKです。その後は、GitHubアプリケーションで、レポジトリのChangeのボタンを左側で選び、右上のSyncボタンをクリックすれば、サーバにある最新のレポジトリの内容をダウンロードしてアップデートします。</p>

    <div class="picture"><img src="../files/doc-deploy-fig9.png" /></div>

    <p>ただし、この方法だと、2つ目のクローンを同じアカウント内に作成しようとしても、最初に作ったレポジトリをGitHubアプリケーション側では提示して、新たなレポジトリを作りに行きません。その場合は、クローン作成については、コマンドで行ってください。その上で、レポジトリの一覧を表示します。GitHubアプリケーションのタイトルバーの一番左の「Repositories」をクリックすればいいでしょう。そして、ウインドウ下にある「＋」ボタンをクリックして、「Add Local Repository」を選択します。そして、コマンドで作ったクローンのフォルダを指定すると、INTER-Mediatorの項目が複数登録できるようになります。あるいは、レポジトリのフォルダを、Repotoriesを選択してレポジトリ一覧が見えているウインドウの中にドラッグして追加します。ただし、レポジトリのリストで区別ができなくなるので、レポジトリのリストを右クリックして「Show in Finder」を選択してフォルダを確認して、間違えて作業しないように気をつけないといけません。</p>

    <h2>WindowsでGitHubアプリケーションを使う場合</h2>
    <p>WindowsにもGitHubアプリケーションがありますので、それを使ってくローンを作り、更新するということはもちろん可能です。ただし、サイトに見える「Clone Desktop」ボタンを押しても、アプリケーションの案内が見えるだけで、GitHubアプリケーションが起動して何かを始めるということはありません。従って、最初に作るクローンは、アプリケーションの左側のアカウント一覧から見えている場合は、その項目を選択して、右ボタンメニューから「Clone」を選択するなどして作成できます。</p>

    <p>もし、どうしても出てこないなら、Git Shellという機能を使ってコマンドラインを呼び出し、クローンを作りたい場所をカレントディレクトリにして、「git clone https://github.com/msyk/INTER-Mediator.git」というコマンドを実行します。コマンドラインで作ったクローンをGitHubアプリケーションで認識させるには、フォルダをアプリケーションのウインドウにドラッグ&amp;ドロップします。</p>

    <div class="picture"><img src="../files/doc-deploy-fig5.png" /></div>

    <p>作成すると、レポジトリの詳細を表示すれば、上にsyncボタンが登場します。更新はこのボタンを押すだけでOKです。</p>

    <div class="picture"><img src="../files/doc-deploy-fig7.png" /></div>

    <h2>ダウンロードしたバージョンを開発時に利用する</h2>
    <p>githubのINTER-Mdiatorのページで、右側の「Donwload ZIP」ボタンをクリックすると、現状のレポジトリの各ファイルを圧縮・アーカイブしてダウンロードします。ブランチがmasterであれば、ダウンロードして展開したフォルダは、INTER-Mediator-masterという名前になっています。フォルダ名を適当に変更して、開発中のアプリケーションのフォルダ等へ移動します。</p>

    <p>もちろん、こちらの方が当初は手軽なのですが、レポジトリとは切り離されることになるので、レポジトリの更新があれば、その都度、同じ作業を繰り返さないといけません。</p>

    <h2>バージョン入りの実稼働向けINTER-Mediatorを生成する</h2>

    <p>レポジトリから取り出した結果で開発しているので、その状態で稼働はできるはずです。もちろん、動く状態なのでそのままをアップしてもいいのですが、ページ最後に出ているINTER-Mediatorの帯のバージョンが@@1@@などといった文字列になっていて、ちょっと雑な感じがすると思います。また、以下の方法でビルドすれば、サンプルなど実稼働に不要な素材が取り除かれると同時に、JavaScriptのプログラムを1つのファイルに圧縮してまとめるので、動作のパフォーマンスは有利になります。</p>

    <p>まず、準備として、レポジトリから取り出したINTER-Mediatorフォルダと同じフォルダに、ダウンロードしたyuicompressor-2.4.7.jarを配置してください。ダウンロードは、<a href="http://grepcode.com/snapshot/repo1.maven.org/maven2/com.yahoo.platform.yui/yuicompressor/2.4.7" target="_blank">こちらのページ</a>のBinary downloadのリンクから取得できます。</p>

    <p>独自のバージョンと本日の日付を組み込んだ現状のINTER-Mediatorを作るには、dist-docs/buildup.shというスクリプトを使ってください。たとえば、INTER-Mediatorのディレクトリがカレントディレクトリであれば、MacあるいはUNIX系OSなら、以下のように入力します。</p>

    <div class="code">
<pre><code>cd dist_docs #INTER-Mediatorフォルダがカレントの場合
./buildup.sh</code></pre>
    </div>

    <p>一方、Windowsの場合はCygwinで実行させてください。buildup.shファイルを、Cygwinのターミナルのウインドウにドラッグ&amp;ドロップして、Cygwinのターミナルでreturnキーを押すのが手軽でしょう。なお、ドライブのパスを指定したい場合は、Cygwinでは、/cygdrive/c/で、C:¥ドライブのルートを示すパスとなります。</p>

    <div class="picture">
        <img src="../files/doc-deploy-fig11.png" />
    </div>


    <p>すると以下のようなメッセージがターミナルに表示されます。ここで、キーボードから、1、2、3のいずれかをキータイプしてreturnキーを押してください。3種類のビルド形式が選択できますが、(2)が最小の構成で、通常はこちらでいいかと思われます。(3)は認証ユーザの管理ページのサンプルや、定義ファイルエディタなどを含むようになります。なお、認証のアプリケーションに関しては、Autu_Supportフォルダの内容をもとに独自に開発されることをお勧めします。</p>

    <div class="code">
<pre><code>$ ./buildup.sh
=================================================
Start to build the INTER-Mediator Ver.4.1.6
-------------------------------------------------
 Original: /Users/msyk/Documents/INTER-Mediator_develop/INTER-Mediator
 Build to: /Users/msyk/Documents/INTER-Mediator_develop/im_build/INTER-Mediator
-------------------------------------------------
Choose the build result from these:
 (1) Complete (everything contains)
 (2) Core only (the least set to work wep applications)
 (3) Core + Support (add Auth_Support and INTER-Mediator-Support)
Type 1, 2 or 3, and then type return----></code></pre>
</div>

    <p>INTER-Mediatorフォルダと同じフォルダに、yuicompressor-2.4.7.jarファイルがあれば、これを使ってJavaScriptのプログラムを圧縮します。ない場合には圧縮しないで、いくつかあるJavaScriptのファイルを1つにまとめることだけを行います。なお、別のバージョンのものを使う場合には、buildup.shファイルの最初の方にパスを記述する箇所があるので、それを修正してください。</p>

    <p>その後、メッセージ通り、INTER-Mediatorフォルダと同じ階層に、「im_build」フォルダが作られ、その中に、INTER-Mediatorフォルダがあります。こちらのファイルの中は、動作実行上必要なものだけに絞られています。また、それぞれのファイルや、あるいはページの下部のバーなどに、バージョン番号とビルド日が追加されるようになります。このim_build/INTER-Mediatorフォルダを、現状のINTER-Mediatorフォルダと置き換えればOKです。</p>

    <p>ただし、1点注意があります。ビルドしたINTER-Mediatorは、すべてのJavaScriptのプログラムを、INTER-Mediator.jsファイルにまとめて、その他のjsファイルは削除されています。そのままFTPでアップロードすると、消えたはずのその他のjsファイルが残ったままになります。なので、サーバ側にあるINTER-Mediatorフォルダもいったん消した上で、アップロードするのが確実です。動作がおかしいと思ったときには、INTER-Mediator.js以外のJavaScriptファイルがサーバ上で存在していないかを確認してください。</p>

    <p>バージョン番号については、buildup.shファイルの最初の方に記述があるので、それを変更して利用してください。なお、バージョンのルールは次のようにします。</p>

    <ul>
        <li>バージョン番号は、整数をピリオドで区切ることとする（例：3.4、3.11）</li>
        <li>バージョン表記は、Ver.を基本とするが、vでもVersionでもversionでも基本的には構わない</li>
        <li>整数が2つのものを「正式バージョン」とする（例：3.4、3.11）</li>
        <li>開発者が独自にバージョンを付ける場合、3つ目の整数を必ず付ける（例：3.4.1、3.11.133）</li>
        <li>開発者が独自にバージョンを付ける場合、さらに追加してもいい（例：3.4.1-rev.21）</li>
    </ul>

    <p>つまり、INTER-Mediatorをダウンロードして、実際にアプリケーションに搭載する上で少し修正したとしたら、3つ目の整数で枝番号を付けてくださいということです。できれば、その状態をコミット/プッシュした上で、そのバージョンタグをつけていただけると、自分のバックアップ用にもなると思います。他の人とバージョンが重ならないように、レポジトリをチェックして異なる番号を付けてください。また、3桁目は飛び番号でもいいとしましょう。けっこう緩いルールですね。</p>


</div>
</body>
</html>