/*
 * INTER-Mediator
 * Copyright (c) INTER-Mediator Directive Committee (http://inter-mediator.org)
 * This project started at the end of 2009 by Masayuki Nii msyk@msyk.net.
 *
 * INTER-Mediator is supplied under MIT License.
 * Please see the full license for details:
 * https://github.com/INTER-Mediator/INTER-Mediator/blob/master/dist-docs/License.txt
 */
function SHA1(s){function U(a,b,c){while(0<c--)a.push(b)}function L(a,b){return(a<<b)|(a>>>(32-b))}function P(a,b,c){return a^b^c}function A(a,b){var c=(b&0xFFFF)+(a&0xFFFF),d=(b>>>16)+(a>>>16)+(c>>>16);return((d&0xFFFF)<<16)|(c&0xFFFF)}var B="0123456789abcdef";return(function(a){var c=[],d=a.length*4,e;for(var i=0;i<d;i++){e=a[i>>2]>>((3-(i%4))*8);c.push(B.charAt((e>>4)&0xF)+B.charAt(e&0xF))}return c.join('')}((function(a,b){var c,d,e,f,g,h=a.length,v=0x67452301,w=0xefcdab89,x=0x98badcfe,y=0x10325476,z=0xc3d2e1f0,M=[];U(M,0x5a827999,20);U(M,0x6ed9eba1,20);U(M,0x8f1bbcdc,20);U(M,0xca62c1d6,20);a[b>>5]|=0x80<<(24-(b%32));a[(((b+65)>>9)<<4)+15]=b;for(var i=0;i<h;i+=16){c=v;d=w;e=x;f=y;g=z;for(var j=0,O=[];j<80;j++){O[j]=j<16?a[j+i]:L(O[j-3]^O[j-8]^O[j-14]^O[j-16],1);var k=(function(a,b,c,d,e){var f=(e&0xFFFF)+(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF),g=(e>>>16)+(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(f>>>16);return((g&0xFFFF)<<16)|(f&0xFFFF)})(j<20?(function(t,a,b){return(t&a)^(~t&b)}(d,e,f)):j<40?P(d,e,f):j<60?(function(t,a,b){return(t&a)^(t&b)^(a&b)}(d,e,f)):P(d,e,f),g,M[j],O[j],L(c,5));g=f;f=e;e=L(d,30);d=c;c=k}v=A(v,c);w=A(w,d);x=A(x,e);y=A(y,f);z=A(z,g)}return[v,w,x,y,z]}((function(t){var a=[],b=255,c=t.length*8;for(var i=0;i<c;i+=8){a[i>>5]|=(t.charCodeAt(i/8)&b)<<(24-(i%32))}return a}(s)).slice(),s.length*8))))};
(function(){var charSize=8,b64pad="",hexCase=0,str2binb=function(a){var b=[],mask=(1<<charSize)-1,length=a.length*charSize,i;for(i=0;i<length;i+=charSize){b[i>>5]|=(a.charCodeAt(i/charSize)&mask)<<(32-charSize-(i%32))}return b},hex2binb=function(a){var b=[],length=a.length,i,num;for(i=0;i<length;i+=2){num=parseInt(a.substr(i,2),16);if(!isNaN(num)){b[i>>3]|=num<<(24-(4*(i%8)))}else{return"INVALID HEX STRING"}}return b},binb2hex=function(a){var b=(hexCase)?"0123456789ABCDEF":"0123456789abcdef",str="",length=a.length*4,i,srcByte;for(i=0;i<length;i+=1){srcByte=a[i>>2]>>((3-(i%4))*8);str+=b.charAt((srcByte>>4)&0xF)+b.charAt(srcByte&0xF)}return str},binb2b64=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"+"0123456789+/",str="",length=a.length*4,i,j,triplet;for(i=0;i<length;i+=3){triplet=(((a[i>>2]>>8*(3-i%4))&0xFF)<<16)|(((a[i+1>>2]>>8*(3-(i+1)%4))&0xFF)<<8)|((a[i+2>>2]>>8*(3-(i+2)%4))&0xFF);for(j=0;j<4;j+=1){if(i*8+j*6<=a.length*32){str+=b.charAt((triplet>>6*(3-j))&0x3F)}else{str+=b64pad}}}return str},rotr=function(x,n){return(x>>>n)|(x<<(32-n))},shr=function(x,n){return x>>>n},ch=function(x,y,z){return(x&y)^(~x&z)},maj=function(x,y,z){return(x&y)^(x&z)^(y&z)},sigma0=function(x){return rotr(x,2)^rotr(x,13)^rotr(x,22)},sigma1=function(x){return rotr(x,6)^rotr(x,11)^rotr(x,25)},gamma0=function(x){return rotr(x,7)^rotr(x,18)^shr(x,3)},gamma1=function(x){return rotr(x,17)^rotr(x,19)^shr(x,10)},safeAdd_2=function(x,y){var a=(x&0xFFFF)+(y&0xFFFF),msw=(x>>>16)+(y>>>16)+(a>>>16);return((msw&0xFFFF)<<16)|(a&0xFFFF)},safeAdd_4=function(a,b,c,d){var e=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF),msw=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16);return((msw&0xFFFF)<<16)|(e&0xFFFF)},safeAdd_5=function(a,b,c,d,e){var f=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF),msw=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16);return((msw&0xFFFF)<<16)|(f&0xFFFF)},coreSHA2=function(j,k,l){var a,b,c,d,e,f,g,h,T1,T2,H,lengthPosition,i,t,K,W=[],appendedMessageLength;if(l==="SHA-224"||l==="SHA-256"){lengthPosition=(((k+65)>>9)<<4)+15;K=[0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0x0FC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x06CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];if(l==="SHA-224"){H=[0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]}else{H=[0x6A09E667,0xBB67AE85,0x3C6EF372,0xA54FF53A,0x510E527F,0x9B05688C,0x1F83D9AB,0x5BE0CD19]}}j[k>>5]|=0x80<<(24-k%32);j[lengthPosition]=k;appendedMessageLength=j.length;for(i=0;i<appendedMessageLength;i+=16){a=H[0];b=H[1];c=H[2];d=H[3];e=H[4];f=H[5];g=H[6];h=H[7];for(t=0;t<64;t+=1){if(t<16){W[t]=j[t+i]}else{W[t]=safeAdd_4(gamma1(W[t-2]),W[t-7],gamma0(W[t-15]),W[t-16])}T1=safeAdd_5(h,sigma1(e),ch(e,f,g),K[t],W[t]);T2=safeAdd_2(sigma0(a),maj(a,b,c));h=g;g=f;f=e;e=safeAdd_2(d,T1);d=c;c=b;b=a;a=safeAdd_2(T1,T2)}H[0]=safeAdd_2(a,H[0]);H[1]=safeAdd_2(b,H[1]);H[2]=safeAdd_2(c,H[2]);H[3]=safeAdd_2(d,H[3]);H[4]=safeAdd_2(e,H[4]);H[5]=safeAdd_2(f,H[5]);H[6]=safeAdd_2(g,H[6]);H[7]=safeAdd_2(h,H[7])}switch(l){case"SHA-224":return[H[0],H[1],H[2],H[3],H[4],H[5],H[6]];case"SHA-256":return H;default:return[]}},jsSHA=function(a,b){this.sha224=null;this.sha256=null;this.strBinLen=null;this.strToHash=null;if("HEX"===b){if(0!==(a.length%2)){return"TEXT MUST BE IN BYTE INCREMENTS"}this.strBinLen=a.length*4;this.strToHash=hex2binb(a)}else if(("ASCII"===b)||('undefined'===typeof(b))){this.strBinLen=a.length*charSize;this.strToHash=str2binb(a)}else{return"UNKNOWN TEXT INPUT TYPE"}};jsSHA.prototype={getHash:function(a,b){var c=null,message=this.strToHash.slice();switch(b){case"HEX":c=binb2hex;break;case"B64":c=binb2b64;break;default:return"FORMAT NOT RECOGNIZED"}switch(a){case"SHA-224":if(null===this.sha224){this.sha224=coreSHA2(message,this.strBinLen,a)}return c(this.sha224);case"SHA-256":if(null===this.sha256){this.sha256=coreSHA2(message,this.strBinLen,a)}return c(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(a,b,c,d){var e,keyToUse,i,retVal,keyBinLen,hashBitSize,keyWithIPad=[],keyWithOPad=[];switch(d){case"HEX":e=binb2hex;break;case"B64":e=binb2b64;break;default:return"FORMAT NOT RECOGNIZED"}switch(c){case"SHA-224":hashBitSize=224;break;case"SHA-256":hashBitSize=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===b){if(0!==(a.length%2)){return"KEY MUST BE IN BYTE INCREMENTS"}keyToUse=hex2binb(a);keyBinLen=a.length*4}else if("ASCII"===b){keyToUse=str2binb(a);keyBinLen=a.length*charSize}else{return"UNKNOWN KEY INPUT TYPE"}if(64<(keyBinLen/8)){keyToUse=coreSHA2(keyToUse,keyBinLen,c);keyToUse[15]&=0xFFFFFF00}else if(64>(keyBinLen/8)){keyToUse[15]&=0xFFFFFF00}for(i=0;i<=15;i+=1){keyWithIPad[i]=keyToUse[i]^0x36363636;keyWithOPad[i]=keyToUse[i]^0x5C5C5C5C}retVal=coreSHA2(keyWithIPad.concat(this.strToHash),512+this.strBinLen,c);retVal=coreSHA2(keyWithOPad.concat(retVal),512+hashBitSize,c);return(e(retVal))}};window.jsSHA=jsSHA}());
var INTERMediator={debugMode:false,separator:"@",defDivider:"|",defaultTargetInnerHTML:false,navigationLabel:null,elementIds:[],dontSelectRadioCheck:false,ignoreOptimisticLocking:false,supressDebugMessageOnPage:false,supressErrorMessageOnPage:false,additionalFieldValueOnNewRecord:{},additionalFieldValueOnUpdate:{},additionalFieldValueOnDelete:{},waitSecondsAfterPostMessage:4,pagedAllCount:0,totalRecordCount:null,currentEncNumber:0,isIE:false,isTrident:false,isEdge:false,ieVersion:-1,titleAsLinkInfo:true,classAsLinkInfo:true,isDBDataPreferable:false,noRecordClassName:"_im_for_noresult_",rootEnclosure:null,useSessionStorage:true,errorMessages:[],debugMessages:[],partialConstructing:true,linkedElmCounter:0,pusherObject:null,buttonIdNum:0,masterNodeOriginalDisplay:"block",detailNodeOriginalDisplay:"none",pusherAvailable:false,dateTimeFunction:false,postOnlyNumber:1,errorMessageByAlert:false,errorMessageOnAlert:null,isTablet:false,isMobile:false,crossTableStage:0,setDebugMessage:function(a,b){if(b===undefined){b=1}if(INTERMediator.debugMode>=b){INTERMediator.debugMessages.push(a);if(typeof console!="undefined"){console.log("INTER-Mediator[DEBUG:%s]: %s",new Date(),a)}}},setErrorMessage:function(a,b){b=b===undefined?"":(" - "+b);if(INTERMediator.errorMessageByAlert){alert(INTERMediator.errorMessageOnAlert===null?(a+b):INTERMediator.errorMessageOnAlert)}if((typeof a=="string"||a instanceof String)){INTERMediator.errorMessages.push(a+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a+b)}}else{if(a.message){INTERMediator.errorMessages.push(a.message+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a.message+b)}}if(a.stack&&typeof console!="undefined"){console.error(a.stack)}}},flushMessage:function(){var h,k,e,c,b,l,a,d,f;if(INTERMediator.errorMessageByAlert){INTERMediator.supressErrorMessageOnPage=true}if(!INTERMediator.supressErrorMessageOnPage&&INTERMediator.errorMessages.length>0){h=document.getElementById("_im_error_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_error_panel_4873643897897");h.style.backgroundColor="#FFDDDD";k=document.createElement("h3");k.appendChild(document.createTextNode("Error Info from INTER-Mediator"));k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];e.insertBefore(h,e.firstChild)}h.appendChild(document.createTextNode("============ERROR MESSAGE on "+new Date()+"============"));h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.errorMessages.length;c++){l=INTERMediator.errorMessages[c].split(IMLib.nl_char);for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}if(!INTERMediator.supressDebugMessageOnPage&&INTERMediator.debugMode&&INTERMediator.debugMessages.length>0){h=document.getElementById("_im_debug_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_debug_panel_4873643897897");h.style.backgroundColor="#DDDDDD";a=document.createElement("button");a.setAttribute("title","clear");INTERMediatorLib.addEvent(a,"click",function(i){f=document.getElementById("_im_debug_panel_4873643897897");f.parentNode.removeChild(f);i.preventDefault()});d=document.createTextNode("clear");a.appendChild(d);k=document.createElement("h3");k.appendChild(document.createTextNode("Debug Info from INTER-Mediator"));k.appendChild(a);k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];if(e){if(e.firstChild){e.insertBefore(h,e.firstChild)}else{e.appendChild(h)}}}h.appendChild(document.createTextNode("============DEBUG INFO on "+new Date()+"============ "));if(INTERMediatorOnPage.getEditorPath()){var g=document.createElement("a");g.setAttribute("href",INTERMediatorOnPage.getEditorPath());g.appendChild(document.createTextNode("Definition File Editor"));h.appendChild(g)}h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.debugMessages.length;c++){l=INTERMediator.debugMessages[c].split(IMLib.nl_char);for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}INTERMediator.errorMessages=[];INTERMediator.debugMessages=[]},propertyIETridentSetup:function(){var d,a,e,b;d=navigator.userAgent;a=d.toLocaleUpperCase().indexOf("MSIE");if(a>=0){INTERMediator.isIE=true;for(b=a+4;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+4,b));break}}}a=d.indexOf("; Trident/");if(a>=0){INTERMediator.isTrident=true;for(b=a+10;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+10,b))+4;break}}}a=d.indexOf(" Edge/");if(a>=0){INTERMediator.isEdge=true;for(b=a+6;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))||b===d.length-1){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+6,b));break}}}},propertyW3CUserAgentSetup:function(){var a=window.navigator.userAgent.toLowerCase();INTERMediator.isTablet=(a.indexOf("windows")!=-1&&a.indexOf("touch")!=-1&&a.indexOf("tablet pc")==-1)||a.indexOf("ipad")!=-1||(a.indexOf("android")!=-1&&a.indexOf("mobile")==-1)||(a.indexOf("firefox")!=-1&&a.indexOf("tablet")!=-1)||a.indexOf("kindle")!=-1||a.indexOf("silk")!=-1||a.indexOf("playbook")!=-1;INTERMediator.isMobile=(a.indexOf("windows")!=-1&&a.indexOf("phone")!=-1)||a.indexOf("iphone")!=-1||a.indexOf("ipod")!=-1||(a.indexOf("android")!=-1&&a.indexOf("mobile")!=-1)||(a.indexOf("firefox")!=-1&&a.indexOf("mobile")!=-1)||a.indexOf("blackberry")!=-1},initialize:function(){INTERMediatorOnPage.removeCookie("_im_localcontext");INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};INTERMediator.startFrom=0;IMLibLocalContext.archive()},construct:function(b){var a;INTERMediatorOnPage.showProgress();if(b===true||b===undefined){if(INTERMediatorOnPage.isFinishToConstruct){return}INTERMediatorOnPage.isFinishToConstruct=true;a=function(){INTERMediator.constructMain(true)}}else{a=function(){INTERMediator.constructMain(b)}}setTimeout(a,0)},constructMain:function(R,p){var O,I,E=[],r={},S=1,x=[],w,D=1,m=[],L=false,l,u,k,C;if(INTERMediatorOnPage.doBeforeConstruct){INTERMediatorOnPage.doBeforeConstruct()}if(!INTERMediatorOnPage.isAutoConstruct){return}INTERMediator.crossTableStage=0;u=[];IMLibEventResponder.setup();INTERMediatorOnPage.retrieveAuthInfo();try{if(Pusher.VERSION){INTERMediator.pusherAvailable=true;if(!INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1039]);INTERMediator.pusherAvailable=false}}}catch(H){INTERMediator.pusherAvailable=false;if(INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1038])}}try{if(R===true||R===undefined){IMLibPageNavigation.deleteInsertOnNavi=[];INTERMediator.partialConstructing=false;INTERMediator.buttonIdNum=1;IMLibContextPool.clearAll();y()}else{IMLibPageNavigation.deleteInsertOnNavi=[];INTERMediator.partialConstructing=true;w=false;E=[];try{if(!p){R.removeContext();l=R.original;for(O=0;O<l.length;O++){R.enclosureNode.appendChild(l[O].cloneNode(true))}c(R.enclosureNode,R.foreignValue,R.dependingParentObjectInfo,R)}else{e(R,R.enclosureNode,{recordset:p,targetTotalCount:1,targetCount:1})}}catch(H){if(H=="_im_requath_request_"){throw H}else{INTERMediator.setErrorMessage(H,"EXCEPTION-8")}}for(O=0;O<E.length;O++){if(E[O]["id"]&&document.getElementById(E[O]["id"])){document.getElementById(E[O]["id"]).value=E[O]["value"]}}IMLibCalc.updateCalculationFields()}}catch(H){if(H=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.hideProgress();INTERMediatorOnPage.authenticating(function(){INTERMediator.constructMain(R)});INTERMediator.partialConstructing=true;return}}}else{INTERMediator.setErrorMessage(H,"EXCEPTION-7");INTERMediator.partialConstructing=true}}for(O=0;O<m.length;O++){m[O].finish()}INTERMediatorOnPage.hideProgress();for(O=0;O<u.length;O++){I=u[O].targetNode;k=u[O].parentNode;C=u[O].siblingNode;if(I&&k){if(C){k.insertBefore(I,C)}else{k.appendChild(I)}}}for(O=0;O<x.length;O++){I=document.getElementById(x[O].id);if(I){INTERMediatorLib.addEvent(I,x[O].event,x[O].todo)}}if(INTERMediatorOnPage.doAfterConstruct){INTERMediatorOnPage.doAfterConstruct()}INTERMediatorOnPage.isFinishToConstruct=false;INTERMediator.partialConstructing=true;INTERMediator.flushMessage();function y(){var W,X,Z;IMLibCalc.calculateRequiredObject={};INTERMediator.currentEncNumber=1;INTERMediator.elementIds=[];w=false;X=document.getElementsByTagName("BODY")[0];if(INTERMediator.rootEnclosure===null){INTERMediator.rootEnclosure=X.innerHTML}else{X.innerHTML=INTERMediator.rootEnclosure}E=[];INTERMediatorOnPage.setReferenceToTheme();try{c(X,null,null,null)}catch(V){if(V=="_im_requath_request_"){throw V}else{INTERMediator.setErrorMessage(V,"EXCEPTION-9")}}for(W=0;W<E.length;W++){if(E[W]["value"]===""&&document.getElementById(E[W]["id"]).tagName=="SELECT"){Z=document.createElement("option");Z.setAttribute("id",z());Z.setAttribute("value","");Z.setAttribute("data-im-element","auto-generated");document.getElementById(E[W]["id"]).insertBefore(Z,document.getElementById(E[W]["id"]).firstChild)}document.getElementById(E[W]["id"]).value=E[W]["value"]}IMLibLocalContext.bindingDescendant(document.documentElement);IMLibCalc.updateCalculationFields();IMLibPageNavigation.navigationSetup();if(L&&INTERMediator.pusherAvailable){var U=INTERMediatorOnPage.clientNotificationIdentifier();var Y=INTERMediatorOnPage.clientNotificationKey();if(Y&&Y!="_im_key_isnt_supplied"&&!INTERMediator.pusherObject){try{Pusher.log=function(i){if(window.console&&window.console.log){window.console.log(i)}};INTERMediator.pusherObject=new Pusher(Y);INTERMediator.pusherChannel=INTERMediator.pusherObject.subscribe(U);INTERMediator.pusherChannel.bind("update",function(i){IMLibContextPool.updateOnAnotherClient("update",i)});INTERMediator.pusherChannel.bind("create",function(i){IMLibContextPool.updateOnAnotherClient("create",i)});INTERMediator.pusherChannel.bind("delete",function(i){IMLibContextPool.updateOnAnotherClient("delete",i)})}catch(V){INTERMediator.setErrorMessage(V,"EXCEPTION-47")}}}f()}function c(X,U,Z,V){var W,ac,Y,aa;if(X.nodeType===1){try{if(INTERMediatorLib.isEnclosure(X,false)){ac=INTERMediatorLib.getClassAttributeFromNode(X);aa=X.getAttribute("data-im-control");if((ac&&ac.match(/_im_post/))||(aa&&aa.indexOf("post")>=0)){o(X)}else{if(INTERMediator.isIE){try{N(X,U,Z,V)}catch(ab){if(ab=="_im_requath_request_"){throw ab}}}else{N(X,U,Z,V)}}}else{W=X.childNodes;if(W){for(Y=0;Y<W.length;Y++){if(W[Y].nodeType===1){c(W[Y],U,Z,V)}}}}}catch(ab){if(ab=="_im_requath_request_"){throw ab}else{INTERMediator.setErrorMessage(ab,"EXCEPTION-10")}}}}function o(W){var V,i;i=INTERMediatorLib.getElementsByClassNameOrDataAttr(W,"_im_post");for(O=0;O<i.length;O++){if(i[O].tagName==="BUTTON"||(i[O].tagName==="INPUT"&&(i[O].getAttribute("type").toLowerCase()==="button"||i[O].getAttribute("type").toLowerCase()==="submit"))){INTERMediatorLib.addEvent(i[O],"click",(function(){var X=i[O];return function(){IMLibUI.clickPostOnlyButton(X)}})())}}V=W.childNodes;w=true;for(O=0;O<V.length;O++){U(V[O])}w=false;function U(ab){var aa,Z,Y,ac;if(ab.nodeType===1){try{ac=ab.getAttribute("data-im");if(ac){if(!ab.id){ab.id="IMPOST-"+INTERMediator.postOnlyNumber;INTERMediator.postOnlyNumber++}INTERMediatorLib.addEvent(ab,"blur",function(ae){var ad=ab.id;IMLibUI.valueChange(ad,true)});if(ab.tagName=="INPUT"&&ab.getAttribute("type")=="radio"){if(!r[ac]){r[ac]="Name-"+S;S++}ab.setAttribute("name",r[ac])}}if(INTERMediatorLib.isWidgetElement(ab)){Z=INTERMediatorLib.getWidgetInfo(ab);if(Z[0]){IMParts_Catalog[Z[0]].instanciate(ab);if(m.indexOf(IMParts_Catalog[Z[0]])<0){m.push(IMParts_Catalog[Z[0]])}}}else{if(INTERMediatorLib.isEnclosure(ab,false)){N(ab,null,null,null)}else{aa=ab.childNodes;for(Y=0;Y<aa.length;Y++){U(aa[Y])}}}}catch(X){if(X=="_im_requath_request_"){throw X}else{INTERMediator.setErrorMessage(X,"EXCEPTION-11")}}}}}function N(X,V,aa,W){var Z,ab,Y;var ac=X.getAttribute("data-im-control");if(W&&W.contextName&&V&&V[W.contextName]&&V[W.contextName][W.contextName+"::-recid"]){Z=V[W.contextName][W.contextName+"::-recid"];V=V[W.contextName][Z]}if(ac&&ac.match(/cross-table/)){U(X,V,aa,W)}else{ab=INTERMediatorLib.repeaterTagFromEncTag(X.tagName);Y=b(X,ab);ad(X,Y,V,aa,W)}function ad(at,ai,aj,am,ao,ay,an){var ah,ak,aq,ar,ap,az,av,af,ae,au,ax,ag,al,aw=null;ak=t(ai);ah=INTERMediatorLib.seekLinkedAndWidgetNodes(ak,true).linkedNode;aq=B(ah);ar=G(aq);ap=ar.targettable;INTERMediator.currentEncNumber++;if(!at.getAttribute("id")){at.setAttribute("id",z())}if(!ap){for(av=0;av<ai.length;av++){ae=at.appendChild(ai[av]);if(ai[av].getAttribute("selected")!==null){ax=ae}if(ax!==undefined){ax.selected=true}c(ae,null,at,ao)}}else{aw=IMLibContextPool.generateContextObject(ap,at,ak,ai);al=aw.getCalculationFields();az=ar.fieldlist.map(function(aA){if(!al[aA]){al.push(aA)}return aA});aw.setRelationWithParent(aj,am,ao);if(ap.relation&&ap.relation[0]&&Boolean(ap.relation[0].portal)===true){ap.currentrecord=aj;au=aj["-recid"]}if(ay){ay(aw)}af=A(aw,az,aw.foreignValue);aw.storeRecords(af);v(ap,aw);if(an==undefined){aw.registeredId=af.registeredId;aw.nullAcceptable=af.nullAcceptable;L|=!(INTERMediatorOnPage.notifySupport===false);e(aw,at,af);J(aw,au,at,aw.foreignValue);a(aw,at);T(ap,at)}else{an(aw,af)}aw.sequencing=false}return aw}function U(aw,ai,al,ao){var ay,ax,av,ar,ae,ag,aB,an,at,ah,az,ap,ak,af,aq,aA,aj,au;var am=i(aw);if(am.length!=4){throw"Exception-xx: Cross Table Components aren't prepared."}while(aw.childNodes.length>0){aw.removeChild(aw.childNodes[0])}ak=t([am[3].cloneNode(true)]);af=INTERMediatorLib.seekLinkedAndWidgetNodes(ak,true).linkedNode;aq=B(af);aA=G(aq).targettable;aj=aA.relation[0]["join-field"];au=aA.relation[1]["join-field"];INTERMediator.crossTableStage=1;an=document.createElement("TR");aB=am[0].cloneNode(true);an.appendChild(aB);aw.appendChild(an);aB=am[1].cloneNode(true);at=ad(an,[aB],null,al,ao);av=at.indexingArray(aj);INTERMediator.crossTableStage=2;aB=am[2].cloneNode(true);an=document.createElement("TR");an.appendChild(aB);ah=ad(aw,[an],null,al,ao);ar=ah.indexingArray(au);INTERMediator.crossTableStage=3;aB=am[3].cloneNode(true);ae={};ap=aw.getElementsByTagName("TR");for(ay=1;ay<ap.length;ay+=1){for(ax=0;ax<av.length;ax+=1){az=aB.cloneNode(true);ap[ay].appendChild(az);n(az);if(!ae[av[ax]]){ae[av[ax]]={}}ae[av[ax]][ar[ay-1]]=az}}n(aw);ad(aw,[aB],null,al,ao,function(aC){var aD=aC.getContextDef();INTERMediator.clearCondition(aD.name,"_imlabel_crosstable");INTERMediator.addCondition(aD.name,{field:aD.relation[0]["foreign-key"],operator:"IN",value:av,onetime:true},undefined,"_imlabel_crosstable");INTERMediator.addCondition(aD.name,{field:aD.relation[1]["foreign-key"],operator:"IN",value:ar,onetime:true},undefined,"_imlabel_crosstable")},function(aL,aH){var aC,aI,aM,aD,aE,aK,aJ,aF,aG,aN;aM=aL.getContextDef();aF=aL.getKeyField();aC=aM.relation[0]["foreign-key"];aI=aM.relation[1]["foreign-key"];if(aH.recordset){for(aD=0;aD<aH.recordset.length;aD++){ag=aH.recordset[aD];if(ae[ag[aC]]&&ae[ag[aC]][ag[aI]]){aK=ae[ag[aC]][ag[aI]];if(aK){aE=INTERMediatorLib.seekLinkedAndWidgetNodes([aK],false);aG=ag[aF];if(aF&&!aG&&aG!==0){aG=aD}aN=aF+"="+aG}aJ=K(aE,aL,aH.recordset,aD,aN)}}}})}function i(ah){var ag=[],af=0;ae(ah.childNodes);return ag;function ae(ai){var ak,aj;for(aj=0;aj<ai.length;aj++){if(ai[aj].nodeType==1&&(ai[aj].tagName=="TH"||ai[aj].tagName=="TD")){ag[af]=ai[aj];af+=1}else{ak=ai[aj].childNodes;if(ak){ae(ak)}}}}}}function K(Z,av,an,Y,ag){var ab,aj,az,af,aq,X,ao,ah,ak,at,W,aa,ai,ar,ae={},U,ap,ad,al,au,V=false,am,i=[],ac,ax;af=av.getContextDef();try{ab=Z.widgetNode;aj=Z.linkedNode;X=av.getKeyField();if(an[Y]&&(an[Y][X]||an[Y][X]===0)){for(ao=0;ao<aj.length;ao++){ah=aj[ao].getAttribute("id");at=n(aj[ao]);W=at.getAttribute("type");if(W=="checkbox"||W=="radio"){aa=at.parentNode.childNodes;for(O=0;O<aa.length;O++){if(aa[O].nodeType===1&&aa[O].tagName=="LABEL"&&ah==aa[O].getAttribute("for")){aa[O].setAttribute("for",at.getAttribute("id"));break}}}}for(ao=0;ao<ab.length;ao++){ai=INTERMediatorLib.getWidgetInfo(ab[ao]);if(ai[0]){IMParts_Catalog[ai[0]].instanciate(ab[ao]);if(m.indexOf(IMParts_Catalog[ai[0]])<0){m.push(IMParts_Catalog[ai[0]])}}}}}catch(aw){if(aw=="_im_requath_request_"){throw aw}else{INTERMediator.setErrorMessage(aw,"EXCEPTION-101")}}ar={};for(ao=0;ao<aj.length;ao++){try{U=aj[ao].tagName;ah=aj[ao].getAttribute("id");if(INTERMediatorLib.isWidgetElement(aj[ao])){ah=aj[ao]._im_getComponentId()}W=aj[ao].getAttribute("type");ap=INTERMediatorLib.getLinkedElementInfo(aj[ao]);if(W=="radio"){ad=ap.join("|");if(!ar[ad]){ar[ad]=D;D++}al=ar[ad];au=aj[ao].getAttribute("name");if(au){aj[ao].setAttribute("name",au+"-"+al)}else{aj[ao].setAttribute("name","IM-R-"+al)}}for(aq=0;aq<ap.length;aq++){az=INTERMediatorLib.getNodeInfoArray(ap[aq]);ak=an[Y][az.field];if(!INTERMediator.isDBDataPreferable||ak!==null){IMLibCalc.updateCalculationInfo(av,ag,af,ah,az,an[Y])}if(az.table==af.name){V=true;am=az.target;if(ak===null){if(IMLibElement.setValueToIMNode(aj[ao],am,"")){E.push({id:ah,value:ak})}}else{if((typeof ak=="object"||ak instanceof Object)){if(ak&&ak.length>0){if(IMLibElement.setValueToIMNode(aj[ao],am,ak[0])){E.push({id:ah,value:ak[0]})}}else{if(aj[ao].tagName==="SELECT"){E.push({id:ah,value:""})}}}else{if(IMLibElement.setValueToIMNode(aj[ao],am,ak)){E.push({id:ah,value:ak})}}}av.setValue(ag,az.field,ak,ah,am);if(ae[az.field]===undefined){ae[az.field]=[]}ae[az.field].push(ah)}}ac=am?am.charAt(0):"";ax=aj[ao].getAttribute("data-im-control");if(V&&!w&&ac!="#"&&ac!="$"&&(U=="INPUT"||U=="SELECT"||U=="TEXTAREA")&&(!ax||ax.indexOf("unbind")>0)){var ay=function(aB,aA){return function(){if(aA==="change"||(aA==="input"&&document.getElementById(aB).value==="")){if(IMLibUI.valueChange(aB)){if(document.getElementById(aB).tagName=="SELECT"){aa=document.getElementById(aB).childNodes;for(O=0;O<aa.length;O++){if(aa[O].nodeType===1){if(aa[O].tagName==="OPTION"&&aa[O].getAttribute("data-im-element")==="auto-generated"){i.push(aa[O].getAttribute("id"));IMLibElement.deleteNodes(i)}}}}}}}};x.push({id:ah,event:"change",todo:ay(ah,"change")});if(INTERMediator.isTrident||INTERMediator.isEdge){x.push({id:ah,event:"input",todo:ay(ah,"input")})}if(U!="SELECT"){x.push({id:ah,event:"keydown",todo:IMLibUI.keyDown});x.push({id:ah,event:"keyup",todo:IMLibUI.keyUp})}}}catch(aw){if(aw=="_im_requath_request_"){throw aw}else{INTERMediator.setErrorMessage(aw,"EXCEPTION-27")}}}return ae}function e(aq,ak,V){var U,at,Z,ai,aj,ad,ac,Y,X,al,ah,ao,af,ap,ab,ar,an,aa,ag,W,am,ae;ad=ak.tagName;ac=INTERMediatorLib.repeaterTagFromEncTag(ad);X=aq.original;af=aq.getContextDef();al=V.recordset;ah=V.totalCount;ai=h(X);for(ao=0;ao<ai.length;ao++){U=ai[ao];Z=U.getAttribute("data-im-control");if(Z&&Z.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0){if(!ab){ak.appendChild(U)}}}if(V.count===0){for(ao=0;ao<X.length;ao++){U=X[ao].cloneNode(true);at=INTERMediatorLib.getClassAttributeFromNode(U);Z=U.getAttribute("data-im-control");if((at&&at.indexOf(INTERMediator.noRecordClassName)>-1)||(Z&&Z.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>-1)){ak.appendChild(U);n(U)}}}ar=al?al.length:0;for(Y=0;Y<ar;Y++){ai=h(X);aa=INTERMediatorLib.seekLinkedAndWidgetNodes(ai,true);W=aq.getKeyField();for(ao=0;ao<ai.length;ao++){n(ai[ao])}if(al[Y]&&(al[Y][W]||al[Y][W]===0)){am=al[Y][W];if(W&&!am&&am!==0){INTERMediator.setErrorMessage("The value of the key field is null.","This No.["+Y+"] record should be ignored.");am=Y}ag=W+"="+am}ae=K(aa,aq,al,Y,ag);M(ad,ai,aq,W,am);Q(ad,ai,af,W,am);q(ad,ac,ai,aq,al[Y]);if(Boolean(af.portal)!==true||(Boolean(af.portal)===true&&ah>0)){aj=[];ab=null;if(!aq.sequencing){ap=aq.checkOrder(al[Y]);ab=aq.getRepeaterEndNode(ap+1)}for(ao=0;ao<ai.length;ao++){U=ai[ao];at=INTERMediatorLib.getClassAttributeFromNode(U);Z=U.getAttribute("data-im-control");if(!(at&&at.indexOf(INTERMediator.noRecordClassName)>=0)&&!(Z&&Z.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)&&!(Z&&Z.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)&&!(Z&&Z.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)&&!(Z&&Z.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)){if(!ab){ak.appendChild(U)}else{ab.parentNode.insertBefore(U,ab)}aj.push(U);if(!U.id){n(U)}aq.setValue(ag,"_im_repeater","",U.id,"",af.portal);c(U,al[Y],ae,aq)}}if(Y+1!=ar){for(ao=0;ao<ai.length;ao++){U=ai[ao];Z=U.getAttribute("data-im-control");if(Z&&Z.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0){if(!ab){ak.appendChild(U)}else{ab.parentNode.insertBefore(U,ab)}}}}g(af,ak,aj)}aq.rearrangePendingOrder()}ai=h(X);for(ao=0;ao<ai.length;ao++){U=ai[ao];Z=U.getAttribute("data-im-control");if(Z&&Z.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0){if(!ab){ak.appendChild(U)}}}}function n(Y){var W,X,U,V=true;if(Y.getAttribute("id")===null){Y.setAttribute("id",z())}else{if(INTERMediator.elementIds.indexOf(Y.getAttribute("id"))>=0){X=INTERMediatorLib.getLinkedElementInfo(Y);for(W=0;W<X.length;W++){U=X[W].split(INTERMediator.separator);if(U[2]=="#id"){V=false}}if(V){Y.setAttribute("id",z())}}INTERMediator.elementIds.push(Y.getAttribute("id"))}return Y}function z(){INTERMediator.linkedElmCounter++;return F()}function F(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}function A(Y,V,X){var U,Z,i;if(Boolean(Y.contextDefinition.cache)===true){U=d(Y.contextDefinition,X)}else{try{U=Y.getPortalRecords();if(!U){i=Y.isUseLimit();Z=Y.getRecordNumber();U=INTERMediator_DBAdapter.db_query({name:Y.contextDefinition.name,records:isNaN(Z)?100000000:Z,paging:Y.contextDefinition.paging,fields:V,parentkeyvalue:X,conditions:null,useoffset:true,uselimit:i})}}catch(W){if(W=="_im_requath_request_"){throw W}else{INTERMediator.setErrorMessage(W,"EXCEPTION-12")}}}return U}function d(ad,Y){var Z=null,i,U,V,ac,X,aa,W,af,ae;try{if(!INTERMediatorOnPage.dbCache[ad.name]){INTERMediatorOnPage.dbCache[ad.name]=INTERMediator_DBAdapter.db_query({name:ad.name,records:null,paging:null,fields:null,parentkeyvalue:null,conditions:null,useoffset:false})}if(Y===null){Z=INTERMediatorOnPage.dbCache[ad.name]}else{Z={recordset:[],count:0};U=0;for(V in INTERMediatorOnPage.dbCache[ad.name].recordset){ac=INTERMediatorOnPage.dbCache[ad.name].recordset[V];X=true;aa=0;for(W in Y){af=ad.relation[aa]["foreign-key"];if(ac[af]!=Y[W]){X=false;break}aa++}if(X){i=ad.paging?ad.paging:false;ae=ad.records?ad.records:10000000000;if(!i||(i&&(U>=INTERMediator.startFrom))){Z.recordset.push(ac);Z.count++;if(ae<=Z.count){break}}U++}}return Z}}catch(ab){if(ab=="_im_requath_request_"){throw ab}else{INTERMediator.setErrorMessage(ab,"EXCEPTION-24")}}}function g(W,V,U){try{if(INTERMediatorOnPage.additionalExpandingRecordFinish[W.name]){INTERMediatorOnPage.additionalExpandingRecordFinish[W.name](V);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingRecordFinish["+W.name+"] with the context.",2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-33: hint: post-repeater of "+W.name)}}try{if(INTERMediatorOnPage.expandingRecordFinish!=null){INTERMediatorOnPage.expandingRecordFinish(W.name,U);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingRecordFinish with the context: "+W.name,2)}if(W["post-repeater"]){INTERMediatorOnPage[W["post-repeater"]](U);INTERMediator.setDebugMessage("Call the post repeater method 'INTERMediatorOnPage."+W["post-repeater"]+"' with the context: "+W.name,2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-23")}}}function T(V,U){try{if(INTERMediatorOnPage.additionalExpandingEnclosureFinish[V.name]){INTERMediatorOnPage.additionalExpandingEnclosureFinish[V.name](U);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingEnclosureFinish["+V.name+"] with the context.",2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-32: hint: post-enclosure of "+V.name)}}try{if(INTERMediatorOnPage.expandingEnclosureFinish!=null){INTERMediatorOnPage.expandingEnclosureFinish(V.name,U);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingEnclosureFinish with the context: "+V.name,2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-21")}}try{if(V["post-enclosure"]){INTERMediatorOnPage[V["post-enclosure"]](U);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage."+V["post-enclosure"]+"' with the context: "+V.name,2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-22: hint: post-enclosure of "+V.name)}}}function v(V,U){try{if(V["post-query-stored"]){INTERMediatorOnPage[V["post-query-stored"]](U);INTERMediator.setDebugMessage("Call the post query stored method 'INTERMediatorOnPage."+V["post-enclosure"]+"' with the context: "+V.name,2)}}catch(i){if(i=="_im_requath_request_"){throw i}else{INTERMediator.setErrorMessage(i,"EXCEPTION-41: hint: post-query-stored of "+V.name)}}}function b(Y,U){var X,Z=[],W,V;W=Y.childNodes;for(X=0;X<W.length;X++){if(W[X].nodeType===1){if(W[X].tagName==U){Z.push(W[X])}else{if(U==null&&(W[X].getAttribute("data-im-control"))){V=W[X].getAttribute("data-im-control");if(V.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>-1||V.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>-1||V.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>-1||V.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>-1||V.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>-1){Z.push(W[X])}}else{if(U==null&&INTERMediatorLib.getClassAttributeFromNode(W[X])&&INTERMediatorLib.getClassAttributeFromNode(W[X]).match(/_im_repeater/)){V=INTERMediatorLib.getClassAttributeFromNode(W[X]);if(V.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>-1){Z.push(W[X])}}}}}}return Z}function t(Y){var W,Z=[],X,U,V;for(W=0;W<Y.length;W++){X=Y[W];U=Y[W].parentNode;V=Y[W].cloneNode(true);Z.push(V);V.setAttribute("id",z());if(U){U.removeChild(X)}}return Z}function B(X){var V=[],W,U,i;for(U=0;U<X.length;U++){W=INTERMediatorLib.getLinkedElementInfo(X[U]);if(W!==null){for(i=0;i<W.length;i++){V.push(W[i])}}}return V}function G(ad){var ab,af,V,Y,X,Z,ae,i,U,W=[],aa=[],ac=[];for(ab=0;ab<ad.length;ab++){af=INTERMediatorLib.getNodeInfoArray(ad[ab]);V=af.field;Y=af.table;i=af.tableindex;if(Y!=IMLibLocalContext.contextName){if(V!=null&&V.length!=0&&Y.length!=0&&Y!=null){if(!ac[i]){ac[i]=[]}ac[i].push(V);if(!aa[i]){aa[i]=1}else{++aa[i]}}else{INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1006,[ad[ab]]))}}}X=-1;Z="";for(ae in aa){if(X<aa[ae]){X=aa[ae];Z=ae.substring(10)}}U=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",Z);if(ad.length>0&&!U){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1046,[Z]))}for(ab=0;ab<ad.length;ab++){if(ad[ab].indexOf(Z)!==0&&ad[ab].indexOf("_@")!==0){W.push(ad[ab])}}if(ad.length>0&&U&&W.length>0){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1047,[Z,W.toString()]))}return{targettable:U,fieldlist:ac["_im_index_"+Z]}}function h(W){var V,U=[];for(V=0;V<W.length;V++){U.push(W[V].cloneNode(true))}return U}function q(ab,ad,Y,V,i){var U,W,aa,Z,X,ae,ac;ac=V.getContextDef();if(!ac["repeat-control"]||!ac["repeat-control"].match(/copy/i)){return}if(ac.paging==true){IMLibPageNavigation.deleteInsertOnNavi.push({kind:"COPY",name:ac.name,contextDef:ac,keyValue:i[ac.key]})}else{U=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(U,"IM_Button_Copy");ae=INTERMediatorOnPage.getMessages()[14];if(ac["button-names"]&&ac["button-names"]["copy"]){ae=ac["button-names"]["copy"]}U.appendChild(document.createTextNode(ae));W="IM_Button_"+INTERMediator.buttonIdNum;U.setAttribute("id",W);INTERMediator.buttonIdNum++;aa=function(ah,af){var ai=ah,ag=af;return function(){IMLibUI.copyButton(ai,ag)}};x.push({id:W,event:"click",todo:aa(V,i[ac.key])});switch(ab){case"TBODY":Z=Y[Y.length-1].getElementsByTagName("TD");X=Z[Z.length-1];X.appendChild(U);break;case"SELECT":break;default:if(Y[0]&&Y[0].childNodes){Y[Y.length-1].appendChild(U)}else{Y.push(U)}break}}}function M(ac,aa,U,W,X){var i,Y,V,ab,Z,ae,ad;ad=U.contextDefinition;if(!ad["repeat-control"]||!ad["repeat-control"].match(/delete/i)){return}if(ad.relation||ad.records===undefined||(ad.records>1&&Number(INTERMediator.pagedSize)!=1)){i=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(i,"IM_Button_Delete");ae=INTERMediatorOnPage.getMessages()[6];if(ad["button-names"]&&ad["button-names"]["delete"]){ae=ad["button-names"]["delete"]}i.appendChild(document.createTextNode(ae));Y="IM_Button_"+INTERMediator.buttonIdNum;i.setAttribute("id",Y);INTERMediator.buttonIdNum++;V=function(ag,af,am,al){var ah=ag,ak=af,aj=am,ai=al;return function(){IMLibUI.deleteButton(ah,ak,aj,ai)}};x.push({id:Y,event:"click",todo:V(U,W,X,ad["repeat-control"].match(/confirm-delete/i))});switch(ac){case"TBODY":ab=aa[aa.length-1].getElementsByTagName("TD");Z=ab[ab.length-1];Z.appendChild(i);break;case"SELECT":break;default:if(aa[0]&&aa[0].childNodes){aa[aa.length-1].appendChild(i)}else{aa.push(i)}break}}else{IMLibPageNavigation.deleteInsertOnNavi.push({kind:"DELETE",name:ad.name,key:W,value:X,confirm:ad["repeat-control"].match(/confirm-delete/i)})}}function J(V,aj,ai,aq){var W,al,am,Z,af,an,ap,ah,aa,ak,ae,ao,Y,U,ab,X,ad,ag,ac;X=ai.tagName;ac=V.getContextDef();if(ac["repeat-control"]&&ac["repeat-control"].match(/insert/i)){if(aq.length>0||!ac.paging||ac.paging===false){W=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(W,"IM_Button_Insert");ad=INTERMediatorOnPage.getMessages()[5];if(ac["button-names"]&&ac["button-names"]["insert"]){ad=ac["button-names"]["insert"]}W.appendChild(document.createTextNode(ad));ab="IM_Button_"+INTERMediator.buttonIdNum;W.setAttribute("id",ab);INTERMediator.buttonIdNum++;al=[];switch(X){case"TBODY":ag=false;ao="TFOOT";if(ac["repeat-control"].match(/top/i)){ao="THEAD";ag=true}am=ai.parentNode;ae=am.childNodes;Z=null;for(ak=0;ak<ae.length;ak++){if(ae[ak].tagName===ao){Z=ae[ak];break}}if(Z===null){Z=document.createElement(ao);am.appendChild(Z)}Y=INTERMediatorLib.getElementsByClassName(Z,"IM_Button_Insert");if(Y.length==0){af=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(af,"IM_Insert_TR");an=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(an,"IM_Insert_TD");n(af);if(ag&&Z.childNodes){Z.insertBefore(af,Z.childNodes[0])}else{Z.appendChild(af)}af.appendChild(an);an.appendChild(W);al=[af.getAttribute("id")]}break;case"UL":case"OL":ap=document.createElement("LI");Y=INTERMediatorLib.getElementsByClassName(ap,"IM_Button_Insert");if(Y.length==0){ap.appendChild(W);if(ac["repeat-control"].match(/top/i)){ai.insertBefore(ap,ai.firstChild)}else{ai.appendChild(ap)}}break;case"SELECT":break;default:ah=document.createElement("DIV");Y=INTERMediatorLib.getElementsByClassName(ah,"IM_Button_Insert");if(Y.length==0){ah.appendChild(W);if(ac["repeat-control"].match(/top/i)){ai.insertBefore(ah,ai.firstChild)}else{ai.appendChild(ah)}}break}aa=function(aA,az,ay,ax,av){var at=aA,au=az,i=ay,aw=ax,ar=av;return function(){IMLibUI.insertButton(V,aj,au,i,ar)}};INTERMediatorLib.addEvent(W,"click",aa(ac.name,aq,ai.getAttribute("id"),al,ac["repeat-control"].match(/confirm-insert/i)))}else{if(INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){U=ac.key?ac.key:"-recid"}else{U=ac.key?ac.key:"id"}IMLibPageNavigation.deleteInsertOnNavi.push({kind:"INSERT",name:ac.name,key:U,confirm:ac["repeat-control"].match(/confirm-insert/i)})}}}function Q(aa,Z,ad,V,am,ak,X){var W,ac,aj,aq,ae,ap,ah,an,al,ai,U,ag,ao,Y,ab;if(!ad["navi-control"]||!ad["navi-control"].match(/master/i)||aa=="SELECT"){return}Y=INTERMediator.isMobile||INTERMediator.isTablet;ah=ad["navi-control"].match(/hide/i);U=ah&&(ad.paging==true);if(INTERMediator.detailNodeOriginalDisplay){al=IMLibContextPool.getDetailContext();if(al){ai=al.enclosureNode;if(ai.tagName=="TBODY"){ai=ai.parentNode}INTERMediator.detailNodeOriginalDisplay=ai.style.display}}W=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(W,"IM_Button_Master");ag=INTERMediatorOnPage.getMessages()[12];if(ad["button-names"]&&ad["button-names"]["navi-detail"]){ag=ad["button-names"]["navi-detail"]}W.appendChild(document.createTextNode(ag));ac="IM_Button_"+INTERMediator.buttonIdNum;W.setAttribute("id",ac);INTERMediator.buttonIdNum++;an=IMLibContextPool.getMasterContext();an.setValue(V+"="+am,"_im_button_master_id",ac,ac);if(Y){ab=af(aa,V,am,ak,X,ah,U);for(ao=0;ao<Z.length;ao++){var ar=Z[ao].style.backgroundColor;x.push({id:Z[ao].id,event:"touchstart",todo:(function(){var i=Z[ao];return function(){IMLibEventResponder.touchEventCancel=false;i.style.backgroundColor=IMLibUI.mobileSelectionColor}})()});x.push({id:Z[ao].id,event:"touchend",todo:(function(){var at=Z[ao];var i=ar;return function(){at.style.backgroundColor=i;if(!IMLibEventResponder.touchEventCancel){IMLibEventResponder.touchEventCancel=false;ab()}}})()});x.push({id:Z[ao].id,event:"touchmove",todo:(function(){return function(){IMLibEventResponder.touchEventCancel=true}})()});x.push({id:Z[ao].id,event:"touchcancel",todo:(function(){return function(){IMLibEventResponder.touchEventCancel=true}})()})}}else{x.push({id:ac,event:"click",todo:af(aa,V,am,ak,X,ah,U)});switch(aa){case"TBODY":aj=Z[Z.length-1].getElementsByTagName("TD");aq=aj[0];ae=aq.childNodes[0];if(ae){aq.insertBefore(W,ae)}else{aq.appendChild(W)}break;case"SELECT":break;default:ae=Z[Z.length-1].childNodes[0];if(ae){Z[Z.length-1].insertBefore(W,ae)}else{Z[Z.length-1].appendChild(W)}break}}function af(aC,ax,az,av,aw,at,aF){var aA=ax,aE=az,i=av,ay=aw;var au={},aB=aC,aD=at,aG=aF;au[i]=ay;return function(){var aI,aH,aM,aL,aN,aK,aJ;aI=IMLibContextPool.getMasterContext();aH=IMLibContextPool.getDetailContext();if(aH){if(INTERMediatorOnPage.naviBeforeMoveToDetail){INTERMediatorOnPage.naviBeforeMoveToDetail(aI,aH)}ap=aH.getContextDef();aM=ap.name;INTERMediator.clearCondition(aM,"_imlabel_crosstable");INTERMediator.addCondition(aM,{field:aA,operator:"=",value:aE},undefined,"_imlabel_crosstable");INTERMediator.constructMain(aH);INTERMediator.clearCondition(aM);if(aD){INTERMediatorOnPage.masterScrollPosition={x:window.scrollX,y:window.scrollY};window.scrollTo(0,0);aL=aI.enclosureNode;if(aB=="TBODY"){aL=aL.parentNode}INTERMediator.masterNodeOriginalDisplay=aL.style.display;aL.style.display="none";aN=aH.enclosureNode;if(aN.tagName=="TBODY"){aN=aN.parentNode}aN.style.display=INTERMediator.detailNodeOriginalDisplay}if(aG){document.getElementById("IM_NAVIGATOR").style.display="none"}if(IMLibUI.mobileNaviBackButtonId){aJ=document.getElementById(IMLibUI.mobileNaviBackButtonId);aJ.style.display="inline-block"}if(INTERMediatorOnPage.naviAfterMoveToDetail){aI=IMLibContextPool.getMasterContext();aH=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToDetail(aI,aH)}}}}}function a(W,af){var X,ad,ah,ag,al,Z,aa,V,ac,Y,ai,ae,aj;Z=W.getContextDef();if(!Z["navi-control"]||!Z["navi-control"].match(/detail/i)){return}ag=IMLibContextPool.getMasterContext();al=ag.getContextDef()["navi-control"];if(!al||(!al.match(/hide/i))){return}V=ag.getContextDef()["paging"]==true;ac=Z["navi-control"].match(/update/i);Y=INTERMediator.isMobile||INTERMediator.isTablet;aj=!(Z["navi-control"].match(/bottom/i));aa=W.enclosureNode;if(aa.tagName=="TBODY"){aa=aa.parentNode}if(INTERMediator.detailNodeOriginalDisplay){INTERMediator.detailNodeOriginalDisplay=aa.style.display}aa.style.display="none";if(Y){ae=document.getElementsByClassName("IM_Button_BackNavi");if(!ae||ae.length==0){ai=ak("DIV",Z);IMLibUI.mobileNaviBackButtonId=ai.id;ai.style.display="none";ae=INTERMediatorLib.getElementsByAttributeValue(document.getElementsByTagName("BODY")[0],"data-role",aj?"header":"footer");if(ae&&ae[0]){if(ae[0].firstChild){ae[0].insertBefore(ai,ae[0].firstChild)}else{ae[0].appendChild(ai)}}else{switch(af.tagName){case"TBODY":ab(af,aj,ai);break;case"UL":case"OL":am(af,aj,"LI",ai);break;case"SELECT":break;default:am(af,aj,"DIV",ai);break}}INTERMediatorLib.addEvent(ai,"click",U(ag,W,V,ac))}}else{X=ak("BUTTON",Z);switch(af.tagName){case"TBODY":ab(af,aj,X);break;case"UL":case"OL":am(af,aj,"LI",X);break;case"SELECT":break;default:am(af,aj,"DIV",X);break}INTERMediatorLib.addEvent(X,"click",U(ag,W,V,ac))}function ak(ao,ap){var an,i;an=document.createElement(ao);INTERMediatorLib.setClassAttributeToNode(an,"IM_Button_BackNavi");i=INTERMediatorOnPage.getMessages()[13];if(ap["button-names"]&&ap["button-names"]["navi-back"]){i=ap["button-names"]["navi-back"]}an.appendChild(document.createTextNode(i));s(an);return an}function ab(ap,av,an){var i,ar,au,at,aw,ao,aq;i=av?"THEAD":"TFOOT";ar=ap.parentNode;au=ar.childNodes;at=null;for(ah=0;ah<au.length;ah++){if(au[ah].tagName===i){at=au[ah];break}}if(at===null){at=document.createElement(i);u.push({targetNode:at,parentNode:ar,siblingNode:(i=="THEAD")?ar.firstChild:null})}aw=INTERMediatorLib.getElementsByClassName(at,"IM_Button_BackNavi");if(aw.length==0){ao=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(ao,"IM_NaviBack_TR");aq=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(aq,"IM_NaviBack_TD");n(ao);at.appendChild(ao);ao.appendChild(aq);aq.appendChild(an)}}function am(aq,an,ap,i){var ao,ar;ao=document.createElement(ap);ar=INTERMediatorLib.getElementsByClassName(ad,"IM_Button_BackNavi");if(ar.length==0){ao.appendChild(i);if(!an){aq.appendChild(ao)}else{aq.insertBefore(ao,aq.firstChild)}}}function U(au,at,aq,ao){var ap=au,an=at,ar=aq,av=ao,i;return function(){var aw;if(INTERMediatorOnPage.naviBeforeMoveToMaster){INTERMediatorOnPage.naviBeforeMoveToMaster(ap,an)}aw=an.enclosureNode;if(aw.tagName=="TBODY"){aw=aw.parentNode}aw.style.display="none";aw=ap.enclosureNode;if(aw.tagName=="TBODY"){aw=aw.parentNode}aw.style.display=INTERMediator.masterNodeOriginalDisplay;if(ar){document.getElementById("IM_NAVIGATOR").style.display="block"}if(av){INTERMediator.constructMain(ap)}if(IMLibUI.mobileNaviBackButtonId){i=document.getElementById(IMLibUI.mobileNaviBackButtonId);i.style.display="none"}if(INTERMediatorOnPage.naviAfterMoveToMaster){ap=IMLibContextPool.getMasterContext();an=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToMaster(ap,an)}if(INTERMediatorOnPage.masterScrollPosition){window.scrollTo(INTERMediatorOnPage.masterScrollPosition.x,INTERMediatorOnPage.masterScrollPosition.y)}}}}function s(U){var i;i="IM_Button_"+INTERMediator.buttonIdNum;U.setAttribute("id",i);INTERMediator.buttonIdNum++}function P(W,Z,aa){var Y,X,ab,ac,V,U;if(W.nodeType==1){ab=INTERMediatorLib.getLinkedElementInfo(W);for(X=0;X<ab.length;X++){ac=INTERMediatorLib.getNodeInfoArray(ab[X]);if(ac.table==Z&&ac.field==aa){return W}}}V=W.childNodes;for(Y=0;Y<V.length;Y++){U=P(V[Y],Z,aa);if(U!==null){return U}}return null}function f(){var W,X,V,i,U,Y;if(document.getElementById("IM_CREDIT")===null){if(INTERMediatorOnPage.creditIncluding){W=document.getElementById(INTERMediatorOnPage.creditIncluding)}if(!W){W=document.getElementsByTagName("BODY")[0]}X=document.createElement("div");W.appendChild(X);X.setAttribute("id","IM_CREDIT");X.setAttribute("class","IM_CREDIT");V=document.createElement("div");X.appendChild(V);V.style.backgroundColor="#F6F7FF";V.style.height="2px";V.style.margin="0";V.style.padding="0";V=document.createElement("div");X.appendChild(V);V.style.backgroundColor="#EBF1FF";V.style.height="2px";V.style.margin="0";V.style.padding="0";V=document.createElement("div");X.appendChild(V);V.style.backgroundColor="#E1EAFF";V.style.height="2px";V.style.margin="0";V.style.padding="0";V=document.createElement("div");X.appendChild(V);V.setAttribute("align","right");V.style.backgroundColor="#D7E4FF";V.style.padding="2px";V.style.margin="0";V.style.padding="0";i=document.createElement("span");V.appendChild(i);V.style.color="#666666";V.style.fontSize="7pt";U=document.createElement("a");U.appendChild(document.createTextNode("INTER-Mediator"));U.setAttribute("href","http://inter-mediator.com/");U.setAttribute("target","_href");i.appendChild(document.createTextNode("Generated by "));i.appendChild(U);if(INTERMediatorOnPage.metadata){Y=" Ver."+INTERMediatorOnPage.metadata.version+"("+INTERMediatorOnPage.metadata.releasedate+")"}else{Y=" Ver. Development Now!"}i.appendChild(document.createTextNode(Y))}}},getLocalProperty:function(b,a){var c;c=IMLibLocalContext.getValue(b);return c===null?a:c},setLocalProperty:function(a,b){IMLibLocalContext.setValue(a,b,true)},addCondition:function(f,g,b,a){var e,d,c;if(b!=undefined){g.matching=!b}else{g.matching=INTERMediator_DBAdapter.eliminateDuplicatedConditions}if(a!=undefined){g.label=a}if(INTERMediator.additionalCondition){e=INTERMediator.additionalCondition;if(g){if(!e[f]){e[f]=[]}if(!g.matching){e[f].push(g)}else{c=false;for(d=0;d<e[f].length;d++){if(e[f][d].field==g.field&&e[f][d].operator==g.operator){c=true;e[f][d].value=g.value;break}}if(!c){e[f].push(g)}}}INTERMediator.additionalCondition=e}IMLibLocalContext.archive()},clearCondition:function(d,a){var b,c=INTERMediator.additionalCondition;if(a==undefined){if(c[d]){delete c[d];INTERMediator.additionalCondition=c;IMLibLocalContext.archive()}}else{if(c[d]){for(b=0;b<c[d].length;b++){if(c[d][b]["label"]==a){c[d].splice(b,1);b--}}INTERMediator.additionalCondition=c;IMLibLocalContext.archive()}}},addSortKey:function(c,a){var b=INTERMediator.additionalSortKey;if(b[c]){b[c].push(a)}else{b[c]=[a]}INTERMediator.additionalSortKey=b;IMLibLocalContext.archive()},clearSortKey:function(b){var a=INTERMediator.additionalSortKey;if(a[b]){delete a[b];INTERMediator.additionalSortKey=a;IMLibLocalContext.archive()}}};if(!Object.keys){Object.keys=function(b){var a=[],c;if(b!==Object(b)){throw new TypeError("Object.keys called on a non-object")}for(c in b){if(Object.prototype.hasOwnProperty.call(b,c)){a.push(c)}}return a}}if(!Array.indexOf){var isWebkit="WebkitAppearance" in document.documentElement.style;if(!isWebkit){Array.prototype.indexOf=function(b){var a;for(a=0;a<this.length;a++){if(this[a]===b){return a}}return -1}}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var IMLibElement={setValueToIMNode:function(b,o,m,k){var d,f,n,c,e,p,h=false,a,q,r,g=false,t;if(m===undefined){return false}if(!b){return false}if(m===null||m===false){m=""}a=b.tagName;t=b.getAttribute("data-im-control");if(k===true&&o==""){switch(a){case"INPUT":switch(b.getAttribute("type")){case"text":b.value="";break;default:break}break;case"SELECT":break;default:while(b.childNodes.length>0){if(b.parentNode.getAttribute("data-im-element")==="processed"||INTERMediatorLib.isWidgetElement(b.parentNode)){return false}b.removeChild(b.childNodes[0])}break}}if(o!=null&&o.length>0){if(o.charAt(0)=="#"){o=o.substring(1);if(o=="innerHTML"){if(INTERMediator.isIE&&a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}b.innerHTML+=m}else{if(o=="textNode"||o=="script"){p=document.createTextNode(m);if(a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}b.appendChild(p)}else{if(o.indexOf("style.")==0){d=o.substring(6,o.length);b.style[d]=m}else{f=b.getAttribute(o);if(m.indexOf("/fmi/xml/cnt/")===0&&f.indexOf("?media=")===-1){m=INTERMediatorOnPage.getEntryPath()+"?media="+m}b.setAttribute(o,f+m)}}}g=true}else{if(o.charAt(0)=="$"){o=o.substring(1);if(o=="innerHTML"){if(INTERMediator.isIE&&a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}b.innerHTML=b.innerHTML.replace("$",m)}else{if(o=="textNode"||o=="script"){if(a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}b.innerHTML=b.innerHTML.replace("$",m)}else{if(o.indexOf("style.")==0){d=o.substring(6,o.length);b.style[d]=m}else{f=b.getAttribute(o);m=String(m);if(m.indexOf("/fmi/xml/cnt/")===0&&f.indexOf("?media=")===-1){m=INTERMediatorOnPage.getEntryPath()+"?media="+m}b.setAttribute(o,f.replace("$",m))}}}g=true}else{if(INTERMediatorLib.isWidgetElement(b)){b._im_setValue(m)}else{if(o=="innerHTML"){if(INTERMediator.isIE&&a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}b.innerHTML=m}else{if(o=="textNode"){if(a=="TEXTAREA"){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}p=document.createTextNode(m);b.appendChild(p)}else{if(o=="script"){p=document.createTextNode(m);if(a=="SCRIPT"){b.appendChild(p)}else{n=document.createElement("script");n.type="text/javascript";n.appendChild(p);b.appendChild(n)}}else{if(o.indexOf("style.")==0){d=o.substring(6,o.length);b.style[d]=m}else{b.setAttribute(o,m)}}}}}}}}else{if(INTERMediatorLib.isWidgetElement(b)){b._im_setValue(m)}else{if(a=="INPUT"){c=b.getAttribute("type");if(c=="checkbox"||c=="radio"){e=b.value;q=m.toString().split(IMLib.nl_char);if(c=="checkbox"&&q.length>1){for(r=0;r<q.length;r++){if(e==q[r]&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){b.setAttribute("checked","checked")}else{b.checked=true}}}}else{if(e==m&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){b.setAttribute("checked","checked")}else{b.checked=true}}else{b.checked=false}}}else{b.value=m}}else{if(a=="SELECT"){h=true;b.value=m}else{if(a=="TEXTAREA"){if(INTERMediator.defaultTargetInnerHTML){if(INTERMediator.isIE){m=m.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br/>")}b.innerHTML=m}else{if(m.length>0&&INTERMediator.isTrident&&INTERMediator.ieVersion>=11){m=m.replace(/\r\n/g,IMLib.nl_char).replace(/\r/g,IMLib.nl_char)}b.value=m}}else{if(INTERMediator.defaultTargetInnerHTML){b.innerHTML=m}else{b.appendChild(document.createTextNode(m))}}}}}}if((a==="INPUT"||a==="SELECT"||a==="TEXTAREA")&&!g&&(!t||t.indexOf("unbind")>0)){var s=b.id;var l=b;INTERMediatorLib.addEvent(b,"blur",function(i){if(!IMLibUI.valueChange(s,true)&&this.id===s){l.focus()}})}b.setAttribute("data-im-element","processed");return h},getValueFromIMNode:function(c){var h,g,f,e,a,b,d;if(c){h=c.tagName;g=c.getAttribute("type")}else{return""}if(INTERMediatorLib.isWidgetElement(c)||(INTERMediatorLib.isWidgetElement(c.parentNode))){f=c._im_getValue()}else{if(h=="INPUT"){if(g=="checkbox"){if(INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){e=[];a=c.parentNode.getElementsByTagName("INPUT");for(b=0;b<a.length;b++){if(a[b].checked){e.push(a[b].getAttribute("value"))}}f=e.join(IMLib.nl_char)}else{d=c.getAttribute("value");if(c.checked){f=d}else{f=""}}}else{if(g=="radio"){f=c.value}else{f=c.value}}}else{if(h=="SELECT"){f=c.value}else{if(h=="TEXTAREA"){f=c.value}else{f=c.innerHTML}}}}return f},deleteNodes:function(n){var b,a,l,h,g,e,c,f,d,p,o;for(o=0;o<n.length;o++){b=document.getElementById(n[o]);if(b){a=INTERMediatorLib.getElementsByIMManaged(b);if(a){for(l=0;l<a.length;l++){e=a[l].id;if(e in IMLibCalc.calculateRequiredObject){delete IMLibCalc.calculateRequiredObject[e]}}for(l=0;l<a.length;l++){e=a[l].id;for(c in IMLibCalc.calculateRequiredObject){if(IMLibCalc.calculateRequiredObject.hasOwnProperty(c)){f=IMLibCalc.calculateRequiredObject[c];d={};p={};for(h in f.referes){if(f.referes.hasOwnProperty(h)){d[h]=[];p[h]=[];for(g=0;g<f.referes[h].length;g++){if(e!=f.referes[h][g]){d[h].push(f.referes[h][g]);p[h].push(f.values[h][g])}}}}f.referes=d;f.values=p}}}}try{b.parentNode.removeChild(b)}catch(m){}}}}};IMLibEventResponder={touchEventCancel:false,isSetup:false,setup:function(){var a;if(IMLibEventResponder.isSetup){return}IMLibEventResponder.isSetup=true;IMLibChangeEventDispatch=new IMLibEventDispatch();IMLibKeyEventDispatch=new IMLibEventDispatch();IMLibMouseEventDispatch=new IMLibEventDispatch();a=document.getElementsByTagName("BODY")[0];INTERMediatorLib.addEvent(a,"change",function(g){var d=g?g:window.event;if(!d){return}var f=d.target;if(!f){f=d.srcElement;if(!f){return}}var c=f.id;if(!c){return}var b=IMLibChangeEventDispatch.dispatchTable[c];if(!b){return}b(c)});INTERMediatorLib.addEvent(a,"keydown",function(h){var f,b,g,d;f=h?h:window.event;if(f.charCode){b=f.charCode}else{b=f.keyCode}if(!f){return}g=f.target;if(!g){g=f.srcElement;if(!g){return}}d=g.id;if(!d){return}if(!IMLibKeyEventDispatch.dispatchTable[d]){return}var c=IMLibKeyEventDispatch.dispatchTable[d][b];if(!c){return}c(f)});INTERMediatorLib.addEvent(a,"click",function(f){var b,g,c,m,h,d,l,k;b=f?f:window.event;if(!b){return}g=b.target;if(!g){g=b.srcElement;if(!g){return}}c=g.id;if(!c){return}m=IMLibMouseEventDispatch.dispatchTable[c];if(m){m(b);return}h=INTERMediatorLib.getLinkedElementInfo(g);for(d=0;d<h.length;d++){m=IMLibMouseEventDispatch.dispatchTableTarget[h[d]];if(m){l=INTERMediatorLib.getNodeInfoArray(h[d]);if(l.target){k=g.getAttribute(l.target)}else{k=IMLibElement.getValueFromIMNode(g)}m(k,g);return}}})}};var IMLibChangeEventDispatch;var IMLibKeyEventDispatch;var IMLibMouseEventDispatch;function IMLibEventDispatch(){this.dispatchTable={};this.dispatchTableTarget={};this.clearAll=function(){this.dispatchTable={};this.dispatchTableTarget={}};this.setExecute=function(b,a){if(b&&a){this.dispatchTable[b]=a}};this.setTargetExecute=function(b,a){if(b&&a){this.dispatchTableTarget[b]=a}};this.setExecuteByCode=function(c,b,a){if(c&&b){if(!this.dispatchTable[c]){this.dispatchTable[c]={}}this.dispatchTable[c][b]=a}}}var IMLibContextPool={poolingContexts:null,clearAll:function(){this.poolingContexts=null},registerContext:function(a){if(this.poolingContexts==null){this.poolingContexts=[a]}else{this.poolingContexts.push(a)}},excludingNode:null,synchronize:function(a,c,n,m,g,k){var e,d,l,f,h,o=[],b;l=a.viewName;if(this.poolingContexts==null){return null}if(k){for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].binding[c][n][k]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined&&this.poolingContexts[e].store[c][n][k]!==undefined){this.poolingContexts[e].store[c][n][k]=m;h=this.poolingContexts[e].binding[c][n][k];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);if(f){IMLibElement.setValueToIMNode(f,h[d].target,m,true);o.push(h[d].id)}}}}}else{for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined){this.poolingContexts[e].store[c][n]=m;h=this.poolingContexts[e].binding[c][n];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);b=h[d].id;if(h[d].target&&h[d].target.length>0){b+=INTERMediator.separator+h[d].target}if(f&&!(b in IMLibCalc.calculateRequiredObject)){IMLibElement.setValueToIMNode(f,h[d].target,m,true);o.push(h[d].id)}}}}}return o},getContextInfoFromId:function(a,g){var d,b,e,f,h,c,k=null;if(!a){return k}e=document.getElementById(a);if(!e){return k}f=INTERMediatorLib.getLinkedElementInfo(e);if(!f&&INTERMediatorLib.isWidgetElement(e.parentNode)){f=INTERMediatorLib.getLinkedElementInfo(e.parentNode)}h=INTERMediatorLib.getNodeInfoArray(f[0]);c=g===""?"_im_no_target":g;if(this.poolingContexts===null){return null}for(d=0;d<this.poolingContexts.length;d++){b=this.poolingContexts[d];if(b.contextInfo[a]&&b.contextInfo[a][c]&&b.contextInfo[a][c].context.contextName==h.table){k=b.contextInfo[a][c];return k}}return null},getKeyFieldValueFromId:function(a,d){var b=this.getContextInfoFromId(a,d);if(!b){return null}var f=b.context.contextName;var c=IMLibContextPool.getContextDef(f);if(!c){return null}var e=c.key?c.key:"id";return b.record.substr(e.length+1)},updateContext:function(a,d){var b,c;b=IMLibContextPool.getContextInfoFromId(a,d);c=IMLibElement.getValueFromIMNode(document.getElementById(a));if(b){b.context.setValue(b.record,b.field,c,false,d,b.portal)}},getContextFromEnclosure:function(a){var b;for(b=0;b<this.poolingContexts.length;b++){if(this.poolingContexts[b].enclosureNode===a){return this.poolingContexts[b]}}},contextFromEnclosureId:function(a){var b,c;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){c=this.poolingContexts[b].enclosureNode;if(c.getAttribute("id")==a){return this.poolingContexts[b]}}return null},contextFromName:function(a){var b;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){if(this.poolingContexts[b].contextName==a){return this.poolingContexts[b]}}return null},getContextFromName:function(b){var c,a=[];if(!b){return false}for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].contextName==b){a.push(this.poolingContexts[c])}}return a},getContextsFromNameAndForeignValue:function(b,c,e){var d,a=[];if(!b){return false}for(d=0;d<this.poolingContexts.length;d++){if(this.poolingContexts[d].contextName==b&&this.poolingContexts[d].foreignValue[e]==c){a.push(this.poolingContexts[d])}}return a},dependingObjects:function(b){var d,c,a=[];if(!b){return false}for(d=0;d<this.poolingContexts.length;d++){for(c=0;c<this.poolingContexts[d].dependingObject.length;c++){if(this.poolingContexts[d].dependingObject[c]==b){a.push(this.poolingContexts[d])}}}return a.length==0?false:a},getChildContexts:function(b){var c,a=[];for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].parentContext==b){a.push(this.poolingContexts[c])}}return a},childContexts:null,removeContextsFromPool:function(d){var a,c=[],b=[];for(a=0;a<this.poolingContexts.length;a++){if(d.indexOf(this.poolingContexts[a])>-1){c.push(this.poolingContexts[a].registeredId);b.push(a)}}for(a=b.length-1;a>-1;a--){this.poolingContexts.splice(b[a],1)}return c},removeRecordFromPool:function(q){var g,f,n,l=[],c,h,d,p,b,o,a,m,e;a=k(q);if(a==null){return}m=this.getContextsWithSameOrigin(a.context);c=a.key;for(g=0;g<m.length;g++){h=m[g].binding[c];for(n in h){if(h.hasOwnProperty(n)){for(f=0;f<h[n].length;f++){if(l.indexOf(h[n][f].id)<0){l.push(h[n][f].id)}}}}if(INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){d=Object.keys(a.context.binding)[0];p=c.split("=")[1];if(m[g].binding[d]&&m[g].binding[d]["_im_repeater"]&&m[g].binding[d]["_im_repeater"][p]&&m[g].binding[d]["_im_repeater"][p][0]){l.push(m[g].binding[d]["_im_repeater"][p][0].id)}}}o=[];for(g=0;g<m.length;g++){for(b in m[g].contextInfo){if(m[g].contextInfo.hasOwnProperty(b)){if(l.indexOf(b)>=0){delete a.context.contextInfo[b];o.push(b)}}}delete m[g].binding[c];delete m[g].store[c]}e=o.length;IMLibElement.deleteNodes(o);this.poolingContexts=this.poolingContexts.filter(function(i){return l.indexOf(i.enclosureNode.id)<0});return e;function k(u){var s,v,r,w,t;for(s=0;s<IMLibContextPool.poolingContexts.length;s++){for(w in IMLibContextPool.poolingContexts[s].binding){if(IMLibContextPool.poolingContexts[s].binding.hasOwnProperty(w)){for(v in IMLibContextPool.poolingContexts[s].binding[w]){if(IMLibContextPool.poolingContexts[s].binding[w].hasOwnProperty(v)&&v=="_im_repeater"){for(r=0;r<IMLibContextPool.poolingContexts[s].binding[w][v].length;r++){if(u==IMLibContextPool.poolingContexts[s].binding[w][v][r].id){return({context:IMLibContextPool.poolingContexts[s],key:w})}}if(INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){for(t in IMLibContextPool.poolingContexts[s].binding[w][v]){for(r=0;r<IMLibContextPool.poolingContexts[s].binding[w][v][t].length;r++){if(u==IMLibContextPool.poolingContexts[s].binding[w][v][t][r].id){return({context:IMLibContextPool.poolingContexts[s],key:"-recid="+t})}}}}}}}}}return null}},getContextsWithSameOrigin:function(a){var b,e=[],c,d=false;c=IMLibContextPool.getContextDef(a.contextName);if(c&&c.relation){for(b in c.relation){if(c.relation.hasOwnProperty(b)&&c.relation[b]["portal"]){d=true;break}}}for(b=0;b<IMLibContextPool.poolingContexts.length;b++){if(IMLibContextPool.poolingContexts[b].sourceName==a.sourceName){if(!d||a.parentContext!=IMLibContextPool.poolingContexts[b]){e.push(IMLibContextPool.poolingContexts[b])}}}return e},updateOnAnotherClient:function(l,a){var g,f,e,n=a.entity,h,o,d,b;if(l=="update"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){d=h.key;b=d+"="+a.pkvalue;this.poolingContexts[g].setValue(b,a.field[0],a.value[0]);var c=this.poolingContexts[g].binding[b][a.field[0]];for(f=0;f<c.length;f++){var m=IMLibContextPool.dependingObjects(c[f].id);for(e=0;e<m.length;e++){m[e].foreignValue={};m[e].foreignValue[a.field[0]]=a.value[0];if(m[e]){INTERMediator.constructMain(m[e])}}}}}IMLibCalc.recalculation()}else{if(l=="create"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){if(this.poolingContexts[g].isContaining(a.value[0])){INTERMediator.constructMain(this.poolingContexts[g],a.value)}}}IMLibCalc.recalculation()}else{if(l=="delete"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){this.poolingContexts[g].removeEntry(a.pkvalue)}}IMLibCalc.recalculation()}}}},getMasterContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/master/)){return this.poolingContexts[a]}}return null},getDetailContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/detail/)){return this.poolingContexts[a]}}return null},getContextDef:function(a){return INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",a)},getContextFromNodeId:function(c){var f,a,g,b,d,h,e,k;if(!this.poolingContexts){return null}for(f=0;f<this.poolingContexts.length;f++){a=this.poolingContexts[f];g=a.getContextDef();e=false;if(g.relation){for(b in g.relation){if(g.relation[b][portal]){e=true}}}for(b in a.binding){for(d in a.binding[b]){if(e){for(h in a.binding[b][d]){k=a.binding[b][d][h];if(k.nodeId==c){return a}}}else{k=a.binding[b][d];if(k.nodeId==c){return a}}}}}return null},getContextFromEnclosureNode:function(a){var c,b;if(!this.poolingContexts){return null}for(c=0;c<this.poolingContexts.length;c++){b=this.poolingContexts[c];if(b.enclosureNode==a){return b}}return null},generateContextObject:function(b,d,e,a){var c=new IMLibContext(b.name);c.contextDefinition=b;c.enclosureNode=d;c.repeaterNodes=e;c.original=a;c.sequencing=true;return c}};var IMLibContext=function(a){this.contextName=a;this.tableName=null;this.viewName=null;this.sourceName=null;this.contextDefinition=null;this.store={};this.binding={};this.contextInfo={};this.modified={};this.recordOrder=[];this.pendingOrder=[];IMLibContextPool.registerContext(this);this.foreignValue={};this.enclosureNode=null;this.repeaterNodes=null;this.dependingObject=[];this.original=null;this.nullAcceptable=true;this.parentContext=null;this.registeredId=null;this.sequencing=false;this.dependingParentObjectInfo=null;this.isPortal=false;this.potalContainingRecordKV=null;this.setTable(this)};IMLibContext.prototype.updateFieldValue=function(p,h,l,r,d){var o,m,a,q,c,g;q=document.getElementById(p);a=INTERMediatorLib.getLinkedElementInfo(q);o=INTERMediatorLib.getNodeInfoArray(a[0]);m=IMLibContextPool.getContextInfoFromId(p,o.target);if(INTERMediator.ignoreOptimisticLocking){IMLibContextPool.updateContext(p,o.target);g=IMLibElement.getValueFromIMNode(q);if(g!==null){c=m.record.split("=");INTERMediatorOnPage.retrieveAuthInfo();if(m.context.isPortal){c=m.context.potalContainingRecordKV.split("=");INTERMediator_DBAdapter.db_update_async({name:m.context.parentContext.contextName,conditions:[{field:c[0],operator:"=",value:c[1]}],dataset:[{field:m.field+"."+m.record.split("=")[1],value:g}]},h,l)}else{c=m.record.split("=");INTERMediator_DBAdapter.db_update_async({name:m.context.contextName,conditions:[{field:c[0],operator:"=",value:c[1]}],dataset:[{field:m.field,value:g}]},h,l)}}}else{var f=m.context;var b=f.parentContext;var k=m.field;var i=(f.isPortal?f.potalContainingRecordKV:m.record).split("=");var n=i[0];i.shift();var e=i.join("=");INTERMediator_DBAdapter.db_query_async({name:f.isPortal?b.contextName:f.contextName,records:1,paging:false,fields:[m.field],parentkeyvalue:null,conditions:[{field:n,operator:"=",value:e}],useoffset:false,primaryKeyOnly:true},(function(){var x=k;var w=m;var y=f;var z=q;var v=o;var u=p;return function(L){var C,B,G,D,K=[],A,H,E,I,J;if(y.isPortal){A=y.getPortalRecordsetImpl(L.dbresult[0],y.contextName);E=y.getKeyField();I=w.record.split("=");for(H=0;H<A.length;H++){if(A[H][E]==I[1]){K.push(A[H]);break}}}else{K=L.dbresult}if(!K||!K[0]||K[0][x]===undefined){l();return}if(L.resultCount>1){if(!r()){return}}if(y.isPortal){for(var F=0;F<K.length;F++){if(K[F]["-recid"]===m.record.split("=")[1]){D=K[F][x];break}}C=y.getValue(Object.keys(b.store)[0],x,"-recid="+K[F]["-recid"])}else{D=K[0][x];C=y.getValue(w.record,x)}G=s(C,D);if(z.tagName=="INPUT"&&z.getAttribute("type")=="checkbox"){if(C==z.value){G=false}else{if(!parseInt(D)){G=false}else{G=true}}}if(G){B=IMLibElement.getValueFromIMNode(z);if(!d(C,B,D)){return}INTERMediatorOnPage.retrieveAuthInfo()}IMLibContextPool.updateContext(u,v.target);B=IMLibElement.getValueFromIMNode(z);if(B!=null){INTERMediatorOnPage.retrieveAuthInfo();if(y.isPortal){J=y.potalContainingRecordKV.split("=");INTERMediator_DBAdapter.db_update_async({name:y.parentContext.contextName,conditions:[{field:J[0],operator:"=",value:J[1]}],dataset:[{field:w.field+"."+w.record.split("=")[1],value:B}]},h,l)}else{J=w.record.split("=");INTERMediator_DBAdapter.db_update_async({name:y.contextName,conditions:[{field:J[0],operator:"=",value:J[1]}],dataset:[{field:m.field,value:B}]},h,l)}}}})(),function(){INTERMediatorOnPage.hideProgress();INTERMediator.setErrorMessage("Error in valueChange method.","EXCEPTION-1");IMLibUI.clearLockInfo()})}var t=["0000-00-00","0000-00-00 00:00:00"];function s(v,u){if(t.indexOf(v)){v=""}if(t.indexOf(u)){u=""}return v!=u}};IMLibContext.prototype.getKeyField=function(){var a;if(INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){if(this.isPortal){a="-recid"}else{a=this.contextDefinition.key?this.contextDefinition.key:"-recid"}}else{a=this.contextDefinition.key?this.contextDefinition.key:"id"}return a};IMLibContext.prototype.getCalculationFields=function(){var a=this.contextDefinition.calculation;var c=[],b;for(b in a){if(a.hasOwnProperty(b)){c.push(a[b]["field"])}}return c};IMLibContext.prototype.isUseLimit=function(){var a=false;if(this.contextDefinition.records&&this.contextDefinition.paging){a=true}return a};IMLibContext.prototype.getPortalRecords=function(){var a={};if(!this.isPortal){return null}a.recordset=this.getPortalRecordsetImpl(this.parentContext.store[this.potalContainingRecordKV],this.contextName);return a};IMLibContext.prototype.getPortalRecordsetImpl=function(b,g){var a,e,f,c,d;f=[];if(b[0]){if(!b[0][g]){for(c in b[0]){d=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c);if(g===d.view&&!b[0][g]){g=c;break}}}if(b[0][g]){a=b[0][g];for(e in a){if(a.hasOwnProperty(e)&&isFinite(e)){f.push(a[e])}}}}return f};IMLibContext.prototype.getRecordNumber=function(){var a;if(this.contextDefinition["navi-control"]&&this.contextDefinition["navi-control"]==="detail"){a=1}else{if(this.contextDefinition.maxrecords){if(parseInt(INTERMediator.pagedSize,10)===0){if(this.contextDefinition.records){a=parseInt(this.contextDefinition.records,10)}else{a=parseInt(this.contextDefinition.maxrecords,10)}}else{if(parseInt(this.contextDefinition.maxrecords,10)<parseInt(INTERMediator.pagedSize,10)){if(parseInt(this.contextDefinition.maxrecords,10)<parseInt(this.contextDefinition.records,10)){a=parseInt(this.contextDefinition.records,10)}else{a=parseInt(this.contextDefinition.maxrecords,10)}}else{if(this.contextDefinition.relation||this.contextDefinition.paging!==true){a=parseInt(this.contextDefinition.records,10)}else{a=parseInt(INTERMediator.pagedSize,10)}}}}else{if(parseInt(INTERMediator.pagedSize,10)===0||(parseInt(this.contextDefinition.records,10)<parseInt(INTERMediator.pagedSize,10))){a=parseInt(this.contextDefinition.records,10)}else{if(this.contextDefinition.relation||this.contextDefinition.paging!==true){a=parseInt(this.contextDefinition.records,10)}else{a=parseInt(INTERMediator.pagedSize,10)}}}if(!this.contextDefinition.relation&&this.contextDefinition.paging&&Boolean(this.contextDefinition.paging)===true){INTERMediator.setLocalProperty("_im_pagedSize",a)}}return a};IMLibContext.prototype.setRelationWithParent=function(a,f,e){var k,d,b,h,c;this.parentContext=e;if(a){try{k=this.contextDefinition.relation;if(k){for(d in k){if(Boolean(k[d].portal)===true){this.isPortal=true;this.potalContainingRecordKV="-recid="+a["-recid"]}b=k[d]["join-field"];this.addForeignValue(b,a[b]);for(h in f){if(h==k[d]["join-field"]){for(c=0;c<f[h].length;c++){this.addDependingObject(f[h][c])}this.dependingParentObjectInfo=JSON.parse(JSON.stringify(f))}}}}}catch(g){if(g=="_im_requath_request_"){throw g}else{INTERMediator.setErrorMessage(g,"EXCEPTION-25")}}}};IMLibContext.prototype.getInsertOrder=function(b){var a,g=[],f,e,d=[],c=[];for(a in INTERMediator.additionalSortKey){if(a==this.contextName){g.push(INTERMediator.additionalSortKey[a])}}f=this.getContextDef();if(f.sort){g.push(f.sort)}for(e=0;e<g.length;e++){if(d.indexOf(g[e].field)<0){d.push(g[e].field);c.push(g[e].direction)}}};IMLibContext.prototype.indexingArray=function(e){var c=[],d,a,b=0;for(d in this.store){a=d.split("=");c[b]=this.store[d][e];b+=1}return c};IMLibContext.prototype.clearAll=function(){this.store={};this.binding={}};IMLibContext.prototype.setContextName=function(a){this.contextName=a};IMLibContext.prototype.getContextDef=function(){return INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",this.contextName)};IMLibContext.prototype.setTableName=function(a){this.tableName=a};IMLibContext.prototype.setViewName=function(a){this.viewName=a};IMLibContext.prototype.addDependingObject=function(a){this.dependingObject.push(a)};IMLibContext.prototype.addForeignValue=function(b,a){this.foreignValue[b]=a};IMLibContext.prototype.setOriginal=function(b){var a;this.original=[];for(a=0;a<b.length;a++){this.original.push(b[a].cloneNode(true))}};IMLibContext.prototype.setTable=function(a){var b;if(!a||!INTERMediatorOnPage.getDataSources){this.tableName=this.contextName;this.viewName=this.contextName;this.sourceName=this.contextName;return}b=this.getContextDef();if(b){this.viewName=b.view?b.view:b.name;this.tableName=b.table?b.table:b.name;this.sourceName=(b.source?b.source:(b.table?b.table:(b.view?b.view:b.name)))}};IMLibContext.prototype.removeContext=function(){var c=[],b=[];a(this);c=IMLibContextPool.removeContextsFromPool(b);while(this.enclosureNode.firstChild){this.enclosureNode.removeChild(this.enclosureNode.firstChild)}INTERMediator_DBAdapter.unregister(c);function a(f){var e,d;b.push(f);c.push(f.registeredId);d=IMLibContextPool.getChildContexts(f);for(e=0;e<d.length;e++){a(d[e])}}};IMLibContext.prototype.setModified=function(c,a,b){if(this.modified[c]===undefined){this.modified[c]={}}this.modified[c][a]=b};IMLibContext.prototype.getModified=function(){return this.modified};IMLibContext.prototype.clearModified=function(){this.modified={}};IMLibContext.prototype.getContextDef=function(){var a;a=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",this.contextName);return a};IMLibContext.prototype.checkOrder=function(k,o){var c,f=[],l=[],p,h,d,n,g,a,b,e,m;if(o!==true){if(INTERMediator&&INTERMediator.additionalSortKey[this.contextName]){for(c=0;c<INTERMediator.additionalSortKey[this.contextName].length;c++){p=INTERMediator.additionalSortKey[this.contextName][c];if(!(p.field in f)){f.push(p.field);l.push(p.direction)}}}h=this.getContextDef();if(h&&h.sort){for(c=0;c<h.sort.length;c++){p=h.sort[c];if(!(p.field in f)){f.push(p.field);l.push(p.direction)}}}}else{f=["field1","field2"]}d=0;n=this.recordOrder.length;for(c=0;c<f.length;c++){if(k[f[c]]){g=parseInt((n+d)/2);do{a=this.store[this.recordOrder[g]];b=a[f[c]];e=k[f[c]];if(b<e){d=g}else{if(b>e){n=g}else{d=n=g}}g=parseInt((n+d)/2)}while(n-d>1);a=this.store[this.recordOrder[g]];b=a[f[c]];if(b==e){d=n=g;m=false;do{a=this.store[this.recordOrder[d-1]];if(a&&a[f[c]]&&a[f[c]]==e){d--}else{m=true}}while(!m);m=false;do{a=this.store[this.recordOrder[n+1]];if(a&&a[f[c]]&&a[f[c]]==e){n++}else{m=true}}while(!m);if(d==n){break}n++}else{if(b<e){break}else{if(b>e){g--;break}}}}}if(o===true){console.log("#lower="+d+",upper="+n+",index="+g+",contextValue="+b+",checkingValue="+e)}return g};IMLibContext.prototype.rearrangePendingOrder=function(d){var c,b,a;for(c=0;c<this.pendingOrder.length;c++){a=this.store[this.pendingOrder[c]];b=this.checkOrder(a,d);if(b>=-1){this.recordOrder.splice(b+1,0,this.pendingOrder[c])}else{}}this.pendingOrder=[]};IMLibContext.prototype.getRepeaterEndNode=function(h){var b,l,f=[],k,d,e,g,a;var c=this.recordOrder[h];for(l in this.binding[c]){b=this.binding[c][l].nodeId;k=INTERMediatorLib.getParentRepeater(document.getElementById(b));if(!(k in f)){f.push(k)}}if(f.length<1){return null}d=f[0];g=INTERMediatorLib.getParentEnclosure(d);a=g.childNodes;for(e=0;e<a.length;e++){if(a[e] in f){d=f[e];break}}return d};IMLibContext.prototype.storeRecords=function(c){var b,a,f,g,e;var d=d=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",this.contextName);g=d.key?d.key:"id";if(c.recordset){for(b=0;b<c.recordset.length;b++){a=c.recordset[b];for(f in a){e=a[g]?a[g]:b;this.setValue(g+"="+e,f,a[f])}}}};IMLibContext.prototype.getDataAtLastRecord=function(b){var a;var c=Object.keys(this.store);if(c.length>0){a=c[c.length-1];return this.getValue(a,b)}return undefined};IMLibContext.prototype.setDataAtLastRecord=function(b,d){var a,c;var e=Object.keys(this.store);if(e.length>0){a=e[e.length-1];this.setValue(a,b,d);c=a.split("=");INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:c[0],operator:"=",value:c[1]}],dataset:[{field:b,value:d}]});IMLibCalc.recalculation();INTERMediator.flushMessage()}};IMLibContext.prototype.setDataWithKey=function(d,c,f){var a,e,b;e=this.getContextDef();if(!e){return}a=e.key+"="+d;b=this.store[a];if(b){this.setValue(a,c,f);INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:e.key,operator:"=",value:d}],dataset:[{field:c,value:f}]});INTERMediator.flushMessage()}};IMLibContext.prototype.setValue=function(g,b,d,f,e,a){var c=null;if(a){console.error("Using the portal parameter in IMLibContext.setValue")}if(g!=undefined&&g!=null){if(this.store[g]===undefined){this.store[g]={}}if(a&&this.store[g][b]===undefined){this.store[g][b]={}}if(this.binding[g]===undefined){this.binding[g]={};if(this.sequencing){this.recordOrder.push(g)}else{this.pendingOrder.push(g)}}if(this.binding[g][b]===undefined){this.binding[g][b]=[]}if(a&&this.binding[g][b][a]===undefined){if(this.binding[g][b].length<1){this.binding[g][b]={}}this.binding[g][b][a]=[]}if(b!=undefined&&b!=null){if(a){this.store[g][b]=d}else{this.store[g][b]=d}if(f){if(a){this.binding[g][b].push({id:f,target:e})}else{this.binding[g][b].push({id:f,target:e})}if(this.contextInfo[f]===undefined){this.contextInfo[f]={}}this.contextInfo[f][e==""?"_im_no_target":e]={context:this,record:g,field:b};if(a){this.contextInfo[f][e==""?"_im_no_target":e].portal=a}}else{if(INTERMediator.partialConstructing){c=IMLibContextPool.synchronize(this,g,b,d,e,a)}}}}return c};IMLibContext.prototype.getValue=function(e,c,a){var d;try{if(a){d=this.store[a][c]}else{d=this.store[e][c]}if(Array.isArray(d)){d=d.join()}return d===undefined?null:d}catch(b){return null}};IMLibContext.prototype.isValueUndefined=function(g,d,a){var f,c,e;try{if(a){c=d.split("::")[0];e=a.split("=")[1];f=this.store[g][0][c][e][d]}else{f=this.store[g][d]}return f===undefined?true:false}catch(b){return null}};IMLibContext.prototype.getContextInfo=function(d,c){try{var b=this.contextInfo[d][c==""?"_im_no_target":c];return b===undefined?null:b}catch(a){return null}};IMLibContext.prototype.getContextValue=function(e,d){try{var c=this.contextInfo[e][d==""?"_im_no_target":d];var b=c.context.getValue(c.record,c.field);return b===undefined?null:b}catch(a){return null}};IMLibContext.prototype.getContextRecord=function(e){var d,c,b;try{d=this.contextInfo[e];c=Object.keys(d);for(b=0;b<c.length;b++){if(d[c[b]]){return this.store[d[c[b]].record]}}return null}catch(a){return null}};IMLibContext.prototype.removeEntry=function(b){var c,g,a,f,h,l,d,e,k=[];f=this.getContextDef();c=f.key;g=c+"="+b;a=this.binding[g];if(a){l=a._im_repeater;if(l){for(d=0;d<l.length;d++){k.push(l[d].id)}}}if(k.length>0){for(d=0;d<k.length;d++){IMLibContextPool.removeRecordFromPool(k[d])}for(d=0;d<k.length;d++){h=document.getElementById(k[d]);if(h){e=INTERMediatorLib.getParentRepeater(h);if(e){e.parentNode.removeChild(h)}}}}};IMLibContext.prototype.isContaining=function(h){var f,c,n=[],e,l,o,m,b,k,g,a;f=this.getContextDef();c=f.name;if(f.query){for(e in f.query){n.push(d(f.query[e],h))}}if(INTERMediator.additionalCondition[c]){for(e=0;e<INTERMediator.additionalCondition[c].length;e++){n.push(d(INTERMediator.additionalCondition[c][e],h))}}o=true;if(n.length!=0){m=n.indexOf("D");if(m>-1){b=n.slice(0,m);k=m.slice(m+1);if(k.length==0){o=(b.indexOf(false)<0)}else{g=(b.indexOf(false)<0);a=(k.indexOf(false)<0);o=g||a}}else{m=n.indexOf("EX");if(m>-1){b=n.slice(0,m);k=m.slice(m+1);if(k.length==0){o=(b.indexOf(true)>-1)}else{g=(b.indexOf(true)>-1);a=(k.indexOf(true)>-1);o=g&&a}}else{m=n.indexOf(false);if(m>-1){o=(n.indexOf(false)<0)}}}if(o==false){return false}}if(this.foreignValue){for(l in this.foreignValue){if(f.relation){for(e in f.relation){if(f.relation[e]["join-field"]==l){o&=(d({field:f.relation[e]["foreign-key"],operator:"=",value:this.foreignValue[l]},h))}}}}}return o;function d(p,i){var q;if(p.field=="__operation__"){return p.operator=="ex"?"EX":"D"}q=i[p.field];if(!q){return false}switch(p.operator){case"=":case"eq":return q==p.value;case">":case"gt":return q>p.value;case"<":case"lt":return q<p.value;case">=":case"gte":return q>=p.value;case"<=":case"lte":return q<=p.value;case"!=":case"neq":return q!=p.value;default:return false}}};IMLibContext.prototype.insertEntry=function(f,a,b){var c,e,d;for(c=0;c<a.length;c++){e=a[c];d=b[c];this.setValue(f,e,d)}};var IMLibLocalContext={contextName:"_",store:{},binding:{},clearAll:function(){this.store={}},setValue:function(d,g,b){var c,f,a,e;f=false;if(d!=undefined&&d!=null){if(g===undefined||g===null){delete this.store[d]}else{this.store[d]=g;f=true;a=this.binding[d];if(a){for(c=0;c<a.length;c++){e=document.getElementById(a[c]);IMLibElement.setValueToIMNode(e,"",g,true)}}}}if(f&&!(b===true)){this.archive()}},getValue:function(a){var b=this.store[a];return b===undefined?null:b},archive:function(){var f,e,d,b,a;INTERMediatorOnPage.removeCookie("_im_localcontext");if(INTERMediator.isIE&&INTERMediator.ieVersion<9){this.store._im_additionalCondition=INTERMediator.additionalCondition;this.store._im_additionalSortKey=INTERMediator.additionalSortKey;this.store._im_startFrom=INTERMediator.startFrom;this.store._im_pagedSize=INTERMediator.pagedSize;f=JSON.stringify(this.store,function(h,g){return g===""?"":g})}else{f=JSON.stringify(this.store)}if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{d=location.search?location.search.length:0;b=location.hash?location.hash.length:0;a=d+b;e="_im_localcontext"+document.URL.toString();e=(a>0)?e.slice(0,-a):e;sessionStorage.setItem(e,f)}catch(c){INTERMediatorOnPage.setCookieWorker("_im_localcontext",f,false,0)}}else{INTERMediatorOnPage.setCookieWorker("_im_localcontext",f,false,0)}},unarchive:function(){var f="",e,b,d,a;if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{e=location.search?location.search.length:0;b=location.hash?location.hash.length:0;a=e+b;d="_im_localcontext"+document.URL.toString();d=(a>0)?d.slice(0,-a):d;f=sessionStorage.getItem(d)}catch(c){f=INTERMediatorOnPage.getCookie("_im_localcontext")}}else{f=INTERMediatorOnPage.getCookie("_im_localcontext")}if(f&&f.length>0){this.store=JSON.parse(f);if(INTERMediator.isIE&&INTERMediator.ieVersion<9){if(this.store._im_additionalCondition){INTERMediator.additionalCondition=this.store._im_additionalCondition}if(this.store._im_additionalSortKey){INTERMediator.additionalSortKey=this.store._im_additionalSortKey}if(this.store._im_startFrom){INTERMediator.startFrom=this.store._im_startFrom}if(this.store._im_pagedSize){INTERMediator.pagedSize=this.store._im_pagedSize}}this.updateAll(true)}},bindingNode:function(b){var p,o,a,f,e,m,d,h,n,l;if(b.nodeType!=1){return}p=INTERMediatorLib.getLinkedElementInfo(b);l=b.getAttribute("data-im-control");h=(l&&l=="unbind");for(f=0;f<p.length;f++){o=INTERMediatorLib.getNodeInfoArray(p[f]);if(o.table==this.contextName){if(!b.id){b.id=k()}a=b.id;if(!this.binding[o.field]){this.binding[o.field]=[]}if(this.binding[o.field].indexOf(a)<0&&!h){this.binding[o.field].push(a)}n=-1;while(n>=0){for(e=0;e<this.binding[o.field].length;e++){if(!document.getElementById(this.binding[o.field][e])){n=e}}if(n>=0){delete this.binding[o.field][n]}}d=o.field.split(":");switch(d[0]){case"addorder":IMLibMouseEventDispatch.setExecute(a,IMLibUI.eventAddOrderHandler);break;case"update":IMLibMouseEventDispatch.setExecute(a,(function(){var i=d[1];return function(){INTERMediator.startFrom=0;IMLibUI.eventUpdateHandler(i);IMLibPageNavigation.navigationSetup()}})());break;case"condition":var c=b.getAttribute("type");if(c&&c=="text"){IMLibKeyEventDispatch.setExecuteByCode(a,13,(function(){var i=d[1];return function(){INTERMediator.startFrom=0;IMLibUI.eventUpdateHandler(i);IMLibPageNavigation.navigationSetup()}})())}else{if(c&&(c=="checkbox"||c=="radio")){IMLibChangeEventDispatch.setExecute(a,(function(){var i=d[1];return function(){INTERMediator.startFrom=0;IMLibUI.eventUpdateHandler(i);IMLibPageNavigation.navigationSetup()}})())}}break;case"limitnumber":IMLibChangeEventDispatch.setExecute(a,(function(){var i=d[1];return function(){INTERMediator.pagedSize=document.getElementById(a).value;IMLibUI.eventUpdateHandler(i);IMLibPageNavigation.navigationSetup()}})());break;default:IMLibChangeEventDispatch.setExecute(a,IMLibLocalContext.update);break}m=this.store[o.field];IMLibElement.setValueToIMNode(b,o.target,m,true)}}function k(){INTERMediator.linkedElmCounter++;return g()}function g(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}},update:function(a){IMLibLocalContext.updateFromNodeValue(a)},updateFromNodeValue:function(a){var e,b,f,d,c;e=document.getElementById(a);b=IMLibElement.getValueFromIMNode(e);f=INTERMediatorLib.getLinkedElementInfo(e);for(c=0;c<f.length;c++){IMLibLocalContext.store[f[c]]=b;d=INTERMediatorLib.getNodeInfoArray(f[c]);if(d.table==IMLibLocalContext.contextName){IMLibLocalContext.setValue(d.field,b)}}},updateFromStore:function(b){var f,c,h,e,d,g,a;f=document.getElementById(b);g=f.getAttribute("data-im");a=g.split(INTERMediator.separator);if(a[1]){c=IMLibLocalContext.store[a[1]];h=INTERMediatorLib.getLinkedElementInfo(f);for(d=0;d<h.length;d++){IMLibLocalContext.store[h[d]]=c;e=INTERMediatorLib.getNodeInfoArray(h[d]);if(e.table==IMLibLocalContext.contextName){IMLibLocalContext.setValue(e.field,c)}}}},updateAll:function(e){var b,d,c,a,f;for(d in IMLibLocalContext.binding){c=IMLibLocalContext.binding[d];for(b=0;b<c.length;b++){a=c[b];f=document.getElementById(a);if(f&&(f.tagName=="INPUT"||f.tagName=="TEXTAREA"||f.tagName=="SELECT")){if(e===true){IMLibLocalContext.updateFromStore(a)}else{IMLibLocalContext.updateFromNodeValue(a)}break}}}},bindingDescendant:function(b){var a=this;c(b);function c(g){var f,e;if(g.nodeType===1){try{a.bindingNode(g);f=g.childNodes;if(f){for(e=0;e<f.length;e++){c(f[e])}}}catch(d){if(d=="_im_requath_request_"){throw d}else{INTERMediator.setErrorMessage(d,"EXCEPTION-31")}}}}}};var IMLib={nl_char:"\n",cr_char:"\r",tab_char:"\t",singleQuote_char:"'",doubleQuote_char:'"',backSlash_char:"\\",get zerolength_strfunction(){return""},set zerolength_strfunction(a){},get crlf_strfunction(){return"\r\n"},set crlf_strfunction(a){}};var INTERMediatorLib={ignoreEnclosureRepeaterClassName:"_im_ignore_enc_rep",ignoreEnclosureRepeaterControlName:"ignore_enc_rep",roleAsRepeaterClassName:"_im_repeater",roleAsEnclosureClassName:"_im_enclosure",roleAsRepeaterDataControlName:"repeater",roleAsEnclosureDataControlName:"enclosure",roleAsSeparatorDataControlName:"separator",roleAsHeaderDataControlName:"header",roleAsFooterDataControlName:"footer",roleAsNoResultDataControlName:"noresult",initialize:function(){var b,d,a,c;IMLibLocalContext.unarchive();return null},setup:function(){if(window.addEventListener){window.addEventListener("load",this.initialize,false)}else{if(window.attachEvent){window.attachEvent("onload",this.initialize)}else{window.onload=this.initialize}}return null},generatePasswordHash:function(d){var g,f,c,h,a,b,e;g=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];f="";c="";for(e=0;e<4;e++){h=Math.floor(Math.random()*(128-32)+32);a=h&15;b=(h>>4)&15;f+=String.fromCharCode(h);c+=g[b]+g[a]}return encodeURIComponent(SHA1(d+f)+c)},getParentRepeater:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isRepeater(a,true)){return a}a=a.parentNode}return null},getParentEnclosure:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isEnclosure(a,true)){return a}a=a.parentNode}return null},isEnclosure:function(f,g){var c,e,b,a,d;if(!f||f.nodeType!==1){return false}e=INTERMediatorLib.getClassAttributeFromNode(f);if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}d=f.getAttribute("data-im-control");if(d&&d.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}c=f.tagName;if((c==="TBODY")||(c==="UL")||(c==="OL")||(c==="SELECT")||((c==="DIV"||c==="SPAN")&&e&&e.indexOf(INTERMediatorLib.roleAsEnclosureClassName)>=0)||(d&&d.indexOf(INTERMediatorLib.roleAsEnclosureDataControlName)>=0)){if(g){return true}else{b=f.childNodes;for(a=0;a<b.length;a++){if(INTERMediatorLib.isRepeater(b[a],true)){return true}}}}return false},isRepeater:function(g,h){var d,f,c,b,e;if(!g||g.nodeType!==1){return false}f=INTERMediatorLib.getClassAttributeFromNode(g);if(f&&f.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}e=g.getAttribute("data-im-control");if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}d=g.tagName;if((d==="TR")||(d==="LI")||(d==="OPTION")||(f&&f.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)){if(h){return true}else{return a(g)}}return false;function a(i){if(INTERMediatorLib.isLinkedElement(i)){return true}c=i.childNodes;for(b=0;b<c.length;b++){if(c[b].nodeType===1){if(INTERMediatorLib.isLinkedElement(c[b])){return true}else{if(a(c[b])){return true}}}}return false}},isLinkedElement:function(c){var d,b,a;if(c!=null&&c.getAttribute){a=c.getAttribute("data-im");if(a){return true}if(INTERMediator.titleAsLinkInfo){if(c.getAttribute("TITLE")!=null&&c.getAttribute("TITLE").length>0){return true}}if(INTERMediator.classAsLinkInfo){d=INTERMediatorLib.getClassAttributeFromNode(c);if(d!=null){b=d.match(/IM\[.*\]/);if(b){return true}}}}return false},isWidgetElement:function(d){var e,c,b,a;if(!d){return false}if(INTERMediatorLib.getLinkedElementInfo(d)){b=d.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(d);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}else{a=d.parentNode;if(!a&&INTERMediatorLib.getLinkedElementInfoImpl(a)){b=a.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(a);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}}return false},isNamedElement:function(b){var c,a;if(b!=null){c=b.getAttribute("data-im-group");if(c){return true}c=b.getAttribute("name");if(c){a=c.match(/IM\[.*\]/);if(a){return true}}}return false},getEnclosureSimple:function(a){if(INTERMediatorLib.isEnclosure(a,true)){return a}return INTERMediatorLib.getEnclosureSimple(a.parentNode)},getEnclosure:function(d){var c,b;c=d;while(c!=null){if(INTERMediatorLib.isRepeater(c,true)){b=c}else{if(a(b,c)){b=null;return c}}c=c.parentNode}return null;function a(m,k){var l,f,g,e,h,i,n;if(!m||!k){return false}l=m.tagName;f=k.tagName;if((l==="TR"&&f==="TBODY")||(l==="OPTION"&&f==="SELECT")||(l==="LI"&&f==="OL")||(l==="LI"&&f==="UL")){return true}g=INTERMediatorLib.getClassAttributeFromNode(k);h=k.getAttribute("data-im-control");if((g&&g.indexOf(INTERMediatorLib.roleAsEnclosureClassName)>=0)||(h&&h.indexOf("enclosure")>=0)){e=INTERMediatorLib.getClassAttributeFromNode(m);i=m.getAttribute("data-im-control");if((e&&e.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>=0)||(i&&i.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>=0)||(i&&i.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)||(i&&i.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)||(i&&i.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)||(i&&i.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)){return true}else{if(l==="INPUT"){n=m.getAttribute("type");if(n&&((n.indexOf("radio")>=0||n.indexOf("check")>=0))){return true}}}}return false}},getLinkedElementInfo:function(b){var a=INTERMediatorLib.getLinkedElementInfoImpl(b);if(a!==false){return a}if(INTERMediatorLib.isWidgetElement(b.parentNode)){return INTERMediatorLib.getLinkedElementInfo(b.parentNode)}return false},getLinkedElementInfoImpl:function(h){var c=[],d,g,e,b,a;if(INTERMediatorLib.isLinkedElement(h)){b=h.getAttribute("data-im");if(b!==null&&b.length>0){g=new RegExp("[\\s"+INTERMediator.defDivider+"]+");d=b.split(g);for(e=0;e<d.length;e++){if(d[e]&&d[e].length>0){c.push(f(d[e]))}}return c}if(INTERMediator.titleAsLinkInfo&&h.getAttribute("TITLE")!=null){d=h.getAttribute("TITLE").split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}return c}if(INTERMediator.classAsLinkInfo){b=INTERMediatorLib.getClassAttributeFromNode(h);if(b!==null&&b.length>0){a=b.match(/IM\[([^\]]*)\]/);d=a[1].split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}}return c}}return false;function f(k){var i=INTERMediatorOnPage.getOptionsAliases();if(i!=null&&i[k]!=null){return i[k]}return k}},getWidgetInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isWidgetElement(g)){d=g.getAttribute("data-im-widget");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=INTERMediatorLib.getClassAttributeFromNode(g);if(d&&d.length>0){a=d.match(/IM_WIDGET\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},getNamedInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isNamedElement(g)){d=g.getAttribute("data-im-group");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=g.getAttribute("name");if(d&&d.length>0){a=d.match(/IM\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},repeaterTagFromEncTag:function(a){if(a=="TBODY"){return"TR"}else{if(a=="SELECT"){return"OPTION"}else{if(a=="UL"){return"LI"}else{if(a=="OL"){return"LI"}}}}return null},getNodeInfoArray:function(b){var e,a,d,c;if(!b||!b.split){return{table:null,field:null,target:null,tableindex:null,crossTable:false}}e=b.split(INTERMediator.separator);a="";d="";c="";if(e.length==3){a=e[0];d=e[1];c=e[2]}else{if(e.length==2){a=e[0];d=e[1]}else{d=b}}return{table:a,field:d,target:c,tableindex:"_im_index_"+a,crossTable:INTERMediator.crossTableStage==3}},getCalcNodeInfoArray:function(b){var g,a,f,c,e,d;if(!b){return null}e=document.getElementById(b);if(!e){return null}d=e.getAttribute("data-im");if(!d){return null}g=d.split(INTERMediator.separator);a="";f="";c="";if(g.length==3){a=g[0];f=g[1];c=g[2]}else{if(g.length==2){f=g[0];c=g[1]}else{f=d}}return{table:a,field:f,target:c,tableindex:"_im_index_"+a}},getClassAttributeFromNode:function(a){var b="";if(a===null){return""}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b=a.getAttribute("className")}else{b=a.getAttribute("class")}return b},setClassAttributeToNode:function(b,a){if(b===null){return}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b.setAttribute("className",a)}else{b.setAttribute("class",a)}},eventInfos:[],addEvent:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}else{if(c.attachEvent){c.attachEvent("on"+a,b);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}}return -1},removeEvent:function(a){if(this.eventInfos[a].node.removeEventListener){this.eventInfos[a].node.removeEventListener(this.eventInfos[a].evt,this.eventInfos[a].func,false)}else{if(this.eventInfos[a].node.detachEvent){this.eventInfos[a].node.detachEvent("on"+this.eventInfos[a].evt,this.eventInfos[a].func)}}},toNumber:function(d){var b="",a,e;d=(new String(d)).toString();for(a=0;a<d.length;a++){e=d.charAt(a);if((e>="0"&&e<="9")||e=="."||e=="-"||e==INTERMediatorOnPage.localInfo.mon_decimal_point){b+=e}}return parseFloat(b)},RoundHalfToEven:function(a,b){return a},Round:function(b,c){var a=Math.pow(10,c);return Math.round(b*a)/a},numberFormat:function(g,k){var m,c,d,a,l,h,f,i,b,e;c=this.toNumber(g);d="";if(c<0){d="-";c=-c}l=(k===undefined)?0:this.toNumber(k);a=Math.pow(10,l);i=Math.round(c*a);b=(l>0)?i%a:0;e=(i-b)/a;h=(l>0)?new String(b):"";while(h.length<l){h="0"+h}c=e;m=[];for(c=Math.floor(c);c>0;c=Math.floor(c/1000)){if(c>=1000){f="000"+(c%1000).toString();m.push(f.substr(f.length-3))}else{m.push(c)}}m=m.length<1?["0"]:m;return d+m.reverse().join(INTERMediatorOnPage.localInfo.mon_thousands_sep)+(h==""?"":INTERMediatorOnPage.localInfo.mon_decimal_point+h)},currencyFormat:function(a,b){return INTERMediatorOnPage.localInfo.currency_symbol+INTERMediatorLib.numberFormat(a,b)},objectToString:function(c){var d,b,a;if(c===null){return"null"}if(typeof c=="object"){d="";if(c.constractor===Array){for(b=0;b<c.length;b++){d+=INTERMediatorLib.objectToString(c[b])+", "}return"["+d+"]"}else{for(a in c){d+="'"+a+"':"+INTERMediatorLib.objectToString(c[a])+", "}return"{"+d+"}"}}else{return"'"+c+"'"}},getTargetTableForRetrieve:function(a){if(a.view!=null){return a.view}return a.name},getTargetTableForUpdate:function(a){if(a.table!=null){return a.table}return a.name},getInsertedString:function(b,a){var d,c;d=b;if(a!=null){for(c=1;c<=a.length;c++){d=d.replace("@"+c+"@",a[c-1])}}return d},getInsertedStringFromErrorNumber:function(b,a){var e,c,d;d=INTERMediatorOnPage.getMessages();e=d?d[b]:"Error:"+b;if(a){for(c=1;c<=a.length;c++){e=e.replace("@"+c+"@",a[c-1])}}return e},getNamedObject:function(d,c,a){var b;for(b in d){if(d[b][c]==a){return d[b]}}return null},getNamedObjectInObjectArray:function(b,d,a){var c;for(c=0;c<b.length;c++){if(b[c][d]==a){return b[c]}}return null},getNamedValueInObject:function(c,e,b,f){var a=[],d;for(d in c){if(c[d][e]==b){a.push(c[d][f])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},is_array:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!(a.propertyIsEnumerable("length"))},getNamedValuesInObject:function(c,g,e,f,b,h){var a=[],d;for(d in c){if(c.hasOwnProperty(d)&&c[d][g]==e&&c[d][f]==b){a.push(c[d][h])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},getRecordsetFromFieldValueObject:function(b){var c={},a;for(a in b){if(b.hasOwnProperty(a)){c[b[a]["field"]]=b[a]["value"]}}return c},getNodePath:function(a){if(a.tagName===null){return""}else{return INTERMediatorLib.getNodePath(a.parentNode)+"/"+a.tagName}},isPopupMenu:function(a){if(!a||!a.tagName){return false}if(a.tagName=="SELECT"){return true}return false},getElementsByClassNameOrDataAttr:function(d,a){var c=[],e;e=(a.match(/^_im_/))?a.substr(4):a;if(e){b(d)}return c;function b(k){var h,g,f;if(k===undefined||k.nodeType!==1){return}h=INTERMediatorLib.getClassAttributeFromNode(k);if(h){f=h.split("|");for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im-control");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}for(g=0;g<k.children.length;g++){b(k.children[g])}}},getElementsByAttributeValue:function(e,d,f){var b=[];var c=new RegExp(f);a(e);return b;function a(k){var h,g;if(k===undefined||k.nodeType!==1){return}h=k.getAttribute(d);if(h&&h.match(c)){b.push(k)}for(g=0;g<k.children.length;g++){a(k.children[g])}}},getElementsByClassName:function(e,a){var c=[];var d=new RegExp(a);b(e);return c;function b(h){var g,f;if(h===undefined||h.nodeType!==1){return}g=INTERMediatorLib.getClassAttributeFromNode(h);if(g&&g.match(d)){c.push(h)}for(f=0;f<h.children.length;f++){b(h.children[f])}}},getElementsByIMManaged:function(d){var b=[];var c=new RegExp(/^IM/);a(d);return b;function a(f){var g,e;if(f===undefined||f.nodeType!==1){return}g=f.getAttribute("id");if(g&&g.match(c)){b.push(f)}for(e=0;e<f.children.length;e++){a(f.children[e])}}},seekLinkedAndWidgetNodes:function(c,a){var g=[];var f=[];var e,d=a;if(a===undefined||a===null){d=false}for(e=0;e<c.length;e++){b(c[e])}return{linkedNode:g,widgetNode:f};function b(n){var h,o,m,k,l;h=n.nodeType;if(h===1){if(INTERMediatorLib.isLinkedElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){g.push(n)}else{return o}}if(INTERMediatorLib.isWidgetElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){f.push(n)}else{return o}}m=n.childNodes;for(l=0;l<m.length;l++){k=b(m[l])}}return null}},createErrorMessageNode:function(a,c){var b;b=document.createElement(a);INTERMediatorLib.setClassAttributeToNode(b,"_im_alertmessage");b.appendChild(document.createTextNode(c));return b},removeChildNodes:function(a){if(a){while(a.childNodes.length>0){a.removeChild(a.childNodes[0])}}},clearErrorMessage:function(b){var c,a;if(b){c=INTERMediatorLib.getElementsByClassName(b.parentNode,"_im_alertmessage");for(a=0;a<c.length;a++){c[a].parentNode.removeChild(c[a])}}},dateTimeStringISO:function(a){a=(!a)?new Date():a;return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).substr(-2,2)+"-"+("0"+a.getDate()).substr(-2,2)+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)},dateTimeStringFileMaker:function(a){a=(!a)?new Date():a;return("0"+(a.getMonth()+1)).substr(-2,2)+"/"+("0"+a.getDate()).substr(-2,2)+"/"+a.getFullYear()+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)},dateStringISO:function(a){a=(!a)?new Date():a;return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).substr(-2,2)+"-"+("0"+a.getDate()).substr(-2,2)},dateStringFileMaker:function(a){a=(!a)?new Date():a;return("0"+(a.getMonth()+1)).substr(-2,2)+"/"+("0"+a.getDate()).substr(-2,2)+"/"+a.getFullYear()},timeString:function(a){a=(!a)?new Date():a;return("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)}};INTERMediatorLib.initialize();var IMLibNodeGraph={nodes:[],edges:[],clear:function(){this.nodes=[];this.edges=[]},addNode:function(a){if(this.nodes.indexOf(a)<0){this.nodes.push(a)}},addEdge:function(b,a){if(this.nodes.indexOf(b)<0){this.addNode(b)}if(this.nodes.indexOf(a)<0){this.addNode(a)}this.edges.push({from:b,to:a})},getAllNodesInEdge:function(){var b,a=[];for(b=0;b<this.edges.length;b++){if(a.indexOf(this.edges[b].from)<0){a.push(this.edges[b].from)}if(a.indexOf(this.edges[b].to)<0){a.push(this.edges[b].to)}}return a},getLeafNodes:function(){var a,c=[],d=[],b=this.getAllNodesInEdge();for(a=0;a<this.edges.length;a++){c.push(this.edges[a].from)}for(a=0;a<this.edges.length;a++){if(c.indexOf(this.edges[a].to)<0&&d.indexOf(this.edges[a].to)<0){d.push(this.edges[a].to)}}for(a=0;a<this.nodes.length;a++){if(b.indexOf(this.nodes[a])<0){d.push(this.nodes[a])}}return d},getLeafNodesWithRemoving:function(){var b,a=[],c=this.getLeafNodes();for(b=0;b<this.edges.length;b++){if(c.indexOf(this.edges[b].to)<0){a.push(this.edges[b])}}this.edges=a;for(b=0;b<c.length;b++){this.nodes.splice(this.nodes.indexOf(c[b]),1)}return c},applyToAllNodes:function(b){var a;for(a=0;a<this.nodes.length;a++){b(this.nodes[a])}},decodeOpenIDToken:function(a){var e,d,b,c=a.split(".");if(c.length!=3){return false}e=Base64.decode(c[0]);d=Base64.decode(c[1]);b=Base64.decode(c[2])}};var IMLibCalc={calculateRequiredObject:null,updateCalculationInfo:function(r,k,e,m,u,d){var c,h,a,n,q,f,v,t,b,l,g,o,p;c=e.calculation;for(f in c){o=c[f]["field"].indexOf(INTERMediator.separator);p=c[f]["field"].length;g=c[f]["field"].substring(0,o>=0?o:p);if(g==u.field){try{h=c[f]["expression"];a=c[f]["field"];n=Parser.parse(h).variables();v=m+(u.target.length>0?(INTERMediator.separator+u.target):"")}catch(s){INTERMediator.setErrorMessage(s,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1036],[a,h]))}if(n&&v){b={};l={};for(q=0;q<n.length;q++){t=n[q];if(t){b[t]=[d[t]];l[t]=[undefined]}r.setValue(k,t,d[t],m,u.target,null)}IMLibCalc.calculateRequiredObject[v]={field:a,expression:h,nodeInfo:u,values:b,referes:l}}}}},updateCalculationFields:function(){var h,e,r,f,k,m,c,t,l;var d,a,s,g,o,n,p,q,b;IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(h in IMLibCalc.calculateRequiredObject){m=IMLibCalc.calculateRequiredObject[h];if(m){n=false;for(a in m.referes){for(c=0;c<m.referes[a].length;c++){IMLibNodeGraph.addEdge(h,m.referes[a][c]);n=false}}if(!n){IMLibNodeGraph.addEdge(h)}}}do{k=IMLibNodeGraph.getLeafNodesWithRemoving();for(o=0;o<k.length;o++){m=IMLibCalc.calculateRequiredObject[k[o]];l=INTERMediatorLib.getCalcNodeInfoArray(k[o]);if(m){q=k[o].match(IMLibCalc.regexpForSeparator)?k[o].split(IMLibCalc.regexpForSeparator)[0]:k[o];d=document.getElementById(q);e=m.expression;r=m.nodeInfo;f=m.values;t=m.referes;for(a in f){s=[];for(c=0;c<f[a].length;c++){if(f[a][c]==undefined){if(t[a][c]){g=document.getElementById(t[a][c]);s.push(IMLibElement.getValueFromIMNode(g))}else{p=IMLibContextPool.getContextInfoFromId(q,r.target);if(p&&p.context){b=p.context.getContextRecord(q);s.push(b[a])}}}else{s.push(f[a][c])}}m.values[a]=s}IMLibElement.setValueToIMNode(d,r.target,Parser.evaluate(e,f),true)}}}while(k.length>0);if(IMLibNodeGraph.nodes.length>0){INTERMediator.setErrorMessage(new Exception(),INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1037],[]))}},recalculation:function(p){var l,e,n,o,d,q,u=false;var m,a,s,f,v,b,g,w,h;var y,x,k,r,c,t;if(p===undefined){u=true;f=[];v=[]}else{m=IMLibElement.getValueFromIMNode(document.getElementById(p));f=[p];v=[m]}IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(l in IMLibCalc.calculateRequiredObject){o=IMLibCalc.calculateRequiredObject[l];t=l.match(IMLibCalc.regexpForSeparator)?l.split(IMLibCalc.regexpForSeparator)[0]:l;for(a in o.referes){for(d=0;d<o.referes[a].length;d++){IMLibNodeGraph.addEdge(l,o.referes[a][d])}}}do{n=IMLibNodeGraph.getLeafNodesWithRemoving();for(s=0;s<n.length;s++){o=IMLibCalc.calculateRequiredObject[n[s]];if(o){t=n[s].match(IMLibCalc.regexpForSeparator)?n[s].split(IMLibCalc.regexpForSeparator)[0]:n[s];g=o.expression;w=o.nodeInfo;h=o.values;y=o.referes;for(a in h){x=[];for(d=0;d<h[a].length;d++){if(h[a][d]==undefined){if(y[a][d]){k=document.getElementById(y[a][d]);x.push(IMLibElement.getValueFromIMNode(k))}else{r=IMLibContextPool.getContextInfoFromId(t,w.target);c=r.context.getContextRecord(t);x.push(c[a])}}else{x.push(h[a][d])}}o.values[a]=x}if(u){e=true}else{e=false;for(a in o.referes){for(d=0;d<o.referes[a].length;d++){b=f.indexOf(o.referes[a][d]);if(b>=0){o.values[a][d]=v[b];e=true}}}}if(e){q=Parser.evaluate(o.expression,o.values);IMLibElement.setValueToIMNode(document.getElementById(t),w.target,q,true);f.push(t);v.push(q)}}}}while(n.length>0);if(IMLibNodeGraph.nodes.length>0){}},setUndefinedToAllValues:function(){var c,f,e,i,k,h,d,a,b,g;do{a=false;for(c in IMLibCalc.calculateRequiredObject){b=c.match(IMLibCalc.regexpForSeparator)?c.split(IMLibCalc.regexpForSeparator)[0]:c;if(!document.getElementById(b)){delete IMLibCalc.calculateRequiredObject[c];a=true;break}}}while(a);for(c in IMLibCalc.calculateRequiredObject){f=IMLibCalc.calculateRequiredObject[c];i=document.getElementById(c);for(k in f.values){if(k.indexOf(INTERMediator.separator)>-1){h=k}else{h=f.nodeInfo.table+INTERMediator.separator+k}if(c.nodeInfo&&c.nodeInfo.crossTable){g=i;while(g.tagName!="TD"&&g.tagName!="TH"){g=g.parentNode}do{d=INTERMediatorOnPage.getNodeIdsHavingTargetFromNode(i,h);if(d&&d.length>0){break}i=INTERMediatorLib.getParentRepeater(INTERMediatorLib.getParentEnclosure(i))}while(i)}else{do{d=INTERMediatorOnPage.getNodeIdsHavingTargetFromRepeater(i,h);if(d&&d.length>0){break}d=INTERMediatorOnPage.getNodeIdsHavingTargetFromEnclosure(i,h);if(d&&d.length>0){break}i=INTERMediatorLib.getParentRepeater(INTERMediatorLib.getParentEnclosure(i))}while(i)}if(INTERMediatorLib.is_array(d)&&d.length>0){f.referes[k]=[];f.values[k]=[];for(e=0;e<d.length;e++){f.referes[k].push(d[e]);f.values[k].push(undefined)}}else{f.referes[k]=[undefined];f.values[k]=[undefined]}}}}};var INTERMediatorOnPage={authCountLimit:4,authCount:0,authUser:"",authHashedPassword:"",authCryptedPassword:"",authUserSalt:"",authUserHexSalt:"",authChallenge:"",requireAuthentication:false,clientId:null,authRequiredContext:null,authStoring:"cookie",authExpired:3600,isOnceAtStarting:true,publickey:null,isNativeAuth:false,httpuser:null,httppasswd:null,mediaToken:null,realm:"",dbCache:{},isEmailAsUsername:false,passwordPolicy:null,creditIncluding:null,masterScrollPosition:null,nonSupportMessageId:"nonsupportmessage",isFinishToConstruct:false,isAutoConstruct:true,isShowChangePassword:true,isSetDefaultStyle:false,authPanelTitle:null,isOAuthAvailable:false,oAuthClientID:null,oAuthClientSecret:null,oAuthBaseURL:null,oAuthRedirect:null,oAuthScope:null,additionalExpandingEnclosureFinish:{},additionalExpandingRecordFinish:{},getEditorPath:null,getEntryPath:null,getIMRootPath:null,getDataSources:null,getOptionsAliases:null,getOptionsTransaction:null,dbClassName:null,browserCompatibility:null,clientNotificationIdentifier:null,metadata:null,isLDAP:null,appLocale:null,localInfo:{mon_decimal_point:".",mon_thousands_sep:",",currency_symbol:""},appCurrency:null,clearCredentials:function(){INTERMediatorOnPage.authChallenge=null;INTERMediatorOnPage.authHashedPassword=null;INTERMediatorOnPage.authCryptedPassword=null},getMessages:function(){return null},getURLParametersAsArray:function(){var c,f,e,a,b,d;a={};f=location.search.substring(1).split("&");for(c=0;c<f.length;c++){e=f[c].indexOf("=");if(e>0){b=f[c].substring(0,e);d=f[c].substring(e+1);a[b]=decodeURIComponent(d)}}return a},getContextInfo:function(b){var c,a;c=INTERMediatorOnPage.getDataSources();for(a in c){if(c.hasOwnProperty(a)&&c[a].name==b){return c[a]}}return null},isComplementAuthData:function(){return INTERMediatorOnPage.authUser!==null&&INTERMediatorOnPage.authUser.length>0&&INTERMediatorOnPage.authHashedPassword!==null&&INTERMediatorOnPage.authHashedPassword.length>0&&INTERMediatorOnPage.authUserSalt!==null&&INTERMediatorOnPage.authUserSalt.length>0&&INTERMediatorOnPage.authChallenge!==null&&INTERMediatorOnPage.authChallenge.length>0},retrieveAuthInfo:function(){if(INTERMediatorOnPage.requireAuthentication){if(INTERMediatorOnPage.isOnceAtStarting){switch(INTERMediatorOnPage.authStoring){case"cookie":case"cookie-domainwide":INTERMediatorOnPage.authUser=INTERMediatorOnPage.getCookie("_im_username");INTERMediatorOnPage.authHashedPassword=INTERMediatorOnPage.getCookie("_im_credential");INTERMediatorOnPage.mediaToken=INTERMediatorOnPage.getCookie("_im_mediatoken");INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.getCookie("_im_crypted");break;case"session-storage":INTERMediatorOnPage.authUser=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_username");INTERMediatorOnPage.authHashedPassword=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_credential");INTERMediatorOnPage.mediaToken=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_mediatoken");INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_crypted");break;default:INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");break}INTERMediatorOnPage.isOnceAtStarting=false}if(INTERMediatorOnPage.authUser.length>0){if(!INTERMediator_DBAdapter.getChallenge()){INTERMediator.flushMessage()}}}},logout:function(){INTERMediatorOnPage.authUser="";INTERMediatorOnPage.authHashedPassword="";INTERMediatorOnPage.authCryptedPassword="";INTERMediatorOnPage.authUserSalt="";INTERMediatorOnPage.authChallenge="";INTERMediatorOnPage.clientId="";INTERMediatorOnPage.removeCredencialsFromCookieOrStorage();INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_localcontext")},storeSessionStorageWithFallDown:function(b,c){if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.setItem(INTERMediatorOnPage.getKeyWithRealm(b),c)}catch(a){INTERMediatorOnPage.setCookie(b,c)}}else{INTERMediatorOnPage.setCookie(b,c)}},getSessionStorageWithFallDown:function(b){var c;if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{c=sessionStorage.getItem(INTERMediatorOnPage.getKeyWithRealm(b));c=c?c:""}catch(a){c=INTERMediatorOnPage.getCookie(b)}}else{c=INTERMediatorOnPage.getCookie(b)}return c},removeFromSessionStorageWithFallDown:function(b){if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.removeItem(INTERMediatorOnPage.getKeyWithRealm(b))}catch(a){INTERMediatorOnPage.removeCookie(b)}}else{INTERMediatorOnPage.removeCookie(b)}},removeCredencialsFromCookieOrStorage:function(){switch(INTERMediatorOnPage.authStoring){case"cookie":case"cookie-domainwide":INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");break;case"session-storage":INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_username");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_credential");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_mediatoken");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_crypted");break}},storeCredentialsToCookieOrStorage:function(){switch(INTERMediatorOnPage.authStoring){case"cookie":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookie("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookie("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookie("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookie("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break;case"cookie-domainwide":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookieDomainWide("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookieDomainWide("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break;case"session-storage":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break}},loginPanelHTML:null,authenticating:function(h,w){var c,i,q,z,k,g,u,f,l,v,m,b,r,e,o,p,d,t,s,y,n,a,x;this.checkPasswordPolicy=function(H,G,I){var F,D,B,E=[],C;if(!I){return E}F=I.split(/[\s,]/);for(D=0;D<F.length;D++){switch(F[D].toUpperCase()){case"USEALPHABET":if(!H.match(/[A-Za-z]/)){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2015))}break;case"USENUMBER":if(!H.match(/[0-9]/)){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2016))}break;case"USEUPPER":if(!H.match(/[A-Z]/)){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2017))}break;case"USELOWER":if(!H.match(/[a-z]/)){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2018))}break;case"USEPUNCTUATION":if(!H.match(/[^A-Za-z0-9]/)){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2019))}break;case"NOTUSERNAME":if(H==G){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2020))}break;default:if(F[D].toUpperCase().indexOf("LENGTH")===0){C=F[D].match(/[0-9]+/)[0];if(H.length<C){B=false;E.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2021,[C]))}}}}return E};if(w){return}if(INTERMediatorOnPage.authCount>INTERMediatorOnPage.authCountLimit){INTERMediatorOnPage.authenticationError();INTERMediatorOnPage.logout();INTERMediator.flushMessage();return}c=document.getElementsByTagName("BODY")[0];i=document.createElement("div");i.id="_im_authpback";c.insertBefore(i,c.childNodes[0]);if(INTERMediatorOnPage.isSetDefaultStyle){i.style.height="100%";i.style.width="100%";i.style.backgroundImage="url("+INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=images&name=background.gif)";i.style.position="absolute";i.style.padding=" 50px 0 0 0";i.style.top="0";i.style.left="0";i.style.zIndex="999998"}if(INTERMediatorOnPage.loginPanelHTML){i.innerHTML=INTERMediatorOnPage.loginPanelHTML;m=document.getElementById("_im_password");u=document.getElementById("_im_username");e=document.getElementById("_im_authbutton");r=document.getElementById("_im_changebutton");x=document.getElementById("_im_oauthbutton")}else{q=document.createElement("div");if(INTERMediatorOnPage.isSetDefaultStyle){q.style.width="450px";q.style.backgroundColor="#333333";q.style.color="#DDDDAA";q.style.margin="50px auto 0 auto";q.style.padding="20px";q.style.borderRadius="10px";q.style.position="relative"}q.id="_im_authpanel";i.appendChild(q);o="";if(INTERMediatorOnPage.authPanelTitle&&INTERMediatorOnPage.authPanelTitle.length>0){o=INTERMediatorOnPage.authPanelTitle}else{if(INTERMediatorOnPage.realm&&INTERMediatorOnPage.realm.length>0){o=INTERMediatorOnPage.realm}}if(o&&o.length>0){y=document.createElement("DIV");y.appendChild(document.createTextNode(o));y.style.textAlign="left";q.appendChild(y);b=document.createElement("HR");q.appendChild(b)}z="100px";k=document.createElement("LABEL");q.appendChild(k);g=document.createElement("span");if(INTERMediatorOnPage.isSetDefaultStyle){g.style.minWidth=z;g.style.textAlign="right";g.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(g,"_im_authlabel");k.appendChild(g);f=INTERMediatorOnPage.isEmailAsUsername?2011:2002;g.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(f)));u=document.createElement("INPUT");u.type="text";u.id="_im_username";u.size="20";u.setAttribute("autocapitalize","off");k.appendChild(u);b=document.createElement("BR");b.clear="all";q.appendChild(b);l=document.createElement("LABEL");q.appendChild(l);v=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){v.style.minWidth=z;v.style.textAlign="right";v.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(v,"_im_authlabel");l.appendChild(v);v.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2003)));m=document.createElement("INPUT");m.type="password";m.id="_im_password";m.size="20";l.appendChild(m);e=document.createElement("BUTTON");e.id="_im_authbutton";e.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2004)));q.appendChild(e);b=document.createElement("BR");b.clear="all";q.appendChild(b);s=document.createElement("DIV");if(INTERMediatorOnPage.isSetDefaultStyle){s.style.textAlign="center";s.style.textSize="10pt";s.style.color="#994433"}s.id="_im_login_message";q.appendChild(s);if(this.isShowChangePassword&&!INTERMediatorOnPage.isNativeAuth){b=document.createElement("HR");q.appendChild(b);p=document.createElement("LABEL");q.appendChild(p);d=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){d.style.minWidth=z;d.style.textAlign="right";d.style.cssFloat="left";d.style.fontSize="0.7em";d.style.paddingTop="4px"}INTERMediatorLib.setClassAttributeToNode(d,"_im_authlabel_pwchange");p.appendChild(d);d.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2006)));t=document.createElement("INPUT");t.type="password";t.id="_im_newpassword";t.size="12";p.appendChild(t);r=document.createElement("BUTTON");r.id="_im_changebutton";r.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2005)));q.appendChild(r);s=document.createElement("DIV");if(INTERMediatorOnPage.isSetDefaultStyle){s.style.textAlign="center";s.style.textSize="10pt";s.style.color="#994433"}s.id="_im_newpass_message";q.appendChild(s)}if(this.isOAuthAvailable){b=document.createElement("HR");q.appendChild(b);x=document.createElement("BUTTON");x.id="_im_authbutton";x.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2014)));q.appendChild(x)}}m.onkeydown=function(B){n=(window.event)?window.event.which:B.keyCode;if(n==13){e.onclick()}};u.value=INTERMediatorOnPage.authUser;u.onkeydown=function(B){n=(window.event)?window.event.which:B.keyCode;if(n==13){m.focus()}};e.onclick=function(){var E,B,D,C;C=document.getElementById("_im_newpass_message");if(C){INTERMediatorLib.removeChildNodes(C)}E=document.getElementById("_im_username").value;B=document.getElementById("_im_password").value;if(E===""||B===""){C=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(C);C.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2013)));return}INTERMediatorOnPage.authUser=E;c.removeChild(i);if(E!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";D=INTERMediator_DBAdapter.getChallenge();if(!D){INTERMediator.flushMessage();return}}INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(B);INTERMediatorOnPage.authHashedPassword=SHA1(B+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;if(INTERMediatorOnPage.authUser.length>0){INTERMediatorOnPage.storeCredentialsToCookieOrStorage()}h();INTERMediator.flushMessage()};if(r){var A=this.checkPasswordPolicy;r.onclick=function(){var G,C,D,B,E,F;E=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(E);E=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(E);G=document.getElementById("_im_username").value;C=document.getElementById("_im_password").value;D=document.getElementById("_im_newpassword").value;if(G===""||C===""||D===""){E=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(E);E.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2007)));return}F=A(D,G,INTERMediatorOnPage.passwordPolicy);if(F.length>0){E.appendChild(document.createTextNode(F.join(", ")));return}B=INTERMediator_DBAdapter.changePassword(G,C,D);E.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(B?2009:2010)));INTERMediator.flushMessage()}}if(this.isOAuthAvailable&&x){x.onclick=function(){var B;INTERMediatorOnPage.setCookieDomainWide("_im_oauth_backurl",location.href,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_realm",INTERMediatorOnPage.realm,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_expired",INTERMediatorOnPage.authExpired,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_storing",INTERMediatorOnPage.authStoring,true);B=INTERMediatorOnPage.oAuthBaseURL+"?scope="+encodeURIComponent(INTERMediatorOnPage.oAuthScope)+"&redirect_uri="+encodeURIComponent(INTERMediatorOnPage.oAuthRedirect)+"&response_type=code&client_id="+encodeURIComponent(INTERMediatorOnPage.oAuthClientID);location.href=B}}if(INTERMediatorOnPage.authCount>0){a=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2012)))}window.scroll(0,0);u.focus();INTERMediatorOnPage.authCount++},authenticationError:function(){var c,b,a;INTERMediatorOnPage.hideProgress();c=document.getElementsByTagName("BODY")[0];b=document.createElement("div");b.id="_im_autherrorback";c.insertBefore(b,c.childNodes[0]);if(INTERMediatorOnPage.isSetDefaultStyle){b.style.height="100%";b.style.width="100%";if(INTERMediatorOnPage.isSetDefaultStyle){b.style.backgroundImage="url("+INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=images&name=background-error.gif)"}b.style.position="absolute";b.style.padding=" 50px 0 0 0";b.style.top="0";b.style.left="0";b.style.zIndex="999999"}a=document.createElement("div");a.id="_im_autherrormessage";if(INTERMediatorOnPage.isSetDefaultStyle){a.style.width="240px";a.style.backgroundColor="#333333";a.style.color="#DD6666";a.style.fontSize="16pt";a.style.margin="50px auto 0 auto";a.style.padding="20px 4px 20px 4px";a.style.borderRadius="10px";a.style.position="relatvie";a.style.textAlign="Center"}a.onclick=function(){c.removeChild(b)};b.appendChild(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2001)))},INTERMediatorCheckBrowser:function(l){var e,n,k,p,c,d,q=false,r,g,b=-1,m,a,o,s,h,f;e=INTERMediatorOnPage.browserCompatibility();n=false;k=false;if(e.edge&&navigator.userAgent.indexOf("Edge/")>-1){e={edge:e.edge}}else{if(e.trident&&navigator.userAgent.indexOf("Trident/")>-1){e={trident:e.trident}}else{if(e.msie&&navigator.userAgent.indexOf("MSIE ")>-1){e={msie:e.msie}}else{if(e.opera&&(navigator.userAgent.indexOf("Opera/")>-1||navigator.userAgent.indexOf("OPR/")>-1)){e={opera:e.opera,opr:e.opera}}}}}for(c in e){if(e.hasOwnProperty(c)){if(navigator.userAgent.toUpperCase().indexOf(c.toUpperCase())>-1){n=true;if(e[c] instanceof Object){for(d in e[c]){if(e[c].hasOwnProperty(d)&&navigator.platform.toUpperCase().indexOf(d.toUpperCase())>-1){k=true;p=e[c][d];break}}}else{k=true;p=e[c];break}}}}if(n&&k){r=parseInt(p,10);if(navigator.appVersion.indexOf("Edge/")>-1){b=navigator.appVersion.indexOf("Edge/")+5}else{if(navigator.appVersion.indexOf("Trident/")>-1){b=navigator.appVersion.indexOf("Trident/")+8}else{if(navigator.appVersion.indexOf("MSIE ")>-1){b=navigator.appVersion.indexOf("MSIE ")+5}else{if(navigator.appVersion.indexOf("OPR/")>-1){b=navigator.appVersion.indexOf("OPR/")+4}else{if(navigator.appVersion.indexOf("Opera/")>-1){b=navigator.appVersion.indexOf("Opera/")+6}else{if(navigator.appVersion.indexOf("Chrome/")>-1){b=navigator.appVersion.indexOf("Chrome/")+7}else{if(navigator.appVersion.indexOf("Safari/")>-1&&navigator.appVersion.indexOf("Version/")>-1){b=navigator.appVersion.indexOf("Version/")+8}else{if(navigator.userAgent.indexOf("Firefox/")>-1){b=navigator.userAgent.indexOf("Firefox/")+8}else{if(navigator.appVersion.indexOf("WebKit/")>-1){b=navigator.appVersion.indexOf("WebKit/")+7}}}}}}}}}if(b>-1){if(navigator.userAgent.indexOf("Firefox/")>-1){m=navigator.userAgent.indexOf(".",b);g=parseInt(navigator.userAgent.substring(b,m),10)}else{m=navigator.appVersion.indexOf(".",b);g=parseInt(navigator.appVersion.substring(b,m),10)}}else{m=navigator.appVersion.indexOf(".");g=parseInt(navigator.appVersion.substring(0,m),10)}if(INTERMediator.isTrident){r=r+4}if(p.indexOf("-")>-1){q=(r>=g);if(document.documentMode){q=(r>=document.documentMode)}}else{if(p.indexOf("+")>-1){q=(r<=g);if(document.documentMode){q=(r<=document.documentMode)}}else{q=(r==g);if(document.documentMode){q=(r==document.documentMode)}}}}if(q===true){if(l){l.parentNode.removeChild(l)}}else{a=document.getElementsByTagName("BODY")[0];o=document.createElement("div");o.setAttribute("align","center");s=document.createElement("font");s.setAttribute("color","gray");h=document.createElement("font");h.setAttribute("size","+2");h.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1022]));s.appendChild(h);s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1023]));s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(navigator.userAgent));o.appendChild(s);for(f=a.childNodes.length-1;f>=0;f--){a.removeChild(a.childNodes[f])}a.appendChild(o)}return q},getNodeIdFromIMDefinition:function(c,e,a){var b;if(a){b=e}else{b=INTERMediatorLib.getParentRepeater(e)}return d(b,c);function d(l,f){var h,g,m,k;if(l.nodeType!=1){return null}h=l.childNodes;if(h){for(g=0;g<h.length;g++){if(h[g].nodeType==1){if(INTERMediatorLib.isLinkedElement(h[g])){m=INTERMediatorLib.getLinkedElementInfo(h[g]);if(m.indexOf(f)>-1){k=h[g].getAttribute("id");return k}}k=d(h[g],f);if(k!==null){return k}}}}return null}},getNodeIdFromIMDefinitionOnEnclosure:function(b,d){var a;a=INTERMediatorLib.getParentEnclosure(d);return c(a,b);function c(k,e){var g,f,l,h;if(k.nodeType!=1){return null}g=k.childNodes;if(g){for(f=0;f<g.length;f++){if(g[f].nodeType==1){if(INTERMediatorLib.isLinkedElement(g[f])){l=INTERMediatorLib.getLinkedElementInfo(g[f]);if(l.indexOf(e)>-1&&g[f].getAttribute){h=g[f].getAttribute("id");return h}}h=c(g[f],e);if(h!==null){return h}}}}return null}},getNodeIdsFromIMDefinition:function(c,g,a){var b,e,d;if(a===true){b=g}else{if(a===false){b=INTERMediatorLib.getParentEnclosure(g)}else{b=INTERMediatorLib.getParentRepeater(g)}}if(b!==null){e=[];if(Array.isArray(b)){for(d=0;d<b.length;d++){f(b[d],c)}}else{f(b,c)}}return e;function f(m,h){var l,k,n;if(m.nodeType!=1){return}l=m.childNodes;if(l){for(k=0;k<l.length;k++){if(l[k].nodeType==1){n=INTERMediatorLib.getLinkedElementInfo(l[k]);if(n&&n.indexOf(h)>-1){if(l[k].getAttribute("id")){e.push(l[k].getAttribute("id"))}else{e.push(l[k])}}}f(l[k],h)}}}},getNodeIdsHavingTargetFromNode:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,true)},getNodeIdsHavingTargetFromRepeater:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,IMLib.zerolength_str)},getNodeIdsHavingTargetFromEnclosure:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,false)},getKeyWithRealm:function(a){if(INTERMediatorOnPage.realm.length>0){return a+"_"+INTERMediatorOnPage.realm}return a},getCookie:function(c){var d,b,a;d=document.cookie.split("; ");a=this.getKeyWithRealm(c);for(b=0;b<d.length;b++){if(d[b].indexOf(a+"=")===0){return decodeURIComponent(d[b].substring(d[b].indexOf("=")+1))}}return""},removeCookie:function(a){document.cookie=this.getKeyWithRealm(a)+"=; path=/; max-age=0; expires=Thu, 1-Jan-1900 00:00:00 GMT;";document.cookie=this.getKeyWithRealm(a)+"=; max-age=0;  expires=Thu, 1-Jan-1900 00:00:00 GMT;"},setCookie:function(a,b){this.setCookieWorker(this.getKeyWithRealm(a),b,false,INTERMediatorOnPage.authExpired)},setCookieDomainWide:function(a,d,c){var b;b=(c===true)?a:this.getKeyWithRealm(a);this.setCookieWorker(b,d,true,INTERMediatorOnPage.authExpired)},setCookieWorker:function(b,g,a,c){var e;var f=new Date();f.setTime(f.getTime()+c*1000);e=b+"="+encodeURIComponent(g)+(a?";path=/":"")+";";if(c>0){e+="max-age="+c+";expires="+f.toUTCString()+";"}if(document.URL.substring(0,8)=="https://"){e+="secure;"}document.cookie=e},hideProgress:function(){var a=document.getElementById("_im_progress");var b=INTERMediatorOnPage.getTheme().toLowerCase();if(a){if(b=="least"||b=="thosedays"){a.parentNode.removeChild(a)}else{a.addEventListener("transitionend",function(c){a.parentNode.removeChild(a)},true);a.style.transitionProperty="opacity";a.style.transitionDuration="0.3s";a.style.opacity=0}}},showProgress:function(){var f,d,b,a,c,e=INTERMediatorOnPage.getTheme().toLowerCase();b=document.getElementById("_im_progress");if(!b){b=document.createElement("div");b.setAttribute("id","_im_progress");d=document.getElementsByTagName("BODY")[0];if(d.firstChild){d.insertBefore(b,d.firstChild)}else{d.appendChild(b)}if(e=="least"||e=="thosedays"){c=document.createElement("img");c.setAttribute("id","_im_logo");c.setAttribute("src",INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=images&name=logo.gif");b.appendChild(c);a=document.createElement("img");a.setAttribute("id","_im_animatedimage");a.setAttribute("src",INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=images&name=inprogress.gif");b.appendChild(a);f=document.createElement("BR");f.setAttribute("clear","all");b.appendChild(f);b.appendChild(document.createTextNode("INTER-Mediator working"))}else{c=document.createElement("img");c.setAttribute("src",INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=images&name=gears.svg");b.appendChild(c)}}if(e=="least"||e=="thosedays"){}else{b.style.display="flex"}},setReferenceToTheme:function(){var c,a,b,d=-1;c=document.getElementsByTagName("HEAD")[0];a=document.createElement("link");a.setAttribute("href",INTERMediatorOnPage.getEntryPath()+"?theme="+INTERMediatorOnPage.getTheme()+"&type=css");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");for(b=0;b<c.childNodes.length;b++){if(c.childNodes[b]&&c.childNodes[b].nodeType==1&&c.childNodes[b].tagName=="LINK"&&c.childNodes[b].rel=="stylesheet"){d=b;break}}if(d>-1){c.insertBefore(a,c.childNodes[d])}else{c.appendChild(a)}}};var IMParts_Catalog={};IMParts_Catalog.fileupload={html5DDSuported:false,progressSupported:false,forceOldStyleForm:false,uploadButtonLabel:"",uploadCancelButtonLabel:"",uploadId:"sign"+Math.random(),instanciate:function(h){var b,l,e,u;var n=h.getAttribute("id")+"-e";var d=document.createElement("DIV");IMLibLocalContext.setValue("uploadFileSelect","false");INTERMediatorLib.setClassAttributeToNode(d,"_im_fileupload");d.setAttribute("id",n);this.ids.push(n);if(this.forceOldStyleForm||(INTERMediator.isEdge&&INTERMediator.ieVersion<14)){this.html5DDSuported=false}else{this.html5DDSuported=true;try{var m=new FileReader();var k=new FormData()}catch(r){this.html5DDSuported=false}}u=("ontouchstart" in window);if(u){this.html5DDSuported=false}var s=(h.getAttribute("data-im-widget-reload")!==null)?h.getAttribute("data-im-widget-reload"):false;d.setAttribute("data-im-widget-reload",s);if(this.html5DDSuported){d.dropzone="copy";var a=(h.getAttribute("data-im-widget-style")==="false")?false:true;if(a){d.style.width="200px";d.style.height="100px";d.style.paddingTop="20px";d.style.backgroundColor="#AAAAAA";d.style.border="3px dotted #808080";d.style.textAlign="center";d.style.fontSize="75%";var p=INTERMediatorOnPage.getMessages()[3101].split(/\n/);for(var q=0;q<p.length;q++){if(q>0){d.appendChild(document.createElement("BR"))}d.appendChild(document.createTextNode(p[q]))}}}else{l=document.createElement("FORM");l.className="_im_fileupload_form";l.setAttribute("method","post");l.setAttribute("action",INTERMediatorOnPage.getEntryPath()+"?access=uploadfile");l.setAttribute("enctype","multipart/form-data");var o=document.createElement("DIV");o.className="_im_fileupload_form_wrapper form-wrapper";o.appendChild(l);d.appendChild(o);if(this.progressSupported){b=document.createElement("INPUT");b.setAttribute("type","hidden");b.setAttribute("name","APC_UPLOAD_PROGRESS");b.setAttribute("id","progress_key");b.setAttribute("value",this.uploadId+(this.ids.length-1));l.appendChild(b)}b=document.createElement("INPUT");b.setAttribute("type","hidden");b.setAttribute("name","_im_redirect");b.setAttribute("value",location.href);l.appendChild(b);b=document.createElement("INPUT");b.setAttribute("type","hidden");b.setAttribute("name","_im_contextnewrecord");b.setAttribute("value","uploadfile");l.appendChild(b);b=document.createElement("INPUT");b.setAttribute("type","hidden");b.setAttribute("name","access");b.setAttribute("value","uploadfile");l.appendChild(b);b=document.createElement("INPUT");b.setAttribute("type","file");b.setAttribute("accept","*/*");b.setAttribute("name","_im_uploadfile");b.className="_im_uploadfile";b.addEventListener("change",function(){if(this.files[0].size>0){this.nextSibling.removeAttribute("disabled")}},false);l.appendChild(b);var v,g;v=document.createElement("DIV");v.className="_im_fileupload_cancel_button_wrapper";g=document.createElement("BUTTON");g.className="_im_fileupload_cancel_button";g.appendChild(document.createTextNode(this.uploadCancelButtonLabel));v.appendChild(g);e=document.createElement("BUTTON");e.className="_im_fileupload_button";e.setAttribute("type","submit");e.setAttribute("disabled","");e.appendChild(document.createTextNode(this.uploadButtonLabel));d.addEventListener("click",function(c){if(this.children.length>0){if(this.children[0].style.display==="none"||this.children[0].style.display===""){this.children[0].style.display="flex";this.children[0].style.display="-webkit-flex"}}},true);v.addEventListener("click",function(i){this.parentNode.style.display="none"});o.appendChild(v);l.appendChild(e);this.formFromId[n]=l}if(h.getAttribute("data-im-widget-inner")==="true"){var f=h.children;for(var t=f.length-1;t>=0;t--){d.appendChild(f[t])}}h.appendChild(d);d._im_getValue=function(){var c=d;return c.value};h._im_getValue=function(){var c=d;return c.value};h._im_getComponentId=function(){var c=n;return c};h._im_setValue=function(i){var c=d;if(this.html5DDSuported){}}},ids:[],formFromId:{},finish:function(){var d,a,h,b,f,e,k,m,c;if(this.html5DDSuported){for(f=0;f<this.ids.length;f++){e=this.ids[f];h=document.getElementById(e);if(h){INTERMediatorLib.addEvent(h,"dragleave",function(i){i.preventDefault();i.target.style.backgroundColor="#AAAAAA"});INTERMediatorLib.addEvent(h,"dragover",function(i){i.preventDefault();i.target.style.backgroundColor="#AADDFF"});k=this.progressSupported;m=this.ids.length;c=this.uploadId;INTERMediatorLib.addEvent(h,"drop",(function(){var r=f;var o=k;var i=m;var q=c;var p=e;return function(w){var v,x;w.preventDefault();var y=w.currentTarget;if(o){var u=document.createElement("iframe");u.setAttribute("id","upload_frame"+i);u.setAttribute("name","upload_frame");u.setAttribute("frameborder","0");u.setAttribute("border","0");u.setAttribute("scrolling","no");u.setAttribute("scrollbar","no");u.style.width="100%";u.style.height="24px";y.appendChild(u)}for(var t=0;t<w.dataTransfer.files.length;t++){v=w.dataTransfer.files[t];x=document.createElement("DIV");x.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3102]+v.name));x.style.marginTop="20px";x.style.backgroundColor="#FFFFFF";x.style.textAlign="center";w.target.appendChild(x)}var s=IMLibContextPool.getContextInfoFromId(y.getAttribute("id"),"");if(o){u.style.display="block";setTimeout(function(){u.setAttribute("src","upload_frame.php?up_id="+q+r)})}INTERMediator_DBAdapter.uploadFile("&_im_contextname="+encodeURIComponent(s.context.contextName)+"&_im_field="+encodeURIComponent(s.field)+"&_im_keyfield="+encodeURIComponent(s.record.split("=")[0])+"&_im_keyvalue="+encodeURIComponent(s.record.split("=")[1])+"&_im_contextnewrecord="+encodeURIComponent("uploadfile")+(o?("&APC_UPLOAD_PROGRESS="+encodeURIComponent(q+r)):""),{fileName:v.name,content:v},function(C){var H,E,F=null,z,D,A;A=IMLibContextPool.getContextDef(s.context.contextName);if(A["file-upload"]){var B="";for(var G in A["file-upload"]){if(A["file-upload"][G]["field"]==s.field){B=A["file-upload"][G]["context"];break}}z=IMLibContextPool.getKeyFieldValueFromId(p,"");F=IMLibContextPool.getContextsFromNameAndForeignValue(B,z,A.key)}else{F=IMLibContextPool.getContextFromName(s.context.contextName)}E=IMLibContextPool.getContextInfoFromId(p,"");E.context.setValue(E.record,E.field,C);if(F){for(D=0;D<F.length;D++){H=F[D];INTERMediator.construct(H)}}INTERMediator.flushMessage();if(h.getAttribute("data-im-widget-reload")==="true"){INTERMediator.construct()}w.target.style.backgroundColor="#AAAAAA"},function(){w.target.style.backgroundColor="#AAAAAA"})}})())}}}else{for(f=0;f<this.ids.length;f++){h=document.getElementById(this.ids[f]);b=h.getElementsByTagName("FORM")[0];if(h&&b){var g=IMLibContextPool.getContextInfoFromId(this.ids[f],"");var l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_contextname");l.setAttribute("value",g.context.contextName);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_field");l.setAttribute("value",g.field);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_keyfield");l.setAttribute("value",g.record.split("=")[0]);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_keyvalue");l.setAttribute("value",g.record.split("=")[1]);b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","clientid");if(INTERMediatorOnPage.authUser.length>0){l.value=INTERMediatorOnPage.clientId}b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","authuser");if(INTERMediatorOnPage.authUser.length>0){l.value=INTERMediatorOnPage.authUser}b.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","response");if(INTERMediatorOnPage.authUser.length>0){if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){d=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=d.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");l.value=a}else{l.value="dummy"}}b.appendChild(l);if(INTERMediatorOnPage.authUser.length>0){l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","cresponse");l.setAttribute("value",INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+IMLib.nl_char+INTERMediatorOnPage.authChallenge));b.appendChild(l)}if(this.progressSupported){l=document.createElement("iframe");l.setAttribute("id","upload_frame"+f);l.setAttribute("name","upload_frame");l.setAttribute("frameborder","0");l.setAttribute("border","0");l.setAttribute("scrolling","no");l.setAttribute("scrollbar","no");b.appendChild(l);INTERMediatorLib.addEvent(b,"submit",(function(){var i=f;return function(p){var o=document.getElementById("upload_frame"+i);o.style.display="block";setTimeout(function(){var q=n()+"?uploadprocess="+this.uploadId+i;o.setAttribute("src",q)});return true}})())}}}}this.ids=[];this.formFromId={};function n(){var p=document.getElementsByTagName("SCRIPT");for(var q=0;q<p.length;q++){var o=p[q].getAttribute("src");if(o.match(/\.php/)){return o}}return null}}};IMParts_Catalog.jsonformat={instanciate:function(a){var b=a.getAttribute("id")+"-jsonf";var c=document.createElement("pre");c.setAttribute("id",b);a.appendChild(c);IMParts_Catalog.jsonformat.ids.push(b);a._im_getComponentId=(function(){var d=b;return function(){return d}})();a._im_setValue=(function(){var d=b;return function(e){IMParts_Catalog.jsonformat.initialValues[d]=e?JSON.stringify(JSON.parse(e),null,"    "):""}})()},ids:[],initialValues:{},finish:function(){for(var b=0;b<IMParts_Catalog.jsonformat.ids.length;b++){var a=IMParts_Catalog.jsonformat.ids[b];var c=document.getElementById(a);if(c){c.appendChild(document.createTextNode(IMParts_Catalog.jsonformat.initialValues[a]))}}IMParts_Catalog.jsonformat.ids=[];IMParts_Catalog.jsonformat.initialValues={}}};IMLibPageNavigation={deleteInsertOnNavi:[],navigationSetup:function(){var b,p,q,g,n,e,t,f,o,h,s,l,a,d,m,c,u,r,k;b=document.getElementById("IM_NAVIGATOR");if(b!==null){q=b.childNodes;for(p=0;p<q.length;p++){b.removeChild(q[p])}b.innerHTML="";b.setAttribute("class","IM_NAV_panel");g=INTERMediator.navigationLabel;if(g===null||g[8]!==false){n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode(((g===null||g[8]===null)?INTERMediatorOnPage.getMessages()[2]:g[8])));n.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(n,"click",function(){INTERMediator.initialize();IMLibLocalContext.archive();location.reload()})}if(g===null||g[4]!==false){e=Number(INTERMediator.startFrom);t=Number(INTERMediator.pagedSize);f=Number(INTERMediator.pagedAllCount);o=" IM_NAV_disabled";n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode(((g===null||g[4]===null)?INTERMediatorOnPage.getMessages()[1]:g[4])+(f===0?0:e+1)+((Math.min(e+t,f)-e>1)?(((g===null||g[5]===null)?"-":g[5])+Math.min(e+t,f)):"")+((g===null||g[6]===null)?" / ":g[6])+(f)+((g===null||g[7]===null)?"":g[7])));n.setAttribute("class","IM_NAV_info")}if((g===null||g[0]!==false)&&INTERMediator.pagination===true){n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[0]===null)?"<<":g[0]));n.setAttribute("class","IM_NAV_button"+(e===0?o:""));INTERMediatorLib.addEvent(n,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=0;INTERMediator.constructMain(true)});n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[1]===null)?"<":g[1]));n.setAttribute("class","IM_NAV_button"+(e===0?o:""));s=(e-t>0)?e-t:0;INTERMediatorLib.addEvent(n,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=s;INTERMediator.constructMain(true)});n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[2]===null)?">":g[2]));n.setAttribute("class","IM_NAV_button"+(e+t>=f?o:""));l=(e+t<f)?e+t:((f-t>0)?e:0);INTERMediatorLib.addEvent(n,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=l;INTERMediator.constructMain(true)});n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[3]===null)?">>":g[3]));n.setAttribute("class","IM_NAV_button"+(e+t>=f?o:""));if(f%t===0){a=f-(f%t)-t}else{a=f-(f%t)}INTERMediatorLib.addEvent(n,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=(a>0)?a:0;INTERMediator.constructMain(true)});n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[10]));h=document.createElement("INPUT");h.setAttribute("class","IM_NAV_JUMP");h.setAttribute("type","text");h.setAttribute("value",Math.ceil(INTERMediator.startFrom/t+1));n.appendChild(h);n.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[11]));INTERMediatorLib.addEvent(h,"change",function(){if(h.value<1){h.value=1}var i=Math.ceil(f/t);if(i<h.value){h.value=i}INTERMediator.startFrom=(~~h.value-1)*t;INTERMediator.construct(true)})}if(g===null||g[9]!==false){for(p=0;p<IMLibPageNavigation.deleteInsertOnNavi.length;p++){switch(IMLibPageNavigation.deleteInsertOnNavi[p]["kind"]){case"INSERT":n=document.createElement("SPAN");b.appendChild(n);u=IMLibPageNavigation.deleteInsertOnNavi[p]["name"];r=IMLibContextPool.getContextDef(u);if(r&&r["button-names"]&&r["button-names"]["insert"]){k=r["button-names"]["insert"]}else{k=INTERMediatorOnPage.getMessages()[3]+": "+u}n.appendChild(document.createTextNode(k));n.setAttribute("class","IM_NAV_button");d=function(v,i,z){var y=v,x=i,w=z;return function(){IMLibPageNavigation.insertRecordFromNavi(y,x,w)}};INTERMediatorLib.addEvent(n,"click",d(IMLibPageNavigation.deleteInsertOnNavi[p]["name"],IMLibPageNavigation.deleteInsertOnNavi[p]["key"],IMLibPageNavigation.deleteInsertOnNavi[p]["confirm"]?true:false));break;case"DELETE":n=document.createElement("SPAN");b.appendChild(n);u=IMLibPageNavigation.deleteInsertOnNavi[p]["name"];r=IMLibContextPool.getContextDef(u);if(r&&r["button-names"]&&r["button-names"]["delete"]){k=r["button-names"]["delete"]}else{k=INTERMediatorOnPage.getMessages()[4]+": "+u}n.appendChild(document.createTextNode(k));n.setAttribute("class","IM_NAV_button");m=function(v,i,B,A){var z=v,x=i,y=B,w=A;return function(){IMLibPageNavigation.deleteRecordFromNavi(z,x,y,w)}};INTERMediatorLib.addEvent(n,"click",m(IMLibPageNavigation.deleteInsertOnNavi[p]["name"],IMLibPageNavigation.deleteInsertOnNavi[p]["key"],IMLibPageNavigation.deleteInsertOnNavi[p]["value"],IMLibPageNavigation.deleteInsertOnNavi[p]["confirm"]?true:false));break;case"COPY":n=document.createElement("SPAN");b.appendChild(n);u=IMLibPageNavigation.deleteInsertOnNavi[p]["name"];r=IMLibContextPool.getContextDef(u);if(r&&r["button-names"]&&r["button-names"]["copy"]){k=r["button-names"]["copy"]}else{k=INTERMediatorOnPage.getMessages()[15]+": "+u}n.appendChild(document.createTextNode(k));n.setAttribute("class","IM_NAV_button");c=function(w,i){var x=w,v=i;return function(){IMLibPageNavigation.copyRecordFromNavi(x,v)}};INTERMediatorLib.addEvent(n,"click",c(IMLibPageNavigation.deleteInsertOnNavi[p]["contextDef"],IMLibPageNavigation.deleteInsertOnNavi[p]["keyValue"]));break}}}if(g===null||g[10]!==false){if(INTERMediatorOnPage.getOptionsTransaction()=="none"){n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[10]===null)?INTERMediatorOnPage.getMessages()[7]:g[10]));n.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(n,"click",IMLibPageNavigation.saveRecordFromNavi)}}if(g===null||g[11]!==false){if(INTERMediatorOnPage.requireAuthentication){n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[8]+INTERMediatorOnPage.authUser));n.setAttribute("class","IM_NAV_info");n=document.createElement("SPAN");b.appendChild(n);n.appendChild(document.createTextNode((g===null||g[11]===null)?INTERMediatorOnPage.getMessages()[9]:g[11]));n.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(n,"click",function(){INTERMediatorOnPage.logout();location.reload()})}}}},insertRecordFromNavi:function(c,g,e){var f,b,d;if(e){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();d=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c);if(d===null){alert("no targetname :"+c);INTERMediatorOnPage.hideProgress();return}try{INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_createRecord_async({name:c,dataset:[]},function(h){var i=h.newRecordKeyValue;if(i>-1){b=INTERMediator.additionalCondition;if(d.records<=1){INTERMediator.startFrom=0;INTERMediator.pagedAllCount=1;f=INTERMediator.additionalCondition;f[c]={field:g,value:i};INTERMediator.additionalCondition=f;IMLibLocalContext.archive()}else{INTERMediator.pagedAllCount++}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=b;IMLibPageNavigation.navigationSetup()}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},null)}catch(a){if(a=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.insertRecordFromNavi(c,g,e)});INTERMediator.flushMessage();return}}}else{INTERMediator.setErrorMessage(a,"EXCEPTION-5")}}},deleteRecordFromNavi:function(b,e,d,c){if(c){if(!confirm(INTERMediatorOnPage.getMessages()[1025])){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_delete_async({name:b,conditions:[{field:e,operator:"=",value:d}]},function(){INTERMediator.pagedAllCount--;INTERMediator.totalRecordCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom--;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}INTERMediator.constructMain(true);INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},null)}catch(a){INTERMediator.setErrorMessage(a,"EXCEPTION-6")}},copyRecordFromNavi:function(f,d){var l,e,a,c,b,k,g;INTERMediatorOnPage.showProgress();if(f["repeat-control"].match(/confirm-copy/)){if(!confirm(INTERMediatorOnPage.getMessages()[1041])){return}}try{if(f.relation){for(g in f.relation){if(f.relation[g]["portal"]==true){f.portal=true}}}l=[];if(f["repeat-control"].match(/copy-/)){b=f["repeat-control"].indexOf("copy-");k=f["repeat-control"].substr(b+5);if((b=k.search(/\s/))>-1){k=k.substr(0,b)}c=k.split(",");for(e=0;e<c.length;e++){a=IMLibContextPool.getContextDef(c[e]);if(a.relation[0]["foreign-key"]){l.push({name:a.name,field:a.relation[0]["foreign-key"],value:d})}}}INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_copy_async({name:f.name,conditions:[{field:f.key,operator:"=",value:d}],associated:l.length>0?l:null},(function(){var i=f;return function(m){var o,p;var n=m.newRecordKeyValue;if(n>-1){o=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(i.records<=1){p=INTERMediator.additionalCondition;p[i.name]={field:i.key,value:n};INTERMediator.additionalCondition=p;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=o}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})(),null)}catch(h){INTERMediator.setErrorMessage(h,"EXCEPTION-43")}},saveRecordFromNavi:function(h){var o,b,k,q,g,m,n,e,l,t,f,s,r=true,c,d,a;INTERMediatorOnPage.showProgress();INTERMediatorOnPage.retrieveAuthInfo();for(n=0;n<IMLibContextPool.poolingContexts.length;n++){c=IMLibContextPool.poolingContexts[n];d=c.getModified();for(o in d){if(d.hasOwnProperty(o)){t=[];f=[];for(b in d[o]){if(d[o].hasOwnProperty(b)){t.push(b);f.push({field:b,value:d[o][b]})}}if(!INTERMediator.ignoreOptimisticLocking){k=o.split("=");q=k[0];k.shift();g=k.join("=");m={name:c.contextName,records:1,paging:false,fields:t,parentkeyvalue:null,conditions:[{field:q,operator:"=",value:g}],useoffset:false,primaryKeyOnly:true};try{l=INTERMediator_DBAdapter.db_query(m)}catch(p){if(p=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating((function(){var i=m;return function(){INTERMediator.db_query(i)}})());return}}else{INTERMediator.setErrorMessage(p,"EXCEPTION-28")}}if(l.recordset===null||l.recordset[0]===null){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[t.join(",")]));return}if(l.count>1){a=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!a){return}}s=false;for(b in d[o]){if(d[o].hasOwnProperty(b)){e=c.getValue(o,b);if(e!=l.recordset[0][b]){s+=INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1035],[b,l.recordset[0][b],d[o][b]])}}}if(s!==false){if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1034],[s]))){return}INTERMediatorOnPage.retrieveAuthInfo()}}try{INTERMediator_DBAdapter.db_update({name:c.contextName,conditions:[{field:q,operator:"=",value:g}],dataset:f})}catch(p){if(p=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.saveRecordFromNavi(h)});return}}else{INTERMediator.setErrorMessage(p,"EXCEPTION-29")}}c.clearModified()}}}if(r&&(h!==true)){INTERMediator.constructMain(true)}INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}};var IMLibUI={isShiftKeyDown:false,isControlKeyDown:false,mobileSelectionColor:"#BBBBBB",mobileNaviBackButtonId:null,mergedFieldSeparator:"\n",changeValueLock:{},keyDown:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=true}if(b==17){IMLibUI.isControlKeyDown=true}},keyUp:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=false}if(b==17){IMLibUI.isControlKeyDown=false}},lockUIElement:function(a){IMLibUI.changeValueLock[a]=true},isLockUIElement:function(a){return IMLibUI.changeValueLock[a]===true},hasLockUIElement:function(){var b,a=false;for(b in IMLibUI.changeValueLock){a|=IMLibUI.changeValueLock[b]}return a},unlockUIElement:function(a){IMLibUI.changeValueLock[a]=false},clearLockInfo:function(a){IMLibUI.changeValueLock={}},valueChange:function(s,m){var t,h,n,g,e,b,r,o,c,k,p,d,l,f,a,q;if(IMLibUI.isShiftKeyDown&&IMLibUI.isControlKeyDown){INTERMediator.setDebugMessage("Canceled to update the value with shift+control keys.");INTERMediator.flushMessage();IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;return true}IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;t=document.getElementById(s);if(!t){return false}if(t.readOnly){return true}if(!m&&IMLibUI.isLockUIElement(s)){setTimeout((function(){var u=s;var i=m;return function(){IMLibUI.valueChange(u,i)}})(),100);return true}IMLibUI.lockUIElement(s);b=INTERMediatorLib.getLinkedElementInfo(t);r=INTERMediatorLib.getNodeInfoArray(b[0]);o=IMLibContextPool.getContextInfoFromId(s,r.target);if(!o){IMLibUI.unlockUIElement(s);a=document.getElementById(s);q=a.getAttribute("data-im");if(q&&q.split(INTERMediator.separator)[0]==IMLibLocalContext.contextName){IMLibLocalContext.updateFromNodeValue(s);IMLibCalc.recalculation();return true}return false}if(!IMLibUI.validation(t)){t.focus();window.setTimeout((function(){var u=t;var i=o;return function(){if(i){u.value=i.context.getValue(i.record,i.field)}u.removeAttribute("data-im-validation-notification")}})(),0);return false}if(m===true){IMLibUI.unlockUIElement(s);return true}h=t.getAttribute("type");if(h==="radio"&&!t.checked){INTERMediatorOnPage.hideProgress();return true}if(!o){IMLibUI.unlockUIElement(s);return false}g=IMLibElement.getValueFromIMNode(t);c=o.context.parentContext;if(c){e=c.isValueUndefined(Object.keys(c.store)[0],o.field,o.record)}else{e=o.context.isValueUndefined(o.record,o.field,false)}if(e){INTERMediator.setErrorMessage("Error in updating.",INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1040],[o.context.contextName,o.field]));IMLibUI.unlockUIElement(s);return false}if(INTERMediatorOnPage.getOptionsTransaction()=="none"){o.context.setModified(o.record,o.field,g);IMLibUI.unlockUIElement(s);return false}INTERMediatorOnPage.showProgress();o.context.updateFieldValue(s,(function(){var i=s;var u=o;var v=g;return function(x){var D,z,w,A;var B=u.context.getKeyField();if(x&&x.dbresult){var y=x.dbresult[0];var C=INTERMediator.partialConstructing;INTERMediator.partialConstructing=false;for(A in y){u.context.setValue(B+"="+y[B],A,y[A])}}INTERMediator.partialConstructing=C;D=IMLibContextPool.dependingObjects(i);for(n=0;n<D.length;n++){D[n].foreignValue={};D[n].foreignValue[u.field]=v;if(D[n]){INTERMediator.constructMain(D[n]);w=D[n].enclosureNode;if(INTERMediatorLib.isPopupMenu(w)){z=o.context.getContextValue(w.id,"");IMLibElement.setValueToIMNode(w,"",z,false)}}}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage();IMLibUI.unlockUIElement(i)}})(),(function(){var i=l;return function(){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[i]));INTERMediatorOnPage.hideProgress();IMLibUI.clearLockInfo()}})(),function(){var i=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!i){INTERMediatorOnPage.hideProgress();IMLibUI.clearLockInfo()}return i},(function(){var i=t;return function(v,w,u){if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1001],[v,w,u]))){window.setTimeout(function(){i.focus()},0);INTERMediatorOnPage.hideProgress();IMLibUI.clearLockInfo();return false}return true}})());return true},validation:function(d){var k,c,b,f,l,h,g,n,e=[],a;if(e){while(e.length>0){e[0].parentNode.removeChild(e[0]);delete e[0]}}if(!e){e=[]}try{k=INTERMediatorLib.getLinkedElementInfo(d);h=false;n=true;if(k.length>0){c=k[0].match(/([^@]+)/);if(c[1]!==IMLibLocalContext.contextName){b=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c[1]);if(b!=null&&b.validation!=null){for(f=0;f<k.length;f++){c=k[f].match(/([^@]+)@([^@]+)/);for(l in b.validation){if(b.validation[l].field===c[2]){h=true;n=Parser.evaluate(b.validation[l].rule,{value:d.value,target:d});if(!n){switch(b.validation[l].notify){case"inline":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("SPAN",b.validation[l].message);d.parentNode.insertBefore(a,d.nextSibling);e.push(a);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("DIV",b.validation[l].message);d.parentNode.appendChild(a);e.push(a);break;default:if(d.getAttribute("data-im-validation-notification")!=="alert"){alert(b.validation[l].message);d.setAttribute("data-im-validation-notification","alert")}break}g=IMLibContextPool.getContextInfoFromId(d,"");if(g){d.value=g.context.getValue(g.record,g.field);window.setTimeout(function(){d.focus()},0);if(INTERMediatorOnPage.doAfterValidationFailure!==null){INTERMediatorOnPage.doAfterValidationFailure(d,k[f])}}return n}else{switch(b.validation[l].notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);break}}}}}}}if(h){if(INTERMediatorOnPage.doAfterValidationSucceed!=null){n=INTERMediatorOnPage.doAfterValidationSucceed(d,k[f])}}}return n}catch(m){if(m==="_im_requath_request_"){throw m}else{INTERMediator.setErrorMessage(m,"EXCEPTION-32: on the validation process.")}return false}},copyButton:function(k,d){var f,m,e,g,a,c,b,l;INTERMediatorOnPage.showProgress();f=k.getContextDef();if(f["repeat-control"].match(/confirm-copy/)){if(!confirm(INTERMediatorOnPage.getMessages()[1041])){return}}try{if(f.relation){for(g in f.relation){if(f.relation[g]["portal"]==true){f.portal=true}}}m=[];if(f["repeat-control"].match(/copy-/)){b=f["repeat-control"].indexOf("copy-");l=f["repeat-control"].substr(b+5);if((b=l.search(/\s/))>-1){l=l.substr(0,b)}c=l.split(",");for(e=0;e<c.length;e++){a=IMLibContextPool.getContextDef(c[e]);if(a.relation[0]["foreign-key"]){m.push({name:a.name,field:a.relation[0]["foreign-key"],value:d})}}}INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_copy_async({name:f.name,conditions:[{field:f.key,operator:"=",value:d}],associated:m.length>0?m:null},(function(){var i=f;var n=k;return function(o){var r,s,p;var q=o.newRecordKeyValue;if(q>-1){r=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(i.records<=1){s=INTERMediator.additionalCondition;s[i.name]={field:i.key,value:q};INTERMediator.additionalCondition=s;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(n);p=IMLibContextPool.getContextsWithSameOrigin(n);for(e=0;e<p.length;e++){INTERMediator.constructMain(p[e],null)}INTERMediator.additionalCondition=r}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})(),null)}catch(h){INTERMediator.setErrorMessage(h,"EXCEPTION-43")}},deleteButton:function(b,c,d,f){var e,a,k,h,l;if(f){a=INTERMediatorOnPage.getMessages()[1025];if(!window.confirm(a)){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();h=(function(){var i=b;var m=c+"="+d;return function(){if(i.relation==true){INTERMediator.pagedAllCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom=INTERMediator.startFrom-INTERMediator.pagedSize;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}if(INTERMediator.pagedAllCount>=INTERMediator.pagedSize){INTERMediator.construct()}}IMLibPageNavigation.navigationSetup();l=i.binding[m]["_im_repeater"];for(e=0;e<l.length;e++){IMLibContextPool.removeRecordFromPool(l[e].id)}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})();if(b.isPortal){k=b.potalContainingRecordKV.split("=");INTERMediator_DBAdapter.db_update_async({name:b.parentContext.contextName,conditions:[{field:k[0],operator:"=",value:k[1]}],dataset:[{field:"-delete.related",operator:"=",value:b.contextName+"."+d}]},h,null)}else{INTERMediator_DBAdapter.db_delete_async({name:b.contextName,conditions:[{field:c,operator:"=",value:d}]},h,function(){INTERMediator.setErrorMessage("Delete Error","EXCEPTION-46")})}}catch(g){if(g=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibUI.deleteButton(b,c,d,false)});return}}else{INTERMediator.setErrorMessage(g,"EXCEPTION-3")}}},insertButton:function(d,e,m,p,k){var c,n,l,a,q,g,i,h=false,o,f;if(k){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();f=d.contextName;c=d.getContextDef();n=[];o=[];if(m!=null){for(l in c.relation){if(c.relation.hasOwnProperty(l)){n.push({field:c.relation[l]["foreign-key"],value:m[c.relation[l]["join-field"]]})}}}INTERMediatorOnPage.retrieveAuthInfo();if(d.isPortal){o=[];for(l in c["default-values"]){if(c["default-values"].hasOwnProperty(l)){o.push({field:f+"::"+c["default-values"][l]["field"]+".0",value:c["default-values"][l]["value"]})}}if(o.length==0){i="";a=INTERMediator_DBAdapter.db_query({name:f,records:1,conditions:[{field:c.key?c.key:"-recid",operator:"=",value:e}]});for(q in a.recordset[0][0]){if(q.indexOf(f+"::")>-1&&q!==f+"::-recid"){h=true;g=q;if(q==f+"::"+n[0]["field"]){i=n[0]["value"];break}if(q!=f+"::id"&&q!=f+"::"+n[0]["field"]){break}}}if(h==false){a=INTERMediator_DBAdapter.db_query({name:f,records:0,conditions:[{field:c.key?c.key:"-recid",operator:"=",value:e}]});for(q in a.recordset){if(q.indexOf(f+"::")>-1&&q!==f+"::-recid"){g=q;if(q==f+"::"+n[0]["field"]){i=n[0]["value"];break}if(q!=f+"::id"&&q!=f+"::"+n[0]["field"]){break}}}}o.push({field:g+".0",value:i})}if(c.relation&&c.relation[0]&&c.relation[0]["join-field"]){INTERMediator_DBAdapter.db_update({name:d.parentContext.contextName,conditions:[{field:c.relation[0]["join-field"],operator:"=",value:m.id}],dataset:o});INTERMediator.constructMain()}else{INTERMediator.setErrorMessage("Insert Error (Portal Access Mode)","EXCEPTION-4")}}else{INTERMediator_DBAdapter.db_createRecord_async({name:f,dataset:n},b(f,c,p,m,h),function(){INTERMediator.setErrorMessage("Insert Error","EXCEPTION-4")})}function b(x,u,B,z,y){var t=x;var A=u;var w=B;var s=z;var v=y;var r=e;return function(C){var H,J,E,G,I,F,D;J=C.newRecordKeyValue;H=A.key?A.key:"-recid";E=IMLibContextPool.contextFromEnclosureId(w);if(E){E.foreignValue=s;if(A.portal==true&&v==false){G=INTERMediator.additionalCondition;G[t]={field:H,operator:"=",value:r};INTERMediator.additionalCondition=G}I=[{}];I[0][H]=J;INTERMediator.constructMain(E,C.dbresult);D=IMLibContextPool.getContextsWithSameOrigin(E);for(F=0;F<D.length;F++){INTERMediator.constructMain(D[F],null)}}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}}},clickPostOnlyButton:function(u){var y,x,d,h,A,t,f,z,E;var n,C,c,w,b,p,r;var e,v,l,a,m,D;var g=u.parentNode;while(!INTERMediatorLib.isEnclosure(g,true)){g=g.parentNode;if(!g){return}}if(INTERMediatorOnPage.processingBeforePostOnlyContext){if(!INTERMediatorOnPage.processingBeforePostOnlyContext(g)){return}}D=[];e=[];v=[];for(y=0;y<g.childNodes.length;y++){o(g.childNodes[y]);s(g.childNodes[y])}t={};for(y=0;y<D.length;y++){h=INTERMediatorLib.getLinkedElementInfo(D[y]);for(x=0;x<h.length;x++){A=h[x].split(INTERMediator.separator);if(!t[A[x]]){t[A[x]]=0}t[A[x]]++}}if(t.length<1){return}var q=-100;for(var B in t){if(q<t[B]){q=t[B];f=B;z=INTERMediatorOnPage.getContextInfo(B)}}r="";d=[];a=false;for(y=0;y<e.length;y++){h=INTERMediatorLib.getLinkedElementInfo(e[y]);for(x=0;x<h.length;x++){A=h[x].split(INTERMediator.separator);if(A[0]==f){if(z.validation){for(l in z.validation){E=z.validation[l];if(E&&E.field==A[1]){switch(E.notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(e[y]);break}}}for(l in z.validation){E=z.validation[l];if(E.field==A[1]){if(E){p=Parser.evaluate(E.rule,{value:e[y].value,target:e[y]});if(!p){a=true;switch(E.notify){case"inline":INTERMediatorLib.clearErrorMessage(e[y]);b=INTERMediatorLib.createErrorMessageNode("SPAN",E.message);e[y].parentNode.insertBefore(b,e[y].nextSibling);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(e[y]);b=INTERMediatorLib.createErrorMessageNode("DIV",E.message);e[y].parentNode.appendChild(b);break;default:r+=E.message+IMLib.nl_char}if(INTERMediatorOnPage.doAfterValidationFailure!=null){INTERMediatorOnPage.doAfterValidationFailure(e[y])}}}}}}if(INTERMediatorLib.isWidgetElement(e[y])){d.push({field:A[1],value:e[y]._im_getValue()})}else{if(e[y].tagName=="SELECT"){d.push({field:A[1],value:e[y].value})}else{if(e[y].tagName=="TEXTAREA"){d.push({field:A[1],value:e[y].value})}else{if(e[y].tagName=="INPUT"){if((e[y].getAttribute("type")=="radio")||(e[y].getAttribute("type")=="checkbox")){if(e[y].checked){d.push({field:A[1],value:e[y].value})}}else{d.push({field:A[1],value:e[y].value})}}}}}}}}for(y=0;y<v.length;y++){h=INTERMediatorLib.getNamedInfo(v[y]);for(x=0;x<h.length;x++){A=h[x].split(INTERMediator.separator);if(A[0]==f){n=[];if(v[y].tagName=="INPUT"){C=[v[y]]}else{C=v[y].getElementsByTagName("INPUT")}for(w=0;w<C.length;w++){c=C[w].getAttribute("type");if(c=="radio"||c=="checkbox"){if(C[w].checked){n.push(C[w].value)}}else{n.push(C[w].value)}}if(n.length>0){m=false;for(l=0;l<d.length;l++){if(d[l]["field"]==A[1]){d[l]["value"]+=IMLibUI.mergedFieldSeparator;d[l]["value"]+=n.join(IMLibUI.mergedFieldSeparator);m=true}}if(!m){d.push({field:A[1],value:n.join(IMLibUI.mergedFieldSeparator)})}}}}}if(r.length>0){window.alert(r);return}if(a){return}z=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",f);if(INTERMediatorOnPage.modifyPostOnlyContext){z=INTERMediatorOnPage.modifyPostOnlyContext(z)}INTERMediator_DBAdapter.db_createRecord_async({name:f,dataset:d},function(i){var F,I,H=u,G=z,k=false;INTERMediator.flushMessage();if(INTERMediatorOnPage.processingAfterPostOnlyContext){INTERMediatorOnPage.processingAfterPostOnlyContext(H,i.newRecordKeyValue)}if(G["post-dismiss-message"]){I=H.parentNode;I.removeChild(H);F=document.createElement("SPAN");INTERMediatorLib.setClassAttributeToNode(F,"IM_POSTMESSAGE");F.appendChild(document.createTextNode(G["post-dismiss-message"]));I.appendChild(F);k=true}if(G["post-reconstruct"]){setTimeout(function(){INTERMediator.construct(true)},k?INTERMediator.waitSecondsAfterPostMessage*1000:0)}if(G["post-move-url"]){setTimeout(function(){location.href=G["post-move-url"]},k?INTERMediator.waitSecondsAfterPostMessage*1000:0)}},null);function o(G){var F,k;if(G.nodeType===1){if(INTERMediatorLib.isLinkedElement(G)){D.push(G)}else{if(INTERMediatorLib.isWidgetElement(G)){D.push(G)}else{if(INTERMediatorLib.isEnclosure(G)){return}F=G.childNodes;for(k=0;k<F.length;k++){o(F[k])}}}}}function s(G){var F,k;if(G.nodeType===1){if(INTERMediatorLib.isNamedElement(G)){v.push(G)}else{if(INTERMediatorLib.isLinkedElement(G)){e.push(G)}else{if(INTERMediatorLib.isWidgetElement(G)){e.push(G)}else{F=G.childNodes;for(k=0;k<F.length;k++){s(F[k])}}}}}}},eventUpdateHandler:function(b){IMLibLocalContext.updateAll();var a=IMLibContextPool.getContextFromName(b);INTERMediator.constructMain(a[0])},eventAddOrderHandler:function(g){var a,c,d,f,b;if(g.target){a=g.target.getAttribute("data-im")}else{a=g.srcElement.getAttribute("data-im")}c=a.split(":");if(c[0]!="_@addorder"||c.length<3){return}for(d in IMLibLocalContext.store){f=d.split(":");if(f.length>3&&f[0]=="valueofaddorder"&&f[1]==c[1]){b=IMLibLocalContext.getValue(d);if(b){IMLibLocalContext.store[d]++}}}IMLibLocalContext.setValue("valueof"+a.substring(2),1);IMLibUI.eventUpdateHandler(c[1])}};var biRadixBits=16;biRadixBits=biRadixBits-biRadixBits%4;var bitsPerDigit=biRadixBits;var biRadix=1<<biRadixBits;var biHalfRadix=biRadix>>>1;var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=4294967295;var biHexPerDigit=biRadixBits/4;var bigZero=biFromNumber(0);var bigOne=biFromNumber(1);function BigInt(a){this.isNeg=false;if(a==-1){return}if(a){this.digits=new Array(a);while(a){this.digits[--a]=0}}else{this.digits=[0]}}BigInt.prototype.isZero=function(){return this.digits[0]==0&&biNormalize(this).digits.length==1};BigInt.prototype.isOne=function(){return this.digits[0]==1&&!this.isNeg&&biNormalize(this).digits.length==1};BigInt.prototype.isEqual=function(b){var a;if(this.isNeg!=b.isNeg){return false}if(this.digits.length!=b.digits.length){return false}for(a=this.digits.length-1;a>-1;a--){if(this.digits[a]!=b.digits[a]){return false}}return true};BigInt.prototype.blankZero=function(){this.digits.length=1;this.digits[0]=0};BigInt.prototype.blankOne=function(){this.digits.length=1;this.digits[0]=1};BigInt.prototype.blankEmpty=function(){this.digits.length=0};function biCopy(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=b.isNeg;return a}function biAbs(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=false;return a}function biMinus(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=!b.isNeg;return a}function biFromNumber(c){var a,b;if(Math.abs(c)>maxInteger){return(biFromFloat(c))}a=new BigInt();if(a.isNeg=c<0){c=-c}b=0;while(c>0){a.digits[b++]=c&maxDigitVal;c>>>=biRadixBits}return a}function biFromFloat(d){var a,b,e;a=new BigInt();if(a.isNeg=d<0){d=-d}b=0;while(d>0){e=Math.floor(d/biRadix);a.digits[b++]=d-e*biRadix;d=e}return a}function biFromString(l,k){var a,e,m,b,d,f,g,h;if(k==16){return biFromHex(l)}a=l.charAt(0)=="-";e=(a?1:0)-1;m=new BigInt();b=biCopy(bigOne);for(d=l.length-1;d>e;d--){f=l.charCodeAt(d);g=charToHex(f);h=biMultiplyDigit(b,g);m=biAdd(m,h);b=biMultiplyDigit(b,k)}m.isNeg=a;return biNormalize(m)}function biFromDecimal(a){return biFromString(a,10)}function biFromHex(d){var b,a,c;b=new BigInt();if(d.charAt(0)=="-"){b.isNeg=true;d=substr(d,1)}else{b.isNeg=false}a=d.length;for(c=a,j=0;c>0;c-=biHexPerDigit,j++){b.digits[j]=hexToDigit(d.substr(Math.max(c-biHexPerDigit,0),Math.min(c,biHexPerDigit)))}return biNormalize(b)}function reverseStr(c){var a="",b;for(b=c.length-1;b>-1;b--){a+=c.charAt(b)}return a}var hexatrigesimalToChar=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];function biToString(d,f){var c,e,a;if(f==16){return biToHex(d)}c=biFromNumber(f);e=biDivideModulo(biAbs(d),c);a=hexatrigesimalToChar[e[1].digits[0]];while(!e[0].isZero()){e=biDivideModulo(e[0],c);a+=hexatrigesimalToChar[e[1].digits[0]]}return(d.isNeg?"-":"")+reverseStr(a)}function biToDecimal(a){return biToString(a,10)}var hexToChar=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function digitToHex(d){var b,a,c;b=15;a="";for(c=0;c<biHexPerDigit;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function digitToHexTrunk(d){var b,a,c;if(d==0){return"0"}b=15;a="";for(c=0;c<biHexPerDigit&&d>0;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function biToHex(b){var c,a;a=b.isNeg?"-":"";c=biHighIndex(b);a+=digitToHexTrunk(b.digits[c--]);while(c>-1){a+=digitToHex(b.digits[c--])}return a}function biToNumber(b){var a=0,d=1,c;c=biHighIndex(b)+1;for(var e=0;e<c;e++){a+=b.digits[e]*d;d*=biRadix}return b.isNeg?-a:a}function charToHex(i){var d=48;var b=d+9;var e=97;var h=e+25;var g=65;var f=65+25;var a;if(i>=d&&i<=b){a=i-d}else{if(i>=g&&i<=f){a=10+i-g}else{if(i>=e&&i<=h){a=10+i-e}else{a=0}}}return a}function hexToDigit(d){var b=0,a,c;a=Math.min(d.length,biHexPerDigit);for(c=0;c<a;c++){b<<=4;b|=charToHex(d.charCodeAt(c))}return b}function biDump(a){return(a.isNeg?"minus ":"plus ")+a.digits.join(" ")}function biNormalize(a){var b,c;b=a.digits.length;if(a.digits[b-1]!=0&&!isNaN(a.digits[b-1])){return a}for(c=b-1;c>0;c--){if(a.digits[c]==0||isNaN(a.digits[c])){a.digits.pop()}else{return a}}if(a.digits.length==1&&a.digits[0]==0){a.isNeg=false}if(isNaN(a.digits[0])){throw new Error("Undefined BigInt: "+biDump(a))}return a}function biHighIndex(a){biNormalize(a);return a.digits.length-1}function biNumBits(c){var f,e,b,a;f=biHighIndex(c);e=c.digits[f];b=(f+1)*bitsPerDigit;for(a=b;a>b-bitsPerDigit;a--){if((e&biHalfRadix)!=0){break}e<<=1}return a}function biCompareAbs(c,b){var a=biHighIndex(c);var e=biHighIndex(b);if(a!=e){return 1-2*((a<e)?1:0)}for(var d=c.digits.length-1;d>-1;d--){if(c.digits[d]!=b.digits[d]){return 1-2*((c.digits[d]<b.digits[d])?1:0)}}return 0}function biCompare(b,a){if(b.isNeg!=a.isNeg){return 1-2*(b.isNeg?1:0)}return b.isNeg?-biCompareAbs(b,a):biCompareAbs(b,a)}function biAddNatural(h,g){var f,e,d,l,m,a,b;f=biHighIndex(h)+1;e=biHighIndex(g)+1;d=0;l=0;if(f>e){m=biAbs(h);a=g;b=e}else{m=biAbs(g);a=h;b=f}while(d<b){m.digits[d]+=a.digits[d]+l;if(m.digits[d]<biRadix){l=0}else{m.digits[d]&=maxDigitVal;l=1}d++}while(l>0){m.digits[d]=(m.digits[d]||0)+l;if(m.digits[d]<biRadix){l=0}else{m.digits[d]&=maxDigitVal;l=1}d++}return m}function biSubtractNatural(h,g){var f,e,m,a,b,l,k,d;f=biHighIndex(h)+1;e=biHighIndex(g)+1;m=biAbs(h);a=m.digits;b=h.digits;l=g.digits;k=0;for(d=0;d<e;d++){if(b[d]>=l[d]-k){a[d]=b[d]-l[d]+k;k=0}else{a[d]=biRadix+b[d]-l[d]+k;k=-1}}while(k<0&&d<f){if(b[d]>=-k){a[d]=b[d]+k;k=0}else{a[d]=biRadix+b[d]+k;k=-1}d++}return biNormalize(m)}function biAdd(c,b){var a,d;if(!c.isNeg&&!b.isNeg){return biAddNatural(c,b)}if(c.isNeg&&b.isNeg){a=biAddNatural(c,b);a.isNeg=true;return a}d=biCompareAbs(c,b);if(d==0){return biFromNumber(0)}if(d>0){a=biSubtractNatural(c,b);a.isNeg=c.isNeg}if(d<0){a=biSubtractNatural(b,c);a.isNeg=b.isNeg}return a}function biSubtract(c,b){var a,d;if(!c.isNeg&&b.isNeg){return biAddNatural(c,b)}if(c.isNeg&&!b.isNeg){a=biAddNatural(c,b);a.isNeg=true;return a}d=biCompareAbs(c,b);if(d==0){return biCopy(bigZero)}if(d>0){a=biSubtractNatural(c,b);a.isNeg=c.isNeg}if(d<0){a=biSubtractNatural(b,c);a.isNeg=!c.isNeg}return a}function biMultiply(m,l){var o,e,q,r,a,b,p,h,g,d,f;e=biHighIndex(m)+1;q=biHighIndex(l)+1;if(e==1&&m.digits[0]==0||q==1&&l.digits[0]==0){return new BigInt()}r=new BigInt(e+q);a=r.digits;b=m.digits;p=l.digits;for(h=0;h<q;h++){o=0;f=h;for(g=0;g<e;g++,f++){d=a[f]+b[g]*p[h]+o;a[f]=d&maxDigitVal;o=d>>>biRadixBits}a[h+e]=o}r.isNeg=m.isNeg!=l.isNeg;return biNormalize(r)}function biMultiplyDigit(e,b){var h,a,g,d,f;h=biHighIndex(e)+1;a=new BigInt(h);g=0;for(d=0;d<h;d++){f=a.digits[d]+e.digits[d]*b+g;a.digits[d]=f&maxDigitVal;g=f>>>biRadixBits}a.digits[h]=g;return a}function arrayCopy(e,g,b,f,d){var c,a;if(g>=e.length){if(b.length==0){b[0]=0}return}for(c=0;c<f;c++){b[c]=0}a=Math.min(g+d,e.length);for(c=g,j=f;c<a;c++,j++){b[j]=e[c]}}function biShiftLeft(b,g){var d,a,f,c,e;d=Math.floor(g/bitsPerDigit);a=new BigInt();arrayCopy(b.digits,0,a.digits,d,b.digits.length);f=g%bitsPerDigit;c=bitsPerDigit-f;a.digits[a.digits.length]=a.digits[a.digits.length]>>>c;for(e=a.digits.length-1;e>0;e--){a.digits[e]=((a.digits[e]<<f)&maxDigitVal)|(a.digits[e-1]>>>c)}a.digits[0]=(a.digits[0]<<f)&maxDigitVal;a.isNeg=b.isNeg;return biNormalize(a)}function biShiftRight(b,g){var c,a,e,f,d;c=Math.floor(g/bitsPerDigit);a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);e=g%bitsPerDigit;f=bitsPerDigit-e;for(d=0;d<a.digits.length-1;d++){a.digits[d]=(a.digits[d]>>>e)|((a.digits[d+1]<<f)&maxDigitVal)}a.digits[a.digits.length-1]>>>=e;a.isNeg=b.isNeg;return biNormalize(a)}function biMultiplyByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,c,b.digits.length);return a}function biDivideByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);return a}function biModuloByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,0,c);return a}function biMultiplyModByRadixPower(q,o,d){var m,f,s,e,g,u,a,b,r,l,h;f=biHighIndex(q)+1;s=biHighIndex(o)+1;if(f==1&&q.digits[0]==0||s==1&&o.digits[0]==0){return new BigInt()}u=new BigInt(d);a=u.digits;b=q.digits;r=o.digits;for(l=0;l<s&&l<d;l++){m=0;g=l;for(h=0;h<f&&g<d;h++,g++){e=a[g]+b[h]*r[l]+m;a[g]=e&maxDigitVal;m=e>>>biRadixBits}a[l+f]=m}u=biModuloByRadixPower(u,d);u.isNeg=q.isNeg!=o.isNeg;return biNormalize(u)}function biDivideModuloNatural(l,h){var f,e,b,a,k,c,m,g;f=biHighIndex(l);e=biHighIndex(h);b=new BigInt(-1);b.digits=[];a=new BigInt();for(var d=f;d>-1;d--){a.digits.unshift(l.digits[d]);g=biCompareAbs(h,a);if(g>0){b.digits.unshift(0);continue}if(g==0){b.digits.unshift(1);a.blankZero();continue}k=biHighIndex(a);if(k==e){c=Math.floor((a.digits[k]*biRadix+(a.digits[k-1]||0))/(h.digits[e]*biRadix+(h.digits[e-1]||0)+1))}else{c=Math.floor((a.digits[k]*biRadixSquared+(a.digits[k-1]||0)*biRadix+(a.digits[k-2]||0))/(h.digits[e]*biRadix+(h.digits[e-1]||0)+1))}c=Math.max(0,Math.min(c,maxDigitVal));m=biMultiplyDigit(h,c);a=biSubtract(a,m);if(a.isNeg){while(a.isNeg){a=biAdd(a,h);c--}}else{while(biCompare(a,h)>=0){a=biSubtract(a,h);c++}}b.digits.unshift(c)}return[biNormalize(b),biNormalize(a)]}function biDivideModulo(c,g){var f,e,d,b,a;if(biCompareAbs(c,g)<0){if((c.isNeg&&g.isNeg)||(!c.isNeg&&!g.isNeg)){f=biFromNumber(0);e=biCopy(c)}else{f=biFromNumber(-1);e=biAdd(g,c)}return[f,e]}d=c.isNeg;b=g.isNeg;a=biDivideModuloNatural(biAbs(c),biAbs(g));f=a[0];e=a[1];if(!d&&!b){return[f,e]}else{if(d&&b){e.isNeg=true;return[f,e]}else{f.isNeg=true;f=biSubtract(f,bigOne);e.isNeg=d;e=biAdd(e,g)}}if(e.digits[0]==0&&biHighIndex(e)==0){e.isNeg=false}return[f,e]}function biDivide(a,b){return biDivideModulo(a,b)[0]}function biModulo(a,b){return biDivideModulo(a,b)[1]}function biMultiplyMod(b,c,a){return biModulo(biMultiply(b,c),a)}function biPow(c,e){var b=biCopy(bigOne);var d=c;while(true){if((e&1)!=0){b=biMultiply(b,d)}e>>>=1;if(e==0){break}d=biMultiply(d,d)}return b}function biPowMod(d,g,c){var b=biCopy(bigOne);var e=d;var f=g;while(true){if((f.digits[0]&1)!=0){b=biMultiplyMod(b,e,c)}f=biShiftRight(f,1);if(f.digits[0]==0&&biHighIndex(f)==0){break}e=biMultiplyMod(e,e,c)}return b}function biRandom(b){var a=new BigInt();while(b--){a.digits[b]=Math.floor(Math.random()*maxDigitVal)}return a}function biModularInverse(c,b){var a;c=biModulo(c,b);a=biExtendedEuclid(b,c);if(!a[2].isOne()){return null}return biModulo(a[1],b)}function biExtendedEuclid(e,d){var c;if(biCompare(e,d)>=0){return biExtendedEuclidNatural(e,d)}c=biExtendedEuclidNatural(d,e);return[c[1],c[0],c[2]]}function biExtendedEuclidNatural(n,k){var i,d,c,f,e,m,h,l,g;if(k.isZero()){return[biFromNumber(1),biFromNumber(0),n]}f=biFromNumber(0);e=biFromNumber(1);m=biFromNumber(1);h=biFromNumber(0);while(!k.isZero()){i=biDivideModulo(n,k);d=i[0];c=i[1];l=biSubtract(e,biMultiply(d,f));g=biSubtract(h,biMultiply(d,m));n=k;k=c;e=f;f=l;h=m;m=g}return[e,h,n]}function biMontgomeryPowMod(c,e,f){var b=biFromNumber(1);var a=biModulo(biMultiply(c,f.R),f);for(var d=e.bin.length-1;d>-1;d--){if(e.bin.charAt(d)=="1"){b=biMultiply(b,a);b=biMontgomeryModulo(b,f)}a=biMultiply(a,a);a=biMontgomeryModulo(a,f)}return b}function biMontgomeryModulo(b,c){var a=biModuloByRadixPower(b,c.nN);a=biMultiplyModByRadixPower(a,c.Ninv,c.nN);a=biMultiply(a,c);a=biAdd(b,a);a=biDivideByRadixPower(a,c.nN);while(biCompare(a,c)>=0){a=biSubtract(a,c)}return a}function biRSAKeyPair(b,c,a){this.e=biFromHex(b);this.d=biFromHex(c);this.m=biFromHex(a);this.chunkSize=2*biHighIndex(this.m);this.m.nN=biHighIndex(this.m)+1;this.m.R=biMultiplyByRadixPower(biFromNumber(1),this.m.nN);this.m.EGCD=biExtendedEuclid(this.m.R,this.m);this.m.Ri=this.m.EGCD[0];this.m.Rinv=biModulo(this.m.EGCD[0],this.m);this.m.Ni=biMinus(this.m.EGCD[1]);this.m.Ninv=biModulo(biMinus(this.m.EGCD[1]),this.m.R);this.e.bin=biToString(this.e,2);this.d.bin=biToString(this.d,2)}biRSAKeyPair.prototype.biEncryptedString=biEncryptedString;biRSAKeyPair.prototype.biDecryptedString=biDecryptedString;function biEncryptedString(h){var e,d,c,b,a,l;h=biUTF8Encode(h);h=h.replace(/[\x00]/gm,String.fromCharCode(255));h=h+String.fromCharCode(254);a=h.length;h=h+biRandomPadding(this.chunkSize-a%this.chunkSize);a=h.length;l="";b=new BigInt();for(e=0;e<a;e+=this.chunkSize){b.blankZero();d=0;for(c=e;c<e+this.chunkSize&&c<a;++d){b.digits[d]=h.charCodeAt(c++);b.digits[d]+=(h.charCodeAt(c++)||0)<<8}var g=biMontgomeryPowMod(b,this.e,this.m);var f=biToHex(g);l+=f+","}return l.substring(0,l.length-1)}function biDecryptedString(e){var g=e.split(",");var a="";var d,c,f;for(d=0;d<g.length;++d){var b;b=biFromHex(g[d],10);f=biMontgomeryPowMod(b,this.d,this.m);for(c=0;c<=biHighIndex(f);++c){a+=String.fromCharCode(f.digits[c]&255,f.digits[c]>>8)}}a=a.replace(/\xff/gm,String.fromCharCode(0));a=a.substr(0,a.lastIndexOf(String.fromCharCode(254)));return biUTF8Decode(a)}function biUTF8Encode(d){var b="";var a=d.length;for(var f=0;f<a;f++){var e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b}function biUTF8Decode(e){var d="";var a=e.length;var b;for(var g=0;g<a;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f);b=0}else{if((f>191)&&(f<224)){b=((f&31)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}else{b=((f&15)<<12);f=e.charCodeAt(++g);b+=((f&63)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}}}return d}function biRandomPadding(c){var a="";for(var b=0;b<c;b++){a=a+String.fromCharCode(Math.floor(Math.random()*126)+1)}return a}var INTERMediator_DBAdapter={eliminateDuplicatedConditions:false,debugMessage:false,generate_authParams:function(){var b="",c,a;if(INTERMediatorOnPage.authUser.length>0){b="&clientid="+encodeURIComponent(INTERMediatorOnPage.clientId);b+="&authuser="+encodeURIComponent(INTERMediatorOnPage.authUser);if(INTERMediatorOnPage.isNativeAuth||INTERMediatorOnPage.isLDAP){if(INTERMediatorOnPage.authCryptedPassword&&INTERMediatorOnPage.authChallenge){b+="&cresponse="+encodeURIComponent(INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+IMLib.nl_char+INTERMediatorOnPage.authChallenge));if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("generate_authParams/authCryptedPassword="+INTERMediatorOnPage.authCryptedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&cresponse=dummy"}}if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){c=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=c.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");b+="&response="+encodeURIComponent(a);if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("generate_authParams/authHashedPassword="+INTERMediatorOnPage.authHashedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&response=dummy"}}b+="&notifyid=";b+=encodeURIComponent(INTERMediatorOnPage.clientNotificationIdentifier());b+=("&pusher="+(INTERMediator.pusherAvailable?"yes":""));return b},store_challenge:function(a){if(a!==null){INTERMediatorOnPage.authChallenge=a.substr(0,24);INTERMediatorOnPage.authUserHexSalt=a.substr(24,32);INTERMediatorOnPage.authUserSalt=String.fromCharCode(parseInt(a.substr(24,2),16),parseInt(a.substr(26,2),16),parseInt(a.substr(28,2),16),parseInt(a.substr(30,2),16));if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("store_challenge/authChallenge="+INTERMediatorOnPage.authChallenge);INTERMediator.setDebugMessage("store_challenge/authUserHexSalt="+INTERMediatorOnPage.authUserHexSalt);INTERMediator.setDebugMessage("store_challenge/authUserSalt="+INTERMediatorOnPage.authUserSalt)}}},logging_comAction:function(a,d,c,b){INTERMediator.setDebugMessage(INTERMediatorOnPage.getMessages()[a]+"Accessing:"+decodeURI(d)+", Parameters:"+decodeURI(c+b))},logging_comResult:function(c,i,a,d,h,k,b,f,e){var g;if(INTERMediator.debugMode>1){if(c.responseText.length>1000){g=c.responseText.substr(0,1000)+" ...[trancated]"}else{g=c.responseText}INTERMediator.setDebugMessage("myRequest.responseText="+g);INTERMediator.setDebugMessage("Return: resultCount="+i+", dbresult="+INTERMediatorLib.objectToString(a)+IMLib.nl_char+"Return: requireAuth="+d+", challenge="+h+", clientid="+k+IMLib.nl_char+"Return: newRecordKeyValue="+b+", changePasswordResult="+f+", mediatoken="+e)}},server_access:function(h,d,f){var m="",c="",r=0,u=null,w=null,t=null,o=false,n=null,x=null,l=null,k,b,g,s,q=false,p=false,a="";k=INTERMediatorOnPage.getEntryPath();b=INTERMediator_DBAdapter.generate_authParams();INTERMediator_DBAdapter.logging_comAction(d,k,h,b);INTERMediatorOnPage.notifySupport=q;try{n=new XMLHttpRequest();n.open("POST",k,false,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);n.setRequestHeader("charset","utf-8");n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("X-From",location.href);n.send(h+b);g=JSON.parse(n.responseText);r=g.resultCount?g.resultCount:0;u=g.totalCount?g.totalCount:null;c=g.dbresult?g.dbresult:null;o=g.requireAuth?g.requireAuth:false;w=g.challenge?g.challenge:null;t=g.clientid?g.clientid:null;m=g.newRecordKeyValue?g.newRecordKeyValue:"";x=g.changePasswordResult?g.changePasswordResult:null;l=g.mediatoken?g.mediatoken:null;q=g.notifySupport;for(s=0;s<g.errorMessages.length;s++){INTERMediator.setErrorMessage(g.errorMessages[s])}for(s=0;s<g.debugMessages.length;s++){INTERMediator.setDebugMessage(g.debugMessages[s])}p=g.usenull;a=g.hasOwnProperty("registeredid")?g.registeredid:"";INTERMediator_DBAdapter.logging_comResult(n,r,c,o,w,t,m,x,l);INTERMediator_DBAdapter.store_challenge(w);if(t!==null){INTERMediatorOnPage.clientId=t}if(l!==null){INTERMediatorOnPage.mediaToken=l}if(INTERMediatorOnPage.isLDAP===true&&INTERMediatorOnPage.authUserHexSalt!=INTERMediatorOnPage.authHashedPassword.substr(-8,8)){if(h!="access=challenge"){o=true}}}catch(v){INTERMediator.setErrorMessage(v,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[f],[v,n.responseText]))}if(h.indexOf("access=changepassword&newpass=")===0){return x}if(o){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();throw"_im_requath_request_"}if(!h.match(/access=challenge/)){INTERMediatorOnPage.authCount=0}INTERMediatorOnPage.storeCredentialsToCookieOrStorage();INTERMediatorOnPage.notifySupport=q;return{dbresult:c,resultCount:r,totalCount:u,newRecordKeyValue:m,newPasswordResult:x,registeredId:a,nullAcceptable:p}},server_access_async:function(l,f,h,r,c,g){var o="",d="",v=0,x=null,z=null,w=null,q=false,p=null,A=null,n=null,m,b,k,u,t=false,s=false,a="";m=INTERMediatorOnPage.getEntryPath();b=INTERMediator_DBAdapter.generate_authParams();INTERMediator_DBAdapter.logging_comAction(f,m,l,b);INTERMediatorOnPage.notifySupport=t;try{p=new XMLHttpRequest();p.open("POST",m,true,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);p.setRequestHeader("charset","utf-8");p.setRequestHeader("Content-Type","application/x-www-form-urlencoded");p.setRequestHeader("X-Requested-With","XMLHttpRequest");p.setRequestHeader("X-From",location.href);p.onreadystatechange=function(){switch(p.readyState){case 0:break;case 1:break;case 2:break;case 3:break;case 4:k=JSON.parse(p.responseText);v=k.resultCount?k.resultCount:0;x=k.totalCount?k.totalCount:null;d=k.dbresult?k.dbresult:null;q=k.requireAuth?k.requireAuth:false;z=k.challenge?k.challenge:null;w=k.clientid?k.clientid:null;o=k.newRecordKeyValue?k.newRecordKeyValue:"";A=k.changePasswordResult?k.changePasswordResult:null;n=k.mediatoken?k.mediatoken:null;t=k.notifySupport;for(u=0;u<k.errorMessages.length;u++){INTERMediator.setErrorMessage(k.errorMessages[u])}for(u=0;u<k.debugMessages.length;u++){INTERMediator.setDebugMessage(k.debugMessages[u])}s=k.usenull;a=k.hasOwnProperty("registeredid")?k.registeredid:"";if(k.errorMessages.length>0){INTERMediator.setErrorMessage("Communication Error: "+k.errorMessages);if(c){c()}throw"Communication Error"}INTERMediator_DBAdapter.logging_comResult(p,v,d,q,z,w,o,A,n);INTERMediator_DBAdapter.store_challenge(z);if(w!==null){INTERMediatorOnPage.clientId=w}if(n!==null){INTERMediatorOnPage.mediaToken=n}if(INTERMediatorOnPage.isLDAP===true&&INTERMediatorOnPage.authUserHexSalt!=INTERMediatorOnPage.authHashedPassword.substr(-8,8)){if(l!="access=challenge"){q=true}}if(l.indexOf("access=changepassword&newpass=")===0){if(r){r({dbresult:d,resultCount:v,totalCount:x,newRecordKeyValue:o,newPasswordResult:A,registeredId:a,nullAcceptable:s})}return}if(q){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();if(g){g(p)}return}if(!l.match(/access=challenge/)){INTERMediatorOnPage.authCount=0}INTERMediatorOnPage.storeCredentialsToCookieOrStorage();INTERMediatorOnPage.notifySupport=t;if(r){r({dbresult:d,resultCount:v,totalCount:x,newRecordKeyValue:o,newPasswordResult:A,registeredId:a,nullAcceptable:s})}break}};p.send(l+b)}catch(y){INTERMediator.setErrorMessage(y,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[h],[y,p.responseText]));if(c){c()}}},changePassword:function(i,d,g){var c,h,a,b;if(i&&d){INTERMediatorOnPage.authUser=i;if(i!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";c=INTERMediator_DBAdapter.getChallenge();if(!c){b=document.getElementById("_im_newpass_message");if(b){INTERMediatorLib.removeChildNodes(b);b.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2008)))}else{alert(INTERMediatorLib.getInsertedStringFromErrorNumber(2008))}INTERMediator.flushMessage();return}}INTERMediatorOnPage.authHashedPassword=SHA1(d+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt}else{INTERMediatorOnPage.retrieveAuthInfo()}h="access=changepassword&newpass="+INTERMediatorLib.generatePasswordHash(g);try{a=INTERMediator_DBAdapter.server_access(h,1029,1030);if(a){INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(g);INTERMediatorOnPage.authHashedPassword=SHA1(g+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;INTERMediatorOnPage.storeCredentialsToCookieOrStorage()}}catch(f){return false}return a},getChallenge:function(){try{this.server_access("access=challenge",1027,1028)}catch(a){if(a=="_im_requath_request_"){throw a}else{INTERMediator.setErrorMessage(a,"EXCEPTION-19")}}if(INTERMediatorOnPage.authChallenge===null){return false}return true},uploadFile:function(p,l,a,n){var d=null,h,g,m,f;h=INTERMediatorOnPage.getEntryPath();g=INTERMediator_DBAdapter.generate_authParams();m="access=uploadfile"+p;INTERMediator_DBAdapter.logging_comAction(1031,h,m,g);try{d=new XMLHttpRequest();d.open("POST",h,true,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);d.setRequestHeader("charset","utf-8");var c=(m+g).split("&");var b=new FormData();for(f=0;f<c.length;f++){var o=c[f].split("=");b.append(o[0],decodeURIComponent(o[1]))}b.append("_im_uploadfile",l.content);d.onreadystatechange=function(){switch(d.readyState){case 3:break;case 4:INTERMediator_DBAdapter.uploadFileAfterSucceed(d,a,n,false);break}};d.send(b)}catch(k){INTERMediator.setErrorMessage(k,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],[k,d.responseText]));n()}},uploadFileAfterSucceed:function(g,c,o,a){var e="",d="",q=0,p=null,r=null,f=false,l=null,k=null,n,h,b=true;try{n=JSON.parse(g.responseText)}catch(m){INTERMediator.setErrorMessage(m,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],["",""]));INTERMediator.flushMessage();o();return false}q=n.resultCount?n.resultCount:0;d=n.dbresult?n.dbresult:null;f=n.requireAuth?n.requireAuth:false;p=n.challenge?n.challenge:null;r=n.clientid?n.clientid:null;e=n.newRecordKeyValue?n.newRecordKeyValue:"";l=n.changePasswordResult?n.changePasswordResult:null;k=n.mediatoken?n.mediatoken:null;for(h=0;h<n.errorMessages.length;h++){if(a){window.alert(n.errorMessages[h])}else{INTERMediator.setErrorMessage(n.errorMessages[h])}b=false}for(h=0;h<n.debugMessages.length;h++){INTERMediator.setDebugMessage(n.debugMessages[h])}INTERMediator_DBAdapter.logging_comResult(g,q,d,f,p,r,e,l,k);INTERMediator_DBAdapter.store_challenge(p);if(r!==null){INTERMediatorOnPage.clientId=r}if(k!==null){INTERMediatorOnPage.mediaToken=k}if(f){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();o()}INTERMediatorOnPage.authCount=0;INTERMediatorOnPage.storeCredentialsToCookieOrStorage();c(d);return b},db_query:function(b){var f,d,a,e;if(!INTERMediator_DBAdapter.db_queryChecking(b)){return}f=INTERMediator_DBAdapter.db_queryParameters(b);d={};try{a=this.server_access(f,1012,1004);d.recordset=a.dbresult;d.totalCount=a.resultCount;d.count=0;d.registeredId=a.registeredId;d.nullAcceptable=a.nullAcceptable;d.count=a.dbresult?Object.keys(a.dbresult).length:0;e=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",b.name);if(!e.relation&&b.paging&&Boolean(b.paging)===true){INTERMediator.pagedAllCount=parseInt(a.resultCount,10);if(a.totalCount){INTERMediator.totalRecordCount=parseInt(a.totalCount,10)}}if((b.paging!==null)&&(Boolean(b.paging)===true)){INTERMediator.pagination=true;if(!(Number(b.records)>=Number(INTERMediator.pagedSize)&&Number(INTERMediator.pagedSize)>0)){INTERMediator.pagedSize=parseInt(b.records,10)}}}catch(c){if(c=="_im_requath_request_"){throw c}else{INTERMediator.setErrorMessage(c,"EXCEPTION-17")}d.recordset=null;d.totalCount=0;d.count=0;d.registeredid=null;d.nullAcceptable=null}return d},db_queryWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_query(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_queryWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-16")}}a(d)},db_query_async:function(c,b,a){var e;if(!INTERMediator_DBAdapter.db_queryChecking(c)){return}e=INTERMediator_DBAdapter.db_queryParameters(c);try{this.server_access_async(e,1012,1004,(function(){var g;var i=c.name;var f=Number(c.records);var h=b;return function(k){k.count=k.dbresult?Object.keys(k.dbresult).length:0;g=IMLibContextPool.getContextDef(i);if(!g.relation&&c.paging&&Boolean(c.paging)===true){INTERMediator.pagedAllCount=parseInt(k.resultCount,10);if(k.totalCount){INTERMediator.totalRecordCount=parseInt(k.totalCount,10)}}if((c.paging!==null)&&(Boolean(c.paging)===true)){INTERMediator.pagination=true;if(!(f>=Number(INTERMediator.pagedSize)&&Number(INTERMediator.pagedSize)>0)){INTERMediator.pagedSize=parseInt(f,10)}}h(k)}})(),a,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var g=c;var h=b;var f=a;return function(){INTERMediator_DBAdapter.db_query_async(g,h,f)}})()))}catch(d){INTERMediator.setErrorMessage(d,"EXCEPTION-17")}},db_queryChecking:function(b){var a=true;if(b.name===null||b.name===""){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1005));a=false}return a},db_queryParameters:function(c){var s,f,u,l,v,k,e,a,r=10000000,g,m,o,d,w,t,q,p,h,n,b=[];if(c.records===null){u="access=read&name="+encodeURIComponent(c.name)}else{if(parseInt(c.records,10)===0&&INTERMediatorOnPage.dbClassName==="DB_FileMaker_FX"){u="access=describe&name="+encodeURIComponent(c.name)}else{u="access=read&name="+encodeURIComponent(c.name)}if(Boolean(c.uselimit)===true&&parseInt(c.records,10)>=INTERMediator.pagedSize&&parseInt(INTERMediator.pagedSize,10)>0){r=INTERMediator.pagedSize}else{r=c.records}}if(c.primaryKeyOnly){u+="&pkeyonly=true"}if(c.fields){for(s=0;s<c.fields.length;s++){u+="&field_"+s+"="+encodeURIComponent(c.fields[s])}}l=0;if(c.parentkeyvalue){for(f in c.parentkeyvalue){if(c.parentkeyvalue.hasOwnProperty(f)){u+="&foreign"+l+"field="+encodeURIComponent(f);u+="&foreign"+l+"value="+encodeURIComponent(c.parentkeyvalue[f]);l++}}}if(c.useoffset&&INTERMediator.startFrom!==null){u+="&start="+encodeURIComponent(INTERMediator.startFrom)}v=0;g=[];while(c.conditions&&c.conditions[v]){m=c.conditions[v]["field"]+"#"+c.conditions[v]["operator"]+"#"+c.conditions[v]["value"];if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){u+="&condition"+v;u+="field="+encodeURIComponent(c.conditions[v]["field"]);u+="&condition"+v;u+="operator="+encodeURIComponent(c.conditions[v]["operator"]);u+="&condition"+v;u+="value="+encodeURIComponent(c.conditions[v]["value"]);g.push(m)}v++}k=INTERMediator.additionalCondition[c.name];if(k){if(k.field){k=[k]}for(f=0;f<k.length;f++){if(k[f]&&k[f]["field"]){if(k[f]["value"]||k[f]["field"]=="__operation__"){m=k[f]["field"]+"#"+((k[f]["operator"]!==undefined)?k[f]["operator"]:"")+"#"+((k[f]["value"]!==undefined)?k[f]["value"]:"");if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){u+="&condition"+v;u+="field="+encodeURIComponent(k[f]["field"]);if(k[f]["operator"]!==undefined){u+="&condition"+v;u+="operator="+encodeURIComponent(k[f]["operator"])}if(k[f]["value"]!==undefined){u+="&condition"+v;q=k[f]["value"];if(Array.isArray(q)){q=JSON.stringify(q)}u+="value="+encodeURIComponent(q)}if(k[f]["field"]!="__operation__"){g.push(m)}else{}}v++}}if(k[f]&&k[f]["onetime"]){b.push=f}}if(b.length>0){o=[];for(f=0;f<k.length;f++){if(!(f in b)){o.push(k[f])}}INTERMediator.additionalCondition[c.name]=o;IMLibLocalContext.archive()}}a=0;e=INTERMediator.additionalSortKey[c.name];if(e){if(e.field){e=[e]}for(f=0;f<e.length;f++){u+="&sortkey"+a;u+="field="+encodeURIComponent(e[f]["field"]);u+="&sortkey"+a;u+="direction="+encodeURIComponent(e[f]["direction"]);a++}}d={};for(w in IMLibLocalContext.store){if(IMLibLocalContext.store.hasOwnProperty(w)){q=String(IMLibLocalContext.store[w]);t=w.split(":");if(t&&t.length>1&&t[1].trim()==c.name&&q.length>0){if(t[0].trim()=="condition"&&t.length>=4){p=t[2].split(",");h=t[3].trim();if(p.length>1){u+="&condition"+v+"field=__operation__";u+="&condition"+v+"operator=ex";v++}for(f=0;f<p.length;f++){m=p[f].trim()+"#"+h+"#"+q;if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){u+="&condition"+v+"field="+encodeURIComponent(p[f].trim());u+="&condition"+v+"operator="+encodeURIComponent(h);u+="&condition"+v+"value="+encodeURIComponent(q);g.push(m)}v++}}else{if(t[0].trim()=="valueofaddorder"&&t.length>=4){d[parseInt(q)]=[t[2].trim(),t[3].trim()]}else{if(t[0].trim()=="limitnumber"&&t.length>=4){r=parseInt(q)}}}}}}u+="&records="+encodeURIComponent(r);n=Object.keys(d);for(s=0;s<n.length;s++){u+="&sortkey"+a+"field="+encodeURIComponent(d[n[s]][0]);u+="&sortkey"+a+"direction="+encodeURIComponent(d[n[s]][1]);a++}return u},db_update:function(b){var c,a;if(!INTERMediator_DBAdapter.db_updateChecking(b)){return}c=INTERMediator_DBAdapter.db_updateParameters(b);a=this.server_access(c,1013,1014);return a.dbresult},db_updateWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_update(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_updateWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-15")}}a(d)},db_updateChecking:function(b){var a=true,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1007));a=false}c=IMLibContextPool.getContextDef(b.name);if(!c.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[b.name]));a=false}if(b.dataset===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1011));a=false}return a},db_updateParameters:function(d){var g,b,a,c,f;g="access=update&name="+encodeURIComponent(d.name);a=0;if(INTERMediator.additionalFieldValueOnUpdate&&INTERMediator.additionalFieldValueOnUpdate[d.name]){f=INTERMediator.additionalFieldValueOnUpdate[d.name];if(f.field){f=[f]}for(c in f){if(f.hasOwnProperty(c)){var e=f[c];g+="&field_"+a+"="+encodeURIComponent(e.field);g+="&value_"+a+"="+encodeURIComponent(e.value);a++}}}if(d.conditions!=null){for(b=0;b<d.conditions.length;b++){g+="&condition"+b+"field=";g+=encodeURIComponent(d.conditions[b]["field"]);g+="&condition"+b+"operator=";g+=encodeURIComponent(d.conditions[b]["operator"]);if(d.conditions[b]["value"]){g+="&condition"+b+"value=";g+=encodeURIComponent(d.conditions[b]["value"])}}}for(b=0;b<d.dataset.length;b++){g+="&field_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["field"]);if(INTERMediator.isTrident&&INTERMediator.ieVersion==8){g+="&value_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["value"].replace(/\n/g,""))}else{g+="&value_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["value"])}}return g},db_update_async:function(c,b,a){var d;if(!INTERMediator_DBAdapter.db_updateChecking(c)){return}d=INTERMediator_DBAdapter.db_updateParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1013,1014,b,a,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_update_async(f,g,e)}})()))}},db_delete:function(b){var c,a;if(!INTERMediator_DBAdapter.db_deleteChecking(b)){return}c=INTERMediator_DBAdapter.db_deleteParameters(b);a=this.server_access(c,1017,1015);INTERMediator.flushMessage();return a},db_deleteWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_delete(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_deleteWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},db_deleteChecking:function(b){var a=true,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));a=false}c=IMLibContextPool.getContextDef(b.name);if(!c.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[b.name]));a=false}if(b.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));a=false}return a},db_deleteParameters:function(c){var g,d,a,b,f;g="access=delete&name="+encodeURIComponent(c.name);a=0;if(INTERMediator.additionalFieldValueOnDelete&&INTERMediator.additionalFieldValueOnDelete[c.name]){f=INTERMediator.additionalFieldValueOnDelete[c.name];if(f.field){f=[f]}for(b in f){if(f.hasOwnProperty(b)){var e=f[b];g+="&field_"+a+"="+encodeURIComponent(e.field);g+="&value_"+a+"="+encodeURIComponent(e.value);a++}}}for(d=0;d<c.conditions.length;d++){g+="&condition"+d+"field="+encodeURIComponent(c.conditions[d]["field"]);g+="&condition"+d+"operator="+encodeURIComponent(c.conditions[d]["operator"]);g+="&condition"+d+"value="+encodeURIComponent(c.conditions[d]["value"])}return g},db_delete_async:function(c,b,a){var d;if(!INTERMediator_DBAdapter.db_deleteChecking(c)){return}d=INTERMediator_DBAdapter.db_deleteParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1017,1015,b,a,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_delete_async(f,g,e)}})()))}},db_createRecord:function(b){var c,a;c=INTERMediator_DBAdapter.db_createParameters(b);if(c){a=INTERMediator_DBAdapter.server_access(c,1018,1016);INTERMediator.flushMessage();return{newKeyValue:a.newRecordKeyValue,recordset:a.dbresult}}return false},db_createRecordWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_createRecord(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_createRecordWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-13")}}if(a){a(d.newKeyValue)}},db_createRecord_async:function(c,b,a){var d=INTERMediator_DBAdapter.db_createParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1018,1016,b,a,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_createRecord_async(f,g,e)}})()))}},db_createParameters:function(l){var e,f,k,h,a,b,d,m,g;if(l.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1021));return false}g=IMLibContextPool.getContextDef(l.name);if(!g.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[l.name]));return false}d=INTERMediatorOnPage.getDataSources();b=null;for(m in d){if(d.hasOwnProperty(m)&&d[m]["name"]==l.name){b=m;break}}if(b===null){INTERMediator.setErrorMessage("no targetname :"+l.name);return false}e="access=create&name="+encodeURIComponent(l.name);a=0;if(INTERMediator.additionalFieldValueOnNewRecord&&INTERMediator.additionalFieldValueOnNewRecord[l.name]){h=INTERMediator.additionalFieldValueOnNewRecord[l.name];if(h.field){h=[h]}for(k in h){if(h.hasOwnProperty(k)){var c=h[k];e+="&field_"+a+"="+encodeURIComponent(c.field);e+="&value_"+a+"="+encodeURIComponent(c.value);a++}}}for(f=0;f<l.dataset.length;f++){e+="&field_"+a+"="+encodeURIComponent(l.dataset[f]["field"]);e+="&value_"+a+"="+encodeURIComponent(l.dataset[f]["value"]);a++}return e},db_copy:function(b){var c,a;c=INTERMediator_DBAdapter.db_copyParameters(b);if(c){a=INTERMediator_DBAdapter.server_access(c,1017,1015);INTERMediator.flushMessage();return{newKeyValue:a.newRecordKeyValue,recordset:a.dbresult}}return false},db_copyWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_copy(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_copyWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},db_copy_async:function(c,b,a){var d=INTERMediator_DBAdapter.db_copyParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1017,1015,b,a,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_copy_async(f,g,e)}})()))}},db_copyParameters:function(b){var a=true,d,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));a=false}if(b.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));a=false}if(!a){return false}d="access=copy&name="+encodeURIComponent(b.name);for(c=0;c<b.conditions.length;c++){d+="&condition"+c+"field="+encodeURIComponent(b.conditions[c]["field"]);d+="&condition"+c+"operator="+encodeURIComponent(b.conditions[c]["operator"]);d+="&condition"+c+"value="+encodeURIComponent(b.conditions[c]["value"])}if(b.associated){for(c=0;c<b.associated.length;c++){d+="&assoc"+c+"="+encodeURIComponent(b.associated[c]["name"]);d+="&asfield"+c+"="+encodeURIComponent(b.associated[c]["field"]);d+="&asvalue"+c+"="+encodeURIComponent(b.associated[c]["value"])}}return d},createExceptionFunc:function(c,a){var b=c;return function(d){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(a)}}else{INTERMediator.setErrorMessage("Communication Error",INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[b],["Communication Error",d.responseText]))}}},unregister:function(b){var a=null,c;if(INTERMediatorOnPage.clientNotificationKey){var d=INTERMediatorOnPage.clientNotificationKey();if(d&&d!="_im_key_isnt_supplied"){c="access=unregister";if(b){c+="&pks="+encodeURIComponent(JSON.stringify(b))}a=this.server_access(c,1018,1016);return a}}}};var Parser=(function(aQ){var al=0;var ag=1;var af=2;var ae=5;var aW=65;var am=3;var E=4;at.regFirstVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_]");at.regRestVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_0-9]");function aT(bp,br,bq,bs){this.type_=bp;this.index_=br||0;this.prio_=bq||0;this.number_=(bs!==undefined&&bs!==null)?bs:0;this.toString=function(){switch(this.type_){case al:return this.number_;case ag:case af:case ae:case am:return this.index_;case E:return"CALL";case aW:return"SEPARATOR";default:return"Invalid Token"}}}function a2(bt,br,bq,bs,bp,bu){this.tokens=bt}var aX=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var T={"\b":IMLib.backSlash_char+"b","\t":IMLib.backSlash_char+"t","\n":IMLib.backSlash_char+"n","\f":IMLib.backSlash_char+"f","\r":IMLib.backSlash_char+"r","'":IMLib.backSlash_char+IMLib.singleQuote_char,"\\":IMLib.backSlash_char+IMLib.backSlash_char};function aj(bp){if(typeof bp==="string"){aX.lastIndex=0;return aX.test(bp)?IMLib.singleQuote_char+bp.replace(aX,function(bq){var br=T[bq];return typeof br==="string"?br:"\\u"+("0000"+bq.charCodeAt(0).toString(16)).slice(-4)})+IMLib.singleQuote_char:IMLib.singleQuote_char+bp+IMLib.singleQuote_char}return bp}a2.prototype={simplify:function(by){by=by||{};var bs=[];var br=[];var bw;var bv;var bt;var bu;var bx=this.tokens.length;var bz;var bq=0;for(bq=0;bq<bx;bq++){bz=this.tokens[bq];var bp=bz.type_;if(bp===al){bs.push(bz)}else{if(bp===am&&(bz.index_ in by)){bz=new aT(al,0,0,by[bz.index_]);bs.push(bz)}else{if(bp===ae&&bs.length>2){bt=bs.pop();bv=bs.pop();bw=bs.pop();bu=at.ops3[bz.index_];bz=new aT(al,0,0,bu(bw.number_,bv.number_,bt.number_));bs.push(bz)}else{if(bp===af&&bs.length>1){bv=bs.pop();bw=bs.pop();bu=at.ops2[bz.index_];bz=new aT(al,0,0,bu(bw.number_,bv.number_));bs.push(bz)}else{if(bp===ag&&bs.length>0){bw=bs.pop();bu=at.ops1[bz.index_];bz=new aT(al,0,0,bu(bw.number_));bs.push(bz)}else{while(bs.length>0){br.push(bs.shift())}br.push(bz)}}}}}}while(bs.length>0){br.push(bs.shift())}return new a2(br)},substitute:function(bq,bx){if(!(bx instanceof a2)){bx=new at().parse(String(bx))}var bv=[];var bw=this.tokens.length;var by;var bs=0;for(bs=0;bs<bw;bs++){by=this.tokens[bs];var bt=by.type_;if(bt===am&&by.index_===bq){for(var br=0;br<bx.tokens.length;br++){var bu=bx.tokens[br];var bp=new aT(bu.type_,bu.index_,bu.prio_,bu.number_);bv.push(bp)}}else{bv.push(by)}}return new a2(bv)},evaluate:function(bx){bx=bx||{};var br=[];var bv;var bu;var bs;var bt;var bw=this.tokens.length;var by;var bq=0;for(bq=0;bq<bw;bq++){by=this.tokens[bq];var bp=by.type_;if(bp===al){br.push(by.number_)}else{if(bp===ae){bs=br.pop();bu=br.pop();bv=br.pop();bt=at.ops3Trail[by.index_];br.push(bt(bv,bu,bs))}else{if(bp===af){bu=br.pop();bv=br.pop();bt=at.ops2[by.index_];br.push(bt(bv,bu))}else{if(bp===am){if(by.index_ in bx){br.push(bx[by.index_])}else{if(by.index_ in at.functions){br.push(at.functions[by.index_])}else{throw new Error("undefined variable: "+by.index_)}}}else{if(bp===ag){bv=br.pop();bt=at.ops1[by.index_];br.push(bt(bv))}else{if(bp===aW){bu=br.pop();bv=br.pop();br.push([bv,bu])}else{if(bp===E){bv=br.pop();bt=br.pop();if(bt.apply&&bt.call){if(Object.prototype.toString.call(bv)=="[object Array]"){br.push(bt.apply(undefined,bv))}else{br.push(bt.call(undefined,bv))}}else{throw new Error(bt+" is not a function")}}else{throw new Error("invalid Expression")}}}}}}}}if(br.length>1){throw new Error("invalid Expression (parity)")}return br[0]},variables:function(){var bp=this.tokens.length;var bs=[];for(var bq=0;bq<bp;bq++){var br=this.tokens[bq];if(br.type_===am&&(bs.indexOf(br.index_)==-1)&&!(br.index_ in at.functions)){bs.push(br.index_)}}return bs}};function aC(br,bp,bu){var bt,bs,bq;bt=(br instanceof Array)?arguments[0][0]:arguments[0];bs=(bp instanceof Array)?arguments[1][0]:arguments[1];bq=(bu instanceof Array)?arguments[2][0]:arguments[2];return bt?bs:bq}function ay(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)>Number(br)}return bq>bp}function s(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)<Number(br)}return bq<bp}function R(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)>=Number(br)}return bq>=bp}function h(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)<=Number(br)}return bq<=bp}function be(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)==Number(br)}return bq==bp}function az(bq,bp){var bs,br;bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(bs)){return Number(bs)!=Number(br)}return bq!=bp}function au(bp){return bp!==bp}function A(bq,bp){var bs,br;if((typeof bq)=="string"||(typeof bp)=="string"){return aG(bq,bp)}if(au(bq)||au(bp)){return NaN}bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(br)){return Number(bs)+Number(br)}return bq+bp}function aG(bq,bp){return String(bq)+String(bp)}function a8(bq,bp){var bs,br,bt,bu;if(au(bq)||au(bp)){return NaN}bs=z(bq);br=z(bp);if(!isNaN(bs)&&!isNaN(br)){return bs-br}bt=String(bq);do{bu=bt.indexOf(bp);if(bu>-1){bt=bt.substr(0,bu)+bt.substr(bu+bp.length)}}while(bu>-1);return bt}function b(bq,bp){if(au(bq)||au(bp)){return NaN}bq=z(bq);bp=z(bp);return bq*bp}function y(bq,bp){if(au(bq)||au(bp)){return NaN}bq=z(bq);bp=z(bp);return bq/bp}function c(bq,bp){if(au(bq)||au(bp)){return NaN}bq=z(bq);bp=z(bp);return bq%bp}function aD(bp){if(au(bp)){return NaN}bp=z(bp);return -bp}function aH(bp){bp=z(bp);return Math.random()*(bp||1)}function ap(bq){if(au(bq)){return NaN}bq=z(bq);bq=Math.floor(bq);var bp=bq;while(bq>1){bp=bp*(--bq)}return bp}function Q(bp){bp=z(bp);return !bp}function bo(bq,bp){bq=z(bq);bp=z(bp);return bq&&bp}function J(bq,bp){bq=z(bq);bp=z(bp);return bq||bp}function aU(){var bp=0,bq;for(bq=0;bq<arguments.length;bq++){bp+=z(arguments[bq])}return bp}function ar(){var bp=0,bq,br=0;for(bq=0;bq<arguments.length;bq++){bp+=z(arguments[bq]);br++}return bp/br}function q(){var bp,bq=0;for(bp=0;bp<arguments.length;bp++){bq+=Array.isArray(arguments[bp])?arguments[bp].length:1}return bq}function X(){var bp=IMLib.zerolength_str,bq;for(bq=0;bq<arguments.length;bq++){bp+=String(arguments[bq]);bp+=IMLib.nl_char}return bp}function S(bq,bp){if(bp==undefined){return Math.round(bq)}else{bq=(bq instanceof Array)?bq.join():bq;bp=(bp instanceof Array)?bp.join():bp;return INTERMediatorLib.Round(bq,bp)}}function l(bp){if(bp==undefined||bp==null){return 0}else{bp=(bp instanceof Array)?bp.join():bp;return(new String(bp)).length}}function z(bq){var bp;if(bq===undefined){return NaN}if(bq===true){return true}if(bq===false){return false}if(bq==IMLib.zerolength_str){return 0}bp=bq;if(INTERMediatorLib.is_array(bq)){if(bq.length<1){return 0}else{bp=bq[0]}}bp=D(bp);return bp}function F(bq,bp){return Math.sqrt(bq*bq+bp*bp)}function Y(bq,bp){if(Object.prototype.toString.call(bq)!="[object Array]"){return[bq,bp]}bq=bq.slice();bq.push(bp);return bq}function ax(br,bq){var bt,bs,bu,bp="";bt=(br instanceof Array)?br.join():br;bs=(bq instanceof Array)?bq.join():bq;for(bu=0;bu<bt.length;bu++){if(bs.indexOf(bt.substr(bu,1))>-1){bp+=bt.substr(bu,1)}}return bp}function r(br,bq){var bt,bs,bu,bp="";bt=(br instanceof Array)?br.join():br;bs=(bq instanceof Array)?bq.join():bq;for(bu=0;bu<bs.length;bu++){if(bt.indexOf(bs.substr(bu,1))<0){bp+=bs.substr(bu,1)}}return bt+bp}function ao(br,bq){var bt,bs,bu,bp="";bt=(br instanceof Array)?br.join():br;bs=(bq instanceof Array)?bq.join():bq;for(bu=0;bu<bt.length;bu++){if(bs.indexOf(bt.substr(bu,1))<0){bp+=bt.substr(bu,1)}}return bp}function aL(bv,bu){var br,bq,bx,bw,bt,bs,bp=IMLib.nl_char;br=(bv instanceof Array)?bv.join():bv;bs=[br.indexOf(IMLib.crlf_str),br.indexOf(IMLib.cr_char),br.indexOf(IMLib.nl_char)];for(bt=0;bt<bs.length;bt++){bs[bt]=(bs[bt]<0)?br.length:bs[bt]}if(bs[0]<br.length&&bs[0]<=bs[1]&&bs[0]<bs[2]){bp=IMLib.crlf_str}else{if(bs[1]<br.length&&bs[1]<bs[0]&&bs[1]<bs[2]){bp=IMLib.cr_char}}bx=br.replace(IMLib.crlf_str,IMLib.nl_char).replace(IMLib.cr_char,IMLib.nl_char).split(IMLib.nl_char);bq=(bu instanceof Array)?bu.join():bu;bw=bq.replace(IMLib.crlf_str,IMLib.nl_char).replace(IMLib.cr_char,IMLib.nl_char).split(IMLib.nl_char);return[bx,bw,bp]}function k(bs,bq){var bw,bu,bt,br,bv,bp="";bw=aL(bs,bq);bu=bw[0];bt=bw[1];br=bw[2];for(bv=0;bv<bu.length;bv++){if(bt.indexOf(bu[bv])>-1&&bu[bv].length>0){bp+=bu[bv]+br}}return bp}function bm(bs,bq){var bw,bu,bt,br,bv,bp="";bw=aL(bs,bq);bu=bw[0];bt=bw[1];br=bw[2];for(bv=0;bv<bu.length;bv++){if(bu[bv].length>0){bp+=bu[bv]+br}}for(bv=0;bv<bt.length;bv++){if(bu.indexOf(bt[bv])<0&&bt[bv].length>0){bp+=bt[bv]+br}}return bp}function ad(bs,bq){var bw,bu,bt,br,bv,bp="";bw=aL(bs,bq);bu=bw[0];bt=bw[1];br=bw[2];for(bv=0;bv<bu.length;bv++){if(bt.indexOf(bu[bv])<0&&bu[bv].length>0){bp+=bu[bv]+br}}return bp}function aR(bs,bw,br){var bv,bt,bq,bu,bp="";bv=aL(bs,"");bt=bv[0];bq=bv[2];br=(br==undefined)?bt.length:br;for(bu=bw;(bu<bw+br)&&(bu<bt.length);bu++){bp+=bt[bu]+bq}return bp}function ab(bs,bt){if(!bs){return -1}var bq=bs.replace(IMLib.crlf_str,IMLib.nl_char).replace(IMLib.cr_char,IMLib.nl_char);var bp=0;var br,bu;while(bq.length>0){bu=bq.indexOf(IMLib.nl_char);if(bu>-1){br=bq.substr(0,bu);bq=bq.substr(bu+1)}else{br=bq;bq=IMLib.zerolength_str}if(br==bt){return bp}bp++}return -1}function p(br,bs){var bq,bp;bq=(br instanceof Array)?br.join():br;bp=(bs instanceof Array)?bs.join():bs;return INTERMediatorLib.numberFormat(bq,bp)}function a7(br,bs){var bq,bp;bq=(br instanceof Array)?br.join():br;bp=(bs instanceof Array)?bs.join():bs;return INTERMediatorLib.currencyFormat(bq,bp)}function ac(bt,bu,bp){var br,bs,bq;if(bt==null){return null}br=(bt instanceof Array)?bt.join():bt;bs=(bu instanceof Array)?bu.join():bu;bq=(bp instanceof Array)?bp.join():bp;return br.substr(bs,bq)}function U(bt,bu,bp){var bq,br,bs;if(bt==null){return null}bq=(bt instanceof Array)?bt.join():bt;br=(bu instanceof Array)?bu.join():bu;bs=(bp instanceof Array)?bp.join():bp;return bq.substring(br,bs)}function aO(br,bs){var bp,bq;if(br==null){return null}bp=String((br instanceof Array)?br.join():br);bq=parseInt((bs instanceof Array)?bs.join():bs);return bp.substring(0,bq)}function aB(bt,bu,bp){var bq,br,bs;if(bt==null){return null}bq=String((bt instanceof Array)?bt.join():bt);br=parseInt((bu instanceof Array)?bu.join():bu);bs=parseInt((bp instanceof Array)?bp.join():bp);return bq.substr(br,bs)}function bn(br,bs){var bp,bq;if(br==null){return null}bp=String((br instanceof Array)?br.join():br);bq=parseInt((bs instanceof Array)?bs.join():bs);return bp.substring(bp.length-bq)}function bh(bs,bq,bt){var bp,br;if(bs==null){return null}bp=(bs instanceof Array)?bs.join():bs;br=(bq instanceof Array)?bq.join():bq;if(bt==undefined){return bp.indexOf(br)}return bp.indexOf(br,bt)}function a3(bs,bq,bt){var bp,br;if(bs==null){return null}bp=(bs instanceof Array)?bs.join():bs;br=(bq instanceof Array)?bq.join():bq;if(bt==undefined){return bp.lastIndexOf(br)}return bp.lastIndexOf(br,bt)}function ah(bv,bw,bp,bt){var bq,br,bu,bs;if(bv==null){return null}bq=(bv instanceof Array)?bv.join():bv;br=(bw instanceof Array)?bw.join():bw;bu=(bp instanceof Array)?bp.join():bp;bs=(bt instanceof Array)?bt.join():bt;return bq.substr(0,br)+bs+bq.substr(bu)}function x(bv,bq,bu){var bp,bs,bt,br;if(bv==null){return null}bp=(bv instanceof Array)?bv.join():bv;bs=(bq instanceof Array)?bq.join():bq;bt=(bu instanceof Array)?bu.join():bu;br=new RegExp(bs,"g");return bp.replace(br,bt)}function aS(bs,bq){var bp,br;bp=(bs instanceof Array)?bs.join():bs;br=(bq instanceof Array)?bq.join():bq;return bp.match(new RegExp(br))}function aA(bs,bq){var bp,br;if(bs==null){return null}bp=(bs instanceof Array)?bs.join():bs;br=(bq instanceof Array)?bq.join():bq;return(new RegExp(br)).test(bp)}at.timeOffset=(new Date()).getTimezoneOffset();function a(bq){var bp;if(bq===undefined){bp=Date.now()}else{bp=Date.parse(bq.replace(/-/g,"/"));bp-=at.timeOffset*60000}return parseInt(bp/86400000)}function a4(bq){var bp;if(bq===undefined){bp=Date.now()}else{bp=Date.parse(bq.replace(/-/g,"/"))}return parseInt(bp/1000)}function bl(bp){if(parseInt(bp).length==bp.length){return bp}else{return a(bp)}}function aK(bp){if(parseInt(bp).length==bp.length){return bp}else{return a4(bp)}}function n(bs,bp,br){var bq=[];bq.push(aV(bs));bq.push(bb(bs));bq.push(aa(bs));bq[br]+=bp;return aE(bq[0],bq[1],bq[2])}function aP(bs,bp,br){var bq=[];bq.push(bj(bs));bq.push(g(bs));bq.push(d(bs));bq.push(bf(bs));bq.push(H(bs));bq.push(f(bs));bq[br]+=bp;return a5(bq[0],bq[1],bq[2],bq[3],bq[4],bq[5])}function aE(bs,bp,br){var bq=bp-1;if(bq<0||bq>11){bs+=parseInt(bq/12);bp=bq%12+1}return parseInt(Date.UTC(bs,bp-1,br,0,0,0)/86400000)}function a5(bv,bp,bu,bt,br,bs){if(bs<0||bs>59){br+=parseInt(bs/60);bs=bs%60}if(br<0||br>59){bt+=parseInt(br/60);br=br%60}if(bt<0||bt>23){bu+=parseInt(bt/24);bt=bt%24}var bq=bp-1;if(bq<0||bq>11){bv+=parseInt(bq/12);bp=bq%12+1}return Date.UTC(bv,bp-1,bu,bt,br,bs)/1000}function aJ(bp){return INTERMediator.dateTimeFunction?bj(bp):aV(bp)}function bg(bp){return INTERMediator.dateTimeFunction?g(bp):bb(bp)}function L(bp){return INTERMediator.dateTimeFunction?d(bp):aa(bp)}function aF(bp){return INTERMediator.dateTimeFunction?aw(bp):aq(bp)}function ak(bp){return INTERMediator.dateTimeFunction?bf(bp):0}function M(bp){return INTERMediator.dateTimeFunction?H(bp):0}function Z(bp){return INTERMediator.dateTimeFunction?f(bp):0}function aV(bp){return new Date(bl(bp)*86400000).getFullYear()}function bb(bp){return new Date(bl(bp)*86400000).getMonth()+1}function aa(bp){return new Date(bl(bp)*86400000).getDate()}function aq(bp){return new Date(bl(bp)*86400000).getDay()}function bj(bp){return new Date(aK(bp)*1000).getFullYear()}function g(bp){return new Date(aK(bp)*1000).getMonth()+1}function d(bp){return new Date(aK(bp)*1000).getDate()}function aw(bp){return new Date(aK(bp)*1000).getDay()}function bf(bp){return new Date(aK(bp)*1000).getHours()}function H(bp){return new Date(aK(bp)*1000).getMinutes()}function f(bp){return new Date(aK(bp)*1000).getSeconds()}function o(bq,bp){return INTERMediator.dateTimeFunction?G(bq,bp):aY(bq,bp)}function av(bq,bp){return INTERMediator.dateTimeFunction?bc(bq,bp):v(bq,bp)}function W(bq,bp){return INTERMediator.dateTimeFunction?i(bq,bp):a6(bq,bp)}function m(bq,bp){return INTERMediator.dateTimeFunction?C(bq,bp):NaN}function O(bq,bp){return INTERMediator.dateTimeFunction?V(bq,bp):NaN}function ba(bq,bp){return INTERMediator.dateTimeFunction?t(bq,bp):NaN}function aY(bq,bp){return n(bq,bp,0)}function v(bq,bp){return n(bq,bp,1)}function a6(bq,bp){return n(bq,bp,2)}function G(bq,bp){return aP(bq,bp,0)}function bc(bq,bp){return aP(bq,bp,1)}function i(bq,bp){return aP(bq,bp,2)}function C(bq,bp){return aP(bq,bp,3)}function V(bq,bp){return aP(bq,bp,4)}function t(bq,bp){return aP(bq,bp,5)}function K(bp){return INTERMediator.dateTimeFunction?w(bp):ai(bp)}function ai(bp){return a6(v(a1(bp),1),-1)}function w(bp){return t(bc(a9(bp),1),-1)}function aZ(bp){return INTERMediator.dateTimeFunction?a9(bp):a1(bp)}function a1(bq){var bp=aV(bq)+"/"+("0"+bb(bq)).substr(-2,2)+"/01";return a(bp)}function a9(bp){var bq=bj(bp)+"/"+("0"+g(bp)).substr(-2,2)+"/01 00:00:00";return a4(bq)}function an(){return parseInt(Date.now()/86400)}function N(){return parseInt(Date.now()/1000)}function D(bs){var bp,br,bq,bt;bp=String(bs);br=IMLib.zerolength_str;for(bq=0;bq<bp.length;bq++){bt=bp.substr(bq,1);if(bt>="0"&&bt<="9"){br+=bt}else{if(bt>=""&&bt<=""){br+=String.fromCharCode("0".charCodeAt(0)+bt.charCodeAt(0)-"".charCodeAt(0))}else{if(bt=="."||bt=="-"){br+=bt}}}}return parseFloat(br)}function P(){var bp;if(arguments[0]==null||arguments[0]==undefined){return arguments[0]}bp=parseInt(arguments[0]);if(bp<0||bp>=(arguments.length-1)){return undefined}return arguments[bp+1]}function a0(){var bp;for(bp=0;bp<arguments.length;bp+=2){if(arguments[bp]==true&&bp+1<arguments.length){return arguments[bp+1]}}return undefined}function e(){var bp,bq="";for(bp=0;bp<arguments.length;bp+=2){if(arguments[bp]==true&&bp+1<arguments.length){bq=bq+arguments[bp+1]+"\n"}}return bq}function at(){this.success=false;this.errormsg=IMLib.zerolength_str;this.expression=IMLib.zerolength_str;this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;at.functions={count:q,random:aH,fac:ap,min:Math.min,max:Math.max,pyt:F,pow:Math.pow,atan2:Math.atan2,"if":aC,sum:aU,average:ar,list:X,format:p,currency:a7,substr:ac,substring:U,indexof:bh,lastindexof:a3,replace:ah,substitute:x,match:aS,test:aA,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:S,exp:Math.exp,items:aR,length:l,datetime:a4,date:a,datecomponents:aE,datetimecomponents:a5,year:aJ,month:bg,day:L,weekday:aF,hour:ak,minute:M,second:Z,yeard:aV,monthd:bb,dayd:aa,weekdayd:aq,yeardt:bj,monthdt:g,daydt:d,weekdaydt:aw,hourdt:bf,minutedt:H,seconddt:f,addyear:o,addmonth:av,addday:W,addhour:m,addminute:O,addsecond:ba,addyeard:aY,addmonthd:v,adddayd:a6,addyeardt:G,addmonthdt:bc,adddaydt:i,addhourdt:C,addminutedt:V,addseconddt:t,endofmonth:K,startofmonth:aZ,endofmonthd:ai,startofmonthd:a1,endofmonthdt:w,startofmonthdt:a9,today:an,now:N,right:bn,mid:aB,left:aO,itemIndexOf:ab,choice:P,condition:a0,accumulate:e};this.consts={E:Math.E,PI:Math.PI};at.operators={"!":[1,Q,2],"+":[2,A,4],"":[2,aG,4],"-":[2,a8,4],"*":[2,b,3],"/":[2,y,3],"%":[2,c,3],"^":[2,Math.pow,1],",":[2,Y,15],">":[2,ay,6],"<":[2,s,6],">=":[2,R,6],"<=":[2,h,6],"==":[2,be,7],"=":[2,be,7],"!=":[2,az,7],"<>":[2,az,7],"&&":[2,bo,11],"||":[2,J,12],"":[2,ax,3],"":[2,r,4],"":[2,ao,4],"":[2,k,3],"":[2,bm,4],"":[2,ad,4],"?":[2,aC,13],":":[4,aC,13]};at.ops1={"-":aD};at.ops2={};at.ops3={};at.ops3Trail={};for(var bp in at.operators){if(at.operators.hasOwnProperty(bp)){switch(at.operators[bp][0]){case 1:at.ops1[bp]=at.operators[bp][1];break;case 2:at.ops2[bp]=at.operators[bp][1];break;case 3:at.ops3[bp]=at.operators[bp][1];break;case 4:at.ops3Trail[bp]=at.operators[bp][1];break}}}}at.parse=function(bp){return new at().parse(bp)};at.evaluate=function(bq,br){var bp;bp=at.parse(bq).evaluate(br);return bp};at.Expression=a2;var bd=1<<0;var aM=1<<1;var aI=1<<2;var I=1<<3;var B=1<<4;var u=1<<5;var bi=1<<6;var bk=1<<7;var aN=1<<8;at.prototype={parse:function(bx){this.errormsg=IMLib.zerolength_str;this.success=true;var br=[];var bz=[];this.tmpprio=0;var bt=(bd|I|aI|bi);var bu=0;this.expression=bx;this.pos=0;var bw=[],bq;while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&(bt&bi)){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";bu++;this.addfunc(bz,br,ag)}bt=(bd|I|aI|bi)}else{if(this.isComment()){}else{if((bt&aM)===0){this.error_parsing(this.pos,"unexpected operator")}if(this.tokenindex=="?"){this.tmpprio-=40;this.tokenindex="if";this.addfunc(bz,br,af);this.tmpprio+=40;this.tokenindex=",";bu+=3;this.addfunc(bz,br,af)}else{if(this.tokenindex==":"){this.tokenindex=",";bu+=2;this.addfunc(bz,br,af)}else{bu+=2;this.addfunc(bz,br,af)}}bt=(bd|I|aI|bi)}}}else{if(this.isNumber()){if((bt&bd)===0){this.error_parsing(this.pos,"unexpected number")}bq=new aT(al,0,0,this.tokennumber);bz.push(bq);bt=(aM|B|u)}else{if(this.isString()){if((bt&bd)===0){this.error_parsing(this.pos,"unexpected string")}bq=new aT(al,0,0,this.tokennumber);bz.push(bq);bt=(aM|B|u)}else{if(this.isLeftParenth()){if((bt&I)===0){this.error_parsing(this.pos,"unexpected '(\"")}if(bt&bk){bw.push(true)}else{bw.push(false)}bt=(bd|I|aI|bi|aN)}else{if(this.isRightParenth()){var by=bw.pop();if(by){bu+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(bz,br,E)}if(bt&aN){bq=new aT(al,0,0,[]);bz.push(bq)}else{if((bt&B)===0){this.error_parsing(this.pos,'unexpected ")"')}}bt=(aM|B|u|I|bk)}else{if(this.isConst()){if((bt&bd)===0){this.error_parsing(this.pos,"unexpected constant")}var bp=new aT(al,0,0,this.tokennumber);bz.push(bp);bt=(aM|B|u)}else{if(this.isVar()){if((bt&bd)===0){this.error_parsing(this.pos,"unexpected variable")}var bv=new aT(am,this.tokenindex,0,0);bz.push(bv);bt=(aM|B|u|I|bk)}else{if(this.isWhite()){}else{if(this.errormsg===IMLib.zerolength_str){this.error_parsing(this.pos,"unknown character")}else{this.error_parsing(this.pos,this.errormsg)}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"')}while(br.length>0){var bs=br.pop();bz.push(bs)}return new a2(bz)},evaluate:function(bq,br){var bp;this.parse(bq).evaluate(br);return bp},error_parsing:function(bp,bq){this.success=false;this.errormsg="parse error [column "+(bp)+"]: "+bq;throw new Error(this.errormsg)},addfunc:function(bs,bp,br){var bq=new aT(br,this.tokenindex,this.tokenprio+this.tmpprio,0);while(bp.length>0){if(bq.prio_>=bp[bp.length-1].prio_){bs.push(bp.pop())}else{break}}bp.push(bq)},isNumber:function(){var bq=false;var br=IMLib.zerolength_str;while(this.pos<this.expression.length){var bp=this.expression.charCodeAt(this.pos);if((bp>=48&&bp<=57)||bp===46){br+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(br);bq=true}else{break}}return bq},unescape:function(bq,bv){var bp=[];var bu=false;for(var bs=0;bs<bq.length;bs++){var bt=bq.charAt(bs);if(bu){switch(bt){case IMLib.singleQuote_char:bp.push(IMLib.singleQuote_char);break;case IMLib.backSlash_char:bp.push(IMLib.backSlash_char);break;case"/":bp.push("/");break;case"b":bp.push("\b");break;case"f":bp.push("\f");break;case"n":bp.push(IMLib.nl_char);break;case"r":bp.push(IMLib.cr_char);break;case"t":bp.push(IMLib.tab_char);break;case"u":var br=parseInt(bq.substring(bs+1,bs+5),16);bp.push(String.fromCharCode(br));bs+=4;break;default:throw this.error_parsing(bv+bs,"Illegal escape sequence: '\\"+bt+IMLib.singleQuote_char)}bu=false}else{if(bt==IMLib.backSlash_char){bu=true}else{bp.push(bt)}}}return bp.join("")},isString:function(){var bq=false;var bs=IMLib.zerolength_str;var br=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)==IMLib.singleQuote_char){this.pos++;while(this.pos<this.expression.length){var bp=this.expression.charAt(this.pos);if(bp!=IMLib.singleQuote_char||bs.slice(-1)==IMLib.backSlash_char){bs+=this.expression.charAt(this.pos);this.pos++}else{this.pos++;this.tokennumber=this.unescape(bs,br);bq=true;break}}}return bq},isConst:function(){var br,bq;for(bq in this.consts){if(this.consts.hasOwnProperty(bq)){var bp=bq.length;br=this.expression.substr(this.pos,bp);if(bq===br){this.tokennumber=this.consts[bq];this.pos+=bp;return true}}}return false},isOperator:function(){var bp;if(this.pos+1<this.expression.length){bp=this.expression.substr(this.pos,2);if(at.operators[bp]){this.tokenprio=at.operators[bp][2];this.tokenindex=bp;this.pos+=2;return true}}bp=this.expression.substr(this.pos,1);if(at.operators[bp]){this.tokenprio=at.operators[bp][2];this.tokenindex=bp;this.pos++;return true}return false},isSign:function(){var bp=this.expression.charCodeAt(this.pos-1);if(bp===45||bp===43){return true}return false},isPositiveSign:function(){var bp=this.expression.charCodeAt(this.pos-1);if(bp===43){return true}return false},isNegativeSign:function(){var bp=this.expression.charCodeAt(this.pos-1);if(bp===45){return true}return false},isLeftParenth:function(){var bp=this.expression.charCodeAt(this.pos);if(bp===40){this.pos++;this.tmpprio-=20;return true}return false},isRightParenth:function(){var bp=this.expression.charCodeAt(this.pos);if(bp===41){this.pos++;this.tmpprio+=20;return true}return false},isComma:function(){var bp=this.expression.charCodeAt(this.pos);if(bp===44){this.pos++;this.tokenprio=15;this.tokenindex=",";return true}return false},isWhite:function(){var bp=this.expression.charCodeAt(this.pos);if(bp===32||bp===9||bp===10||bp===13){this.pos++;return true}return false},isVar:function(){var bq=IMLib.zerolength_str;for(var bp=this.pos;bp<this.expression.length;bp++){var br=this.expression.charAt(bp);if(bp===this.pos){if(!br.match(at.regFirstVarChar)){break}}else{if(!br.match(at.regRestVarChar)){break}}bq+=br}if(bq.length>0){this.tokenindex=bq;this.tokenprio=0;this.pos+=bq.length;return true}return false},isComment:function(){var bp=this.expression.charCodeAt(this.pos-1);if(bp===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length}return true}return false}};aQ.Parser=at;return at})(typeof exports==="undefined"?{}:exports);INTERMediator.propertyIETridentSetup();INTERMediator.propertyW3CUserAgentSetup();if(INTERMediator.isIE&&INTERMediator.ieVersion<9){INTERMediator.startFrom=0;INTERMediator.pagedSize=0;INTERMediator.pagination=false;INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};IMLibCalc.regexpForSeparator=INTERMediator.separator}else{Object.defineProperty(INTERMediator,"startFrom",{get:function(){return INTERMediator.getLocalProperty("_im_startFrom",0)},set:function(a){INTERMediator.setLocalProperty("_im_startFrom",a)}});Object.defineProperty(INTERMediator,"pagedSize",{get:function(){return INTERMediator.getLocalProperty("_im_pagedSize",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagedSize",a)}});Object.defineProperty(INTERMediator,"pagination",{get:function(){return INTERMediator.getLocalProperty("_im_pagination",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagination",a)}});Object.defineProperty(INTERMediator,"additionalCondition",{get:function(){return INTERMediator.getLocalProperty("_im_additionalCondition",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalCondition",a)}});Object.defineProperty(INTERMediator,"additionalSortKey",{get:function(){return INTERMediator.getLocalProperty("_im_additionalSortKey",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalSortKey",a)}});Object.defineProperty(IMLibCalc,"regexpForSeparator",{get:function(){if(INTERMediator){return new RegExp(INTERMediator.separator)}return new RegExp("@")}})}if(!INTERMediator.additionalCondition){INTERMediator.additionalCondition={}}if(!INTERMediator.additionalSortKey){INTERMediator.additionalSortKey={}}INTERMediatorLib.addEvent(window,"beforeunload",function(a){});INTERMediatorLib.addEvent(window,"unload",function(){INTERMediator_DBAdapter.unregister()});INTERMediatorLib.addEvent(window,"load",function(){var a,b;if(INTERMediatorOnPage.initLocalContext){for(a in INTERMediatorOnPage.initLocalContext){if(INTERMediatorOnPage.initLocalContext.hasOwnProperty(a)){IMLibLocalContext.setValue(a,INTERMediatorOnPage.initLocalContext[a],true)}}}b=document.getElementById(INTERMediatorOnPage.nonSupportMessageId);if(INTERMediatorOnPage.isAutoConstruct){if(b){if(INTERMediatorOnPage.INTERMediatorCheckBrowser(b)){INTERMediator.construct(true)}}else{INTERMediator.construct(true)}}});
