/*
 * INTER-Mediator Ver.5.2 Released 2015-08-24
 *
 *   Copyright (c) 2010-2015 INTER-Mediator Directive Committee, All rights reserved.
 *
 *   This project started at the end of 2009 by Masayuki Nii  msyk@msyk.net.
 *   INTER-Mediator is supplied under MIT License.
 */
var INTERMediator;INTERMediator={debugMode:false,separator:"@",defDivider:"|",defaultTargetInnerHTML:false,navigationLabel:null,elementIds:[],radioNameMode:false,dontSelectRadioCheck:false,ignoreOptimisticLocking:false,supressDebugMessageOnPage:false,supressErrorMessageOnPage:false,additionalFieldValueOnNewRecord:{},additionalFieldValueOnUpdate:{},additionalFieldValueOnDelete:{},waitSecondsAfterPostMessage:4,pagedAllCount:0,totalRecordCount:null,currentEncNumber:0,isIE:false,isTrident:false,ieVersion:-1,titleAsLinkInfo:true,classAsLinkInfo:true,isDBDataPreferable:false,noRecordClassName:"_im_for_noresult_",rootEnclosure:null,useSessionStorage:true,errorMessages:[],debugMessages:[],partialConstructing:false,linkedElmCounter:0,pusherObject:null,buttonIdNum:0,masterNodeOriginalDisplay:"block",detailNodeOriginalDisplay:"none",pusherAvailable:false,dateTimeFunction:false,postOnlyNodes:null,postOnlyNumber:1,errorMessageByAlert:false,errorMessageOnAlert:null,setDebugMessage:function(a,b){if(b===undefined){b=1}if(INTERMediator.debugMode>=b){INTERMediator.debugMessages.push(a);if(typeof console!="undefined"){console.log("INTER-Mediator[DEBUG:%s]: %s",new Date(),a)}}},setErrorMessage:function(a,b){b=b===undefined?"":(" - "+b);if(INTERMediator.errorMessageByAlert){alert(INTERMediator.errorMessageOnAlert===null?(a+b):INTERMediator.errorMessageOnAlert)}if((typeof a=="string"||a instanceof String)){INTERMediator.errorMessages.push(a+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a+b)}}else{if(a.message){INTERMediator.errorMessages.push(a.message+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a.message+b)}}if(a.stack&&typeof console!="undefined"){console.error(a.stack)}}},flushMessage:function(){var h,k,e,c,b,l,a,d,f;if(INTERMediator.errorMessageByAlert){INTERMediator.supressErrorMessageOnPage=true}if(!INTERMediator.supressErrorMessageOnPage&&INTERMediator.errorMessages.length>0){h=document.getElementById("_im_error_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_error_panel_4873643897897");h.style.backgroundColor="#FFDDDD";k=document.createElement("h3");k.appendChild(document.createTextNode("Error Info from INTER-Mediator"));k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];e.insertBefore(h,e.firstChild)}h.appendChild(document.createTextNode("============ERROR MESSAGE on "+new Date()+"============"));h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.errorMessages.length;c++){l=INTERMediator.errorMessages[c].split("\n");for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}if(!INTERMediator.supressDebugMessageOnPage&&INTERMediator.debugMode&&INTERMediator.debugMessages.length>0){h=document.getElementById("_im_debug_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_debug_panel_4873643897897");h.style.backgroundColor="#DDDDDD";a=document.createElement("button");a.setAttribute("title","clear");INTERMediatorLib.addEvent(a,"click",function(){f=document.getElementById("_im_debug_panel_4873643897897");f.parentNode.removeChild(f)});d=document.createTextNode("clear");a.appendChild(d);k=document.createElement("h3");k.appendChild(document.createTextNode("Debug Info from INTER-Mediator"));k.appendChild(a);k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];if(e){if(e.firstChild){e.insertBefore(h,e.firstChild)}else{e.appendChild(h)}}}h.appendChild(document.createTextNode("============DEBUG INFO on "+new Date()+"============ "));if(INTERMediatorOnPage.getEditorPath()){var g=document.createElement("a");g.setAttribute("href",INTERMediatorOnPage.getEditorPath());g.appendChild(document.createTextNode("Definition File Editor"));h.appendChild(g)}h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.debugMessages.length;c++){l=INTERMediator.debugMessages[c].split("\n");for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}INTERMediator.errorMessages=[];INTERMediator.debugMessages=[]},propertyIETridentSetup:function(){var d,a,e,b;d=navigator.userAgent;a=d.toLocaleUpperCase().indexOf("MSIE");if(a>=0){INTERMediator.isIE=true;for(b=a+4;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+4,b));break}}}a=d.indexOf("; Trident/");if(a>=0){INTERMediator.isTrident=true;for(b=a+10;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+10,b))+4;break}}}},initialize:function(){INTERMediatorOnPage.removeCookie("_im_localcontext");INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};INTERMediator.startFrom=0;IMLibLocalContext.archive()},construct:function(b){var a;INTERMediatorOnPage.showProgress();if(b===true||b===undefined){a=function(){INTERMediator.constructMain(true)}}else{a=function(){INTERMediator.constructMain(b)}}setTimeout(a,0)},constructMain:function(N,o){var K,F,y=0,B=[],t=[],s,A=1,l=[],H=false,k,r,h,z;r=[];IMLibEventResponder.setup();INTERMediatorOnPage.retrieveAuthInfo();try{if(Pusher.VERSION){INTERMediator.pusherAvailable=true;if(!INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1039]);INTERMediator.pusherAvailable=false}}}catch(E){INTERMediator.pusherAvailable=false;if(INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1038])}}try{if(N===true||N===undefined){IMLibPageNavigation.deleteInsertOnNavi=[];this.partialConstructing=false;INTERMediator.buttonIdNum=1;IMLibContextPool.clearAll();u()}else{IMLibPageNavigation.deleteInsertOnNavi=[];this.partialConstructing=true;s=false;B=[];try{if(!o){N.removeContext();k=N.original;for(K=0;K<k.length;K++){N.enclosureNode.appendChild(k[K].cloneNode(true))}c(N.enclosureNode,N.foreignValue,N.dependingParentObjectInfo,N)}else{d(N,N.enclosureNode,{recordset:o,targetTotalCount:1,targetCount:1})}}catch(E){if(E=="_im_requath_request_"){throw E}else{INTERMediator.setErrorMessage(E,"EXCEPTION-8")}}for(K=0;K<B.length;K++){document.getElementById(B[K]["id"]).value=B[K]["value"]}IMLibCalc.updateCalculationFields()}}catch(E){if(E=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){INTERMediator.constructMain(N)});return}}}else{INTERMediator.setErrorMessage(E,"EXCEPTION-7")}}for(K=0;K<l.length;K++){l[K].finish()}INTERMediatorOnPage.hideProgress();for(K=0;K<r.length;K++){F=r[K].targetNode;h=r[K].parentNode;z=r[K].siblingNode;if(F&&h){if(z){h.insertBefore(F,z)}else{h.appendChild(F)}}}for(K=0;K<t.length;K++){F=document.getElementById(t[K].id);if(F){INTERMediatorLib.addEvent(F,t[K].event,t[K].todo)}}if(INTERMediatorOnPage.doAfterConstruct){INTERMediatorOnPage.doAfterConstruct()}INTERMediator.flushMessage();function u(){var R,S,U;IMLibCalc.calculateRequiredObject={};INTERMediator.currentEncNumber=1;INTERMediator.elementIds=[];s=false;S=document.getElementsByTagName("BODY")[0];if(INTERMediator.rootEnclosure===null){INTERMediator.rootEnclosure=S.innerHTML}else{S.innerHTML=INTERMediator.rootEnclosure}B=[];try{c(S,null,null,null)}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-9")}}for(R=0;R<B.length;R++){if(B[R]["value"]===""&&document.getElementById(B[R]["id"]).tagName=="SELECT"){U=document.createElement("option");U.setAttribute("value","");document.getElementById(B[R]["id"]).insertBefore(U,document.getElementById(B[R]["id"]).firstChild)}document.getElementById(B[R]["id"]).value=B[R]["value"]}IMLibLocalContext.bindingDescendant(S);IMLibCalc.updateCalculationFields();IMLibPageNavigation.navigationSetup();if(H&&INTERMediator.pusherAvailable){var P=INTERMediatorOnPage.clientNotificationIdentifier();var T=INTERMediatorOnPage.clientNotificationKey();if(T&&T!="_im_key_isnt_supplied"&&!INTERMediator.pusherObject){try{Pusher.log=function(V){if(window.console&&window.console.log){window.console.log(V)}};INTERMediator.pusherObject=new Pusher(T);INTERMediator.pusherChannel=INTERMediator.pusherObject.subscribe(P);INTERMediator.pusherChannel.bind("update",function(V){IMLibContextPool.updateOnAnotherClient("update",V)});INTERMediator.pusherChannel.bind("create",function(V){IMLibContextPool.updateOnAnotherClient("create",V)});INTERMediator.pusherChannel.bind("delete",function(V){IMLibContextPool.updateOnAnotherClient("delete",V)})}catch(Q){INTERMediator.setErrorMessage(Q,"EXCEPTION-47")}}}e()}function c(S,P,U,Q){var R,X,T,V;if(S.nodeType===1){try{if(INTERMediatorLib.isEnclosure(S,false)){X=INTERMediatorLib.getClassAttributeFromNode(S);V=S.getAttribute("data-im-control");if((X&&X.match(/_im_post/))||(V&&V=="post")){n(S)}else{if(INTERMediator.isIE){try{J(S,P,U,Q)}catch(W){if(W=="_im_requath_request_"){throw W}}}else{J(S,P,U,Q)}}}else{R=S.childNodes;if(R){for(T=0;T<R.length;T++){if(R[T].nodeType===1){c(R[T],P,U,Q)}}}}}catch(W){if(W=="_im_requath_request_"){throw W}else{INTERMediator.setErrorMessage(W,"EXCEPTION-10")}}}}function n(S){var R,P;P=INTERMediatorLib.getElementsByClassNameOrDataAttr(S,"_im_post");for(K=0;K<P.length;K++){if(P[K].tagName==="BUTTON"){INTERMediatorLib.addEvent(P[K],"click",(function(){var T=P[K];return function(){IMLibUI.clickPostOnlyButton(T)}})())}}R=S.childNodes;s=true;for(K=0;K<R.length;K++){Q(R[K])}s=false;function Q(X){var W,V,U;if(X.nodeType===1){try{if(X.getAttribute("data-im")){if(!X.id){X.id="IMPOST-"+INTERMediator.postOnlyNumber;INTERMediator.postOnlyNumber++}INTERMediatorLib.addEvent(X,"blur",function(Z){var Y=X.id;IMLibUI.valueChange(Y,true)})}if(INTERMediatorLib.isWidgetElement(X)){V=INTERMediatorLib.getWidgetInfo(X);if(V[0]){IMParts_Catalog[V[0]].instanciate(X);if(l.indexOf(IMParts_Catalog[V[0]])<0){l.push(IMParts_Catalog[V[0]])}}}else{if(INTERMediatorLib.isEnclosure(X,false)){J(X,null,null,null)}else{W=X.childNodes;for(U=0;U<W.length;U++){Q(W[U])}}}}catch(T){if(T=="_im_requath_request_"){throw T}else{INTERMediator.setErrorMessage(T,"EXCEPTION-11")}}}}}function J(ai,V,ab,ad){var T,Z,U,Y,af,ag,ae,ap,X,ao,ah,ac,S,ak,W,Q,P,aj,an,R,aa,al;y++;Z=ai.tagName;X=INTERMediatorLib.repeaterTagFromEncTag(Z);U=b(ai,X);Y=q(U);T=INTERMediatorLib.seekLinkedAndWidgetNodes(Y,true).linkedNode;af=x(T);ag=D(af);ae=ag.targettable;INTERMediator.currentEncNumber++;if(!ai.getAttribute("id")){ai.setAttribute("id",v())}if(!ae){for(ak=0;ak<U.length;ak++){P=ai.appendChild(U[ak]);if(U[ak].getAttribute("selected")!==null){an=P}if(an!==undefined){an.selected=true}c(P,null,ai,ad)}}else{al=new IMLibContext(ae.name);al.enclosureNode=ai;al.repeaterNodes=Y;al.original=U;al.parentContext=ad;al.sequencing=true;ap=[];R=ae.calculation;aa=[];for(W in R){aa.push(R[W]["field"])}for(ak=0;ak<ag.fieldlist.length;ak++){if(!aa[ag.fieldlist[ak]]){aa.push(ag.fieldlist[ak])}}if(V){try{ah=ae.relation;al.setOriginal(U);if(ah){for(ac in ah){if(Boolean(ah[ac].portal)===true){ae.portal=true}ao=ah[ac]["join-field"];al.addForeignValue(ao,V[ao]);for(S in ab){if(S==ah[ac]["join-field"]){al.addDependingObject(ab[S]);al.dependingParentObjectInfo=JSON.parse(JSON.stringify(ab))}}}}}catch(am){if(am=="_im_requath_request_"){throw am}else{INTERMediator.setErrorMessage(am,"EXCEPTION-25")}}}if(Boolean(ae.portal)===true){ae.currentrecord=V;aj=V["-recid"]}Q=w(ae,ap,al.foreignValue);al.registeredId=Q.registeredId;al.nullAcceptable=Q.nullAcceptable;H|=!(INTERMediatorOnPage.notifySupport===false);d(al,ai,Q);G(ae,aj,ai,al.foreignValue);a(al,ai);O(ae,ai);al.sequencing=false}y--}function d(af,aq,ar){var aa,aN,an,aO,av,al,Y,aD,aJ,R,S,ab,aM,X,at,ah,aH,aI,aG,ad,Z,Q,W,aE,az,aB,ag,ax,ay,U,aK,T,aw,aC,ap,aj,ae,P,ao,aL,V,ai,aA,ak,am;aC=aq.tagName;ap=INTERMediatorLib.repeaterTagFromEncTag(aC);ai={};ae=af.original;V=af.getContextDef();P=ar.recordset;ao=ar.totalCount;if(ar.count===0){for(aL=0;aL<ae.length;aL++){aa=ae[aL].cloneNode(true);aN=INTERMediatorLib.getClassAttributeFromNode(aa);an=aa.getAttribute("data-im-control");if(aN==INTERMediator.noRecordClassName||an=="noresult"){aq.appendChild(aa);m(aa)}}}aO=0;am=false;for(aj=0;aj<P.length;aj++){try{aO++;av=g(ae);al=INTERMediatorLib.seekLinkedAndWidgetNodes(av,true);Y=al.widgetNode;aD=al.linkedNode;aJ=[];for(aL=0;aL<av.length;aL++){m(av[aL]);aJ.push(av[aL].getAttribute("id"))}R=INTERMediatorOnPage.getDBSpecification();if(R["db-class"]!==null&&R["db-class"]=="FileMaker_FX"){S=V.key?V.key:"-recid"}else{S=V.key?V.key:"id"}if(V.relation){for(aL=0;aL<Object.keys(V.relation).length;aL++){if(V.relation[aL]["portal"]&&Number(V.relation[aL]["portal"])===1){am=true}}}if(am===true){S="-recid";ab=V.name+"::-recid";aM=P[aj][ab];X=ab+"="+aM}else{X="=";aM=null}at=P[aj][S];ah=S+"="+at;for(aH=0;aH<aD.length;aH++){aI=aD[aH].getAttribute("id");aG=m(aD[aH]);aE=aG.getAttribute("type");if(aE=="checkbox"||aE=="radio"){ad=aG.parentNode.childNodes;for(aL=0;aL<ad.length;aL++){if(ad[aL].nodeType===1&&ad[aL].tagName=="LABEL"&&aI==ad[aL].getAttribute("for")){ad[aL].setAttribute("for",aG.getAttribute("id"));break}}}}for(aH=0;aH<Y.length;aH++){Z=INTERMediatorLib.getWidgetInfo(Y[aH]);if(Z[0]){IMParts_Catalog[Z[0]].instanciate(Y[aH]);if(l.indexOf(IMParts_Catalog[Z[0]])<0){l.push(IMParts_Catalog[Z[0]])}}}}catch(aF){if(aF=="_im_requath_request_"){throw aF}else{INTERMediator.setErrorMessage(aF,"EXCEPTION-26")}}if(Boolean(V.portal)!==true||(Boolean(V.portal)===true&&ao>0)){Q={};for(aH=0;aH<aD.length;aH++){try{W=aD[aH].tagName;aI=aD[aH].getAttribute("id");if(INTERMediatorLib.isWidgetElement(aD[aH])){aI=aD[aH]._im_getComponentId()}aE=aD[aH].getAttribute("type");az=INTERMediatorLib.getLinkedElementInfo(aD[aH]);if(aE=="radio"){aB=az.join("|");if(!Q[aB]){Q[aB]=A;A++}ag=Q[aB];ax=aD[aH].getAttribute("name");if(ax){aD[aH].setAttribute("name",ax+"-"+ag)}else{aD[aH].setAttribute("name","IM-R-"+ag)}}var au=false;for(aK=0;aK<az.length;aK++){ay=INTERMediatorLib.getNodeInfoArray(az[aK]);U=P[aj][ay.field];if(!INTERMediator.isDBDataPreferable||U!==null){IMLibCalc.updateCalculationInfo(af,ah,V,aI,ay,P[aj])}if(ay.table==V.name){au=true;T=ay.target;if(U===null){if(IMLibElement.setValueToIMNode(aD[aH],T,"")){B.push({id:aI,value:U})}}else{if((typeof U=="object"||U instanceof Object)){if(U&&U.length>0){if(IMLibElement.setValueToIMNode(aD[aH],T,U[0])){B.push({id:aI,value:U[0]})}}}else{if(IMLibElement.setValueToIMNode(aD[aH],T,U)){B.push({id:aI,value:U})}}}af.setValue(ah,ay.field,U,aI,T,aM);ai[ay.field]=aI}}if(au&&!s&&(W=="INPUT"||W=="SELECT"||W=="TEXTAREA")){var ac=function(aP){var aQ=aP;return function(){IMLibUI.valueChange(aQ)}};t.push({id:aI,event:"change",todo:ac(aI)});if(W!="SELECT"){t.push({id:aI,event:"keydown",todo:IMLibUI.keyDown});t.push({id:aI,event:"keyup",todo:IMLibUI.keyUp})}}}catch(aF){if(aF=="_im_requath_request_"){throw aF}else{INTERMediator.setErrorMessage(aF,"EXCEPTION-27")}}}}if(am===true){S="-recid";ab=V.name+"::-recid";aM=P[aj][ab];X=ab+"="+aM}else{ab="";aM="";X="="}I(aC,ap,av[av.length-1],V,S,at,ab,aM,aJ);M(aC,ap,av[av.length-1],V,S,at,ab,aM);p(aC,ap,av[av.length-1],V,P[aj]);if(Boolean(V.portal)!==true||(Boolean(V.portal)===true&&ao>0)){aw=[];ak=null;if(!af.sequencing){aA=af.checkOrder(P[aj]);ak=af.getRepeaterEndNode(aA+1)}for(aL=0;aL<av.length;aL++){aa=av[aL];aN=INTERMediatorLib.getClassAttributeFromNode(aa);an=aa.getAttribute("data-im-control");if((aN!=INTERMediator.noRecordClassName)&&(an!="noresult")){if(!ak){aq.appendChild(aa)}else{ak.parentNode.insertBefore(aa,ak)}aw.push(aa);m(aa);af.setValue(ah,"_im_repeater","",aa.id,"",aM);ai[ay.field]=aI;c(aa,P[aj],ai,af)}}f(V,aq,aw)}af.rearrangePendingOrder()}}function w(Y,ah,ai){var U,R,Q,Z,ae,aa,W,T,ac,X,ag,S=[],P,af,ab,V=[];if(Boolean(Y.cache)===true){try{if(!INTERMediatorOnPage.dbCache[Y.name]){INTERMediatorOnPage.dbCache[Y.name]=INTERMediator_DBAdapter.db_query({name:Y.name,records:null,paging:null,fields:ah,parentkeyvalue:null,conditions:null,useoffset:false})}if(ai===null){Q=INTERMediatorOnPage.dbCache[Y.name]}else{Q={recordset:[],count:0};Z=0;for(U in INTERMediatorOnPage.dbCache[Y.name].recordset){ae=INTERMediatorOnPage.dbCache[Y.name].recordset[U];aa=true;W=0;for(R in ai){T=Y.relation[W]["foreign-key"];if(ae[T]!=ai[R]){aa=false;break}W++}if(aa){P=Y.paging?Y.paging:false;af=Y.records?Y.records:10000000000;if(!P||(P&&(Z>=INTERMediator.startFrom))){Q.recordset.push(ae);Q.count++;if(af<=Q.count){break}}Z++}}}}catch(ad){if(ad=="_im_requath_request_"){throw ad}else{INTERMediator.setErrorMessage(ad,"EXCEPTION-24")}}}else{try{if(Y.portal==true){for(ac in INTERMediator.additionalCondition){S.push(INTERMediator.additionalCondition[ac]);break}}ag=false;if(Y.records&&Y.paging){ag=true}if(Y["navi-control"]&&Y["navi-control"]==="detail"){X=1}else{if(Y.maxrecords){if(parseInt(INTERMediator.pagedSize,10)===0){if(Y.records){X=parseInt(Y.records,10)}else{X=parseInt(Y.maxrecords,10)}}else{if(parseInt(Y.maxrecords,10)<parseInt(INTERMediator.pagedSize,10)){if(parseInt(Y.maxrecords,10)<parseInt(Y.records,10)){X=parseInt(Y.records,10)}else{X=parseInt(Y.maxrecords,10)}}else{if(Y.relation){X=parseInt(Y.records,10)}else{X=parseInt(INTERMediator.pagedSize,10)}}}}else{if(parseInt(INTERMediator.pagedSize,10)===0||(parseInt(Y.records,10)<parseInt(INTERMediator.pagedSize,10))){X=parseInt(Y.records,10)}else{if(Y.relation){X=parseInt(Y.records,10)}else{X=parseInt(INTERMediator.pagedSize,10)}}}if(!Y.relation&&Y.paging&&Boolean(Y.paging)===true){INTERMediator.setLocalProperty("_im_pagedSize",X)}}Q={};if(Boolean(Y.portal)===true){for(ab=0;ab<Object.keys(Y.currentrecord).length;ab++){if(Y.currentrecord[ab]){V.push(Y.currentrecord[ab])}}Q.recordset=V}else{Q=INTERMediator_DBAdapter.db_query({name:Y.name,records:isNaN(X)?100000000:X,paging:Y.paging,fields:ah,parentkeyvalue:ai,conditions:S,useoffset:true,uselimit:ag})}}catch(ad){if(ad=="_im_requath_request_"){throw ad}else{INTERMediator.setErrorMessage(ad,"EXCEPTION-12")}}}return Q}function m(T){var R,S,P,Q=true;if(T.getAttribute("id")===null){T.setAttribute("id",v())}else{if(INTERMediator.elementIds.indexOf(T.getAttribute("id"))>=0){S=INTERMediatorLib.getLinkedElementInfo(T);for(R=0;R<S.length;R++){P=S[R].split(INTERMediator.separator);if(P[2]=="#id"){Q=false}}if(Q){T.setAttribute("id",v())}}INTERMediator.elementIds.push(T.getAttribute("id"))}return T}function v(){INTERMediator.linkedElmCounter++;return C()}function C(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}function f(S,R,Q){try{if(INTERMediatorOnPage.additionalExpandingRecordFinish[S.name]){INTERMediatorOnPage.additionalExpandingRecordFinish[S.name](R);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingRecordFinish["+S.name+"] with the context.",2)}}catch(P){if(P=="_im_requath_request_"){throw P}else{INTERMediator.setErrorMessage(P,"EXCEPTION-33: hint: post-repeater of "+S.name)}}try{if(INTERMediatorOnPage.expandingRecordFinish!=null){INTERMediatorOnPage.expandingRecordFinish(S.name,Q);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingRecordFinish with the context: "+S.name,2)}if(S["post-repeater"]){INTERMediatorOnPage[S["post-repeater"]](Q);INTERMediator.setDebugMessage("Call the post repeater method 'INTERMediatorOnPage."+S["post-repeater"]+"' with the context: "+S.name,2)}}catch(P){if(P=="_im_requath_request_"){throw P}else{INTERMediator.setErrorMessage(P,"EXCEPTION-23")}}}function O(R,Q){try{if(INTERMediatorOnPage.additionalExpandingEnclosureFinish[R.name]){INTERMediatorOnPage.additionalExpandingEnclosureFinish[R.name](Q);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingEnclosureFinish["+R.name+"] with the context.",2)}}catch(P){if(P=="_im_requath_request_"){throw P}else{INTERMediator.setErrorMessage(P,"EXCEPTION-32: hint: post-enclosure of "+R.name)}}try{if(INTERMediatorOnPage.expandingEnclosureFinish!=null){INTERMediatorOnPage.expandingEnclosureFinish(R.name,Q);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingEnclosureFinish with the context: "+R.name,2)}}catch(P){if(P=="_im_requath_request_"){throw P}else{INTERMediator.setErrorMessage(P,"EXCEPTION-21")}}try{if(R["post-enclosure"]){INTERMediatorOnPage[R["post-enclosure"]](Q);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage."+R["post-enclosure"]+"' with the context: "+R.name,2)}}catch(P){if(P=="_im_requath_request_"){throw P}else{INTERMediator.setErrorMessage(P,"EXCEPTION-22: hint: post-enclosure of "+R.name)}}}function b(S,P){var R,T=[],Q;Q=S.childNodes;for(R=0;R<Q.length;R++){if(Q[R].nodeType===1&&Q[R].tagName==P){T.push(Q[R])}}return T}function q(T){var R,U=[],S,P,Q;for(R=0;R<T.length;R++){S=T[R];P=T[R].parentNode;Q=T[R].cloneNode(true);U.push(Q);Q.setAttribute("id",v());P.removeChild(S)}return U}function x(T){var R=[],S,Q,P;for(Q=0;Q<T.length;Q++){S=INTERMediatorLib.getLinkedElementInfo(T[Q]);if(S!==null){for(P=0;P<S.length;P++){R.push(S[P])}}}return R}function D(Y){var W,aa,R,T,S,U,Z,P,Q,V=[],X=[];for(W=0;W<Y.length;W++){aa=INTERMediatorLib.getNodeInfoArray(Y[W]);R=aa.field;T=aa.table;P=aa.tableindex;if(T!=IMLibLocalContext.contextName){if(R!=null&&R.length!=0&&T.length!=0&&T!=null){if(!X[P]){X[P]=[]}X[P].push(R);if(!V[P]){V[P]=1}else{++V[P]}}else{INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1006,[Y[W]]))}}}S=-1;U="";for(Z in V){if(S<V[Z]){S=V[Z];U=Z.substring(10)}}Q=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",U);return{targettable:Q,fieldlist:X["_im_index_"+U]}}function g(R){var Q,P=[];for(Q=0;Q<R.length;Q++){P.push(R[Q].cloneNode(true))}return P}function p(V,X,Z,W,P){var Q,R,U,T,S,Y;if(!W["repeat-control"]||!W["repeat-control"].match(/copy/i)){return}if(W.paging==true){IMLibPageNavigation.deleteInsertOnNavi.push({kind:"COPY",contextDef:W,keyValue:P[W.key]})}else{Q=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(Q,"IM_Button_Copy");Y=INTERMediatorOnPage.getMessages()[14];if(W["button-names"]&&W["button-names"]["copy"]){Y=W["button-names"]["copy"]}Q.appendChild(document.createTextNode(Y));R="IM_Button_"+INTERMediator.buttonIdNum;Q.setAttribute("id",R);INTERMediator.buttonIdNum++;U=function(ac,aa){var ad=ac,ab=aa;return function(){IMLibUI.copyButton(ad,ab)}};t.push({id:R,event:"click",todo:U(W,P[W.key])});switch(V){case"TBODY":T=Z.getElementsByTagName("TD");S=T[T.length-1];S.appendChild(Q);break;case"UL":case"OL":Z.appendChild(Q);break;case"DIV":case"SPAN":if(X=="DIV"||X=="SPAN"){Z.appendChild(Q)}break}}}function I(Z,ab,ad,aa,T,W,Q,R,V){var P,U,S,Y,X,ac;if(!aa["repeat-control"]||!aa["repeat-control"].match(/delete/i)){return}if(aa.relation||aa.records===undefined||(aa.records>1&&Number(INTERMediator.pagedSize)!=1)){P=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(P,"IM_Button_Delete");ac=INTERMediatorOnPage.getMessages()[6];if(aa["button-names"]&&aa["button-names"]["delete"]){ac=aa["button-names"]["delete"]}P.appendChild(document.createTextNode(ac));U="IM_Button_"+INTERMediator.buttonIdNum;P.setAttribute("id",U);INTERMediator.buttonIdNum++;S=function(an,am,al,ak,ai){var af=an,ag=am,ah=al,aj=ak,ae=ai;return function(){IMLibUI.deleteButton(af,ag,ah,Q,R,aj,ae)}};t.push({id:U,event:"click",todo:S(aa.name,T,W,V,aa["repeat-control"].match(/confirm-delete/i))});switch(Z){case"TBODY":Y=ad.getElementsByTagName("TD");X=Y[Y.length-1];X.appendChild(P);break;case"UL":case"OL":ad.appendChild(P);break;case"DIV":case"SPAN":if(ab=="DIV"||ab=="SPAN"){ad.appendChild(P)}break}}else{IMLibPageNavigation.deleteInsertOnNavi.push({kind:"DELETE",name:aa.name,key:T,value:W,confirm:aa["repeat-control"].match(/confirm-delete/i)})}}function G(Y,af,ae,am){var R,ah,ai,V,ab,aj,al,ad,W,ag,aa,ak,U,Q,P,X,T,S,Z,ac;T=ae.tagName;S=INTERMediatorLib.repeaterTagFromEncTag(T);if(Y["repeat-control"]&&Y["repeat-control"].match(/insert/i)){if(am.length>0||!Y.paging||Y.paging===false){R=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(R,"IM_Button_Insert");Z=INTERMediatorOnPage.getMessages()[5];if(Y["button-names"]&&Y["button-names"]["insert"]){Z=Y["button-names"]["insert"]}R.appendChild(document.createTextNode(Z));X="IM_Button_"+INTERMediator.buttonIdNum;R.setAttribute("id",X);INTERMediator.buttonIdNum++;ah=[];switch(T){case"TBODY":ac=false;ak="TFOOT";if(Y["repeat-control"].match(/top/i)){ak="THEAD";ac=true}ai=ae.parentNode;aa=ai.childNodes;V=null;for(ag=0;ag<aa.length;ag++){if(aa[ag].tagName===ak){V=aa[ag];break}}if(V===null){V=document.createElement(ak);ai.appendChild(V)}U=INTERMediatorLib.getElementsByClassName(V,"IM_Button_Insert");if(U.length==0){ab=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(ab,"IM_Insert_TR");aj=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(aj,"IM_Insert_TD");m(ab);if(ac&&V.childNodes){V.insertBefore(ab,V.childNodes[0])}else{V.appendChild(ab)}ab.appendChild(aj);aj.appendChild(R);ah=[ab.getAttribute("id")]}break;case"UL":case"OL":al=document.createElement("LI");U=INTERMediatorLib.getElementsByClassName(al,"IM_Button_Insert");if(U.length==0){al.appendChild(R);if(Y["repeat-control"].match(/top/i)){ae.insertBefore(al,ae.firstChild)}else{ae.appendChild(al)}}break;case"DIV":case"SPAN":if(S=="DIV"||S=="SPAN"){ad=document.createElement(S);U=INTERMediatorLib.getElementsByClassName(ad,"IM_Button_Insert");if(U.length==0){ad.appendChild(R);if(Y["repeat-control"].match(/top/i)){ae.insertBefore(ad,ae.firstChild)}else{ae.appendChild(ad)}}}break}W=function(ax,aw,av,au,ar){var ap=ax,aq=aw,an=av,at=au,ao=ar;return function(){IMLibUI.insertButton(ap,af,aq,an,at,ao)}};INTERMediatorLib.addEvent(R,"click",W(Y.name,am,ae.getAttribute("id"),ah,Y["repeat-control"].match(/confirm-insert/i)))}else{P=INTERMediatorOnPage.getDBSpecification();if(P["db-class"]!=null&&P["db-class"]=="FileMaker_FX"){Q=Y.key?Y.key:"-recid"}else{Q=Y.key?Y.key:"id"}IMLibPageNavigation.deleteInsertOnNavi.push({kind:"INSERT",name:Y.name,key:Q,confirm:Y["repeat-control"].match(/confirm-insert/i)})}}}function M(V,U,ai,X,R,af,ad,T){var S,W,P,ac,ah,Y,ag,aa,ae,ab,Q,Z;if(!X["navi-control"]||!X["navi-control"].match(/master/i)){return}aa=X["navi-control"].match(/hide/i);Q=aa&&(X.paging==true);if(INTERMediator.detailNodeOriginalDisplay){ae=IMLibContextPool.getDetailContext();if(ae){ab=ae.enclosureNode;if(ab.tagName=="TBODY"){ab=ab.parentNode}INTERMediator.detailNodeOriginalDisplay=ab.style.display}}S=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(S,"IM_Button_Master");Z=INTERMediatorOnPage.getMessages()[12];if(X["button-names"]&&X["button-names"]["navi-detail"]){Z=X["button-names"]["navi-detail"]}S.appendChild(document.createTextNode(Z));W="IM_Button_"+INTERMediator.buttonIdNum;S.setAttribute("id",W);INTERMediator.buttonIdNum++;P=function(au,ao,aq,am,an,ak,ax){var ar=ao,aw=aq,aj=am,ap=an;var al={},at=au,av=ak,ay=ax;al[aj]=ap;return function(){var aA,az,aD,aC,aE,aB;aA=IMLibContextPool.getMasterContext();az=IMLibContextPool.getDetailContext();if(az){if(INTERMediatorOnPage.naviBeforeMoveToDetail){INTERMediatorOnPage.naviBeforeMoveToDetail(aA,az)}ag=az.getContextDef();aD=ag.name;aB=INTERMediator.additionalCondition;aB[aD]={field:ar,operator:"=",value:aw};INTERMediator.additionalCondition=aB;INTERMediator.constructMain(az);if(av){aC=aA.enclosureNode;if(at=="TBODY"){aC=aC.parentNode}INTERMediator.masterNodeOriginalDisplay=aC.style.display;aC.style.display="none";aE=az.enclosureNode;if(aE.tagName=="TBODY"){aE=aE.parentNode}aE.style.display=INTERMediator.detailNodeOriginalDisplay}if(ay){document.getElementById("IM_NAVIGATOR").style.display="none"}if(INTERMediatorOnPage.naviAfterMoveToDetail){aA=IMLibContextPool.getMasterContext();az=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToDetail(aA,az)}}}};t.push({id:W,event:"click",todo:P(V,R,af,ad,T,aa,Q)});switch(V){case"TBODY":ac=ai.getElementsByTagName("TD");ah=ac[0];Y=ah.childNodes[0];if(Y){ah.insertBefore(S,Y)}else{ah.appendChild(S)}break;case"UL":case"OL":Y=ai.childNodes[0];if(Y){ai.insertBefore(S,Y)}else{ai.appendChild(S)}break;case"DIV":case"SPAN":if(U=="DIV"||U=="SPAN"){Y=ai.childNodes[0];if(Y){ai.insertBefore(S,Y)}else{ai.appendChild(S)}}break}}function a(Q,af){var R,ai,ak,V,ab,al,an,ae,W,ah,aa,am,U,ag,aj,X,T,Y,ac,S,P,Z,ad;Y=Q.getContextDef();if(!Y["navi-control"]||!Y["navi-control"].match(/detail/i)){return}ag=IMLibContextPool.getMasterContext();aj=ag.getContextDef()["navi-control"];if(!aj||(!aj.match(/hide/i))){return}P=ag.getContextDef()["paging"]==true;ad=Y["navi-control"].match(/update/i);ac=Q.enclosureNode;if(ac.tagName=="TBODY"){ac=ac.parentNode}if(INTERMediator.detailNodeOriginalDisplay){INTERMediator.detailNodeOriginalDisplay=ac.style.display}ac.style.display="none";R=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(R,"IM_Button_BackNavi");Z=INTERMediatorOnPage.getMessages()[13];if(Y["button-names"]&&Y["button-names"]["navi-back"]){Z=Y["button-names"]["navi-back"]}R.appendChild(document.createTextNode(Z));X="IM_Button_"+INTERMediator.buttonIdNum;R.setAttribute("id",X);INTERMediator.buttonIdNum++;ai=[];switch(af.tagName){case"TBODY":if(Y["navi-control"].match(/top/i)){am="THEAD"}else{if(Y["navi-control"].match(/bottom/i)){am="TFOOT"}else{am="THEAD"}}ak=af.parentNode;aa=ak.childNodes;S=null;for(ah=0;ah<aa.length;ah++){if(aa[ah].tagName===am){S=aa[ah];break}}if(S===null){S=document.createElement(am);r.push({targetNode:S,parentNode:ak,siblingNode:(am=="THEAD")?ak.firstChild:null})}U=INTERMediatorLib.getElementsByClassName(S,"IM_Button_BackNavi");if(U.length==0){ab=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(ab,"IM_NaviBack_TR");al=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(al,"IM_NaviBack_TD");m(ab);S.appendChild(ab);ab.appendChild(al);al.appendChild(R);ai=[ab.getAttribute("id")]}break;case"UL":case"OL":an=document.createElement("LI");U=INTERMediatorLib.getElementsByClassName(an,"IM_Button_BackNavi");if(U.length==0){an.appendChild(R);if(Y["navi-control"].match(/bottom/i)){af.appendChild(an)}else{af.insertBefore(an,af.firstChild)}}break;case"DIV":case"SPAN":T=INTERMediatorLib.repeaterTagFromEncTag(af.tagName);if(T=="DIV"||T=="SPAN"){ae=document.createElement(T);U=INTERMediatorLib.getElementsByClassName(ae,"IM_Button_BackNavi");if(U.length==0){ae.appendChild(R);if(Y["navi-control"].match(/bottom/i)){af.appendChild(ae)}else{af.insertBefore(ae,af.firstChild)}}}break}W=function(aq,ao,aw,av){var ar=aq,at=ao,au=aw,ap=av;return function(){var ax;if(INTERMediatorOnPage.naviBeforeMoveToMaster){INTERMediatorOnPage.naviBeforeMoveToMaster(ar,at)}ax=at.enclosureNode;if(ax.tagName=="TBODY"){ax=ax.parentNode}ax.style.display="none";ax=ar.enclosureNode;if(ax.tagName=="TBODY"){ax=ax.parentNode}ax.style.display=INTERMediator.masterNodeOriginalDisplay;if(au){document.getElementById("IM_NAVIGATOR").style.display="block"}if(ap){INTERMediator.constructMain(ar)}if(INTERMediatorOnPage.naviAfterMoveToMaster){ar=IMLibContextPool.getMasterContext();at=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToMaster(ar,at)}}};INTERMediatorLib.addEvent(R,"click",W(ag,Q,P,ad))}function L(R,U,V){var T,S,W,X,Q,P;if(R.nodeType==1){W=INTERMediatorLib.getLinkedElementInfo(R);for(S=0;S<W.length;S++){X=INTERMediatorLib.getNodeInfoArray(W[S]);if(X.table==U&&X.field==V){return R}}}Q=R.childNodes;for(T=0;T<Q.length;T++){P=L(Q[T],U,V);if(P!==null){return P}}return null}function e(){var S,T,R,P,Q;if(document.getElementById("IM_CREDIT")===null){S=document.getElementsByTagName("BODY")[0];T=document.createElement("div");S.appendChild(T);T.setAttribute("id","IM_CREDIT");T.setAttribute("class","IM_CREDIT");R=document.createElement("div");T.appendChild(R);R.style.backgroundColor="#F6F7FF";R.style.height="2px";R=document.createElement("div");T.appendChild(R);R.style.backgroundColor="#EBF1FF";R.style.height="2px";R=document.createElement("div");T.appendChild(R);R.style.backgroundColor="#E1EAFF";R.style.height="2px";R=document.createElement("div");T.appendChild(R);R.setAttribute("align","right");R.style.backgroundColor="#D7E4FF";R.style.padding="2px";P=document.createElement("span");R.appendChild(P);R.style.color="#666666";R.style.fontSize="7pt";Q=document.createElement("a");Q.appendChild(document.createTextNode("INTER-Mediator"));Q.setAttribute("href","http://inter-mediator.com/");Q.setAttribute("target","_href");P.appendChild(document.createTextNode("Generated by "));P.appendChild(Q);P.appendChild(document.createTextNode(" Ver.5.2(2015-08-24)"))}}},getLocalProperty:function(b,a){var c;c=IMLibLocalContext.getValue(b);return c===null?a:c},setLocalProperty:function(a,b){IMLibLocalContext.setValue(a,b,true)},addCondition:function(b,c){var a=INTERMediator.additionalCondition;if(a[b]){a[b].push(c)}else{a[b]=[c]}INTERMediator.additionalCondition=a;IMLibLocalContext.archive()},clearCondition:function(b){var a=INTERMediator.additionalCondition;if(a[b]){delete a[b];INTERMediator.additionalCondition=a;IMLibLocalContext.archive()}},addSortKey:function(c,a){var b=INTERMediator.additionalSortKey;if(b[c]){b[c].push(a)}else{b[c]=[a]}INTERMediator.additionalSortKey=b;IMLibLocalContext.archive()},clearSortKey:function(b){var a=INTERMediator.additionalSortKey;if(a[b]){delete a[b];INTERMediator.additionalSortKey=a;IMLibLocalContext.archive()}}};if(!Object.keys){Object.keys=function(b){var a=[],c;if(b!==Object(b)){throw new TypeError("Object.keys called on a non-object")}for(c in b){if(Object.prototype.hasOwnProperty.call(b,c)){a.push(c)}}return a}}if(!Array.indexOf){var isWebkit="WebkitAppearance" in document.documentElement.style;if(!isWebkit){Array.prototype.indexOf=function(b){var a;for(a=0;a<this.length;a++){if(this[a]===b){return a}}return -1}}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var IMLibElement={setValueToIMNode:function(h,e,p,f){var b,o,q,k,d,a,c,l=false,n,m,g;if(p===undefined){return false}if(!h){return false}if(p===null||p===false){p=""}n=h.tagName;if(f===true&&e==""){switch(n){case"INPUT":switch(h.getAttribute("type")){case"text":h.value="";break;default:break}case"SELECT":break;default:while(h.childNodes.length>0){h.removeChild(h.childNodes[0])}break}}if(e!=null&&e.length>0){if(e.charAt(0)=="#"){e=e.substring(1);if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML+=p}else{if(e=="textNode"||e=="script"){c=document.createTextNode(p);if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}h.appendChild(c)}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{q=h.getAttribute(e);if(p.indexOf("/fmi/xml/cnt/")===0&&q.indexOf("?media=")===-1){p=INTERMediatorOnPage.getEntryPath()+"?media="+p}h.setAttribute(e,q+p)}}}}else{if(e.charAt(0)=="$"){e=e.substring(1);if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML=h.innerHTML.replace("$",p)}else{if(e=="textNode"||e=="script"){if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}h.innerHTML=h.innerHTML.replace("$",p)}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{q=h.getAttribute(e);if(p.indexOf("/fmi/xml/cnt/")===0&&q.indexOf("?media=")===-1){p=INTERMediatorOnPage.getEntryPath()+"?media="+p}h.setAttribute(e,q.replace("$",p))}}}}else{if(INTERMediatorLib.isWidgetElement(h)){h._im_setValue(p)}else{if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML=p}else{if(e=="textNode"){if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}c=document.createTextNode(p);h.appendChild(c)}else{if(e=="script"){c=document.createTextNode(p);if(n=="SCRIPT"){h.appendChild(c)}else{k=document.createElement("script");k.type="text/javascript";k.appendChild(c);h.appendChild(k)}}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{h.setAttribute(e,p)}}}}}}}}else{if(INTERMediatorLib.isWidgetElement(h)){h._im_setValue(p)}else{if(n=="INPUT"){d=h.getAttribute("type");if(d=="checkbox"||d=="radio"){a=h.value;m=p.toString().split("\n");if(d=="checkbox"&&m.length>1){for(g=0;g<m.length;g++){if(a==m[g]&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){h.setAttribute("checked","checked")}else{h.checked=true}}}}else{if(a==p&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){h.setAttribute("checked","checked")}else{h.checked=true}}else{h.checked=false}}}else{h.value=p}}else{if(n=="SELECT"){l=true;h.value=p}else{if(INTERMediator.defaultTargetInnerHTML){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br/>")}h.innerHTML=p}else{if(n=="TEXTAREA"){if(INTERMediator.isTrident&&INTERMediator.ieVersion>=11){p=p.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}else{p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}}c=document.createTextNode(p);h.appendChild(c)}}}}}if(n==="INPUT"||n==="SELECT"||n==="TEXTAREA"){INTERMediatorLib.addEvent(h,"blur",function(s){var r=h.id;if(!IMLibUI.valueChange(r,true)){h.focus()}})}return l},getValueFromIMNode:function(f){var g,d,b,a,h,l,e,c;if(f){g=f.tagName;d=f.getAttribute("type")}else{return""}if(INTERMediatorLib.isWidgetElement(f)||(INTERMediatorLib.isWidgetElement(f.parentNode))){b=f._im_getValue()}else{if(g=="INPUT"){if(d=="checkbox"){a=INTERMediatorOnPage.getDBSpecification();if(a["db-class"]!=null&&a["db-class"]=="FileMaker_FX"){h=[];l=f.parentNode.getElementsByTagName("INPUT");for(e=0;e<l.length;e++){if(l[e].checked){h.push(l[e].getAttribute("value"))}}b=h.join("\n")}else{c=f.getAttribute("value");if(f.checked){b=c}else{b=""}}}else{if(d=="radio"){b=f.value}else{b=f.value}}}else{if(g=="SELECT"){b=f.value}else{if(g=="TEXTAREA"){b=f.value}else{b=f.innerHTML}}}}return b},checkOptimisticLock:function(b,x){var e,v,w,r,m,t,g,q,n,a,p,k,y,l,c,o,f,d,u;if(!b){return false}e=INTERMediatorLib.getLinkedElementInfo(b);v=INTERMediatorLib.getNodeInfoArray(e[0]);if(v.table==IMLibLocalContext.contextName){return false}w=b.getAttribute("id");r=IMLibContextPool.getContextInfoFromId(w,x);if(INTERMediator.ignoreOptimisticLocking){return true}k=r.context;p=r.field;m=r.record.split("=");t=m[0];m.shift();g=m.join("=");q={name:r.context.contextName,records:1,paging:false,fields:[p],parentkeyvalue:null,conditions:[{field:t,operator:"=",value:g}],useoffset:false,primaryKeyOnly:true};try{INTERMediator_DBAdapter.eliminateDuplicatedConditions=true;n=INTERMediator_DBAdapter.db_query(q)}catch(s){if(s=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){INTERMediator.db_query(q)});return}}else{INTERMediator.setErrorMessage(s,"EXCEPTION-1")}}if(r.portal){o=false;f=r.context.contextName+"::-recid";if(n.recordset&&n.recordset[0]){for(d in n.recordset[0]){var h=n.recordset[0][d];if(h[f]&&h[p]!==undefined&&h[f]==r.portal){u=h[p];o=true}}}if(!o){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[p]));return false}}else{if(!n.recordset||!n.recordset[0]||n.recordset[0][p]===undefined){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[p]));return false}if(n.totalCount>1){a=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!a){return false}}u=n.recordset[0][p]}y=k.getValue(r.record,p,r.portal);switch(b.tagName){case"INPUT":switch(b.getAttribute("type")){case"checkbox":if(y==b.value){c=false}else{if(!parseInt(u)){c=false}else{c=true}}break;default:c=(y!=u);break}break;default:c=(y!=u);break}if(c){l=IMLibElement.getValueFromIMNode(b);if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1001],[y,l,u]))){window.setTimeout(function(){b.focus()},0);return false}INTERMediatorOnPage.retrieveAuthInfo()}return true},deleteNodes:function(n){var b,a,l,h,g,e,c,f,d,p,o;for(o in n){b=document.getElementById(n[o]);a=INTERMediatorLib.getElementsByIMManaged(b);if(a){for(l=0;l<a.length;l++){e=a[l].id;if(e in IMLibCalc.calculateRequiredObject){delete IMLibCalc.calculateRequiredObject[e]}}for(l=0;l<a.length;l++){e=a[l].id;for(c in IMLibCalc.calculateRequiredObject){f=IMLibCalc.calculateRequiredObject[c];d={};p={};for(h in f.referes){d[h]=[],p[h]=[];for(g=0;g<f.referes[h].length;g++){if(e!=f.referes[h][g]){d[h].push(f.referes[h][g]);p[h].push(f.values[h][g])}}}f.referes=d;f.values=p}}}try{b.parentNode.removeChild(b)}catch(m){}}}};IMLibEventResponder={isSetup:false,setup:function(){var a;if(IMLibEventResponder.isSetup){return}IMLibEventResponder.isSetup=true;IMLibChangeEventDispatch=new IMLibEventDispatch();IMLibKeyEventDispatch=new IMLibEventDispatch();IMLibMouseEventDispatch=new IMLibEventDispatch();a=document.getElementsByTagName("BODY")[0];INTERMediatorLib.addEvent(a,"change",function(g){var d=g?g:window.event;if(!d){return}var f=d.target;if(!f){f=d.srcElement;if(!f){return}}var c=f.id;if(!c){return}var b=IMLibChangeEventDispatch.dispatchTable[c];if(!b){return}b(c)});INTERMediatorLib.addEvent(a,"keydown",function(h){var f,b,g,d;f=h?h:window.event;if(f.charCode){b=f.charCode}else{b=f.keyCode}if(!f){return}g=f.target;if(!g){g=f.srcElement;if(!g){return}}d=g.id;if(!d){return}if(!IMLibKeyEventDispatch.dispatchTable[d]){return}var c=IMLibKeyEventDispatch.dispatchTable[d][b];if(!c){return}c(f)});INTERMediatorLib.addEvent(a,"click",function(f){var b,g,c,m,h,d,l,k;b=f?f:window.event;if(!b){return}g=b.target;if(!g){g=b.srcElement;if(!g){return}}c=g.id;if(!c){return}m=IMLibMouseEventDispatch.dispatchTable[c];if(m){m(b);return}h=INTERMediatorLib.getLinkedElementInfo(g);for(d=0;d<h.length;d++){m=IMLibMouseEventDispatch.dispatchTableTarget[h[d]];if(m){l=INTERMediatorLib.getNodeInfoArray(h[d]);if(l.target){k=g.getAttribute(l.target)}else{k=IMLibElement.getValueFromIMNode(g)}m(k,g);return}}})}};var IMLibChangeEventDispatch;var IMLibKeyEventDispatch;var IMLibMouseEventDispatch;function IMLibEventDispatch(){this.dispatchTable={};this.dispatchTableTarget={};this.clearAll=function(){this.dispatchTable={};this.dispatchTableTarget={}};this.setExecute=function(b,a){if(b&&a){this.dispatchTable[b]=a}};this.setTargetExecute=function(b,a){if(b&&a){this.dispatchTableTarget[b]=a}};this.setExecuteByCode=function(c,b,a){if(c&&b){if(!this.dispatchTable[c]){this.dispatchTable[c]={}}this.dispatchTable[c][b]=a}}}IMLibContextPool={poolingContexts:null,clearAll:function(){this.poolingContexts=null},registerContext:function(a){if(this.poolingContexts==null){this.poolingContexts=[a]}else{this.poolingContexts.push(a)}},excludingNode:null,synchronize:function(a,c,n,m,g,k){var e,d,l,f,h,o=false,b;l=a.viewName;if(this.poolingContexts==null){return null}if(k){for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].binding[c][n][k]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined&&this.poolingContexts[e].store[c][n][k]!==undefined){this.poolingContexts[e].store[c][n][k]=m;h=this.poolingContexts[e].binding[c][n][k];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);if(f){IMLibElement.setValueToIMNode(f,h[d].target,m,true)}}}}}else{for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined){this.poolingContexts[e].store[c][n]=m;h=this.poolingContexts[e].binding[c][n];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);b=h[d].id;if(h[d].target&&h[d].target.length>0){b+=INTERMediator.separator+h[d].target}if(f&&!(b in IMLibCalc.calculateRequiredObject)){IMLibElement.setValueToIMNode(f,h[d].target,m,true)}}}}}return o},getContextInfoFromId:function(a,g){var d,b,e,f,h,c,k=null;if(!a){return k}e=document.getElementById(a);if(!e){return k}f=INTERMediatorLib.getLinkedElementInfo(e);if(!f&&INTERMediatorLib.isWidgetElement(e.parentNode)){f=INTERMediatorLib.getLinkedElementInfo(e.parentNode)}h=INTERMediatorLib.getNodeInfoArray(f[0]);c=g===""?"_im_no_target":g;for(d=0;d<this.poolingContexts.length;d++){b=this.poolingContexts[d];if(b.contextInfo[a]&&b.contextInfo[a][c]&&b.contextInfo[a][c].context.contextName==h.table){k=b.contextInfo[a][c];return k}}return null},getKeyFieldValueFromId:function(a,d){var b=this.getContextInfoFromId(a,d);if(!b){return null}var f=b.context.contextName;var c=IMLibContextPool.getContextDef(f);if(!c){return null}var e=c.key?c.key:"id";return b.record.substr(e.length+1)},getContextDef:function(a){return INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",a)},updateContext:function(a,d){var b,c;b=IMLibContextPool.getContextInfoFromId(a,d);c=IMLibElement.getValueFromIMNode(document.getElementById(a));if(b){b.context.setValue(b.record,b.field,c,false,d,b.portal)}},contextFromEnclosureId:function(a){var b,c;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){c=this.poolingContexts[b].enclosureNode;if(c.getAttribute("id")==a){return this.poolingContexts[b]}}return null},contextFromName:function(a){var b;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){if(this.poolingContexts[b].contextName==a){return this.poolingContexts[b]}}return null},getContextFromName:function(b){var c,a=[];if(!b){return false}for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].contextName==b){a.push(this.poolingContexts[c])}}return a},getContextsFromNameAndForeignValue:function(b,c,f){var e,d,a=[],f;if(!b){return false}for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].contextName==b&&this.poolingContexts[e].foreignValue[f]==c){a.push(this.poolingContexts[e])}}return a},dependingObjects:function(b){var d,c,a=[];if(!b){return false}for(d=0;d<this.poolingContexts.length;d++){for(c=0;c<this.poolingContexts[d].dependingObject.length;c++){if(this.poolingContexts[d].dependingObject[c]==b){a.push(this.poolingContexts[d])}}}return a.length==0?false:a},getChildContexts:function(b){var c,a=[];for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].parentContext==b){a.push(this.poolingContexts[c])}}return a},childContexts:null,removeContextsFromPool:function(d){var a,c=[],b=[];for(a=0;a<this.poolingContexts.length;a++){if(d.indexOf(this.poolingContexts[a])>-1){c.push(this.poolingContexts[a].registeredId);b.push(a)}}for(a=b.length-1;a>-1;a--){this.poolingContexts.splice(b[a],1)}return c},removeRecordFromPool:function(m){var e,d,c,g,k,h=[],l=-1,b,f=null,a;for(e=0;e<this.poolingContexts.length;e++){for(g in this.poolingContexts[e].binding){for(k in this.poolingContexts[e].binding[g]){if(k=="_im_repeater"){for(d=0;d<this.poolingContexts[e].binding[g][k].length;d++){if(m==this.poolingContexts[e].binding[g][k][d].id){f=this.poolingContexts[e].binding[g];b=g;l=e}}}}}}for(k in f){for(d=0;d<f[k].length;d++){h.push(f[k][d].id)}}if(l>-1){for(a in this.poolingContexts[l].contextInfo){if(h.indexOf(a)>=0){delete this.poolingContexts[l].contextInfo[a]}}delete this.poolingContexts[l].binding[b];delete this.poolingContexts[l].store[b]}this.poolingContexts=this.poolingContexts.filter(function(n){return h.indexOf(n.enclosureNode.id)<0})},updateOnAnotherClient:function(l,a){var g,f,e,n=a.entity,h,o,d,b;if(l=="update"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){d=h.key;b=d+"="+a.pkvalue;this.poolingContexts[g].setValue(b,a.field[0],a.value[0]);var c=this.poolingContexts[g].binding[b][a.field[0]];for(f=0;f<c.length;f++){var m=IMLibContextPool.dependingObjects(c[f].id);for(e=0;e<m.length;e++){m[e].foreignValue={};m[e].foreignValue[a.field[0]]=a.value[0];if(m[e]){INTERMediator.constructMain(m[e])}}}}}IMLibCalc.recalculation()}else{if(l=="create"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){if(this.poolingContexts[g].isContaining(a.value[0])){INTERMediator.constructMain(this.poolingContexts[g],a.value)}}}IMLibCalc.recalculation()}else{if(l=="delete"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){this.poolingContexts[g].removeEntry(a.pkvalue)}}IMLibCalc.recalculation()}}}},getMasterContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/master/)){return this.poolingContexts[a]}}return null},getDetailContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/detail/)){return this.poolingContexts[a]}}return null}};IMLibContext=function(a){this.contextName=a;this.tableName=null;this.viewName=null;this.store={};this.binding={};this.contextInfo={};this.modified={};this.recordOrder=[];this.pendingOrder=[];IMLibContextPool.registerContext(this);this.foreignValue={};this.enclosureNode=null;this.repeaterNodes=null;this.dependingObject=[];this.original=null;this.nullAcceptable=true;this.parentContext=null;this.registeredId=null;this.sequencing=false;this.dependingParentObjectInfo=null;this.getInsertOrder=function(c){var b,h=[],g,f,e=[],d=[];for(b in INTERMediator.additionalSortKey){if(b==this.contextName){h.push(INTERMediator.additionalSortKey[b])}}g=this.getContextDef();if(g.sort){h.push(g.sort)}for(f=0;f<h.length;f++){if(e.indexOf(h[f].field)<0){e.push(h[f].field);d.push(h[f].direction)}}};this.clearAll=function(){this.store={};this.binding={}};this.setContextName=function(b){this.contextName=b};this.setTableName=function(b){this.tableName=b};this.setViewName=function(b){this.viewName=b};this.addDependingObject=function(b){this.dependingObject.push(b)};this.addForeignValue=function(c,b){this.foreignValue[c]=b};this.setOriginal=function(c){var b;this.original=[];for(b=0;b<c.length;b++){this.original.push(c[b].cloneNode(true))}};this.setTable=function(b){var c;if(!b||!INTERMediatorOnPage.getDataSources){this.tableName=this.contextName;this.viewName=this.contextName;return}c=this.getContextDef();if(c){this.viewName=c.view?c.view:c.name;this.tableName=c.table?c.table:c.name}};this.removeContext=function(){var d=[],c=[];b(this);d=IMLibContextPool.removeContextsFromPool(c);while(this.enclosureNode.firstChild){this.enclosureNode.removeChild(this.enclosureNode.firstChild)}INTERMediator_DBAdapter.unregister(d);function b(g){var f,e;c.push(g);d.push(g.registeredId);e=IMLibContextPool.getChildContexts(g);for(f=0;f<e.length;f++){b(e[f])}}};this.setModified=function(d,b,c){if(this.modified[d]===undefined){this.modified[d]={}}this.modified[d][b]=c};this.getModified=function(){return this.modified};this.clearModified=function(){this.modified={}};this.getContextDef=function(){var b;b=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",this.contextName);return b};this.checkOrder=function(l,p){var d,g=[],m=[],q,k,e,o,h,b,c,f,n;if(p!==true){if(INTERMediator&&INTERMediator.additionalSortKey[this.contextName]){for(d=0;d<INTERMediator.additionalSortKey[this.contextName].length;d++){q=INTERMediator.additionalSortKey[this.contextName][d];if(!q.field in g){g.push(q.field);m.push(q.direction)}}}k=this.getContextDef();if(k&&k.sort){for(d=0;d<k.sort.length;d++){q=k.sort[d];if(!q.field in g){g.push(q.field);m.push(q.direction)}}}}else{g=["field1","field2"]}e=0;o=this.recordOrder.length;for(d=0;d<g.length;d++){if(l[g[d]]){h=parseInt((o+e)/2);do{b=this.store[this.recordOrder[h]];c=b[g[d]];f=l[g[d]];if(c<f){e=h}else{if(c>f){o=h}else{e=o=h}}h=parseInt((o+e)/2)}while(o-e>1);b=this.store[this.recordOrder[h]];c=b[g[d]];if(c==f){e=o=h;n=false;do{b=this.store[this.recordOrder[e-1]];if(b&&b[g[d]]&&b[g[d]]==f){e--}else{n=true}}while(!n);n=false;do{b=this.store[this.recordOrder[o+1]];if(b&&b[g[d]]&&b[g[d]]==f){o++}else{n=true}}while(!n);if(e==o){break}o++}else{if(c<f){break}else{if(c>f){h--;break}}}}}if(p===true){console.log("#lower="+e+",upper="+o+",index="+h+",contextValue="+c+",checkingValue="+f)}return h};this.rearrangePendingOrder=function(e){var d,c,b;for(d=0;d<this.pendingOrder.length;d++){b=this.store[this.pendingOrder[d]];c=this.checkOrder(b,e);if(c>=-1){this.recordOrder.splice(c+1,0,this.pendingOrder[d])}else{}}this.pendingOrder=[]};this.getRepeaterEndNode=function(k){var c,m,h=[],l,e,f,n,g,b;var d=this.recordOrder[k];for(m in this.binding[d]){c=this.binding[d][m].nodeId;l=INTERMediatorLib.getParentRepeater(document.getElementById(c));if(!l in h){h.push(l)}}if(h.length<1){return null}e=h[0];g=INTERMediatorLib.getParentEnclosure(e);b=g.childNodes;for(f=0;f<b.length;f++){if(b[f] in h){e=h[f];break}}return e};this.setDataAtLastRecord=function(c,e){var b,d;var f=Object.keys(this.store);if(f.length>0){b=f[f.length-1];this.setValue(b,c,e);d=b.split("=");INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:d[0],operator:"=",value:d[1]}],dataset:[{field:c,value:e}]});IMLibCalc.recalculation();INTERMediator.flushMessage()}};this.setDataWithKey=function(e,d,h){var b,g,f,c;var k=Object.keys(this.store);g=this.getContextDef();if(!g){return}b=g.key+"="+e;c=this.store[b];if(c){this.setValue(b,d,h);INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:g.key,operator:"=",value:e}],dataset:[{field:d,value:h}]});INTERMediator.flushMessage()}};this.setValue=function(g,c,d,f,e,b){if(g!=undefined&&g!=null){if(this.store[g]===undefined){this.store[g]={}}if(b&&this.store[g][c]===undefined){this.store[g][c]={}}if(this.binding[g]===undefined){this.binding[g]={};if(this.sequencing){this.recordOrder.push(g)}else{this.pendingOrder.push(g)}}if(this.binding[g][c]===undefined){this.binding[g][c]=[]}if(b&&this.binding[g][c][b]===undefined){if(this.binding[g][c].length<1){this.binding[g][c]={}}this.binding[g][c][b]=[]}if(c!=undefined&&c!=null){if(b){this.store[g][c][b]=d}else{this.store[g][c]=d}if(f){if(b){this.binding[g][c][b].push({id:f,target:e})}else{this.binding[g][c].push({id:f,target:e})}if(this.contextInfo[f]===undefined){this.contextInfo[f]={}}this.contextInfo[f][e==""?"_im_no_target":e]={context:this,record:g,field:c};if(b){this.contextInfo[f][e==""?"_im_no_target":e].portal=b}}else{IMLibContextPool.synchronize(this,g,c,d,e,b)}}}};this.getValue=function(f,d,b){var e;try{if(b){e=this.store[f][d][b]}else{e=this.store[f][d]}return e===undefined?null:e}catch(c){return null}};this.isValueUndefined=function(f,d,b){var e;try{if(b){e=this.store[f][d][b]}else{e=this.store[f][d]}return e===undefined?true:false}catch(c){return null}};this.getContextInfo=function(e,d){try{var c=this.contextInfo[e][d==""?"_im_no_target":d];return c===undefined?null:c}catch(b){return null}};this.getContextValue=function(f,e){try{var d=this.contextInfo[f][e==""?"_im_no_target":e];var c=d.context.getValue(d.record,d.field);return c===undefined?null:c}catch(b){return null}};this.getContextRecord=function(f){var e,d,c;try{e=this.contextInfo[f];d=Object.keys(e);for(c=0;c<d.length;c++){if(e[d[c]]){return this.store[e[d[c]].record]}}return null}catch(b){return null}};this.removeEntry=function(c){var d,h,b,g,k,m,e,f,l=[];g=this.getContextDef();d=g.key;h=d+"="+c;b=this.binding[h];if(b){m=b._im_repeater;if(m){for(e=0;e<m.length;e++){l.push(m[e].id)}}}if(l.length>0){for(e=0;e<l.length;e++){IMLibContextPool.removeRecordFromPool(l[e])}for(e=0;e<l.length;e++){k=document.getElementById(l[e]);if(k){f=INTERMediatorLib.getParentRepeater(k);if(f){f.parentNode.removeChild(k)}}}}};this.isContaining=function(k){var g,d,o=[],f,m,p,n,c,l,h,b;g=this.getContextDef();d=g.name;if(g.query){for(f in g.query){o.push(e(g.query[f],k))}}if(INTERMediator.additionalCondition[d]){for(f=0;f<INTERMediator.additionalCondition[d].length;f++){o.push(e(INTERMediator.additionalCondition[d][f],k))}}p=true;if(o.length!=0){n=o.indexOf("D");if(n>-1){c=o.slice(0,n);l=n.slice(n+1);if(l.length==0){p=(c.indexOf(false)<0)}else{h=(c.indexOf(false)<0);b=(l.indexOf(false)<0);p=h||b}}else{n=o.indexOf("EX");if(n>-1){c=o.slice(0,n);l=n.slice(n+1);if(l.length==0){p=(c.indexOf(true)>-1)}else{h=(c.indexOf(true)>-1);b=(l.indexOf(true)>-1);p=h&&b}}else{n=o.indexOf(false);if(n>-1){p=(o.indexOf(false)<0)}}}if(p==false){return false}}if(this.foreignValue){for(m in this.foreignValue){if(g.relation){for(f in g.relation){if(g.relation[f]["join-field"]==m){p&=(e({field:g.relation[f]["foreign-key"],operator:"=",value:this.foreignValue[m]},k))}}}}}return p;function e(r,q){var s;if(r.field=="__operation__"){return r.operator=="ex"?"EX":"D"}s=q[r.field];if(!s){return false}switch(r.operator){case"=":case"eq":return s==r.value;break;case">":case"gt":return s>r.value;break;case"<":case"lt":return s<r.value;break;case">=":case"gte":return s>=r.value;break;case"<=":case"lte":return s<=r.value;break;case"!=":case"neq":return s!=r.value;break;default:return false}}};this.insertEntry=function(g,b,c){var d,f,e;for(d=0;d<b.length;d++){f=b[d];e=c[d];this.setValue(g,f,e)}};this.setTable(this)};IMLibLocalContext={contextName:"_",store:{},binding:{},clearAll:function(){this.store={}},setValue:function(d,g,b){var c,f,a,e;f=false;if(d!=undefined&&d!=null){if(g===undefined||g===null){delete this.store[d]}else{this.store[d]=g;f=true;a=this.binding[d];if(a){for(c=0;c<a.length;c++){e=document.getElementById(a[c]);IMLibElement.setValueToIMNode(e,"",g,true)}}}}if(f&&!(b===true)){this.archive()}},getValue:function(a){var b=this.store[a];return b===undefined?null:b},archive:function(){var b;INTERMediatorOnPage.removeCookie("_im_localcontext");if(INTERMediator.isIE&&INTERMediator.ieVersion<9){this.store._im_additionalCondition=INTERMediator.additionalCondition;this.store._im_additionalSortKey=INTERMediator.additionalSortKey;this.store._im_startFrom=INTERMediator.startFrom;this.store._im_pagedSize=INTERMediator.pagedSize;b=JSON.stringify(this.store,function(d,c){return c===""?"":c})}else{b=JSON.stringify(this.store)}if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.setItem("_im_localcontext"+document.URL,b)}catch(a){INTERMediatorOnPage.setCookieWorker("_im_localcontext",b,false,0)}}else{INTERMediatorOnPage.setCookieWorker("_im_localcontext",b,false,0)}},unarchive:function(){var b="";if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{b=sessionStorage.getItem("_im_localcontext"+document.URL)}catch(a){b=INTERMediatorOnPage.getCookie("_im_localcontext")}}else{b=INTERMediatorOnPage.getCookie("_im_localcontext")}if(b&&b.length>0){this.store=JSON.parse(b);if(INTERMediator.isIE&&INTERMediator.ieVersion<9){if(this.store._im_additionalCondition){INTERMediator.additionalCondition=this.store._im_additionalCondition}if(this.store._im_additionalSortKey){INTERMediator.additionalSortKey=this.store._im_additionalSortKey}if(this.store._im_startFrom){INTERMediator.startFrom=this.store._im_startFrom}if(this.store._im_pagedSize){INTERMediator.pagedSize=this.store._im_pagedSize}}this.updateAll()}},binding:function(b){var n,l,a,e,d,h,c,m,k;if(b.nodeType!=1){return}n=INTERMediatorLib.getLinkedElementInfo(b);for(e=0;e<n.length;e++){l=INTERMediatorLib.getNodeInfoArray(n[e]);if(l.table==this.contextName){if(!b.id){b.id=g()}a=b.id;if(!this.binding[l.field]){this.binding[l.field]=[]}if(this.binding[l.field].indexOf(a)<0){this.binding[l.field].push(a)}k=-1;while(k>=0){for(d=0;d<this.binding[l.field].length;d++){if(!document.getElementById(this.binding[l.field][d])){k=d}}if(k>=0){delete this.binding[l.field][k]}}c=l.field.split(":");switch(c[0]){case"addorder":IMLibMouseEventDispatch.setExecute(a,IMLibUI.eventAddOrderHandler);break;case"update":IMLibMouseEventDispatch.setExecute(a,(function(){var o=c[1];return function(){IMLibUI.eventUpdateHandler(o)}})());break;case"condition":IMLibKeyEventDispatch.setExecuteByCode(a,13,(function(){var o=c[1];return function(){INTERMediator.startFrom=0;IMLibUI.eventUpdateHandler(o);IMLibPageNavigation.navigationSetup()}})());break;case"limitnumber":IMLibChangeEventDispatch.setExecute(a,(function(){var o=c[1];return function(){INTERMediator.pagedSize=document.getElementById(a).value;IMLibUI.eventUpdateHandler(o);IMLibPageNavigation.navigationSetup()}})());break;default:IMLibChangeEventDispatch.setExecute(a,IMLibLocalContext.update);break}h=this.store[l.field];IMLibElement.setValueToIMNode(b,l.target,h,true)}}function g(){INTERMediator.linkedElmCounter++;return f()}function f(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}},update:function(a){var e,b,f,d,c;e=document.getElementById(a);b=IMLibElement.getValueFromIMNode(e);f=INTERMediatorLib.getLinkedElementInfo(e);for(c=0;c<f.length;c++){IMLibLocalContext.store[f[c]]=b;d=INTERMediatorLib.getNodeInfoArray(f[c]);if(d.table==IMLibLocalContext.contextName){IMLibLocalContext.setValue(d.field,b)}}},updateAll:function(){var b,d,c,a,e;for(d in IMLibLocalContext.binding){c=IMLibLocalContext.binding[d];for(b=0;b<c.length;b++){a=c[b];e=document.getElementById(a);if(e&&(e.tagName=="INPUT"||e.tagName=="TEXTAREA"||e.tagName=="SELECT")){IMLibLocalContext.update(a);break}}}},bindingDescendant:function(b){var a=this;c(b);function c(g){var f,e;if(g.nodeType===1){try{a.binding(g);f=g.childNodes;if(f){for(e=0;e<f.length;e++){c(f[e])}}}catch(d){if(d=="_im_requath_request_"){throw d}else{INTERMediator.setErrorMessage(d,"EXCEPTION-31")}}}}}};var INTERMediatorLib={ignoreEnclosureRepeaterClassName:"_im_ignore_enc_rep",ignoreEnclosureRepeaterControlName:"ignore_enc_rep",rollingRepeaterClassName:"_im_repeater",rollingEnclosureClassName:"_im_enclosure",rollingRepeaterDataControlName:"repeater",rollingEnclosureDataControlName:"enclosure",cachedDigitSeparator:null,initialize:function(){var b,f,a,e,d;try{b=new Number(1000.1);f=b.toLocaleString();a=f.substr(-2,1);f=f.substring(0,f.length-2);e=f.match(/[^0-9]/)[0];d=f.length-f.indexOf(e)-1;INTERMediatorLib.cachedDigitSeparator=[a,e,d]}catch(c){INTERMediatorLib.cachedDigitSeparator=[".",",",3]}IMLibLocalContext.unarchive();return null},setup:function(){if(window.addEventListener){window.addEventListener("load",this.initialize,false)}else{if(window.attachEvent){window.attachEvent("onload",this.initialize)}else{window.onload=this.initialize}}return null},digitSeparator:function(){return this.cachedDigitSeparator},generatePasswordHash:function(d){var f,e,c,g,a,b;f=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];e="";c="";for(i=0;i<4;i++){g=Math.floor(Math.random()*(128-32)+32);a=g&15;b=(g>>4)&15;e+=String.fromCharCode(g);c+=f[b]+f[a]}return encodeURIComponent(SHA1(d+e)+c)},getParentRepeater:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isRepeater(a,true)){return a}a=a.parentNode}return null},getParentEnclosure:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isEnclosure(a,true)){return a}a=a.parentNode}return null},isEnclosure:function(f,g){var c,e,b,a,d;if(!f||f.nodeType!==1){return false}e=INTERMediatorLib.getClassAttributeFromNode(f);if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}d=f.getAttribute("data-im-control");if(d&&d.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}c=f.tagName;if((c==="TBODY")||(c==="UL")||(c==="OL")||(c==="SELECT")||((c==="DIV"||c==="SPAN")&&e&&e.indexOf(INTERMediatorLib.rollingEnclosureClassName)>=0)||((c==="DIV"||c==="SPAN")&&d&&d.indexOf(INTERMediatorLib.rollingEnclosureDataControlName)>=0)){if(g){return true}else{b=f.childNodes;for(a=0;a<b.length;a++){if(INTERMediatorLib.isRepeater(b[a],true)){return true}}}}return false},isRepeater:function(g,h){var d,f,c,b,e;if(!g||g.nodeType!==1){return false}f=INTERMediatorLib.getClassAttributeFromNode(g);if(f&&f.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}e=g.getAttribute("data-im-control");if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}d=g.tagName;if((d==="TR")||(d==="LI")||(d==="OPTION")||((d==="DIV"||d==="SPAN")&&f&&f.indexOf(INTERMediatorLib.rollingRepeaterClassName)>=0)||((d==="DIV"||d==="SPAN")&&e&&e.indexOf(INTERMediatorLib.rollingRepeaterDataControlName)>=0)){if(h){return true}else{return a(g)}}return false;function a(k){if(INTERMediatorLib.isLinkedElement(k)){return true}c=k.childNodes;for(b=0;b<c.length;b++){if(c[b].nodeType===1){if(INTERMediatorLib.isLinkedElement(c[b])){return true}else{if(a(c[b])){return true}}}}return false}},isLinkedElement:function(c){var d,b,a;if(c!=null){a=c.getAttribute("data-im");if(a){return true}if(INTERMediator.titleAsLinkInfo){if(c.getAttribute("TITLE")!=null&&c.getAttribute("TITLE").length>0){return true}}if(INTERMediator.classAsLinkInfo){d=INTERMediatorLib.getClassAttributeFromNode(c);if(d!=null){b=d.match(/IM\[.*\]/);if(b){return true}}}}return false},isWidgetElement:function(d){var e,c,b,a;if(!d){return false}if(INTERMediatorLib.getLinkedElementInfo(d)){b=d.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(d);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}else{a=d.parentNode;if(!a&&INTERMediatorLib.getLinkedElementInfo(a)){b=a.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(a);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}}return false},isNamedElement:function(b){var c,a;if(b!=null){c=b.getAttribute("data-im-group");if(c){return true}c=b.getAttribute("name");if(c){a=c.match(/IM\[.*\]/);if(a){return true}}}return false},getEnclosureSimple:function(a){if(INTERMediatorLib.isEnclosure(a,true)){return a}return INTERMediatorLib.getEnclosureSimple(a.parentNode)},getEnclosure:function(d){var c,b;c=d;while(c!=null){if(INTERMediatorLib.isRepeater(c,true)){b=c}else{if(a(b,c)){b=null;return c}}c=c.parentNode}return null;function a(n,l){var m,f,g,e,h,k,o;if(!n||!l){return false}m=n.tagName;f=l.tagName;if((m==="TR"&&f==="TBODY")||(m==="OPTION"&&f==="SELECT")||(m==="LI"&&f==="OL")||(m==="LI"&&f==="UL")){return true}if((f==="DIV"||f==="SPAN")){g=INTERMediatorLib.getClassAttributeFromNode(l);h=l.getAttribute("data-im-control");if((g&&g.indexOf("_im_enclosure")>=0)||(h&&h=="enclosure")){e=INTERMediatorLib.getClassAttributeFromNode(n);k=n.getAttribute("data-im-control");if((m==="DIV"||m==="SPAN")&&((e&&e.indexOf("_im_repeater")>=0)||(k&&k=="repeater"))){return true}else{if(m==="INPUT"){o=n.getAttribute("type");if(o&&((o.indexOf("radio")>=0||o.indexOf("check")>=0))){return true}}}}}return false}},getLinkedElementInfo:function(h){var c=[],d,g,e,b,a;if(INTERMediatorLib.isLinkedElement(h)){b=h.getAttribute("data-im");if(b!==null&&b.length>0){g=new RegExp("[\\s"+INTERMediator.defDivider+"]+");d=b.split(g);for(e=0;e<d.length;e++){if(d[e]&&d[e].length>0){c.push(f(d[e]))}}return c}if(INTERMediator.titleAsLinkInfo&&h.getAttribute("TITLE")!=null){d=h.getAttribute("TITLE").split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}return c}if(INTERMediator.classAsLinkInfo){b=INTERMediatorLib.getClassAttributeFromNode(h);if(b!==null&&b.length>0){a=b.match(/IM\[([^\]]*)\]/);d=a[1].split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}}return c}}return false;function f(l){var k=INTERMediatorOnPage.getOptionsAliases();if(k!=null&&k[l]!=null){return k[l]}return l}},getWidgetInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isWidgetElement(g)){d=g.getAttribute("data-im-widget");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=INTERMediatorLib.getClassAttributeFromNode(g);if(d&&d.length>0){a=d.match(/IM_WIDGET\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},getNamedInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isNamedElement(g)){d=g.getAttribute("data-im-group");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=g.getAttribute("name");if(d&&d.length>0){a=d.match(/IM\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},repeaterTagFromEncTag:function(a){if(a=="TBODY"){return"TR"}else{if(a=="SELECT"){return"OPTION"}else{if(a=="UL"){return"LI"}else{if(a=="OL"){return"LI"}else{if(a=="DIV"){return"DIV"}else{if(a=="SPAN"){return"SPAN"}}}}}}return null},getNodeInfoArray:function(b){var e,a,d,c;if(!b||!b.split){return{table:null,field:null,target:null,tableindex:null}}e=b.split(INTERMediator.separator);a="",d="",c="";if(e.length==3){a=e[0];d=e[1];c=e[2]}else{if(e.length==2){a=e[0];d=e[1]}else{d=b}}return{table:a,field:d,target:c,tableindex:"_im_index_"+a}},getCalcNodeInfoArray:function(b){var e,a,d,c;if(!b){return null}e=b.split(INTERMediator.separator);a="",d="",c="";if(e.length==3){a=e[0];d=e[1];c=e[2]}else{if(e.length==2){d=e[0];c=e[1]}else{d=b}}return{table:a,field:d,target:c,tableindex:"_im_index_"+a}},getClassAttributeFromNode:function(a){var b="";if(a===null){return""}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b=a.getAttribute("className")}else{b=a.getAttribute("class")}return b},setClassAttributeToNode:function(b,a){if(b===null){return}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b.setAttribute("className",a)}else{b.setAttribute("class",a)}},eventInfos:[],addEvent:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}else{if(c.attachEvent){c.attachEvent("on"+a,b);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}}return -1},removeEvent:function(a){if(eventInfos[a].node.removeEventListener){eventInfos[a].node.removeEventListener(eventInfos[a].evt,eventInfos[a].func,false)}else{if(eventInfos[a].node.detachEvent){eventInfos[a].node.detachEvent("on"+eventInfos[a].evt,eventInfos[a].func)}}},toNumber:function(d){var b="",a,e;d=(new String(d)).toString();for(a=0;a<d.length;a++){e=d.charAt(a);if((e>="0"&&e<="9")||e=="."||e=="-"||e==this.cachedDigitSeparator[0]){b+=e}}return parseFloat(b)},RoundHalfToEven:function(a,b){return a},Round:function(b,c){var a=Math.pow(10,c);return Math.round(b*a)/a},numberFormat:function(g,l){var o,c,d,a,m,h,f,k,b,e;c=this.toNumber(g);d="";if(c<0){d="-";c=-c}m=(l===undefined)?0:this.toNumber(l);a=Math.pow(10,m);k=Math.round(c*a);b=(m>0)?k%a:0;e=(k-b)/a;h=(m>0)?new String(b):"";while(h.length<m){h="0"+h}c=e;o=[];for(c=Math.floor(c);c>0;c=Math.floor(c/1000)){if(c>=1000){f="000"+(c%1000).toString();o.push(f.substr(f.length-3))}else{o.push(c)}}return d+o.reverse().join(this.cachedDigitSeparator[1])+(h==""?"":this.cachedDigitSeparator[0]+h)},objectToString:function(c){var d,b,a;if(c===null){return"null"}if(typeof c=="object"){d="";if(c.constractor===Array){for(b=0;b<c.length;b++){d+=INTERMediatorLib.objectToString(c[b])+", "}return"["+d+"]"}else{for(a in c){d+="'"+a+"':"+INTERMediatorLib.objectToString(c[a])+", "}return"{"+d+"}"}}else{return"'"+c+"'"}},getTargetTableForRetrieve:function(a){if(a.view!=null){return a.view}return a.name},getTargetTableForUpdate:function(a){if(a.table!=null){return a.table}return a.name},getInsertedString:function(b,a){var d,c;d=b;if(a!=null){for(c=1;c<=a.length;c++){d=d.replace("@"+c+"@",a[c-1])}}return d},getInsertedStringFromErrorNumber:function(b,a){var d,c;d=INTERMediatorOnPage.getMessages()[b];if(a!=null){for(c=1;c<=a.length;c++){d=d.replace("@"+c+"@",a[c-1])}}return d},getNamedObject:function(d,c,a){var b;for(b in d){if(d[b][c]==a){return d[b]}}return null},getNamedObjectInObjectArray:function(b,d,a){var c;for(c=0;c<b.length;c++){if(b[c][d]==a){return b[c]}}return null},getNamedValueInObject:function(c,e,b,f){var a=[],d;for(d in c){if(c[d][e]==b){a.push(c[d][f])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},is_array:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!(a.propertyIsEnumerable("length"))},getNamedValuesInObject:function(c,g,e,f,b,h){var a=[],d;for(d in c){if(c[d][g]==e&&c[d][f]==b){a.push(c[d][h])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},getRecordsetFromFieldValueObject:function(b){var c={},a;for(a in b){c[b[a]["field"]]=b[a]["value"]}return c},getNodePath:function(a){var b="";if(a.tagName===null){return""}else{return INTERMediatorLib.getNodePath(a.parentNode)+"/"+a.tagName}},isPopupMenu:function(a){if(!a||!a.tagName){return false}if(a.tagName=="SELECT"){return true}return false},getElementsByClassNameOrDataAttr:function(d,a){var c=[],e;e=(a.match(/^_im_/))?a.substr(4):a;if(e){b(d)}return c;function b(k){var h,g,f;if(k===undefined||k.nodeType!==1){return}h=INTERMediatorLib.getClassAttributeFromNode(k);if(h){f=h.split("|");for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im-control");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}for(g=0;g<k.children.length;g++){b(k.children[g])}}},getElementsByClassName:function(e,a){var c=[];var d=new RegExp(a);b(e);return c;function b(h){var g,f;if(h===undefined||h.nodeType!==1){return}g=INTERMediatorLib.getClassAttributeFromNode(h);if(g&&g.match(d)){c.push(h)}for(var f=0;f<h.children.length;f++){b(h.children[f])}}},getElementsByIMManaged:function(d){var b=[];var c=new RegExp(/^IM/);a(d);return b;function a(f){var g,e;if(f===undefined||f.nodeType!==1){return}g=f.getAttribute("id");if(g&&g.match(c)){b.push(f)}for(var e=0;e<f.children.length;e++){a(f.children[e])}}},seekLinkedAndWidgetNodes:function(c,a){var g=[];var f=[];var e,d=a;if(a===undefined||a===null){d=false}for(e=0;e<c.length;e++){b(c[e])}return{linkedNode:g,widgetNode:f};function b(n){var h,o,m,k,l;h=n.nodeType;if(h===1){if(INTERMediatorLib.isLinkedElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){g.push(n)}else{return o}}if(INTERMediatorLib.isWidgetElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){f.push(n)}else{return o}}m=n.childNodes;for(l=0;l<m.length;l++){k=b(m[l])}}return null}},createErrorMessageNode:function(a,c){var b;b=document.createElement(a);INTERMediatorLib.setClassAttributeToNode(b,"_im_alertmessage");b.appendChild(document.createTextNode(c));return b},removeChildNodes:function(a){while(a.childNodes.length>0){a.removeChild(a.childNodes[0])}},clearErrorMessage:function(b){var c,a;c=INTERMediatorLib.getElementsByClassName(b.parentNode,"_im_alertmessage");for(a=0;a<c.length;a++){c[a].parentNode.removeChild(c[a])}},dateTimeStringISO:function(a){a=(!a)?new Date():a;return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).substr(-2,2)+"-"+("0"+a.getDate()).substr(-2,2)+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)},dateTimeStringFileMaker:function(a){a=(!a)?new Date():a;return("0"+(a.getMonth()+1)).substr(-2,2)+"/"+("0"+a.getDate()).substr(-2,2)+"/"+a.getFullYear()+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)}};INTERMediatorLib.initialize();var IMLibNodeGraph={nodes:[],edges:[],clear:function(){this.nodes=[];this.edges=[]},addNode:function(a){if(this.nodes.indexOf(a)<0){this.nodes.push(a)}},addEdge:function(b,a){if(this.nodes.indexOf(b)<0){this.addNode(b)}if(this.nodes.indexOf(a)<0){this.addNode(a)}this.edges.push({from:b,to:a})},getAllNodesInEdge:function(){var b,a=[];for(b=0;b<this.edges.length;b++){if(a.indexOf(this.edges[b].from)<0){a.push(this.edges[b].from)}if(a.indexOf(this.edges[b].to)<0){a.push(this.edges[b].to)}}return a},getLeafNodes:function(){var a,c=[],d=[],b=this.getAllNodesInEdge();for(a=0;a<this.edges.length;a++){c.push(this.edges[a].from)}for(a=0;a<this.edges.length;a++){if(c.indexOf(this.edges[a].to)<0&&d.indexOf(this.edges[a].to)<0){d.push(this.edges[a].to)}}for(a=0;a<this.nodes.length;a++){if(b.indexOf(this.nodes[a])<0){d.push(this.nodes[a])}}return d},getLeafNodesWithRemoving:function(){var b,a=[],c=this.getLeafNodes();for(b=0;b<this.edges.length;b++){if(c.indexOf(this.edges[b].to)<0){a.push(this.edges[b])}}this.edges=a;for(b=0;b<c.length;b++){this.nodes.splice(this.nodes.indexOf(c[b]),1)}return c},applyToAllNodes:function(b){var a;for(a=0;a<this.nodes.length;a++){b(this.nodes[a])}}};var IMLibCalc={calculateRequiredObject:null,updateCalculationInfo:function(s,k,e,m,v,d){var c,h,a,n,r,f,w,o,u,b,l,g,p,q;c=e.calculation;a=null;h=null;for(f in c){p=c[f]["field"].indexOf(INTERMediator.separator);q=c[f]["field"].length;g=c[f]["field"].substring(0,p>=0?p:q);if(g==v.field){try{h=c[f]["expression"];a=c[f]["field"];n=Parser.parse(h).variables();o=INTERMediatorLib.getCalcNodeInfoArray(a);w=m+(v.target.length>0?(INTERMediator.separator+v.target):"")}catch(t){INTERMediator.setErrorMessage(t,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1036],[a,h]))}if(n&&w){b={};l={};for(r=0;r<n.length;r++){u=n[r];if(u){b[u]=[d[u]];l[u]=[undefined]}s.setValue(k,u,d[u],m,v.target,null)}IMLibCalc.calculateRequiredObject[w]={field:a,expression:h,nodeInfo:v,values:b,referes:l}}}}},updateCalculationFields:function(){var h,e,r,f,k,m,c,t,l;var d,a,s,g,o,n,p,q,b;IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(h in IMLibCalc.calculateRequiredObject){m=IMLibCalc.calculateRequiredObject[h];q=h.match(IMLibCalc.regexpForSeparator)?h.split(IMLibCalc.regexpForSeparator)[0]:h;if(m){l=INTERMediatorLib.getCalcNodeInfoArray(q);d=document.getElementById(l.field);n=false;for(a in m.referes){for(c=0;c<m.referes[a].length;c++){IMLibNodeGraph.addEdge(h,m.referes[a][c]);n=false}}if(!n){IMLibNodeGraph.addEdge(h)}}}do{k=IMLibNodeGraph.getLeafNodesWithRemoving();for(o=0;o<k.length;o++){m=IMLibCalc.calculateRequiredObject[k[o]];l=INTERMediatorLib.getCalcNodeInfoArray(k[o]);if(m){q=k[o].match(IMLibCalc.regexpForSeparator)?k[o].split(IMLibCalc.regexpForSeparator)[0]:k[o];d=document.getElementById(l.field);e=m.expression;r=m.nodeInfo;f=m.values;t=m.referes;for(a in f){s=[];for(c=0;c<f[a].length;c++){if(f[a][c]==undefined){if(t[a][c]){g=document.getElementById(t[a][c]);s.push(IMLibElement.getValueFromIMNode(g))}else{g=document.getElementById(q);p=IMLibContextPool.getContextInfoFromId(q,r.target);b=p.context.getContextRecord(q);s.push(b[a])}}else{s.push(f[a][c])}}m.values[a]=s}IMLibElement.setValueToIMNode(d,r.target,Parser.evaluate(e,f),true)}else{}}}while(k.length>0);if(IMLibNodeGraph.nodes.length>0){INTERMediator.setErrorMessage(new Exception(),INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1037],[]))}},recalculation:function(r){var m,f,o,q,d,p,s,w=false;var e,n,a,u,g,x,b,k,y,h;var A,z,l,t,c,v;if(r===undefined){w=true;g=[];x=[]}else{n=IMLibElement.getValueFromIMNode(document.getElementById(r));g=[r];x=[n]}IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(m in IMLibCalc.calculateRequiredObject){q=IMLibCalc.calculateRequiredObject[m];v=m.match(IMLibCalc.regexpForSeparator)?m.split(IMLibCalc.regexpForSeparator)[0]:m;p=INTERMediatorLib.getCalcNodeInfoArray(v);e=document.getElementById(p.field);for(a in q.referes){for(d=0;d<q.referes[a].length;d++){IMLibNodeGraph.addEdge(m,q.referes[a][d])}}}do{o=IMLibNodeGraph.getLeafNodesWithRemoving();for(u=0;u<o.length;u++){q=IMLibCalc.calculateRequiredObject[o[u]];p=INTERMediatorLib.getCalcNodeInfoArray(o[u]);if(q){v=o[u].match(IMLibCalc.regexpForSeparator)?o[u].split(IMLibCalc.regexpForSeparator)[0]:o[u];e=document.getElementById(p.field);k=q.expression;y=q.nodeInfo;h=q.values;A=q.referes;for(a in h){z=[];for(d=0;d<h[a].length;d++){if(h[a][d]==undefined){if(A[a][d]){l=document.getElementById(A[a][d]);z.push(IMLibElement.getValueFromIMNode(l))}else{l=document.getElementById(v);t=IMLibContextPool.getContextInfoFromId(v,y.target);c=t.context.getContextRecord(v);z.push(c[a])}}else{z.push(h[a][d])}}q.values[a]=z}if(w){f=true}else{f=false;for(a in q.referes){for(d=0;d<q.referes[a].length;d++){b=g.indexOf(q.referes[a][d]);if(b>=0){q.values[a][d]=x[b];f=true}}}}if(f){s=Parser.evaluate(q.expression,q.values);IMLibElement.setValueToIMNode(document.getElementById(p.field),y.target,s,true);g.push(p.field);x.push(s)}}else{}}}while(o.length>0);if(IMLibNodeGraph.nodes.length>0){}},setUndefinedToAllValues:function(){var c,g,e,f,k,l,h,d,a,b;do{a=false;for(c in IMLibCalc.calculateRequiredObject){b=c.match(IMLibCalc.regexpForSeparator)?c.split(IMLibCalc.regexpForSeparator)[0]:c;if(!document.getElementById(b)){delete IMLibCalc.calculateRequiredObject[c];a=true;break}}}while(a);for(c in IMLibCalc.calculateRequiredObject){g=IMLibCalc.calculateRequiredObject[c];f=INTERMediatorLib.getCalcNodeInfoArray(c);k=document.getElementById(f.field);for(l in g.values){if(l.indexOf(INTERMediator.separator)>-1){h=l}else{h=g.nodeInfo.table+INTERMediator.separator+l}do{d=INTERMediatorOnPage.getNodeIdsHavingTargetFromRepeater(k,h);if(d&&d.length>0){break}d=INTERMediatorOnPage.getNodeIdsHavingTargetFromEnclosure(k,h);if(d&&d.length>0){break}k=INTERMediatorLib.getParentRepeater(INTERMediatorLib.getParentEnclosure(k))}while(k);if(INTERMediatorLib.is_array(d)&&d.length>0){g.referes[l]=[];g.values[l]=[];for(e=0;e<d.length;e++){g.referes[l].push(d[e]);g.values[l].push(undefined)}}else{g.referes[l]=[undefined];g.values[l]=[undefined]}}}}};var INTERMediatorOnPage;INTERMediatorOnPage={authCountLimit:4,authCount:0,authUser:"",authHashedPassword:"",authCryptedPassword:"",authUserSalt:"",authUserHexSalt:"",authChallenge:"",requireAuthentication:false,clientId:null,authRequiredContext:null,authStoring:"cookie",authExpired:3600,isOnceAtStarting:true,publickey:null,isNativeAuth:false,httpuser:null,httppasswd:null,mediaToken:null,realm:"",dbCache:{},isEmailAsUsername:false,isShowChangePassword:true,isSetDefaultStyle:true,authPanelTitle:null,additionalExpandingEnclosureFinish:{},additionalExpandingRecordFinish:{},clearCredentials:function(){INTERMediatorOnPage.authChallenge=null;INTERMediatorOnPage.authHashedPassword=null;INTERMediatorOnPage.authCryptedPassword=null},getMessages:function(){return null},getURLParametersAsArray:function(){var c,f,e,a,b,d;a={};f=location.search.substring(1).split("&");for(c=0;c<f.length;c++){e=f[c].indexOf("=");if(e>0){b=f[c].substring(0,e);d=f[c].substring(e+1);a[b]=decodeURIComponent(d)}}return a},getContextInfo:function(b){var c,a;c=INTERMediatorOnPage.getDataSources();for(a in c){if(c[a].name==b){return c[a]}}return null},isComplementAuthData:function(){if(this.authUser!=null&&this.authUser.length>0&&this.authHashedPassword!=null&&this.authHashedPassword.length>0&&this.authUserSalt!=null&&this.authUserSalt.length>0&&this.authChallenge!=null&&this.authChallenge.length>0){return true}return false},retrieveAuthInfo:function(){if(INTERMediatorOnPage.requireAuthentication){if(INTERMediatorOnPage.isOnceAtStarting){switch(INTERMediatorOnPage.authStoring){case"cookie":case"cookie-domainwide":INTERMediatorOnPage.authUser=this.getCookie("_im_username");INTERMediatorOnPage.authHashedPassword=this.getCookie("_im_credential");INTERMediatorOnPage.mediaToken=this.getCookie("_im_mediatoken");INTERMediatorOnPage.authCryptedPassword=this.getCookie("_im_crypted");break;default:INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");break}INTERMediatorOnPage.isOnceAtStarting=false}if(this.authUser.length>0){if(!INTERMediator_DBAdapter.getChallenge()){INTERMediator.flushMessage()}}}},logout:function(){INTERMediatorOnPage.authUser="";INTERMediatorOnPage.authHashedPassword="";INTERMediatorOnPage.authCryptedPassword="";INTERMediatorOnPage.authUserSalt="";INTERMediatorOnPage.authChallenge="";INTERMediatorOnPage.clientId="";INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.removeItem("_im_localcontext")}catch(a){INTERMediatorOnPage.removeCookie("_im_localcontext")}}else{INTERMediatorOnPage.removeCookie("_im_localcontext")}},storeCredencialsToCookie:function(){switch(INTERMediatorOnPage.authStoring){case"cookie":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookie("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookie("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookie("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookie("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break;case"cookie-domainwide":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookieDomainWide("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookieDomainWide("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break}},defaultBackgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAACF0RVh0U29mdHdhcmUAR3JhcGhpY0NvbnZlcnRlciAoSW50ZWwpd4f6GQAAAHRJREFUeJzs0bENAEAMAjHWzBC/f5sxkPIurkcmSV65KQcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAL4AaA9oHwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA6wAAAA//8DAF3pMFsPzhYWAAAAAElFTkSuQmCC)",defaultBackgroundColor:null,loginPanelHTML:null,authenticating:function(h){var c,k,r,y,l,g,v,f,m,w,n,b,s,e,p,q,d,u,t,x,o,a;if(INTERMediatorOnPage.authCount>INTERMediatorOnPage.authCountLimit){INTERMediatorOnPage.authenticationError();INTERMediatorOnPage.logout();INTERMediator.flushMessage();return}c=document.getElementsByTagName("BODY")[0];k=document.createElement("div");c.insertBefore(k,c.childNodes[0]);k.style.height="100%";k.style.width="100%";if(INTERMediatorOnPage.defaultBackgroundImage){k.style.backgroundImage=INTERMediatorOnPage.defaultBackgroundImage}if(INTERMediatorOnPage.defaultBackgroundColor){k.style.backgroundColor=INTERMediatorOnPage.defaultBackgroundColor}k.style.position="absolute";k.style.padding=" 50px 0 0 0";k.style.top="0";k.style.left="0";k.style.zIndex="999998";if(INTERMediatorOnPage.loginPanelHTML){k.innerHTML=INTERMediatorOnPage.loginPanelHTML;n=document.getElementById("_im_password");v=document.getElementById("_im_username");e=document.getElementById("_im_authbutton");s=document.getElementById("_im_changebutton")}else{r=document.createElement("div");if(INTERMediatorOnPage.isSetDefaultStyle){r.style.width="450px";r.style.backgroundColor="#333333";r.style.color="#DDDDAA";r.style.margin="50px auto 0 auto";r.style.padding="20px";r.style.borderRadius="10px";r.style.position="relative"}r.id="_im_authpanel";k.appendChild(r);p="";if(INTERMediatorOnPage.authPanelTitle&&INTERMediatorOnPage.authPanelTitle.length>0){p=INTERMediatorOnPage.authPanelTitle}else{if(INTERMediatorOnPage.realm&&INTERMediatorOnPage.realm.length>0){p=INTERMediatorOnPage.realm}}if(p&&p.length>0){x=document.createElement("DIV");x.appendChild(document.createTextNode(p));x.style.textAlign="left";r.appendChild(x);b=document.createElement("HR");r.appendChild(b)}y="200px";l=document.createElement("LABEL");r.appendChild(l);g=document.createElement("span");if(INTERMediatorOnPage.isSetDefaultStyle){g.style.width=y;g.style.textAlign="right";g.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(g,"_im_authlabel");l.appendChild(g);f=INTERMediatorOnPage.isEmailAsUsername?2011:2002;g.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(f)));v=document.createElement("INPUT");v.type="text";v.id="_im_username";v.size="24";v.setAttribute("autocapitalize","off");l.appendChild(v);b=document.createElement("BR");b.clear="all";r.appendChild(b);m=document.createElement("LABEL");r.appendChild(m);w=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){w.style.minWidth=y;w.style.textAlign="right";w.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(w,"_im_authlabel");m.appendChild(w);w.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2003)));n=document.createElement("INPUT");n.type="password";n.id="_im_password";n.size="24";m.appendChild(n);e=document.createElement("BUTTON");e.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2004)));r.appendChild(e);b=document.createElement("BR");b.clear="all";r.appendChild(b);t=document.createElement("DIV");t.style.textAlign="center";t.style.textSize="10pt";t.style.color="#994433";t.id="_im_login_message";r.appendChild(t);if(this.isShowChangePassword&&!INTERMediatorOnPage.isNativeAuth){b=document.createElement("HR");r.appendChild(b);q=document.createElement("LABEL");r.appendChild(q);d=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){d.style.minWidth=y;d.style.textAlign="right";d.style.cssFloat="left";d.style.fontSize="0.7em";d.style.paddingTop="4px"}INTERMediatorLib.setClassAttributeToNode(d,"_im_authlabel");q.appendChild(d);d.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2006)));u=document.createElement("INPUT");u.type="password";u.id="_im_newpassword";u.size="12";q.appendChild(u);s=document.createElement("BUTTON");s.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2005)));r.appendChild(s);t=document.createElement("DIV");t.style.textAlign="center";t.style.textSize="10pt";t.style.color="#994433";t.id="_im_newpass_message";r.appendChild(t)}}n.onkeydown=function(z){o=(window.event)?window.event.which:z.keyCode;if(o==13){e.onclick()}};v.value=INTERMediatorOnPage.authUser;v.onkeydown=function(z){o=(window.event)?window.event.which:z.keyCode;if(o==13){n.focus()}};e.onclick=function(){var B,z,A;B=document.getElementById("_im_username").value;z=document.getElementById("_im_password").value;if(B===""||z===""){a=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2013)));return}INTERMediatorOnPage.authUser=B;c.removeChild(k);if(B!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";A=INTERMediator_DBAdapter.getChallenge();if(!A){INTERMediator.flushMessage();return}}INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(z);INTERMediatorOnPage.authHashedPassword=SHA1(z+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;if(INTERMediatorOnPage.authUser.length>0){INTERMediatorOnPage.storeCredencialsToCookie()}h();INTERMediator.flushMessage()};if(s){s.onclick=function(){var G,A,B,D,F,z,C;G=document.getElementById("_im_username").value;A=document.getElementById("_im_password").value;B=document.getElementById("_im_newpassword").value;if(G===""||A===""||B===""){C=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(C);C.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2007)));return}INTERMediatorOnPage.authUser=G;if(G!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";D=INTERMediator_DBAdapter.getChallenge();if(!D){C=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(C);C.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2008)));INTERMediator.flushMessage();return}}INTERMediatorOnPage.authHashedPassword=SHA1(A+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;F="access=changepassword&newpass="+INTERMediatorLib.generatePasswordHash(B);try{z=INTERMediator_DBAdapter.server_access(F,1029,1030)}catch(E){z={newPasswordResult:false}}C=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(C);C.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(z.newPasswordResult===true?2009:2010)));INTERMediator.flushMessage()}}if(INTERMediatorOnPage.authCount>0){a=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2012)))}window.scroll(0,0);v.focus();INTERMediatorOnPage.authCount++},authenticationError:function(){var c,b,a;INTERMediatorOnPage.hideProgress();c=document.getElementsByTagName("BODY")[0];b=document.createElement("div");c.insertBefore(b,c.childNodes[0]);b.style.height="100%";b.style.width="100%";b.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAACF0RVh0U29mdHdhcmUAR3JhcGhpY0NvbnZlcnRlciAoSW50ZWwpd4f6GQAAAHlJREFUeJzs0UENACAQA8EzdAl2EIEg3CKjyTGP/TfTur1OuJ2sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAJwDRAekDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADzAR4AAAD//wMAkUKRPI/rh/AAAAAASUVORK5CYII=)";b.style.position="absolute";b.style.padding=" 50px 0 0 0";b.style.top="0";b.style.left="0";b.style.zIndex="999999";a=document.createElement("div");a.style.width="240px";a.style.backgroundColor="#333333";a.style.color="#DD6666";a.style.fontSize="16pt";a.style.margin="50px auto 0 auto";a.style.padding="20px 4px 20px 4px";a.style.borderRadius="10px";a.style.position="relatvie";a.style.textAlign="Center";a.onclick=function(){c.removeChild(b)};b.appendChild(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2001)))},INTERMediatorCheckBrowser:function(l){var e,n,k,p,c,d,q=false,r,g,b=-1,m,a,o,s,h,f;e=INTERMediatorOnPage.browserCompatibility();n=false;k=false;if(e.edge&&navigator.userAgent.indexOf("Edge/")>-1){e={edge:e.edge}}else{if(e.trident&&navigator.userAgent.indexOf("Trident/")>-1){e={trident:e.trident}}else{if(e.msie&&navigator.userAgent.indexOf("MSIE ")>-1){e={msie:e.msie}}else{if(e.opera&&(navigator.userAgent.indexOf("Opera/")>-1||navigator.userAgent.indexOf("OPR/")>-1)){e={opera:e.opera,opr:e.opera}}}}}for(c in e){if(navigator.userAgent.toUpperCase().indexOf(c.toUpperCase())>-1){n=true;if(e[c] instanceof Object){for(d in e[c]){if(navigator.platform.toUpperCase().indexOf(d.toUpperCase())>-1){k=true;p=e[c][d];break}}}else{k=true;p=e[c];break}}}if(n&&k){r=parseInt(p,10);if(navigator.appVersion.indexOf("Edge/")>-1){b=navigator.appVersion.indexOf("Edge/")+5}else{if(navigator.appVersion.indexOf("Trident/")>-1){b=navigator.appVersion.indexOf("Trident/")+8}else{if(navigator.appVersion.indexOf("MSIE ")>-1){b=navigator.appVersion.indexOf("MSIE ")+5}else{if(navigator.appVersion.indexOf("OPR/")>-1){b=navigator.appVersion.indexOf("OPR/")+4}else{if(navigator.appVersion.indexOf("Opera/")>-1){b=navigator.appVersion.indexOf("Opera/")+6}else{if(navigator.appVersion.indexOf("Chrome/")>-1){b=navigator.appVersion.indexOf("Chrome/")+7}else{if(navigator.appVersion.indexOf("Safari/")>-1&&navigator.appVersion.indexOf("Version/")>-1){b=navigator.appVersion.indexOf("Version/")+8}else{if(navigator.userAgent.indexOf("Firefox/")>-1){b=navigator.userAgent.indexOf("Firefox/")+8}}}}}}}}if(b>-1){if(navigator.userAgent.indexOf("Firefox/")>-1){m=navigator.userAgent.indexOf(".",b);g=parseInt(navigator.userAgent.substring(b,m),10)}else{m=navigator.appVersion.indexOf(".",b);g=parseInt(navigator.appVersion.substring(b,m),10)}}else{m=navigator.appVersion.indexOf(".");g=parseInt(navigator.appVersion.substring(0,m),10)}if(INTERMediator.isTrident){r=r+4}if(p.indexOf("-")>-1){q=(r>=g);if(document.documentMode){q=(r>=document.documentMode)}}else{if(p.indexOf("+")>-1){q=(r<=g);if(document.documentMode){q=(r<=document.documentMode)}}else{q=(r==g);if(document.documentMode){q=(r==document.documentMode)}}}}if(q===true){if(l!==null){l.parentNode.removeChild(l)}}else{a=document.getElementsByTagName("BODY")[0];o=document.createElement("div");o.setAttribute("align","center");s=document.createElement("font");s.setAttribute("color","gray");h=document.createElement("font");h.setAttribute("size","+2");h.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1022]));s.appendChild(h);s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1023]));s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(navigator.userAgent));o.appendChild(s);for(f=a.childNodes.length-1;f>=0;f--){a.removeChild(a.childNodes[f])}a.appendChild(o)}return q},getNodeIdFromIMDefinition:function(c,e,a){var b;if(a){b=e}else{b=INTERMediatorLib.getParentRepeater(e)}return d(b,c);function d(l,f){var h,g,m,k;if(l.nodeType!=1){return null}h=l.childNodes;if(h){for(g=0;g<h.length;g++){if(h[g].nodeType==1){if(INTERMediatorLib.isLinkedElement(h[g])){m=INTERMediatorLib.getLinkedElementInfo(h[g]);if(m.indexOf(f)>-1){k=h[g].getAttribute("id");return k}}k=d(h[g],f);if(k!==null){return k}}}}return null}},getNodeIdFromIMDefinitionOnEnclosure:function(b,d){var a;a=INTERMediatorLib.getParentEnclosure(d);return c(a,b);function c(k,e){var g,f,l,h;if(k.nodeType!=1){return null}g=k.childNodes;if(g){for(f=0;f<g.length;f++){if(g[f].nodeType==1){if(INTERMediatorLib.isLinkedElement(g[f])){l=INTERMediatorLib.getLinkedElementInfo(g[f]);if(l.indexOf(e)>-1&&g[f].getAttribute){h=g[f].getAttribute("id");return h}}h=c(g[f],e);if(h!==null){return h}}}}return null}},getNodeIdsFromIMDefinition:function(c,g,a){var b,d,f;if(a===true){b=g}else{if(a===false){b=INTERMediatorLib.getParentEnclosure(g)}else{b=INTERMediatorLib.getParentRepeater(g)}}if(b!=null){d=[];e(b,c)}return d;function e(m,h){var l,k,n;if(m.nodeType!=1){return}l=m.childNodes;if(l){for(k=0;k<l.length;k++){if(l[k].nodeType==1){n=INTERMediatorLib.getLinkedElementInfo(l[k]);if(n&&n.indexOf(h)>-1){d.push(l[k].getAttribute("id"))}}e(l[k],h)}}}},getNodeIdsHavingTargetFromNode:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,true)},getNodeIdsHavingTargetFromRepeater:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,"")},getNodeIdsHavingTargetFromEnclosure:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,false)},getKeyWithRealm:function(a){if(INTERMediatorOnPage.realm.length>0){return a+"_"+INTERMediatorOnPage.realm}return a},getCookie:function(c){var d,b,a;d=document.cookie.split("; ");a=this.getKeyWithRealm(c);for(b=0;b<d.length;b++){if(d[b].indexOf(a+"=")==0){return decodeURIComponent(d[b].substring(d[b].indexOf("=")+1))}}return""},removeCookie:function(a){document.cookie=this.getKeyWithRealm(a)+"=; path=/; max-age=0; expires=Thu, 1-Jan-1900 00:00:00 GMT;";document.cookie=this.getKeyWithRealm(a)+"=; max-age=0;  expires=Thu, 1-Jan-1900 00:00:00 GMT;"},setCookie:function(a,b){this.setCookieWorker(this.getKeyWithRealm(a),b,false,INTERMediatorOnPage.authExpired)},setCookieDomainWide:function(a,b){this.setCookieWorker(this.getKeyWithRealm(a),b,true,INTERMediatorOnPage.authExpired)},setCookieWorker:function(b,g,a,c){var e;var f=new Date();f.setTime(f.getTime()+c*1000);e=b+"="+encodeURIComponent(g)+(a?";path=/":"")+";";if(c>0){e+="max-age="+c+";expires="+f.toGMTString()+";"}if(document.URL.substring(0,8)=="https://"){e+="secure;"}document.cookie=e},hideProgress:function(){var a;a=document.getElementById("_im_progress");if(a){a.parentNode.removeChild(a)}},showProgress:function(){var d,g,f,c,a,b,e;c=document.getElementById("_im_progress");if(!c){d=INTERMediatorOnPage.getIMRootPath();g=document.getElementsByTagName("HEAD")[0];f=document.getElementsByTagName("BODY")[0];c=document.createElement("div");c.setAttribute("id","_im_progress");a=document.createElement("link");a.setAttribute("href",d+"/themes/default/css/style.css");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");g.appendChild(a);if(f.firstChild){f.insertBefore(c,f.firstChild)}else{f.appendChild(c)}e=document.createElement("img");e.setAttribute("id","_im_logo");e.setAttribute("src",d+"/themes/default/images/logo.gif");c.appendChild(e);b=document.createElement("img");b.setAttribute("src",d+"/themes/default/images/inprogress.gif");c.appendChild(b);c.appendChild(document.createElement("BR"));c.appendChild(document.createTextNode("INTER-Mediator working"))}}};var IMParts_Catalog={};IMParts_Catalog.fileupload={html5DDSuported:false,progressSupported:false,forceOldStyleForm:false,uploadId:"sign"+Math.random(),instanciate:function(g){var l,a,c,e;var d=g.getAttribute("id")+"-e";var n=document.createElement("DIV");INTERMediatorLib.setClassAttributeToNode(n,"_im_fileupload");n.setAttribute("id",d);this.ids.push(d);if(this.forceOldStyleForm){this.html5DDSuported=false}else{this.html5DDSuported=true;try{var m=new FileReader();var k=new FormData()}catch(h){this.html5DDSuported=false}}e=("ontouchstart" in window);if(e){this.html5DDSuported=false}if(this.html5DDSuported){n.dropzone="copy";n.style.width="200px";n.style.height="100px";n.style.paddingTop="20px";n.style.backgroundColor="#AAAAAA";n.style.border="3px dotted #808080";n.style.textAlign="center";n.style.fontSize="75%";var b=INTERMediatorOnPage.getMessages()[3101].split(/\n/);for(var f=0;f<b.length;f++){if(f>0){n.appendChild(document.createElement("BR"))}n.appendChild(document.createTextNode(b[f]))}}else{a=document.createElement("FORM");a.setAttribute("method","post");a.setAttribute("action",INTERMediatorOnPage.getEntryPath()+"?access=uploadfile");a.setAttribute("enctype","multipart/form-data");n.appendChild(a);if(this.progressSupported){l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","APC_UPLOAD_PROGRESS");l.setAttribute("id","progress_key");l.setAttribute("value",this.uploadId+(this.ids.length-1));a.appendChild(l)}l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_redirect");l.setAttribute("value",location.href);a.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","_im_contextnewrecord");l.setAttribute("value","uploadfile");a.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","hidden");l.setAttribute("name","access");l.setAttribute("value","uploadfile");a.appendChild(l);l=document.createElement("INPUT");l.setAttribute("type","file");l.setAttribute("accept","*/*");l.setAttribute("name","_im_uploadfile");a.appendChild(l);c=document.createElement("BUTTON");c.setAttribute("type","submit");c.appendChild(document.createTextNode(""));a.appendChild(c);this.formFromId[d]=a}g.appendChild(n);n._im_getValue=function(){var o=n;return o.value};g._im_getValue=function(){var o=n;return o.value};g._im_getComponentId=function(){var o=d;return o};g._im_setValue=function(p){var o=n;if(this.html5DDSuported){}else{}}},ids:[],formFromId:{},finish:function(){var d,a;if(this.html5DDSuported){for(var f=0;f<this.ids.length;f++){var e=this.ids[f];var k=document.getElementById(e);var g=IMLibContextPool.getContextInfoFromId(e);if(k){INTERMediatorLib.addEvent(k,"dragleave",function(p){p.preventDefault();p.target.style.backgroundColor="#AAAAAA"});INTERMediatorLib.addEvent(k,"dragover",function(p){p.preventDefault();p.target.style.backgroundColor="#AADDFF"});var l=this.progressSupported;var n=this.ids.length;var c=this.uploadId;INTERMediatorLib.addEvent(k,"drop",(function(){var t=f;var q=l;var p=n;var s=c;var r=e;return function(y){var x,z;y.preventDefault();var A=y.currentTarget;if(q){var w=document.createElement("iframe");w.setAttribute("id","upload_frame"+p);w.setAttribute("name","upload_frame");w.setAttribute("frameborder","0");w.setAttribute("border","0");w.setAttribute("scrolling","no");w.setAttribute("scrollbar","no");w.style.width="100%";w.style.height="24px";A.appendChild(w)}for(var v=0;v<y.dataTransfer.files.length;v++){x=y.dataTransfer.files[v];z=document.createElement("DIV");z.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3102]+x.name));z.style.marginTop="20px";z.style.backgroundColor="#FFFFFF";z.style.textAlign="center";y.target.appendChild(z)}var u=IMLibContextPool.getContextInfoFromId(A.getAttribute("id"),"");if(q){w.style.display="block";setTimeout(function(){w.setAttribute("src","upload_frame.php?up_id="+s+t)})}INTERMediator_DBAdapter.uploadFile("&_im_contextname="+encodeURIComponent(u.context.contextName)+"&_im_field="+encodeURIComponent(u.field)+"&_im_keyfield="+encodeURIComponent(u.record.split("=")[0])+"&_im_keyvalue="+encodeURIComponent(u.record.split("=")[1])+"&_im_contextnewrecord="+encodeURIComponent("uploadfile")+(q?("&APC_UPLOAD_PROGRESS="+encodeURIComponent(s+t)):""),{fileName:x.name,content:x},function(E){var J,G,H=null,B,F,C;C=IMLibContextPool.getContextDef(u.context.contextName);if(C["file-upload"]){var D="";for(var I in C["file-upload"]){if(C["file-upload"][I]["field"]==u.field){D=C["file-upload"][I]["context"];break}}B=IMLibContextPool.getKeyFieldValueFromId(r,"");H=IMLibContextPool.getContextsFromNameAndForeignValue(D,B,C.key)}else{H=IMLibContextPool.getContextFromName(u.context.contextName)}G=IMLibContextPool.getContextInfoFromId(r,"");G.context.setValue(G.record,G.field,E);if(H){for(F=0;F<H.length;F++){J=H[F];INTERMediator.construct(J)}}INTERMediator.flushMessage()})}})())}}}else{for(var f=0;f<this.ids.length;f++){var k=document.getElementById(this.ids[f]);if(k){var h=IMLibContextPool.getContextInfoFromId(this.ids[f],"");var b=k.getElementsByTagName("FORM")[0];var m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_contextname");m.setAttribute("value",h.context.contextName);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_field");m.setAttribute("value",h.field);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_keyfield");m.setAttribute("value",h.record.split("=")[0]);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_keyvalue");m.setAttribute("value",h.record.split("=")[1]);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","clientid");if(INTERMediatorOnPage.authUser.length>0){m.value=INTERMediatorOnPage.clientId}b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","authuser");if(INTERMediatorOnPage.authUser.length>0){m.value=INTERMediatorOnPage.authUser}b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","response");if(INTERMediatorOnPage.authUser.length>0){thisForm.elements.cresponse.value=INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+"\n"+INTERMediatorOnPage.authChallenge);if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){d=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=d.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");m.value=a}else{m.value="dummy"}}b.appendChild(m);if(this.progressSupported){m=document.createElement("iframe");m.setAttribute("id","upload_frame"+f);m.setAttribute("name","upload_frame");m.setAttribute("frameborder","0");m.setAttribute("border","0");m.setAttribute("scrolling","no");m.setAttribute("scrollbar","no");b.appendChild(m);INTERMediatorLib.addEvent(b,"submit",(function(){var p=f;return function(r){var q=document.getElementById("upload_frame"+p);q.style.display="block";setTimeout(function(){var s=o()+"?uploadprocess="+this.uploadId+p;q.setAttribute("src",s)});return true}})())}}}}this.ids=[];this.formFromId={};function o(){var q=document.getElementsByTagName("SCRIPT");for(var r=0;r<q.length;r++){var p=q[r].getAttribute("src");if(p.match(/\.php/)){return p}}return null}}};IMLibPageNavigation={deleteInsertOnNavi:[],navigationSetup:function(){var c,h,d,k,e,a,o,l,f,g,q,p,b,r,n,m;c=document.getElementById("IM_NAVIGATOR");if(c!==null){d=c.childNodes;for(h=0;h<d.length;h++){c.removeChild(d[h])}c.innerHTML="";c.setAttribute("class","IM_NAV_panel");k=INTERMediator.navigationLabel;if(k===null||k[8]!==false){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(((k===null||k[8]===null)?INTERMediatorOnPage.getMessages()[2]:k[8])));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",function(){INTERMediator.initialize();IMLibLocalContext.archive();location.reload()})}if(k===null||k[4]!==false){a=Number(INTERMediator.startFrom);o=Number(INTERMediator.pagedSize);l=Number(INTERMediator.pagedAllCount);f=" IM_NAV_disabled";e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(((k===null||k[4]===null)?INTERMediatorOnPage.getMessages()[1]:k[4])+(l===0?0:a+1)+((Math.min(a+o,l)-a>1)?(((k===null||k[5]===null)?"-":k[5])+Math.min(a+o,l)):"")+((k===null||k[6]===null)?" / ":k[6])+(l)+((k===null||k[7]===null)?"":k[7])));e.setAttribute("class","IM_NAV_info")}if((k===null||k[0]!==false)&&INTERMediator.pagination===true){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[0]===null)?"<<":k[0]));e.setAttribute("class","IM_NAV_button"+(a===0?f:""));INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=0;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[1]===null)?"<":k[1]));e.setAttribute("class","IM_NAV_button"+(a===0?f:""));q=(a-o>0)?a-o:0;INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=q;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[2]===null)?">":k[2]));e.setAttribute("class","IM_NAV_button"+(a+o>=l?f:""));p=(a+o<l)?a+o:((l-o>0)?a:0);INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=p;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[3]===null)?">>":k[3]));e.setAttribute("class","IM_NAV_button"+(a+o>=l?f:""));if(l%o===0){b=l-(l%o)-o}else{b=l-(l%o)}INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=(b>0)?b:0;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[10]));g=document.createElement("INPUT");g.setAttribute("class","IM_NAV_JUMP");g.setAttribute("type","text");g.setAttribute("value",Math.ceil(INTERMediator.startFrom/o+1));e.appendChild(g);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[11]));INTERMediatorLib.addEvent(g,"change",function(){if(this.value<1){this.value=1}var s=Math.ceil(l/o);if(s<this.value){this.value=s}INTERMediator.startFrom=(~~this.value-1)*o;INTERMediator.construct(true)})}if(k===null||k[9]!==false){for(h=0;h<IMLibPageNavigation.deleteInsertOnNavi.length;h++){switch(IMLibPageNavigation.deleteInsertOnNavi[h]["kind"]){case"INSERT":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["name"]));e.setAttribute("class","IM_NAV_button");r=function(t,s,x){var w=t,v=s,u=x;return function(){IMLibPageNavigation.insertRecordFromNavi(w,v,u)}};INTERMediatorLib.addEvent(e,"click",r(IMLibPageNavigation.deleteInsertOnNavi[h]["name"],IMLibPageNavigation.deleteInsertOnNavi[h]["key"],IMLibPageNavigation.deleteInsertOnNavi[h]["confirm"]?true:false));break;case"DELETE":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[4]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["name"]));e.setAttribute("class","IM_NAV_button");n=function(t,s,z,y){var x=t,v=s,w=z,u=y;return function(){IMLibPageNavigation.deleteRecordFromNavi(x,v,w,u)}};INTERMediatorLib.addEvent(e,"click",n(IMLibPageNavigation.deleteInsertOnNavi[h]["name"],IMLibPageNavigation.deleteInsertOnNavi[h]["key"],IMLibPageNavigation.deleteInsertOnNavi[h]["value"],IMLibPageNavigation.deleteInsertOnNavi[h]["confirm"]?true:false));break;case"COPY":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[15]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["contextDef"]["name"]));e.setAttribute("class","IM_NAV_button");m=function(u,s){var v=u,t=s;return function(){IMLibPageNavigation.copyRecordFromNavi(v,t)}};INTERMediatorLib.addEvent(e,"click",m(IMLibPageNavigation.deleteInsertOnNavi[h]["contextDef"],IMLibPageNavigation.deleteInsertOnNavi[h]["keyValue"]));break}}}if(k===null||k[10]!==false){if(INTERMediatorOnPage.getOptionsTransaction()=="none"){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[10]===null)?INTERMediatorOnPage.getMessages()[7]:k[10]));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",IMLibPageNavigation.saveRecordFromNavi)}}if(k===null||k[11]!==false){if(INTERMediatorOnPage.requireAuthentication){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[8]+INTERMediatorOnPage.authUser));e.setAttribute("class","IM_NAV_info");e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[11]===null)?INTERMediatorOnPage.getMessages()[9]:k[11]));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",function(){INTERMediatorOnPage.logout();location.reload()})}}}},insertRecordFromNavi:function(d,c,f){var b,k,g,e,a;if(f){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();e=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",d);if(e===null){alert("no targetname :"+d);INTERMediatorOnPage.hideProgress();return}try{INTERMediatorOnPage.retrieveAuthInfo();a=INTERMediator_DBAdapter.db_createRecord({name:d,dataset:[]});b=a.newKeyValue}catch(h){if(h=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.insertRecordFromNavi(d,c,f)});INTERMediator.flushMessage();return}}}else{INTERMediator.setErrorMessage(h,"EXCEPTION-5")}}if(b>-1){restore=INTERMediator.additionalCondition;if(e.records<=1){INTERMediator.startFrom=0;INTERMediator.pagedAllCount=1;k=INTERMediator.additionalCondition;k[d]={field:c,value:b};INTERMediator.additionalCondition=k;IMLibLocalContext.archive()}else{INTERMediator.pagedAllCount++}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=restore;IMLibPageNavigation.navigationSetup()}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},deleteRecordFromNavi:function(b,e,d,c){if(c){if(!confirm(INTERMediatorOnPage.getMessages()[1025])){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_delete({name:b,conditions:[{field:e,operator:"=",value:d}]});INTERMediator.pagedAllCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom--;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}}catch(a){if(a=="_im_requath_request_"){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.deleteRecordFromNavi(b,e,d,c)});INTERMediator.flushMessage();return}else{INTERMediator.setErrorMessage(a,"EXCEPTION-6")}}INTERMediator.constructMain(true);INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},copyRecordFromNavi:function(b,c){var a;INTERMediatorOnPage.showProgress();a=IMLibUI.copyRecordImpl(b,c);if(a>-1){restore=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(b.records<=1){conditions=INTERMediator.additionalCondition;conditions[b.name]={field:b.key,value:a};INTERMediator.additionalCondition=conditions;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=restore}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},saveRecordFromNavi:function(o){var e,n,g,p,q,h,d,s,a,r,m,c,f=true,b,l;INTERMediatorOnPage.showProgress();INTERMediatorOnPage.retrieveAuthInfo();for(d=0;d<IMLibContextPool.poolingContexts.length;d++){b=IMLibContextPool.poolingContexts[d];l=b.getModified();for(e in l){r=[];m=[];for(n in l[e]){r.push(n);m.push({field:n,value:l[e][n]})}if(!INTERMediator.ignoreOptimisticLocking){g=e.split("=");p=g[0];g.shift();q=g.join("=");h={name:b.contextName,records:1,paging:false,fields:r,parentkeyvalue:null,conditions:[{field:p,operator:"=",value:q}],useoffset:false,primaryKeyOnly:true};try{a=INTERMediator_DBAdapter.db_query(h)}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){INTERMediator.db_query(h)});return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-28")}}if(a.recordset===null||a.recordset[0]===null){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[r.join(",")]));return}if(a.count>1){response=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!response){return}}c=false;for(n in l[e]){s=b.getValue(e,n);if(s!=a.recordset[0][n]){c+=INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1035],[n,a.recordset[0][n],l[e][n]])}}if(c!==false){if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1034],[c]))){return}INTERMediatorOnPage.retrieveAuthInfo()}}try{INTERMediator_DBAdapter.db_update({name:b.contextName,conditions:[{field:p,operator:"=",value:q}],dataset:m})}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.deleteRecordFromNavi(targetName,keyField,keyValue,isConfirm)});return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-29")}}b.clearModified()}}if(f&&(o!==true)){INTERMediator.constructMain(true)}INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}};var IMLibUI={isShiftKeyDown:false,isControlKeyDown:false,keyDown:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=true}if(b==17){IMLibUI.isControlKeyDown=true}},keyUp:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=false}if(b==17){IMLibUI.isControlKeyDown=false}},valueChange:function(d,e){var g,c,k,h,m,f,o,b,l,p,n=true;if(IMLibUI.isShiftKeyDown&&IMLibUI.isControlKeyDown){INTERMediator.setDebugMessage("Canceled to update the value with shift+control keys.");INTERMediator.flushMessage();IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;return n}IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;g=document.getElementById(d);if(g!=null){if(g.readOnly){return n}l=INTERMediatorLib.getLinkedElementInfo(g);if(!l&&INTERMediatorLib.isWidgetElement(g.parentNode)){l=INTERMediatorLib.getLinkedElementInfo(g.parentNode)}p=INTERMediatorLib.getNodeInfoArray(l[0]);k=IMLibContextPool.getContextInfoFromId(d,p.target);if(!this.validation(g)){g.focus();window.setTimeout((function(){var r=g;var q=k;return function(){if(q){r.value=q.context.getValue(q.record,q.field)}r.removeAttribute("data-im-validation-notification")}})(),0);return false}if(e===true){return true}c=g.getAttribute("type");if(c==="radio"&&!g.checked){INTERMediatorOnPage.hideProgress();return true}if(k){b=IMLibElement.getValueFromIMNode(g);if(k.context.isValueUndefined(k.record,k.field,k.portal)){INTERMediator.setErrorMessage("Error in updating.",INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1040],[k.context.contextName,k.field]))}else{if(INTERMediatorOnPage.getOptionsTransaction()=="none"){k.context.setModified(k.record,k.field,b)}else{INTERMediatorOnPage.showProgress();if(!IMLibElement.checkOptimisticLock(g,p.target)){INTERMediatorOnPage.hideProgress()}else{IMLibContextPool.updateContext(d,p.target);a(g,d,p.target);m=IMLibContextPool.dependingObjects(d);for(h=0;h<m.length;h++){m[h].foreignValue={};m[h].foreignValue[k.field]=b;if(m[h]){INTERMediator.constructMain(m[h]);f=m[h].enclosureNode;if(INTERMediatorLib.isPopupMenu(f)){o=k.context.getContextValue(f.id,"");IMLibElement.setValueToIMNode(f,"",o,false)}}}}}}}IMLibCalc.recalculation();INTERMediator.flushMessage();return true}function a(w,q,u){var t,r,v;INTERMediatorOnPage.retrieveAuthInfo();r=IMLibContextPool.getContextInfoFromId(q,u);t=IMLibElement.getValueFromIMNode(w);if(t!=null){v=r.record.split("=");try{INTERMediator_DBAdapter.db_update({name:r.context.contextName,conditions:[{field:v[0],operator:"=",value:v[1]}],dataset:[{field:r.field+(r.portal?("."+r.portal):""),value:t}]})}catch(s){if(s=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){a(w,q)});return}}else{INTERMediator.setErrorMessage(s,"EXCEPTION-2")}}}INTERMediatorOnPage.hideProgress()}},validation:function(d){var k,c,b,f,l,h,g,n,e=[],a;if(e){while(e.length>0){e[0].parentNode.removeChild(e[0]);delete e[0]}}if(!e){e=[]}try{k=INTERMediatorLib.getLinkedElementInfo(d);h=false;n=true;if(k.length>0){c=k[0].match(/([^@]+)/);if(c[1]!==IMLibLocalContext.contextName){b=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c[1]);if(b!=null&&b.validation!=null){for(f=0;f<k.length;f++){c=k[f].match(/([^@]+)@([^@]+)/);for(l in b.validation){if(b.validation[l].field===c[2]){h=true;n=Parser.evaluate(b.validation[l].rule,{value:d.value,target:d});if(!n){switch(b.validation[l].notify){case"inline":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("SPAN",b.validation[l].message);d.parentNode.insertBefore(a,d.nextSibling);e.push(a);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("DIV",b.validation[l].message);d.parentNode.appendChild(a);e.push(a);break;default:if(d.getAttribute("data-im-validation-notification")!=="alert"){alert(b.validation[l].message);d.setAttribute("data-im-validation-notification","alert")}break}g=IMLibContextPool.getContextInfoFromId(d,"");if(g){d.value=g.context.getValue(g.record,g.field);window.setTimeout(function(){d.focus()},0);if(INTERMediatorOnPage.doAfterValidationFailure!==null){INTERMediatorOnPage.doAfterValidationFailure(d,k[f])}}return n}else{switch(b.validation[l].notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);break}}}}}}}if(h){if(INTERMediatorOnPage.doAfterValidationSucceed!=null){n=INTERMediatorOnPage.doAfterValidationSucceed(d,k[f])}}}return n}catch(m){if(m==="_im_requath_request_"){throw m}else{INTERMediator.setErrorMessage(m,"EXCEPTION-32: on the validation process.")}return false}},copyButton:function(c,d){var a,b;INTERMediatorOnPage.showProgress();a=IMLibUI.copyRecordImpl(c,d);if(a>-1){b=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(c.records<=1){conditions=INTERMediator.additionalCondition;conditions[c.name]={field:c.key,value:a};INTERMediator.additionalCondition=conditions;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=b}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},copyRecordImpl:function(h,f){var m,a,c,g,b,e,d,l;if(h["repeat-control"].match(/confirm-copy/)){if(!confirm(INTERMediatorOnPage.getMessages()[1025])){return}}try{INTERMediatorOnPage.retrieveAuthInfo();if(h.relation){for(index in h.relation){if(h.relation[index]["portal"]==true){h.portal=true}}}m=[];if(h["repeat-control"].match(/copy-/)){d=h["repeat-control"].indexOf("copy-");l=h["repeat-control"].substr(d+5);if((d=l.search(/\s/))>-1){l=l.substr(0,d)}e=l.split(",");for(g=0;g<e.length;g++){b=IMLibContextPool.getContextDef(e[g]);if(b.relation[0]["foreign-key"]){m.push({name:b.name,field:b.relation[0]["foreign-key"],value:f})}}}if(h.portal==true){a=INTERMediator_DBAdapter.db_copy({name:h.name,conditions:[{field:h.key,operator:"=",value:f}],associated:m.length>0?m:null})}else{a=INTERMediator_DBAdapter.db_copy({name:h.name,conditions:[{field:h.key,operator:"=",value:f}],associated:m.length>0?m:null})}c=a.newKeyValue}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibUI.copyButton(h,f)});return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-43")}}return c},deleteButton:function(f,d,e,b,c,l,h){var g,a,m;if(h){if(!confirm(INTERMediatorOnPage.getMessages()[1025])){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();a=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",f);m=a.relation;if(m){for(index in m){if(m[index]["portal"]==true){a.portal=true}}}if(b!=""&&a.portal==true){INTERMediator_DBAdapter.db_update({name:f,conditions:[{field:d,operator:"=",value:e}],dataset:[{field:"-delete.related",operator:"=",value:b.replace("::-recid","")+"."+c}]})}else{INTERMediator_DBAdapter.db_delete({name:f,conditions:[{field:d,operator:"=",value:e}]})}if(a.relation==true){INTERMediator.pagedAllCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom=INTERMediator.startFrom-INTERMediator.pagedSize;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}if(INTERMediator.pagedAllCount>=INTERMediator.pagedSize){INTERMediator.construct()}IMLibPageNavigation.navigationSetup()}}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibUI.deleteButton(f,d,e,b,c,l,false)});return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-3")}}for(g=0;g<l.length;g++){IMLibContextPool.removeRecordFromPool(l[g])}IMLibElement.deleteNodes(l);IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},insertButton:function(q,x,w,p,v,m){var g,r,k,D,l,y,t,A,C,o,b,s=false,e,u,d,n,c,h,f,B,a;if(m){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();g=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",q);r=[],e=[];if(w!=null){for(k in g.relation){r.push({field:g.relation[k]["foreign-key"],value:w[g.relation[k]["join-field"]]})}}try{INTERMediatorOnPage.retrieveAuthInfo();t=g.relation;if(t){for(k in t){if(t[k]["portal"]==true){g.portal=true}}}if(g.portal==true){e=[];for(k in g["default-values"]){e.push({field:q+"::"+g["default-values"][k]["field"]+".0",value:g["default-values"][k]["value"]})}if(e.length==0){b="";A=INTERMediator_DBAdapter.db_query({name:q,records:1,conditions:[{field:g.key?g.key:"-recid",operator:"=",value:x}]});for(C in A.recordset[0][0]){if(C.indexOf(q+"::")>-1&&C!==q+"::-recid"){s=true;o=C;if(C==q+"::"+r[0]["field"]){b=r[0]["value"];break}if(C!=q+"::id"&&C!=q+"::"+r[0]["field"]){break}}}if(s==false){A=INTERMediator_DBAdapter.db_query({name:q,records:0,conditions:[{field:g.key?g.key:"-recid",operator:"=",value:x}]});for(C in A.recordset){if(C.indexOf(q+"::")>-1&&C!==q+"::-recid"){o=C;if(C==q+"::"+r[0]["field"]){b=r[0]["value"];break}if(C!=q+"::id"&&C!=q+"::"+r[0]["field"]){break}}}}e.push({field:o+".0",value:b})}INTERMediator_DBAdapter.db_update({name:q,conditions:[{field:g.key?g.key:"-recid",operator:"=",value:x}],dataset:e});A=INTERMediator_DBAdapter.db_query({name:q,records:1,conditions:[{field:g.key?g.key:"-recid",operator:"=",value:x}]});h={};a=-1;for(f in A.recordset[0]){if(f==Number(f)&&A.recordset[0][f][q+"::-recid"]){B=parseInt(A.recordset[0][f][q+"::-recid"],10);if(B>a){a=B;h.recordset=[];h.recordset.push(A.recordset[0][f])}}}}else{h=INTERMediator_DBAdapter.db_createRecord({name:q,dataset:r});u=h.newKeyValue}}catch(z){if(z=="_im_requath_request_"){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibUI.insertButton(q,x,w,p,v,false)});INTERMediator.flushMessage();return}else{INTERMediator.setErrorMessage(z,"EXCEPTION-4")}}d=g.key?g.key:"-recid";n=IMLibContextPool.contextFromEnclosureId(p);if(n){n.foreignValue=w;if(g.portal==true&&s==false){l=INTERMediator.additionalCondition;l[q]={field:d,operator:"=",value:x};INTERMediator.additionalCondition=l}c=[{}];c[0][d]=u;INTERMediator.constructMain(n,h.recordset)}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},clickPostOnlyButton:function(s){var w,v,e,l,y,r,g,x,B;var n,A,d,u,c,o,q;var f,t,m,a;var h=s.parentNode;while(!INTERMediatorLib.isEnclosure(h,true)){h=h.parentNode;if(!h){return}}if(INTERMediatorOnPage.processingBeforePostOnlyContext){if(!INTERMediatorOnPage.processingBeforePostOnlyContext(h)){return}}f=[];t=[];for(w=0;w<h.childNodes.length;w++){b(h.childNodes[w])}r={};for(w=0;w<f.length;w++){l=INTERMediatorLib.getLinkedElementInfo(f[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(!r[y[v]]){r[y[v]]=0}r[y[v]]++}}if(r.length<1){return}var p=-100;for(var z in r){if(p<r[z]){p=r[z];g=z;x=INTERMediatorOnPage.getContextInfo(z)}}q="";e=[];a=false;for(w=0;w<f.length;w++){l=INTERMediatorLib.getLinkedElementInfo(f[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(y[0]==g){if(x.validation){for(m in x.validation){B=x.validation[m];if(B&&B.field==y[1]){switch(B.notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(f[w]);break}}}for(m in x.validation){B=x.validation[m];if(B.field==y[1]){if(B){o=Parser.evaluate(B.rule,{value:f[w].value,target:f[w]});if(!o){a=true;switch(B.notify){case"inline":INTERMediatorLib.clearErrorMessage(f[w]);c=INTERMediatorLib.createErrorMessageNode("SPAN",B.message);f[w].parentNode.insertBefore(c,f[w].nextSibling);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(f[w]);c=INTERMediatorLib.createErrorMessageNode("DIV",B.message);f[w].parentNode.appendChild(c);break;default:q+=B.message+"\n"}if(INTERMediatorOnPage.doAfterValidationFailure!=null){INTERMediatorOnPage.doAfterValidationFailure(f[w])}}}}}}if(INTERMediatorLib.isWidgetElement(f[w])){e.push({field:y[1],value:f[w]._im_getValue()})}else{if(f[w].tagName=="SELECT"){e.push({field:y[1],value:f[w].value})}else{if(f[w].tagName=="TEXTAREA"){e.push({field:y[1],value:f[w].value})}else{if(f[w].tagName=="INPUT"){if((f[w].getAttribute("type")=="radio")||(f[w].getAttribute("type")=="checkbox")){if(f[w].checked){e.push({field:y[1],value:f[w].value})}}else{e.push({field:y[1],value:f[w].value})}}}}}}}}for(w=0;w<t.length;w++){l=INTERMediatorLib.getNamedInfo(t[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(y[0]==g){n=[];A=t[w].getElementsByTagName("INPUT");for(u=0;u<A.length;u++){d=A[u].getAttribute("type");if(d=="radio"||d=="checkbox"){if(A[u].checked){n.push(A[u].value)}}else{n.push(A[u].value)}}e.push({field:y[1],value:n.join("\n")+"\n"})}}}if(q.length>0){window.alert(q);return}if(a){return}x=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",g);INTERMediator_DBAdapter.db_createRecordWithAuth({name:g,dataset:e},function(E){var C,G,F=s,D=x,k=false;INTERMediator.flushMessage();if(INTERMediatorOnPage.processingAfterPostOnlyContext){INTERMediatorOnPage.processingAfterPostOnlyContext(F,E)}if(D["post-dismiss-message"]){G=F.parentNode;G.removeChild(F);C=document.createElement("SPAN");INTERMediatorLib.setClassAttributeToNode(C,"IM_POSTMESSAGE");C.appendChild(document.createTextNode(D["post-dismiss-message"]));G.appendChild(C);k=true}if(D["post-reconstruct"]){setTimeout(function(){INTERMediator.construct(true)},k?INTERMediator.waitSecondsAfterPostMessage*1000:0)}if(D["post-move-url"]){setTimeout(function(){location.href=D["post-move-url"]},k?INTERMediator.waitSecondsAfterPostMessage*1000:0)}});function b(D){var C,k;if(D.nodeType===1){if(INTERMediatorLib.isLinkedElement(D)){f.push(D)}else{if(INTERMediatorLib.isWidgetElement(D)){f.push(D)}else{if(INTERMediatorLib.isNamedElement(D)){t.push(D)}else{C=D.childNodes;for(k=0;k<C.length;k++){b(C[k])}}}}}}},eventUpdateHandler:function(b){IMLibLocalContext.updateAll();var a=IMLibContextPool.getContextFromName(b);INTERMediator.constructMain(a[0])},eventAddOrderHandler:function(g){var a,c,d,f,b;if(g.target){a=g.target.getAttribute("data-im")}else{a=g.srcElement.getAttribute("data-im")}c=a.split(":");if(c[0]!="_@addorder"||c.length<3){return}for(d in IMLibLocalContext.store){f=d.split(":");if(f.length>3&&f[0]=="valueofaddorder"&&f[1]==c[1]){b=IMLibLocalContext.getValue(d);if(b){IMLibLocalContext.store[d]++}}}IMLibLocalContext.setValue("valueof"+a.substring(2),1);IMLibUI.eventUpdateHandler(c[1])}};function SHA1(d){function c(h,g,k){while(0<k--){h.push(g)}}function b(h,g){return(h<<g)|(h>>>(32-g))}function e(h,g,k){return h^g^k}function a(h,g){var l=(g&65535)+(h&65535),k=(g>>>16)+(h>>>16)+(l>>>16);return((k&65535)<<16)|(l&65535)}var f="0123456789abcdef";return(function(g){var m=[],l=g.length*4,k;for(var h=0;h<l;h++){k=g[h>>2]>>((3-(h%4))*8);m.push(f.charAt((k>>4)&15)+f.charAt(k&15))}return m.join("")}((function(H,G){var F,E,D,C,B,A=H.length,r=1732584193,q=4023233417,p=2562383102,o=271733878,n=3285377520,m=[];c(m,1518500249,20);c(m,1859775393,20);c(m,2400959708,20);c(m,3395469782,20);H[G>>5]|=128<<(24-(G%32));H[(((G+65)>>9)<<4)+15]=G;for(var u=0;u<A;u+=16){F=r;E=q;D=p;C=o;B=n;for(var t=0,l=[];t<80;t++){l[t]=t<16?H[t+u]:b(l[t-3]^l[t-8]^l[t-14]^l[t-16],1);var s=(function(k,h,z,y,x){var w=(x&65535)+(k&65535)+(h&65535)+(z&65535)+(y&65535),v=(x>>>16)+(k>>>16)+(h>>>16)+(z>>>16)+(y>>>16)+(w>>>16);return((v&65535)<<16)|(w&65535)})(t<20?(function(k,h,g){return(k&h)^(~k&g)}(E,D,C)):t<40?e(E,D,C):t<60?(function(k,h,g){return(k&h)^(k&g)^(h&g)}(E,D,C)):e(E,D,C),B,m[t],l[t],b(F,5));B=C;C=D;D=b(E,30);E=F;F=s}r=a(r,F);q=a(q,E);p=a(p,D);o=a(o,C);n=a(n,B)}return[r,q,p,o,n]}((function(l){var h=[],g=255,m=l.length*8;for(var k=0;k<m;k+=8){h[k>>5]|=(l.charCodeAt(k/8)&g)<<(24-(k%32))}return h}(d)).slice(),d.length*8))))}(function(){var q=8,t="",r=0,s=function(y){var w=[],x=(1<<q)-1,A=y.length*q,z;for(z=0;z<A;z+=q){w[z>>5]|=(y.charCodeAt(z/q)&x)<<(32-q-(z%32))}return w},d=function(x){var w=[],A=x.length,z,y;for(z=0;z<A;z+=2){y=parseInt(x.substr(z,2),16);if(!isNaN(y)){w[z>>3]|=y<<(24-(4*(z%8)))}else{return"INVALID HEX STRING"}}return w},g=function(x){var w=(r)?"0123456789ABCDEF":"0123456789abcdef",B="",A=x.length*4,z,y;for(z=0;z<A;z+=1){y=x[z>>2]>>((3-(z%4))*8);B+=w.charAt((y>>4)&15)+w.charAt(y&15)}return B},m=function(x){var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C="",A=x.length*4,z,y,B;for(z=0;z<A;z+=3){B=(((x[z>>2]>>8*(3-z%4))&255)<<16)|(((x[z+1>>2]>>8*(3-(z+1)%4))&255)<<8)|((x[z+2>>2]>>8*(3-(z+2)%4))&255);for(y=0;y<4;y+=1){if(z*8+y*6<=x.length*32){C+=w.charAt((B>>6*(3-y))&63)}else{C+=t}}}return C},h=function(w,y){return(w>>>y)|(w<<(32-y))},p=function(w,y){return w>>>y},k=function(w,B,A){return(w&B)^(~w&A)},b=function(w,B,A){return(w&B)^(w&A)^(B&A)},n=function(w){return h(w,2)^h(w,13)^h(w,22)},l=function(w){return h(w,6)^h(w,11)^h(w,25)},v=function(w){return h(w,7)^h(w,18)^p(w,3)},u=function(w){return h(w,17)^h(w,19)^p(w,10)},e=function(w,B){var z=(w&65535)+(B&65535),A=(w>>>16)+(B>>>16)+(z>>>16);return((A&65535)<<16)|(z&65535)},c=function(x,w,B,A){var z=(x&65535)+(w&65535)+(B&65535)+(A&65535),y=(x>>>16)+(w>>>16)+(B>>>16)+(A>>>16)+(z>>>16);return((y&65535)<<16)|(z&65535)},a=function(x,w,C,B,A){var z=(x&65535)+(w&65535)+(C&65535)+(B&65535)+(A&65535),y=(x>>>16)+(w>>>16)+(C>>>16)+(B>>>16)+(A>>>16)+(z>>>16);return((y&65535)<<16)|(z&65535)},f=function(F,E,D){var R,Q,P,O,N,M,L,I,C,A,y,J,G,z,x,w=[],B;if(D==="SHA-224"||D==="SHA-256"){J=(((E+65)>>9)<<4)+15;x=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(D==="SHA-224"){y=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}else{y=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]}}F[E>>5]|=128<<(24-E%32);F[J]=E;B=F.length;for(G=0;G<B;G+=16){R=y[0];Q=y[1];P=y[2];O=y[3];N=y[4];M=y[5];L=y[6];I=y[7];for(z=0;z<64;z+=1){if(z<16){w[z]=F[z+G]}else{w[z]=c(u(w[z-2]),w[z-7],v(w[z-15]),w[z-16])}C=a(I,l(N),k(N,M,L),x[z],w[z]);A=e(n(R),b(R,Q,P));I=L;L=M;M=N;N=e(O,C);O=P;P=Q;Q=R;R=e(C,A)}y[0]=e(R,y[0]);y[1]=e(Q,y[1]);y[2]=e(P,y[2]);y[3]=e(O,y[3]);y[4]=e(N,y[4]);y[5]=e(M,y[5]);y[6]=e(L,y[6]);y[7]=e(I,y[7])}switch(D){case"SHA-224":return[y[0],y[1],y[2],y[3],y[4],y[5],y[6]];case"SHA-256":return y;default:return[]}},o=function(x,w){this.sha224=null;this.sha256=null;this.strBinLen=null;this.strToHash=null;if("HEX"===w){if(0!==(x.length%2)){return"TEXT MUST BE IN BYTE INCREMENTS"}this.strBinLen=x.length*4;this.strToHash=d(x)}else{if(("ASCII"===w)||("undefined"===typeof(w))){this.strBinLen=x.length*q;this.strToHash=s(x)}else{return"UNKNOWN TEXT INPUT TYPE"}}};o.prototype={getHash:function(x,w){var z=null,y=this.strToHash.slice();switch(w){case"HEX":z=g;break;case"B64":z=m;break;default:return"FORMAT NOT RECOGNIZED"}switch(x){case"SHA-224":if(null===this.sha224){this.sha224=f(y,this.strBinLen,x)}return z(this.sha224);case"SHA-256":if(null===this.sha256){this.sha256=f(y,this.strBinLen,x)}return z(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(F,E,D,B){var A,z,y,w,C,H,G=[],x=[];switch(B){case"HEX":A=g;break;case"B64":A=m;break;default:return"FORMAT NOT RECOGNIZED"}switch(D){case"SHA-224":H=224;break;case"SHA-256":H=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===E){if(0!==(F.length%2)){return"KEY MUST BE IN BYTE INCREMENTS"}z=d(F);C=F.length*4}else{if("ASCII"===E){z=s(F);C=F.length*q}else{return"UNKNOWN KEY INPUT TYPE"}}if(64<(C/8)){z=f(z,C,D);z[15]&=4294967040}else{if(64>(C/8)){z[15]&=4294967040}}for(y=0;y<=15;y+=1){G[y]=z[y]^909522486;x[y]=z[y]^1549556828}w=f(G.concat(this.strToHash),512+this.strBinLen,D);w=f(x.concat(w),512+H,D);return(A(w))}};window.jsSHA=o}());var biRadixBase=2;var biRadixBits=16;biRadixBits=biRadixBits-biRadixBits%4;var bitsPerDigit=biRadixBits;var biRadix=1<<biRadixBits;var biHalfRadix=biRadix>>>1;var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=4294967295;var biHexPerDigit=biRadixBits/4;var bigZero=biFromNumber(0);var bigOne=biFromNumber(1);var dpl10=9;var lr10=biFromNumber(1000000000);function BigInt(a){this.isNeg=false;if(a==-1){return}if(a){this.digits=new Array(a);while(a){this.digits[--a]=0}}else{this.digits=[0]}}BigInt.prototype.isZero=function(){return this.digits[0]==0&&biNormalize(this).digits.length==1};BigInt.prototype.isOne=function(){return this.digits[0]==1&&!this.isNeg&&biNormalize(this).digits.length==1};BigInt.prototype.isEqual=function(b){if(this.isNeg!=b.isNeg){return false}if(this.digits.length!=b.digits.length){return false}for(var a=this.digits.length-1;a>-1;a--){if(this.digits[a]!=b.digits[a]){return false}}return true};BigInt.prototype.blankZero=function(){this.digits.length=1;this.digits[0]=0};BigInt.prototype.blankOne=function(){this.digits.length=1;this.digits[0]=1};BigInt.prototype.blankEmpty=function(){this.digits.length=0};function biCopy(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=b.isNeg;return a}function biAbs(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=false;return a}function biMinus(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=!b.isNeg;return a}function biFromNumber(c){if(Math.abs(c)>maxInteger){return(biFromFloat(c))}var a=new BigInt();if(a.isNeg=c<0){c=-c}var b=0;while(c>0){a.digits[b++]=c&maxDigitVal;c>>>=biRadixBits}return a}function biFromFloat(d){var a=new BigInt();if(a.isNeg=d<0){d=-d}var b=0;while(d>0){var e=Math.floor(d/biRadix);a.digits[b++]=d-e*biRadix;d=e}return a}function biFromString(l,k){if(k==16){return biFromHex(l)}var a=l.charAt(0)=="-";var e=(a?1:0)-1;var m=new BigInt();var b=biCopy(bigOne);for(var d=l.length-1;d>e;d--){var f=l.charCodeAt(d);var g=charToHex(f);var h=biMultiplyDigit(b,g);m=biAdd(m,h);b=biMultiplyDigit(b,k)}m.isNeg=a;return biNormalize(m)}function biFromDecimal(a){return biFromString(a,10)}function biFromHex(e){var b=new BigInt();if(e.charAt(0)=="-"){b.isNeg=true;e=substr(e,1)}else{b.isNeg=false}var a=e.length;for(var d=a,c=0;d>0;d-=biHexPerDigit,c++){b.digits[c]=hexToDigit(e.substr(Math.max(d-biHexPerDigit,0),Math.min(d,biHexPerDigit)))}return biNormalize(b)}function reverseStr(c){var a="";for(var b=c.length-1;b>-1;b--){a+=c.charAt(b)}return a}var hexatrigesimalToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");function biToString(d,f){if(f==16){return biToHex(d)}var c=biFromNumber(f);var e=biDivideModulo(biAbs(d),c);var a=hexatrigesimalToChar[e[1].digits[0]];while(!e[0].isZero()){e=biDivideModulo(e[0],c);a+=hexatrigesimalToChar[e[1].digits[0]]}return(d.isNeg?"-":"")+reverseStr(a)}function biToDecimal(a){return biToString(a,10)}var hexToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function digitToHex(d){var b=15;var a="";for(var c=0;c<biHexPerDigit;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function digitToHexTrunk(d){if(d==0){return"0"}var b=15;var a="";for(var c=0;c<biHexPerDigit&&d>0;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function biToHex(b){var a=b.isNeg?"-":"";var c=biHighIndex(b);a+=digitToHexTrunk(b.digits[c--]);while(c>-1){a+=digitToHex(b.digits[c--])}return a}function biToNumber(b){var a=0;var d=1;var c=biHighIndex(b)+1;for(var e=0;e<c;e++){a+=b.digits[e]*d;d*=biRadix}return b.isNeg?-a:a}function charToHex(k){var d=48;var b=d+9;var e=97;var h=e+25;var g=65;var f=65+25;var a;if(k>=d&&k<=b){a=k-d}else{if(k>=g&&k<=f){a=10+k-g}else{if(k>=e&&k<=h){a=10+k-e}else{a=0}}}return a}function hexToDigit(d){var b=0;var a=Math.min(d.length,biHexPerDigit);for(var c=0;c<a;c++){b<<=4;b|=charToHex(d.charCodeAt(c))}return b}function biDump(a){return(a.isNeg?"minus ":"plus ")+a.digits.join(" ")}function biNormalize(a){var b=a.digits.length;if(a.digits[b-1]!=0&&!isNaN(a.digits[b-1])){return a}for(var c=b-1;c>0;c--){if(a.digits[c]==0||isNaN(a.digits[c])){a.digits.pop()}else{return a}}if(a.digits.length==1&&a.digits[0]==0){a.isNeg=false}if(isNaN(a.digits[0])){throw new Error("Undefined BigInt: "+biDump(a))}return a}function biHighIndex(a){biNormalize(a);return a.digits.length-1}function biNumBits(c){var f=biHighIndex(c);var e=c.digits[f];var b=(f+1)*bitsPerDigit;var a;for(a=b;a>b-bitsPerDigit;a--){if((e&biHalfRadix)!=0){break}e<<=1}return a}function biCompareAbs(b,e){var a=biHighIndex(b);var d=biHighIndex(e);if(a!=d){return 1-2*((a<d)?1:0)}for(var c=b.digits.length-1;c>-1;c--){if(b.digits[c]!=e.digits[c]){return 1-2*((b.digits[c]<e.digits[c])?1:0)}}return 0}function biCompare(a,b){if(a.isNeg!=b.isNeg){return 1-2*(a.isNeg?1:0)}return a.isNeg?-biCompareAbs(a,b):biCompareAbs(a,b)}function biAddNatural(l,h){var f=biHighIndex(l)+1;var e=biHighIndex(h)+1;var d=0;var g=0;if(f>e){var m=biAbs(l);var a=h;var b=e}else{var m=biAbs(h);var a=l;var b=f}while(d<b){m.digits[d]+=a.digits[d]+g;if(m.digits[d]<biRadix){g=0}else{m.digits[d]&=maxDigitVal;g=1}d++}while(g>0){m.digits[d]=(m.digits[d]||0)+g;if(m.digits[d]<biRadix){g=0}else{m.digits[d]&=maxDigitVal;g=1}d++}return m}function biSubtractNatural(k,h){var f=biHighIndex(k)+1;var e=biHighIndex(h)+1;var m=biAbs(k);var a=m.digits;var b=k.digits;var l=h.digits;var g=0;for(var d=0;d<e;d++){if(b[d]>=l[d]-g){a[d]=b[d]-l[d]+g;g=0}else{a[d]=biRadix+b[d]-l[d]+g;g=-1}}while(g<0&&d<f){if(b[d]>=-g){a[d]=b[d]+g;g=0}else{a[d]=biRadix+b[d]+g;g=-1}d++}return biNormalize(m)}function biAdd(b,d){var a;if(!b.isNeg&&!d.isNeg){return biAddNatural(b,d)}if(b.isNeg&&d.isNeg){a=biAddNatural(b,d);a.isNeg=true;return a}var c=biCompareAbs(b,d);if(c==0){return biFromNumber(0)}if(c>0){a=biSubtractNatural(b,d);a.isNeg=b.isNeg}if(c<0){a=biSubtractNatural(d,b);a.isNeg=d.isNeg}return a}function biSubtract(b,d){var a;if(!b.isNeg&&d.isNeg){return biAddNatural(b,d)}if(b.isNeg&&!d.isNeg){a=biAddNatural(b,d);a.isNeg=true;return a}var c=biCompareAbs(b,d);if(c==0){return biCopy(bigZero)}if(c>0){a=biSubtractNatural(b,d);a.isNeg=b.isNeg}if(c<0){a=biSubtractNatural(d,b);a.isNeg=!b.isNeg}return a}function biMultiply(o,m){var l,q,d,f;var e=biHighIndex(o)+1;var r=biHighIndex(m)+1;if(e==1&&o.digits[0]==0||r==1&&m.digits[0]==0){return new BigInt()}var s=new BigInt(e+r);var a=s.digits;var b=o.digits;var p=m.digits;for(var h=0;h<r;h++){l=0;f=h;for(var g=0;g<e;g++,f++){d=a[f]+b[g]*p[h]+l;a[f]=d&maxDigitVal;l=d>>>biRadixBits}a[h+e]=l}s.isNeg=o.isNeg!=m.isNeg;return biNormalize(s)}function biMultiplyDigit(b,h){var g=biHighIndex(b)+1;var a=new BigInt(g);var f=0;for(var d=0;d<g;d++){var e=a.digits[d]+b.digits[d]*h+f;a.digits[d]=e&maxDigitVal;f=e>>>biRadixBits}a.digits[g]=f;return a}function arrayCopy(f,h,c,g,e){if(h>=f.length){if(c.length==0){c[0]=0}return}for(var d=0;d<g;d++){c[d]=0}var a=Math.min(h+e,f.length);for(var d=h,b=g;d<a;d++,b++){c[b]=f[d]}}function biShiftLeft(b,g){var d=Math.floor(g/bitsPerDigit);var a=new BigInt();arrayCopy(b.digits,0,a.digits,d,b.digits.length);var f=g%bitsPerDigit;var c=bitsPerDigit-f;a.digits[a.digits.length]=a.digits[a.digits.length]>>>c;for(var e=a.digits.length-1;e>0;e--){a.digits[e]=((a.digits[e]<<f)&maxDigitVal)|(a.digits[e-1]>>>c)}a.digits[0]=(a.digits[0]<<f)&maxDigitVal;a.isNeg=b.isNeg;return biNormalize(a)}function biShiftRight(b,g){var c=Math.floor(g/bitsPerDigit);var a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);var e=g%bitsPerDigit;var f=bitsPerDigit-e;for(var d=0;d<a.digits.length-1;d++){a.digits[d]=(a.digits[d]>>>e)|((a.digits[d+1]<<f)&maxDigitVal)}a.digits[a.digits.length-1]>>>=e;a.isNeg=b.isNeg;return biNormalize(a)}function biMultiplyByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,c,b.digits.length);return a}function biDivideByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);return a}function biModuloByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,0,c);return a}function biMultiplyModByRadixPower(o,m,d){var l,r,e,g;var f=biHighIndex(o)+1;var s=biHighIndex(m)+1;if(f==1&&o.digits[0]==0||s==1&&m.digits[0]==0){return new BigInt()}var v=new BigInt(d);var a=v.digits;var b=o.digits;var q=m.digits;for(var h=0;h<s&&h<d;h++){l=0;g=h;for(j=0;j<f&&g<d;j++,g++){e=a[g]+b[j]*q[h]+l;a[g]=e&maxDigitVal;l=e>>>biRadixBits}a[h+f]=l}v=biModuloByRadixPower(v,d);v.isNeg=o.isNeg!=m.isNeg;return biNormalize(v)}function biDivideModuloNatural(m,k){var b,o,d,n,h;var g=biHighIndex(m);var f=biHighIndex(k);var c=new BigInt(-1);c.digits=[];var a=new BigInt();for(var e=g;e>-1;e--){a.digits.unshift(m.digits[e]);h=biCompareAbs(k,a);if(h>0){c.digits.unshift(0);continue}if(h==0){c.digits.unshift(1);a.blankZero();continue}var l=biHighIndex(a);if(l==f){d=Math.floor((a.digits[l]*biRadix+(a.digits[l-1]||0))/(k.digits[f]*biRadix+(k.digits[f-1]||0)+1))}else{d=Math.floor((a.digits[l]*biRadixSquared+(a.digits[l-1]||0)*biRadix+(a.digits[l-2]||0))/(k.digits[f]*biRadix+(k.digits[f-1]||0)+1))}d=Math.max(0,Math.min(d,maxDigitVal));n=biMultiplyDigit(k,d);a=biSubtract(a,n);if(a.isNeg){while(a.isNeg){a=biAdd(a,k);d--}}else{while(biCompare(a,k)>=0){a=biSubtract(a,k);d++}}c.digits.unshift(d)}return[biNormalize(c),biNormalize(a)]}function biDivideModulo(c,g){var f,e;if(biCompareAbs(c,g)<0){if((c.isNeg&&g.isNeg)||(!c.isNeg&&!g.isNeg)){f=biFromNumber(0);e=biCopy(c)}else{f=biFromNumber(-1);e=biAdd(g,c)}return[f,e]}var d=c.isNeg;var b=g.isNeg;var a=biDivideModuloNatural(biAbs(c),biAbs(g));f=a[0];e=a[1];if(!d&&!b){return[f,e]}else{if(d&&b){e.isNeg=true;return[f,e]}else{f.isNeg=true;f=biSubtract(f,bigOne);e.isNeg=d;e=biAdd(e,g)}}if(e.digits[0]==0&&biHighIndex(e)==0){e.isNeg=false}return[f,e]}function biDivide(a,b){return biDivideModulo(a,b)[0]}function biModulo(a,b){return biDivideModulo(a,b)[1]}function biMultiplyMod(b,c,a){return biModulo(biMultiply(b,c),a)}function biPow(c,e){var b=biCopy(bigOne);var d=c;while(true){if((e&1)!=0){b=biMultiply(b,d)}e>>>=1;if(e==0){break}d=biMultiply(d,d)}return b}function biPowMod(d,g,c){var b=biCopy(bigOne);var e=d;var f=g;while(true){if((f.digits[0]&1)!=0){b=biMultiplyMod(b,e,c)}f=biShiftRight(f,1);if(f.digits[0]==0&&biHighIndex(f)==0){break}e=biMultiplyMod(e,e,c)}return b}function biRandom(b){var a=new BigInt();while(b--){a.digits[b]=Math.floor(Math.random()*maxDigitVal)}return a}function biModularInverse(c,b){c=biModulo(c,b);var a=biExtendedEuclid(b,c);if(!a[2].isOne()){return null}return biModulo(a[1],b)}function biExtendedEuclid(e,d){if(biCompare(e,d)>=0){return biExtendedEuclidNatural(e,d)}var c=biExtendedEuclidNatural(d,e);return[c[1],c[0],c[2]]}function biExtendedEuclidNatural(o,l){var k,d,c,f,e,n,h,m,g;if(l.isZero()){return[biFromNumber(1),biFromNumber(0),o]}f=biFromNumber(0);e=biFromNumber(1);n=biFromNumber(1);h=biFromNumber(0);while(!l.isZero()){k=biDivideModulo(o,l);d=k[0];c=k[1];m=biSubtract(e,biMultiply(d,f));g=biSubtract(h,biMultiply(d,n));o=l;l=c;e=f;f=m;h=n;n=g}return[e,h,o]}function biMontgomeryPowMod(c,e,f){var b=biFromNumber(1);var a=biModulo(biMultiply(c,f.R),f);for(var d=e.bin.length-1;d>-1;d--){if(e.bin.charAt(d)=="1"){b=biMultiply(b,a);b=biMontgomeryModulo(b,f)}a=biMultiply(a,a);a=biMontgomeryModulo(a,f)}return b}function biMontgomeryModulo(b,c){var a=biModuloByRadixPower(b,c.nN);a=biMultiplyModByRadixPower(a,c.Ninv,c.nN);a=biMultiply(a,c);a=biAdd(b,a);a=biDivideByRadixPower(a,c.nN);while(biCompare(a,c)>=0){a=biSubtract(a,c)}return a}function biRSAKeyPair(b,c,a){this.e=biFromHex(b);this.d=biFromHex(c);this.m=biFromHex(a);this.chunkSize=2*biHighIndex(this.m);this.radix=16;this.m.nN=biHighIndex(this.m)+1;this.m.R=biMultiplyByRadixPower(biFromNumber(1),this.m.nN);this.m.EGCD=biExtendedEuclid(this.m.R,this.m);this.m.Ri=this.m.EGCD[0];this.m.Rinv=biModulo(this.m.EGCD[0],this.m);this.m.Ni=biMinus(this.m.EGCD[1]);this.m.Ninv=biModulo(biMinus(this.m.EGCD[1]),this.m.R);this.e.bin=biToString(this.e,2);this.d.bin=biToString(this.d,2)}biRSAKeyPair.prototype.biEncryptedString=biEncryptedString;biRSAKeyPair.prototype.biDecryptedString=biDecryptedString;function biEncryptedString(h){h=biUTF8Encode(h);h=h.replace(/[\x00]/gm,String.fromCharCode(255));h=h+String.fromCharCode(254);var a=h.length;h=h+biRandomPadding(this.chunkSize-a%this.chunkSize);var a=h.length;var l="";var e,d,c,b;b=new BigInt();for(var e=0;e<a;e+=this.chunkSize){b.blankZero();d=0;for(c=e;c<e+this.chunkSize&&c<a;++d){b.digits[d]=h.charCodeAt(c++);b.digits[d]+=(h.charCodeAt(c++)||0)<<8}var g=biMontgomeryPowMod(b,this.e,this.m);var f=biToHex(g);l+=f+","}return l.substring(0,l.length-1)}function biDecryptedString(e){var g=e.split(",");var a="";var d,c,f;for(d=0;d<g.length;++d){var b;b=biFromHex(g[d],10);f=biMontgomeryPowMod(b,this.d,this.m);for(c=0;c<=biHighIndex(f);++c){a+=String.fromCharCode(f.digits[c]&255,f.digits[c]>>8)}}a=a.replace(/\xff/gm,String.fromCharCode(0));a=a.substr(0,a.lastIndexOf(String.fromCharCode(254)));return biUTF8Decode(a)}function biUTF8Encode(d){var b="";var a=d.length;for(var f=0;f<a;f++){var e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b}function biUTF8Decode(e){var d="";var a=e.length;var b;for(var g=0;g<a;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f);b=0}else{if((f>191)&&(f<224)){b=((f&31)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}else{b=((f&15)<<12);f=e.charCodeAt(++g);b+=((f&63)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}}}return d}function biRandomPadding(c){var a="";for(var b=0;b<c;b++){a=a+String.fromCharCode(Math.floor(Math.random()*126)+1)}return a}var INTERMediator_DBAdapter;INTERMediator_DBAdapter={eliminateDuplicatedConditions:false,degubMessage:false,generate_authParams:function(){var b="",c,a;if(INTERMediatorOnPage.authUser.length>0){b="&clientid="+encodeURIComponent(INTERMediatorOnPage.clientId);b+="&authuser="+encodeURIComponent(INTERMediatorOnPage.authUser);if(INTERMediatorOnPage.isNativeAuth||INTERMediatorOnPage.isLDAP){if(INTERMediatorOnPage.authCryptedPassword&&INTERMediatorOnPage.authChallenge){b+="&cresponse="+encodeURIComponent(INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+"\n"+INTERMediatorOnPage.authChallenge));if(INTERMediator_DBAdapter.degubMessage){INTERMediator.setDebugMessage("generate_authParams/authCryptedPassword="+INTERMediatorOnPage.authCryptedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&cresponse=dummy"}}if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){c=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=c.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");b+="&response="+encodeURIComponent(a);if(INTERMediator_DBAdapter.degubMessage){INTERMediator.setDebugMessage("generate_authParams/authHashedPassword="+INTERMediatorOnPage.authHashedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&response=dummy"}}b+="&notifyid=";b+=encodeURIComponent(INTERMediatorOnPage.clientNotificationIdentifier());b+=("&pusher="+(INTERMediator.pusherAvailable?"yes":""));return b},store_challenge:function(a){if(a!==null){INTERMediatorOnPage.authChallenge=a.substr(0,24);INTERMediatorOnPage.authUserHexSalt=a.substr(24,32);INTERMediatorOnPage.authUserSalt=String.fromCharCode(parseInt(a.substr(24,2),16),parseInt(a.substr(26,2),16),parseInt(a.substr(28,2),16),parseInt(a.substr(30,2),16));if(INTERMediator_DBAdapter.degubMessage){INTERMediator.setDebugMessage("store_challenge/authChallenge="+INTERMediatorOnPage.authChallenge);INTERMediator.setDebugMessage("store_challenge/authUserHexSalt="+INTERMediatorOnPage.authUserHexSalt);INTERMediator.setDebugMessage("store_challenge/authUserSalt="+INTERMediatorOnPage.authUserSalt)}}},logging_comAction:function(a,d,c,b){INTERMediator.setDebugMessage(INTERMediatorOnPage.getMessages()[a]+"Accessing:"+decodeURI(d)+", Parameters:"+decodeURI(c+b))},logging_comResult:function(c,k,a,d,h,l,b,f,e){var g;if(INTERMediator.debugMode>1){if(c.responseText.length>1000){g=c.responseText.substr(0,1000)+" ...[trancated]"}else{g=c.responseText}INTERMediator.setDebugMessage("myRequest.responseText="+g);INTERMediator.setDebugMessage("Return: resultCount="+k+", dbresult="+INTERMediatorLib.objectToString(a)+"\nReturn: requireAuth="+d+", challenge="+h+", clientid="+l+"\nReturn: newRecordKeyValue="+b+", changePasswordResult="+f+", mediatoken="+e)}},server_access:function(h,d,f){var m="",c="",r=0,u=null,w=null,t=null,o=false,n=null,x=null,l=null,k,b,g,s,q=false,p=false,a="";k=INTERMediatorOnPage.getEntryPath();b=INTERMediator_DBAdapter.generate_authParams();INTERMediator_DBAdapter.logging_comAction(d,k,h,b);INTERMediatorOnPage.notifySupport=q;try{n=new XMLHttpRequest();n.open("POST",k,false,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);n.setRequestHeader("charset","utf-8");n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(h+b);g=JSON.parse(n.responseText);r=g.resultCount?g.resultCount:0;u=g.totalCount?g.totalCount:null;c=g.dbresult?g.dbresult:null;o=g.requireAuth?g.requireAuth:false;w=g.challenge?g.challenge:null;t=g.clientid?g.clientid:null;m=g.newRecordKeyValue?g.newRecordKeyValue:"";x=g.changePasswordResult?g.changePasswordResult:null;l=g.mediatoken?g.mediatoken:null;q=g.notifySupport;for(s=0;s<g.errorMessages.length;s++){INTERMediator.setErrorMessage(g.errorMessages[s])}for(s=0;s<g.debugMessages.length;s++){INTERMediator.setDebugMessage(g.debugMessages[s])}p=g.usenull;a=g.hasOwnProperty("registeredid")?g.registeredid:"";INTERMediator_DBAdapter.logging_comResult(n,r,c,o,w,t,m,x,l);INTERMediator_DBAdapter.store_challenge(w);if(t!==null){INTERMediatorOnPage.clientId=t}if(l!==null){INTERMediatorOnPage.mediaToken=l}if(INTERMediatorOnPage.authUserHexSalt!=INTERMediatorOnPage.authHashedPassword.substr(-8,8)){if(h!="access=challenge"){o=true}}}catch(v){INTERMediator.setErrorMessage(v,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[f],[v,n.responseText]))}if(o){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();throw"_im_requath_request_"}if(!h.match(/access=challenge/)){INTERMediatorOnPage.authCount=0}INTERMediatorOnPage.storeCredencialsToCookie();INTERMediatorOnPage.notifySupport=q;return{dbresult:c,resultCount:r,totalCount:u,newRecordKeyValue:m,newPasswordResult:x,registeredId:a,nullAcceptable:p}},changePassowrd:function(h,c,f){var b,g,a;if(h&&c){INTERMediatorOnPage.authUser=h;if(h!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";b=INTERMediator_DBAdapter.getChallenge();if(!b){INTERMediator.flushMessage();return false}}INTERMediatorOnPage.authHashedPassword=SHA1(c+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt}else{INTERMediatorOnPage.retrieveAuthInfo()}g="access=changepassword&newpass="+INTERMediatorLib.generatePasswordHash(f);try{a=INTERMediator_DBAdapter.server_access(g,1029,1030);if(a.newPasswordResult&&a.newPasswordResult===true){INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(f);INTERMediatorOnPage.authHashedPassword=SHA1(f+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;INTERMediatorOnPage.storeCredencialsToCookie()}}catch(d){return false}return(a.newPasswordResult&&a.newPasswordResult===true)},getChallenge:function(){try{this.server_access("access=challenge",1027,1028)}catch(a){if(a=="_im_requath_request_"){throw a}else{INTERMediator.setErrorMessage(a,"EXCEPTION-19")}}if(INTERMediatorOnPage.authChallenge===null){return false}return true},uploadFile:function(c,n,m){var k="",b="",r=0,w=null,t=null,p=false,o=null,x=null,h=null,g,a,f,d,s;g=INTERMediatorOnPage.getEntryPath();a=INTERMediator_DBAdapter.generate_authParams();f="access=uploadfile"+c;INTERMediator_DBAdapter.logging_comAction(1031,g,f,a);try{o=new XMLHttpRequest();o.open("POST",g,true,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);o.setRequestHeader("charset","utf-8");var v=(f+a).split("&");var l=new FormData();for(var s=0;s<v.length;s++){var q=v[s].split("=");l.append(q[0],decodeURIComponent(q[1]))}l.append("_im_uploadfile",n.content);o.onreadystatechange=function(){switch(o.readyState){case 3:break;case 4:try{d=JSON.parse(o.responseText)}catch(e){INTERMediator.setErrorMessage(e,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],["",""]));INTERMediator.flushMessage();break}r=d.resultCount?d.resultCount:0;b=d.dbresult?d.dbresult:null;p=d.requireAuth?d.requireAuth:false;w=d.challenge?d.challenge:null;t=d.clientid?d.clientid:null;k=d.newRecordKeyValue?d.newRecordKeyValue:"";x=d.changePasswordResult?d.changePasswordResult:null;h=d.mediatoken?d.mediatoken:null;for(s=0;s<d.errorMessages.length;s++){INTERMediator.setErrorMessage(d.errorMessages[s])}for(s=0;s<d.debugMessages.length;s++){INTERMediator.setDebugMessage(d.debugMessages[s])}INTERMediator_DBAdapter.logging_comResult(o,r,b,p,w,t,k,x,h);INTERMediator_DBAdapter.store_challenge(w);if(t!==null){INTERMediatorOnPage.clientId=t}if(h!==null){INTERMediatorOnPage.mediaToken=h}if(p){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();throw"_im_requath_request_"}INTERMediatorOnPage.authCount=0;INTERMediatorOnPage.storeCredencialsToCookie();m(b);break}};o.send(l)}catch(u){INTERMediator.setErrorMessage(u,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],[u,o.responseText]))}},db_query:function(d){var a=true,u,h,y,c,n,B,m,g,z,q,f,b,t=10000000,k,o,v;if(d.name===null||d.name===""){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1005));a=false}if(!a){return}if(d.records===null){y="access=read&name="+encodeURIComponent(d.name)}else{c=INTERMediatorOnPage.getDBSpecification();if(parseInt(d.records,10)===0&&c["db-class"]!==null&&c["db-class"]==="FileMaker_FX"){y="access=describe&name="+encodeURIComponent(d.name)}else{y="access=read&name="+encodeURIComponent(d.name)}if(Boolean(d.uselimit)===true&&parseInt(d.records,10)>=INTERMediator.pagedSize&&parseInt(INTERMediator.pagedSize,10)>0){t=INTERMediator.pagedSize}else{t=d.records}}if(d.primaryKeyOnly){y+="&pkeyonly=true"}if(d.fields){for(u=0;u<d.fields.length;u++){y+="&field_"+u+"="+encodeURIComponent(d.fields[u])}}n=0;if(d.parentkeyvalue){for(h in d.parentkeyvalue){if(d.parentkeyvalue.hasOwnProperty(h)){y+="&foreign"+n+"field="+encodeURIComponent(h);y+="&foreign"+n+"value="+encodeURIComponent(d.parentkeyvalue[h]);n++}}}if(d.useoffset&&INTERMediator.startFrom!==null){y+="&start="+encodeURIComponent(INTERMediator.startFrom)}B=0;k=[];while(d.conditions&&d.conditions[B]){o=d.conditions[B]["field"]+"#"+d.conditions[B]["operator"]+"#"+d.conditions[B]["value"];if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||k.indexOf(o)<0){y+="&condition"+B;y+="field="+encodeURIComponent(d.conditions[B]["field"]);y+="&condition"+B;y+="operator="+encodeURIComponent(d.conditions[B]["operator"]);y+="&condition"+B;y+="value="+encodeURIComponent(d.conditions[B]["value"]);k.push(o)}B++}m=INTERMediator.additionalCondition[d.name];if(m){if(m.field){m=[m]}for(h=0;h<m.length;h++){if(m[h]&&m[h]["field"]){if(m[h]["value"]||m[h]["field"]=="__operation__"){o=m[h]["field"]+"#"+((m[h]["operator"]!==undefined)?m[h]["operator"]:"")+"#"+((m[h]["value"]!==undefined)?m[h]["value"]:"");if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||k.indexOf(o)<0){y+="&condition"+B;y+="field="+encodeURIComponent(m[h]["field"]);if(m[h]["operator"]!==undefined){y+="&condition"+B;y+="operator="+encodeURIComponent(m[h]["operator"])}if(m[h]["value"]!==undefined){y+="&condition"+B;y+="value="+encodeURIComponent(m[h]["value"])}if(m[h]["field"]!="__operation__"){k.push(o)}else{}}B++}}}}b=0;g=INTERMediator.additionalSortKey[d.name];if(g){if(g.field){g=[g]}for(h=0;h<g.length;h++){y+="&sortkey"+b;y+="field="+encodeURIComponent(g[h]["field"]);y+="&sortkey"+b;y+="direction="+encodeURIComponent(g[h]["direction"]);b++}}var e={};for(var A in IMLibLocalContext.store){var s=new String(IMLibLocalContext.store[A]);var x=A.split(":");if(x&&x.length>1&&x[1].trim()==d.name&&s.length>0){if(x[0].trim()=="condition"&&x.length>=4){var r=x[2].split(",");var l=x[3].trim();if(r.length>1){y+="&condition"+B+"field=__operation__";y+="&condition"+B+"operator=ex";B++}for(var h=0;h<r.length;h++){o=r[h].trim()+"#"+l+"#"+s;if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||k.indexOf(o)<0){y+="&condition"+B+"field="+encodeURIComponent(r[h].trim());y+="&condition"+B+"operator="+encodeURIComponent(l);y+="&condition"+B+"value="+encodeURIComponent(s);k.push(o)}B++}}else{if(x[0].trim()=="valueofaddorder"&&x.length>=4){e[parseInt(s)]=[x[2].trim(),x[3].trim()]}else{if(x[0].trim()=="limitnumber"&&x.length>=4){t=parseInt(s)}}}}}y+="&records="+encodeURIComponent(t);var p=Object.keys(e);for(var u=0;u<p.length;u++){y+="&sortkey"+b+"field="+encodeURIComponent(e[p[u]][0]);y+="&sortkey"+b+"direction="+encodeURIComponent(e[p[u]][1]);b++}INTERMediator_DBAdapter.eliminateDuplicatedConditions=false;z={};try{q=this.server_access(y,1012,1004);z.recordset=q.dbresult;z.totalCount=q.resultCount;z.count=0;z.registeredId=q.registeredId;z.nullAcceptable=q.nullAcceptable;for(f in q.dbresult){z.count++}v=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",d.name);if(!v.relation&&d.paging&&Boolean(d.paging)===true){INTERMediator.pagedAllCount=parseInt(q.resultCount,10);if(q.totalCount){INTERMediator.totalRecordCount=parseInt(q.totalCount,10)}}if((d.paging!==null)&&(Boolean(d.paging)===true)){INTERMediator.pagination=true;if(!(Number(d.records)>=Number(INTERMediator.pagedSize)&&Number(INTERMediator.pagedSize)>0)){INTERMediator.pagedSize=parseInt(d.records,10)}}}catch(w){if(w=="_im_requath_request_"){throw w}else{INTERMediator.setErrorMessage(w,"EXCEPTION-17")}z.recordset=null;z.totalCount=0;z.count=0;z.registeredid=null;z.nullAcceptable=null}return z},db_queryWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_query(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_queryWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-16")}}a(d)},db_update:function(g){var b=true,d,h,k,a,f,e;if(g.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1007));b=false}if(g.dataset===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1011));b=false}if(!b){return}d="access=update&name="+encodeURIComponent(g.name);a=0;if(INTERMediator.additionalFieldValueOnUpdate&&INTERMediator.additionalFieldValueOnUpdate[g.name]){e=INTERMediator.additionalFieldValueOnUpdate[g.name];if(e.field){e=[e]}for(f in e){var c=e[f];d+="&field_"+a+"="+encodeURIComponent(c.field);d+="&value_"+a+"="+encodeURIComponent(c.value);a++}}if(g.conditions!=null){for(h=0;h<g.conditions.length;h++){d+="&condition"+h+"field=";d+=encodeURIComponent(g.conditions[h]["field"]);d+="&condition"+h+"operator=";d+=encodeURIComponent(g.conditions[h]["operator"]);if(g.conditions[h]["value"]){d+="&condition"+h+"value=";d+=encodeURIComponent(g.conditions[h]["value"])}}}for(h=0;h<g.dataset.length;h++){d+="&field_"+(a+h)+"="+encodeURIComponent(g.dataset[h]["field"]);if(INTERMediator.isTrident&&INTERMediator.ieVersion==8){d+="&value_"+(a+h)+"="+encodeURIComponent(g.dataset[h]["value"].replace(/\n/g,""))}else{d+="&value_"+(a+h)+"="+encodeURIComponent(g.dataset[h]["value"])}}k=this.server_access(d,1013,1014);return k.dbresult},db_updateWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_update(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_updateWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-15")}}a(d)},db_delete:function(h){var b=true,d,e,k,a,g,f;if(h.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));b=false}if(h.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));b=false}if(!b){return}d="access=delete&name="+encodeURIComponent(h.name);a=0;if(INTERMediator.additionalFieldValueOnDelete&&INTERMediator.additionalFieldValueOnDelete[h.name]){f=INTERMediator.additionalFieldValueOnDelete[h.name];if(f.field){f=[f]}for(g in f){var c=f[g];d+="&field_"+a+"="+encodeURIComponent(c.field);d+="&value_"+a+"="+encodeURIComponent(c.value);a++}}for(e=0;e<h.conditions.length;e++){d+="&condition"+e+"field="+encodeURIComponent(h.conditions[e]["field"]);d+="&condition"+e+"operator="+encodeURIComponent(h.conditions[e]["operator"]);d+="&condition"+e+"value="+encodeURIComponent(h.conditions[e]["value"])}k=this.server_access(d,1017,1015);INTERMediator.flushMessage();return k},db_deleteWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_delete(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_deleteWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},db_createRecord:function(k){var e,f,m,h,g,a,b,d,l;if(k.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1021));return}d=INTERMediatorOnPage.getDataSources();b=null;for(l in d){if(d[l]["name"]==k.name){b=l;break}}if(b===null){alert("no targetname :"+k.name);return}e="access=new&name="+encodeURIComponent(k.name);a=0;if(INTERMediator.additionalFieldValueOnNewRecord&&INTERMediator.additionalFieldValueOnNewRecord[k.name]){g=INTERMediator.additionalFieldValueOnNewRecord[k.name];if(g.field){g=[g]}for(h in g){var c=g[h];e+="&field_"+a+"="+encodeURIComponent(c.field);e+="&value_"+a+"="+encodeURIComponent(c.value);a++}}for(f=0;f<k.dataset.length;f++){e+="&field_"+a+"="+encodeURIComponent(k.dataset[f]["field"]);e+="&value_"+a+"="+encodeURIComponent(k.dataset[f]["value"]);a++}m=this.server_access(e,1018,1016);INTERMediator.flushMessage();return{newKeyValue:m.newRecordKeyValue,recordset:m.dbresult}},db_createRecordWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_createRecord(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_createRecordWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-13")}}if(a){a(d.newKeyValue)}},db_copy:function(c){var b=true,e,d,a;if(c.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));b=false}if(c.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));b=false}if(!b){return}e="access=copy&name="+encodeURIComponent(c.name);for(d=0;d<c.conditions.length;d++){e+="&condition"+d+"field="+encodeURIComponent(c.conditions[d]["field"]);e+="&condition"+d+"operator="+encodeURIComponent(c.conditions[d]["operator"]);e+="&condition"+d+"value="+encodeURIComponent(c.conditions[d]["value"])}if(c.associated){for(d=0;d<c.associated.length;d++){e+="&assoc"+d+"="+encodeURIComponent(c.associated[d]["name"]);e+="&asfield"+d+"="+encodeURIComponent(c.associated[d]["field"]);e+="&asvalue"+d+"="+encodeURIComponent(c.associated[d]["value"])}}a=this.server_access(e,1017,1015);INTERMediator.flushMessage();return{newKeyValue:a.newRecordKeyValue,recordset:a.dbresult}},db_copyWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_delete(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.authChallenge=null;INTERMediatorOnPage.authHashedPassword=null;INTERMediatorOnPage.authCryptedPassword=null;INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_deleteWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},unregister:function(b){var a=null,c;if(INTERMediatorOnPage.clientNotificationKey){var d=INTERMediatorOnPage.clientNotificationKey();if(d&&d!="_im_key_isnt_supplied"){c="access=unregister";if(b){c+="&pks="+encodeURIComponent(JSON.stringify(b))}a=this.server_access(c,1018,1016);return a}}}};var Parser=(function(aM){var ai=0;var ad=1;var ac=2;var ab=5;var aR=65;var aj=3;var D=4;ap.regFirstVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_]");ap.regRestVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_0-9]");function aO(bh,bj,bi,bk){this.type_=bh;this.index_=bj||0;this.prio_=bi||0;this.number_=(bk!==undefined&&bk!==null)?bk:0;this.toString=function(){switch(this.type_){case ai:return this.number_;case ad:case ac:case ab:case aj:return this.index_;case D:return"CALL";case aR:return"SEPARATOR";default:return"Invalid Token"}}}function aW(bl,bj,bi,bk,bh,bm){this.tokens=bl}var aS=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var R={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function ag(bh){if(typeof bh==="string"){aS.lastIndex=0;return aS.test(bh)?"'"+bh.replace(aS,function(bi){var bj=R[bi];return typeof bj==="string"?bj:"\\u"+("0000"+bi.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+bh+"'"}return bh}aW.prototype={simplify:function(bq){bq=bq||{};var bk=[];var bj=[];var bo;var bn;var bl;var bm;var bp=this.tokens.length;var br;var bi=0;for(bi=0;bi<bp;bi++){br=this.tokens[bi];var bh=br.type_;if(bh===ai){bk.push(br)}else{if(bh===aj&&(br.index_ in bq)){br=new aO(ai,0,0,bq[br.index_]);bk.push(br)}else{if(bh===ab&&bk.length>2){bl=bk.pop();bn=bk.pop();bo=bk.pop();bm=ap.ops3[br.index_];br=new aO(ai,0,0,bm(bo.number_,bn.number_,bl.number_));bk.push(br)}else{if(bh===ac&&bk.length>1){bn=bk.pop();bo=bk.pop();bm=ap.ops2[br.index_];br=new aO(ai,0,0,bm(bo.number_,bn.number_));bk.push(br)}else{if(bh===ad&&bk.length>0){bo=bk.pop();bm=ap.ops1[br.index_];br=new aO(ai,0,0,bm(bo.number_));bk.push(br)}else{while(bk.length>0){bj.push(bk.shift())}bj.push(br)}}}}}}while(bk.length>0){bj.push(bk.shift())}return new aW(bj)},substitute:function(bi,bq){if(!(bq instanceof aW)){bq=new ap().parse(String(bq))}var bn=[];var bp=this.tokens.length;var br;var bk=0;for(bk=0;bk<bp;bk++){br=this.tokens[bk];var bl=br.type_;if(bl===aj&&br.index_===bi){for(var bj=0;bj<bq.tokens.length;bj++){var bm=bq.tokens[bj];var bh=new aO(bm.type_,bm.index_,bm.prio_,bm.number_);bn.push(bh)}}else{bn.push(br)}}var bo=new aW(bn);return bo},evaluate:function(bp){bp=bp||{};var bj=[];var bn;var bm;var bk;var bl;var bo=this.tokens.length;var bq;var bi=0;for(bi=0;bi<bo;bi++){bq=this.tokens[bi];var bh=bq.type_;if(bh===ai){bj.push(bq.number_)}else{if(bh===ab){bk=bj.pop();bm=bj.pop();bn=bj.pop();bl=ap.ops3Trail[bq.index_];bj.push(bl(bn,bm,bk))}else{if(bh===ac){bm=bj.pop();bn=bj.pop();bl=ap.ops2[bq.index_];bj.push(bl(bn,bm))}else{if(bh===aj){if(bq.index_ in bp){bj.push(bp[bq.index_])}else{if(bq.index_ in ap.functions){bj.push(ap.functions[bq.index_])}else{throw new Error("undefined variable: "+bq.index_)}}}else{if(bh===ad){bn=bj.pop();bl=ap.ops1[bq.index_];bj.push(bl(bn))}else{if(bh===aR){bm=bj.pop();bn=bj.pop();bj.push([bn,bm])}else{if(bh===D){bn=bj.pop();bl=bj.pop();if(bl.apply&&bl.call){if(Object.prototype.toString.call(bn)=="[object Array]"){bj.push(bl.apply(undefined,bn))}else{bj.push(bl.call(undefined,bn))}}else{throw new Error(bl+" is not a function")}}else{throw new Error("invalid Expression")}}}}}}}}if(bj.length>1){throw new Error("invalid Expression (parity)")}return bj[0]},variables:function(){var bh=this.tokens.length;var bk=[];for(var bi=0;bi<bh;bi++){var bj=this.tokens[bi];if(bj.type_===aj&&(bk.indexOf(bj.index_)==-1)&&!(bj.index_ in ap.functions)){bk.push(bj.index_)}}return bk}};function ay(bj,bh,bm){var bl,bk,bi;bl=(bj instanceof Array)?arguments[0][0]:arguments[0];bk=(bh instanceof Array)?arguments[1][0]:arguments[1];bi=(bh instanceof Array)?arguments[2][0]:arguments[2];return bl?bk:bi}function av(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)>Number(bj)}return bi>bh}function r(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)<Number(bj)}return bi<bh}function P(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)>=Number(bj)}return bi>=bh}function g(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)<=Number(bj)}return bi<=bh}function a6(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)==Number(bj)}return bi==bh}function aw(bi,bh){var bk,bj;bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bk)){return Number(bk)!=Number(bj)}return bi!=bh}function aq(bh){return bh!==bh}function z(bi,bh){var bk,bj;if(aq(bi)||aq(bh)){return NaN}bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bj)){return Number(bk)+Number(bj)}return bi+bh}function aB(bi,bh){return String(bi)+String(bh)}function a0(bi,bh){var bk,bj,bl,bm;if(aq(bi)||aq(bh)){return NaN}bk=y(bi);bj=y(bh);if(!isNaN(bk)&&!isNaN(bj)){return bk-bj}bl=String(bi);do{bm=bl.indexOf(bh);if(bm>-1){bl=bl.substr(0,bm)+bl.substr(bm+bh.length)}}while(bm>-1);return bl}function b(bi,bh){if(aq(bi)||aq(bh)){return NaN}bi=y(bi);bh=y(bh);return bi*bh}function x(bi,bh){if(aq(bi)||aq(bh)){return NaN}bi=y(bi);bh=y(bh);return bi/bh}function c(bi,bh){if(aq(bi)||aq(bh)){return NaN}bi=y(bi);bh=y(bh);return bi%bh}function az(bh){if(aq(bh)){return NaN}bh=y(bh);return -bh}function aD(bh){bh=y(bh);return Math.random()*(bh||1)}function am(bi){if(aq(bi)){return NaN}bi=y(bi);bi=Math.floor(bi);var bh=bi;while(bi>1){bh=bh*(--bi)}return bh}function O(bh){bh=y(bh);return !bh}function bg(bi,bh){bi=y(bi);bh=y(bh);return bi&&bh}function I(bi,bh){bi=y(bi);bh=y(bh);return bi||bh}function aP(bj,bi,bn,bm,bl){var bh=0,bk;for(bk=0;bk<arguments.length;bk++){bh+=y(arguments[bk])}return bh}function ao(bj,bi,bo,bn,bm){var bh=0,bk,bl=0;for(bk=0;bk<arguments.length;bk++){bh+=y(arguments[bk]);bl++}return bh/bl}function V(bj,bi,bn,bm,bl){var bh="",bk;for(bk=0;bk<arguments.length;bk++){bh+=String(arguments[bk]);bh+="\n"}return bh}function Q(bi,bh){if(bh==undefined){return Math.round(bi)}else{bi=(bi instanceof Array)?bi.join():bi;bh=(bh instanceof Array)?bh.join():bh;return INTERMediatorLib.Round(bi,bh)}}function l(bh){if(bh==undefined||bh==null){return 0}else{bh=(bh instanceof Array)?bh.join():bh;return(new String(bh)).length}}ap.regExDigitSeparator=new RegExp(INTERMediatorLib.digitSeparator()[1],"g");function y(bi){var bh;if(bi===undefined){return NaN}if(bi===true){return true}if(bi===false){return false}if(bi==""){return 0}bh=bi;if(INTERMediatorLib.is_array(bi)){if(bi.length<1){return 0}else{bh=bi[0]}}if(bh.replace){bh=bh.replace(ap.regExDigitSeparator,"")}else{bh=bh}bh=parseFloat(bh);if(isNaN(bh)){return NaN}return bh}function E(bi,bh){return Math.sqrt(bi*bi+bh*bh)}function W(bi,bh){if(Object.prototype.toString.call(bi)!="[object Array]"){return[bi,bh]}bi=bi.slice();bi.push(bh);return bi}function au(bj,bi){var bl,bk,bm,bh="";bl=(bj instanceof Array)?bj.join():bj;bk=(bi instanceof Array)?bi.join():bi;for(bm=0;bm<bl.length;bm++){if(bk.indexOf(bl.substr(bm,1))>-1){bh+=bl.substr(bm,1)}}return bh}function q(bj,bi){var bl,bk,bm,bh="";bl=(bj instanceof Array)?bj.join():bj;bk=(bi instanceof Array)?bi.join():bi;for(bm=0;bm<bk.length;bm++){if(bl.indexOf(bk.substr(bm,1))<0){bh+=bk.substr(bm,1)}}return bl+bh}function al(bj,bi){var bl,bk,bm,bh="";bl=(bj instanceof Array)?bj.join():bj;bk=(bi instanceof Array)?bi.join():bi;for(bm=0;bm<bl.length;bm++){if(bk.indexOf(bl.substr(bm,1))<0){bh+=bl.substr(bm,1)}}return bh}function aH(bn,bm){var bj,bi,bp,bo,bl,bk,bh="\n";bj=(bn instanceof Array)?bn.join():bn;bk=[bj.indexOf("\r\n"),bj.indexOf("\r"),bj.indexOf("\n")];for(bl=0;bl<bk.length;bl++){bk[bl]=(bk[bl]<0)?bj.length:bk[bl]}if(bk[0]<bj.length&&bk[0]<=bk[1]&&bk[0]<bk[2]){bh="\r\n"}else{if(bk[1]<bj.length&&bk[1]<bk[0]&&bk[1]<bk[2]){bh="\r"}}bp=bj.replace("\r\n","\n").replace("\r","\n").split("\n");bi=(bm instanceof Array)?bm.join():bm;bo=bi.replace("\r\n","\n").replace("\r","\n").split("\n");return[bp,bo,bh]}function k(bk,bi){var bo,bm,bl,bj,bn,bh="";bo=aH(bk,bi);bm=bo[0];bl=bo[1];bj=bo[2];for(bn=0;bn<bm.length;bn++){if(bl.indexOf(bm[bn])>-1&&bm[bn].length>0){bh+=bm[bn]+bj}}return bh}function be(bk,bi){var bo,bm,bl,bj,bn,bh="";bo=aH(bk,bi);bm=bo[0];bl=bo[1];bj=bo[2];for(bn=0;bn<bm.length;bn++){if(bm[bn].length>0){bh+=bm[bn]+bj}}for(bn=0;bn<bl.length;bn++){if(bm.indexOf(bl[bn])<0&&bl[bn].length>0){bh+=bl[bn]+bj}}return bh}function aa(bk,bi){var bo,bm,bl,bj,bn,bh="";bo=aH(bk,bi);bm=bo[0];bl=bo[1];bj=bo[2];for(bn=0;bn<bm.length;bn++){if(bl.indexOf(bm[bn])<0&&bm[bn].length>0){bh+=bm[bn]+bj}}return bh}function aN(bk,bo,bj){var bn,bl,bi,bm,bh="";bn=aH(bk,"");bl=bn[0];bi=bn[2];bj=(bj==undefined)?bl.length:bj;for(bm=bo;(bm<bo+bj)&&(bm<bl.length);bm++){bh+=bl[bm]+bi}return bh}function p(bj,bk){var bi,bh;bi=(bj instanceof Array)?bj.join():bj;bh=(bk instanceof Array)?bk.join():bk;return INTERMediatorLib.numberFormat(bi,bh)}function Z(bl,bm,bh){var bj,bk,bi;bj=(bl instanceof Array)?bl.join():bl;bk=(bm instanceof Array)?bm.join():bm;bi=(bh instanceof Array)?bh.join():bh;return bj.substr(bk,bi)}function S(bl,bm,bh){var bi,bj,bk;bi=(bl instanceof Array)?bl.join():bl;bj=(bm instanceof Array)?bm.join():bm;bk=(bh instanceof Array)?bh.join():bh;return bi.substring(bj,bk)}function aK(bk,bl,bh){var bi,bj;bi=String((bk instanceof Array)?bk.join():bk);bj=parseInt((bl instanceof Array)?bl.join():bl);return bi.substring(0,bj)}function ax(bl,bm,bh){var bi,bj,bk;bi=String((bl instanceof Array)?bl.join():bl);bj=parseInt((bm instanceof Array)?bm.join():bm);bk=parseInt((bh instanceof Array)?bh.join():bh);return bi.substr(bj,bk)}function bf(bj,bk){var bh,bi;bh=String((bj instanceof Array)?bj.join():bj);bi=parseInt((bk instanceof Array)?bk.join():bk);return bh.substring(bh.length-bi)}function a8(bk,bi){var bh,bj;bh=(bk instanceof Array)?bk.join():bk;bj=(bi instanceof Array)?bi.join():bi;return bh.indexOf(bj)}function ae(bn,bo,bh,bl){var bi,bj,bm,bk;bi=(bn instanceof Array)?bn.join():bn;bj=(bo instanceof Array)?bo.join():bo;bm=(bh instanceof Array)?bh.join():bh;bk=(bl instanceof Array)?bl.join():bl;return bi.substr(0,bj)+bk+bi.substr(bm)}function w(bn,bi,bm){var bh,bk,bl,bj;bh=(bn instanceof Array)?bn.join():bn;bk=(bi instanceof Array)?bi.join():bi;bl=(bm instanceof Array)?bm.join():bm;bj=new RegExp(bk,"g");return bh.replace(bj,bl)}ap.timeOffset=(new Date()).getTimezoneOffset();function a(bi){var bh;if(bi===undefined){bh=Date.now()}else{bh=Date.parse(bi.replace(/-/g,"/"));bh-=ap.timeOffset*60000}return parseInt(bh/86400000)}function aX(bi){var bh;if(bi===undefined){bh=Date.now()}else{bh=Date.parse(bi.replace(/-/g,"/"))}return parseInt(bh/1000)}function bd(bh){if(parseInt(bh).length==bh.length){return bh}else{return a(bh)}}function aG(bh){if(parseInt(bh).length==bh.length){return bh}else{return aX(bh)}}function n(bk,bh,bj){var bi=[];bi.push(aQ(bk));bi.push(a3(bk));bi.push(Y(bk));bi[bj]+=bh;return aA(bi[0],bi[1],bi[2])}function aL(bk,bh,bj){var bi=[];bi.push(bb(bk));bi.push(f(bk));bi.push(d(bk));bi.push(a7(bk));bi.push(G(bk));bi.push(e(bk));bi[bj]+=bh;return aY(bi[0],bi[1],bi[2],bi[3],bi[4],bi[5])}function aA(bl,bh,bk){var bi=bh-1;if(bi<0||bi>11){bl+=parseInt(bi/12);bh=bi%12+1}var bj=parseInt(Date.UTC(bl,bh-1,bk,0,0,0)/86400000);return bj}function aY(bo,bh,bn,bl,bj,bk){if(bk<0||bk>59){bj+=parseInt(bk/60);bk=bk%60}if(bj<0||bj>59){bl+=parseInt(bj/60);bj=bj%60}if(bl<0||bl>23){bn+=parseInt(bl/24);bl=bl%24}var bi=bh-1;if(bi<0||bi>11){bo+=parseInt(bi/12);bh=bi%12+1}var bm=Date.UTC(bo,bh-1,bn,bl,bj,bk)/1000;return bm}function aF(bh){return INTERMediator.dateTimeFunction?bb(bh):aQ(bh)}function a9(bh){return INTERMediator.dateTimeFunction?f(bh):a3(bh)}function K(bh){return INTERMediator.dateTimeFunction?d(bh):Y(bh)}function aC(bh){return INTERMediator.dateTimeFunction?at(bh):an(bh)}function ah(bh){return INTERMediator.dateTimeFunction?a7(bh):0}function L(bh){return INTERMediator.dateTimeFunction?G(bh):0}function X(bh){return INTERMediator.dateTimeFunction?e(bh):0}function aQ(bh){return new Date(bd(bh)*86400000).getFullYear()}function a3(bh){return new Date(bd(bh)*86400000).getMonth()+1}function Y(bh){return new Date(bd(bh)*86400000).getDate()}function an(bh){return new Date(bd(bh)*86400000).getDay()}function bb(bh){return new Date(aG(bh)*1000).getFullYear()}function f(bh){return new Date(aG(bh)*1000).getMonth()+1}function d(bh){return new Date(aG(bh)*1000).getDate()}function at(bh){return new Date(aG(bh)*1000).getDay()}function a7(bh){return new Date(aG(bh)*1000).getHours()}function G(bh){return new Date(aG(bh)*1000).getMinutes()}function e(bh){return new Date(aG(bh)*1000).getSeconds()}function o(bi,bh){return INTERMediator.dateTimeFunction?F(bi,bh):aT(bi,bh)}function ar(bi,bh){return INTERMediator.dateTimeFunction?a4(bi,bh):u(bi,bh)}function U(bi,bh){return INTERMediator.dateTimeFunction?h(bi,bh):aZ(bi,bh)}function m(bi,bh){return INTERMediator.dateTimeFunction?B(bi,bh):NaN}function N(bi,bh){return INTERMediator.dateTimeFunction?T(bi,bh):NaN}function a2(bi,bh){return INTERMediator.dateTimeFunction?s(bi,bh):NaN}function aT(bi,bh){return n(bi,bh,0)}function u(bi,bh){return n(bi,bh,1)}function aZ(bi,bh){return n(bi,bh,2)}function F(bi,bh){return aL(bi,bh,0)}function a4(bi,bh){return aL(bi,bh,1)}function h(bi,bh){return aL(bi,bh,2)}function B(bi,bh){return aL(bi,bh,3)}function T(bi,bh){return aL(bi,bh,4)}function s(bi,bh){return aL(bi,bh,5)}function J(bh){return INTERMediator.dateTimeFunction?v(bh):af(bh)}function af(bh){return aZ(u(aV(bh),1),-1)}function v(bh){return s(a4(a1(bh),1),-1)}function aU(bh){return INTERMediator.dateTimeFunction?a1(bh):aV(bh)}function aV(bj){var bi=aQ(bj)+"/"+("0"+a3(bj)).substr(-2,2)+"/01";var bh=a(bi);return bh}function a1(bh){var bi=bb(bh)+"/"+("0"+f(bh)).substr(-2,2)+"/01 00:00:00";console.log(bi);return aX(bi)}function ak(){return parseInt(Date.now()/86400)}function M(){return parseInt(Date.now()/1000)}function C(bk){var bh,bj,bi,bl;bh=String(bk);bj="";for(bi=0;bi<bh.length;bi++){bl=bh.substr(bi,1);if(bl>="0"&&bl<="9"){bj+=bl}else{if(bl>=""&&bl<=""){bj+=bl}else{if(bl>=""||bl=="."){bj+="."}}}}return parseFloat(bh)}function ap(){this.success=false;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;ap.functions={random:aD,fac:am,min:Math.min,max:Math.max,pyt:E,pow:Math.pow,atan2:Math.atan2,"if":ay,sum:aP,average:ao,list:V,format:p,substr:Z,substring:S,indexof:a8,replace:ae,substitute:w,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Q,exp:Math.exp,items:aN,length:l,datetime:aX,date:a,datecomponents:aA,datetimecomponents:aY,year:aF,month:a9,day:K,weekday:aC,hour:ah,minute:L,second:X,yeard:aQ,monthd:a3,dayd:Y,weekdayd:an,yeardt:bb,monthdt:f,daydt:d,weekdaydt:at,hourdt:a7,minutedt:G,seconddt:e,addyear:o,addmonth:ar,addday:U,addhour:m,addminute:N,addsecond:a2,addyeard:aT,addmonthd:u,adddayd:aZ,addyeardt:F,addmonthdt:a4,adddaydt:h,addhourdt:B,addminutedt:T,addseconddt:s,endofmonth:J,startofmonth:aU,endofmonthd:af,startofmonthd:aV,endofmonthdt:v,startofmonthdt:a1,today:ak,now:M,right:bf,mid:ax,left:aK};this.consts={E:Math.E,PI:Math.PI};ap.operators={"!":[1,O,2],"+":[2,z,4],"":[2,aB,4],"-":[2,a0,4],"*":[2,b,3],"/":[2,x,3],"%":[2,c,3],"^":[2,Math.pow,1],",":[2,W,15],">":[2,av,6],"<":[2,r,6],">=":[2,P,6],"<=":[2,g,6],"==":[2,a6,7],"=":[2,a6,7],"!=":[2,aw,7],"<>":[2,aw,7],"&&":[2,bg,11],"||":[2,I,12],"":[2,au,3],"":[2,q,4],"":[2,al,4],"":[2,k,3],"":[2,be,4],"":[2,aa,4],"?":[2,ay,13],":":[4,ay,13]};ap.ops1={"-":az};ap.ops2={};ap.ops3={};ap.ops3Trail={};for(var bh in ap.operators){switch(ap.operators[bh][0]){case 1:ap.ops1[bh]=ap.operators[bh][1];break;case 2:ap.ops2[bh]=ap.operators[bh][1];break;case 3:ap.ops3[bh]=ap.operators[bh][1];break;case 4:ap.ops3Trail[bh]=ap.operators[bh][1];break}}}ap.parse=function(bh){return new ap().parse(bh)};ap.evaluate=function(bi,bj){var bh;bh=ap.parse(bi).evaluate(bj);return bh};ap.Expression=aW;var a5=1<<0;var aI=1<<1;var aE=1<<2;var H=1<<3;var A=1<<4;var t=1<<5;var ba=1<<6;var bc=1<<7;var aJ=1<<8;ap.prototype={parse:function(bp){this.errormsg="";this.success=true;var bj=[];var br=[];this.tmpprio=0;var bl=(a5|H|aE|ba);var bm=0;this.expression=bp;this.pos=0;var bo=[];while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&(bl&ba)){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";bm++;this.addfunc(br,bj,ad)}bl=(a5|H|aE|ba)}else{if(this.isComment()){}else{if((bl&aI)===0){this.error_parsing(this.pos,"unexpected operator")}if(this.tokenindex=="?"){this.tmpprio-=40;this.tokenindex="if";this.addfunc(br,bj,ac);this.tmpprio+=40;this.tokenindex=",";bm+=3;this.addfunc(br,bj,ac)}else{if(this.tokenindex==":"){this.tokenindex=",";bm+=2;this.addfunc(br,bj,ac)}else{bm+=2;this.addfunc(br,bj,ac)}}bl=(a5|H|aE|ba)}}}else{if(this.isNumber()){if((bl&a5)===0){this.error_parsing(this.pos,"unexpected number")}var bi=new aO(ai,0,0,this.tokennumber);br.push(bi);bl=(aI|A|t)}else{if(this.isString()){if((bl&a5)===0){this.error_parsing(this.pos,"unexpected string")}var bi=new aO(ai,0,0,this.tokennumber);br.push(bi);bl=(aI|A|t)}else{if(this.isLeftParenth()){if((bl&H)===0){this.error_parsing(this.pos,'unexpected "("')}if(bl&bc){bo.push(true)}else{bo.push(false)}bl=(a5|H|aE|ba|aJ)}else{if(this.isRightParenth()){var bq=bo.pop();if(bq){bm+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(br,bj,D)}if(bl&aJ){var bi=new aO(ai,0,0,[]);br.push(bi)}else{if((bl&A)===0){this.error_parsing(this.pos,'unexpected ")"')}}bl=(aI|A|t|H|bc)}else{if(this.isConst()){if((bl&a5)===0){this.error_parsing(this.pos,"unexpected constant")}var bh=new aO(ai,0,0,this.tokennumber);br.push(bh);bl=(aI|A|t)}else{if(this.isVar()){if((bl&a5)===0){this.error_parsing(this.pos,"unexpected variable")}var bn=new aO(aj,this.tokenindex,0,0);br.push(bn);bl=(aI|A|t|H|bc)}else{if(this.isWhite()){}else{if(this.errormsg===""){this.error_parsing(this.pos,"unknown character")}else{this.error_parsing(this.pos,this.errormsg)}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"')}while(bj.length>0){var bk=bj.pop();br.push(bk)}return new aW(br)},evaluate:function(bi,bj){var bh;this.parse(bi).evaluate(bj);return bh},error_parsing:function(bh,bi){this.success=false;this.errormsg="parse error [column "+(bh)+"]: "+bi;throw new Error(this.errormsg)},addfunc:function(bk,bh,bj){var bi=new aO(bj,this.tokenindex,this.tokenprio+this.tmpprio,0);while(bh.length>0){if(bi.prio_>=bh[bh.length-1].prio_){bk.push(bh.pop())}else{break}}bh.push(bi)},isNumber:function(){var bi=false;var bj="";while(this.pos<this.expression.length){var bh=this.expression.charCodeAt(this.pos);if((bh>=48&&bh<=57)||bh===46){bj+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(bj);bi=true}else{break}}return bi},unescape:function(bi,bn){var bh=[];var bm=false;for(var bk=0;bk<bi.length;bk++){var bl=bi.charAt(bk);if(bm){switch(bl){case"'":bh.push("'");break;case"\\":bh.push("\\");break;case"/":bh.push("/");break;case"b":bh.push("\b");break;case"f":bh.push("\f");break;case"n":bh.push("\n");break;case"r":bh.push("\r");break;case"t":bh.push("\t");break;case"u":var bj=parseInt(bi.substring(bk+1,bk+5),16);bh.push(String.fromCharCode(bj));bk+=4;break;default:throw this.error_parsing(bn+bk,"Illegal escape sequence: '\\"+bl+"'")}bm=false}else{if(bl=="\\"){bm=true}else{bh.push(bl)}}}return bh.join("")},isString:function(){var bi=false;var bk="";var bj=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'"){this.pos++;while(this.pos<this.expression.length){var bh=this.expression.charAt(this.pos);if(bh!="'"||bk.slice(-1)=="\\"){bk+=this.expression.charAt(this.pos);this.pos++}else{this.pos++;this.tokennumber=this.unescape(bk,bj);bi=true;break}}}return bi},isConst:function(){var bj;for(var bi in this.consts){if(true){var bh=bi.length;bj=this.expression.substr(this.pos,bh);if(bi===bj){this.tokennumber=this.consts[bi];this.pos+=bh;return true}}}return false},isOperator:function(){var bh;if(this.pos+1<this.expression.length){bh=this.expression.substr(this.pos,2);if(ap.operators[bh]){this.tokenprio=ap.operators[bh][2];this.tokenindex=bh;this.pos+=2;return true}}bh=this.expression.substr(this.pos,1);if(ap.operators[bh]){this.tokenprio=ap.operators[bh][2];this.tokenindex=bh;this.pos++;return true}return false},isSign:function(){var bh=this.expression.charCodeAt(this.pos-1);if(bh===45||bh===43){return true}return false},isPositiveSign:function(){var bh=this.expression.charCodeAt(this.pos-1);if(bh===43){return true}return false},isNegativeSign:function(){var bh=this.expression.charCodeAt(this.pos-1);if(bh===45){return true}return false},isLeftParenth:function(){var bh=this.expression.charCodeAt(this.pos);if(bh===40){this.pos++;this.tmpprio-=20;return true}return false},isRightParenth:function(){var bh=this.expression.charCodeAt(this.pos);if(bh===41){this.pos++;this.tmpprio+=20;return true}return false},isComma:function(){var bh=this.expression.charCodeAt(this.pos);if(bh===44){this.pos++;this.tokenprio=15;this.tokenindex=",";return true}return false},isWhite:function(){var bh=this.expression.charCodeAt(this.pos);if(bh===32||bh===9||bh===10||bh===13){this.pos++;return true}return false},isVar:function(){var bi="";for(var bh=this.pos;bh<this.expression.length;bh++){var bj=this.expression.charAt(bh);if(bh===this.pos){if(!bj.match(ap.regFirstVarChar)){break}}else{if(!bj.match(ap.regRestVarChar)){break}}bi+=bj}if(bi.length>0){this.tokenindex=bi;this.tokenprio=0;this.pos+=bi.length;return true}return false},isComment:function(){var bh=this.expression.charCodeAt(this.pos-1);if(bh===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length}return true}return false}};aM.Parser=ap;return ap})(typeof exports==="undefined"?{}:exports);INTERMediator.propertyIETridentSetup();if(INTERMediator.isIE&&INTERMediator.ieVersion<9){INTERMediator.startFrom=0;INTERMediator.pagedSize=0;INTERMediator.pagination=false;INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};IMLibCalc.regexpForSeparator=INTERMediator.separator}else{Object.defineProperty(INTERMediator,"startFrom",{get:function(){return INTERMediator.getLocalProperty("_im_startFrom",0)},set:function(a){INTERMediator.setLocalProperty("_im_startFrom",a)}});Object.defineProperty(INTERMediator,"pagedSize",{get:function(){return INTERMediator.getLocalProperty("_im_pagedSize",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagedSize",a)}});Object.defineProperty(INTERMediator,"pagination",{get:function(){return INTERMediator.getLocalProperty("_im_pagination",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagination",a)}});Object.defineProperty(INTERMediator,"additionalCondition",{get:function(){return INTERMediator.getLocalProperty("_im_additionalCondition",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalCondition",a)}});Object.defineProperty(INTERMediator,"additionalSortKey",{get:function(){return INTERMediator.getLocalProperty("_im_additionalSortKey",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalSortKey",a)}});Object.defineProperty(IMLibCalc,"regexpForSeparator",{get:function(){if(INTERMediator){return new RegExp(INTERMediator.separator)}return new RegExp("@")}})}if(!INTERMediator.additionalCondition){INTERMediator.additionalCondition={}}if(!INTERMediator.additionalSortKey){INTERMediator.additionalSortKey={}}INTERMediatorLib.addEvent(window,"beforeunload",function(a){var b=""});INTERMediatorLib.addEvent(window,"unload",function(a){INTERMediator_DBAdapter.unregister()});
