/*
 * INTER-Mediator
 * Copyright (c) INTER-Mediator Directive Committee (http://inter-mediator.org)
 * This project started at the end of 2009 by Masayuki Nii msyk@msyk.net.
 *
 * INTER-Mediator is supplied under MIT License.
 * Please see the full license for details:
 * https://github.com/INTER-Mediator/INTER-Mediator/blob/master/dist-docs/License.txt
 */
var INTERMediator;INTERMediator={debugMode:false,separator:"@",defDivider:"|",defaultTargetInnerHTML:false,navigationLabel:null,elementIds:[],radioNameMode:false,dontSelectRadioCheck:false,ignoreOptimisticLocking:false,supressDebugMessageOnPage:false,supressErrorMessageOnPage:false,additionalFieldValueOnNewRecord:{},additionalFieldValueOnUpdate:{},additionalFieldValueOnDelete:{},waitSecondsAfterPostMessage:4,pagedAllCount:0,totalRecordCount:null,currentEncNumber:0,isIE:false,isTrident:false,ieVersion:-1,titleAsLinkInfo:true,classAsLinkInfo:true,isDBDataPreferable:false,noRecordClassName:"_im_for_noresult_",rootEnclosure:null,useSessionStorage:true,errorMessages:[],debugMessages:[],partialConstructing:false,linkedElmCounter:0,pusherObject:null,buttonIdNum:0,masterNodeOriginalDisplay:"block",detailNodeOriginalDisplay:"none",pusherAvailable:false,dateTimeFunction:false,postOnlyNodes:null,postOnlyNumber:1,errorMessageByAlert:false,errorMessageOnAlert:null,isTablet:false,isMobile:false,setDebugMessage:function(a,b){if(b===undefined){b=1}if(INTERMediator.debugMode>=b){INTERMediator.debugMessages.push(a);if(typeof console!="undefined"){console.log("INTER-Mediator[DEBUG:%s]: %s",new Date(),a)}}},setErrorMessage:function(a,b){b=b===undefined?"":(" - "+b);if(INTERMediator.errorMessageByAlert){alert(INTERMediator.errorMessageOnAlert===null?(a+b):INTERMediator.errorMessageOnAlert)}if((typeof a=="string"||a instanceof String)){INTERMediator.errorMessages.push(a+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a+b)}}else{if(a.message){INTERMediator.errorMessages.push(a.message+b);if(typeof console!="undefined"){console.error("INTER-Mediator[ERROR]: %s",a.message+b)}}if(a.stack&&typeof console!="undefined"){console.error(a.stack)}}},flushMessage:function(){var h,k,e,c,b,l,a,d,f;if(INTERMediator.errorMessageByAlert){INTERMediator.supressErrorMessageOnPage=true}if(!INTERMediator.supressErrorMessageOnPage&&INTERMediator.errorMessages.length>0){h=document.getElementById("_im_error_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_error_panel_4873643897897");h.style.backgroundColor="#FFDDDD";k=document.createElement("h3");k.appendChild(document.createTextNode("Error Info from INTER-Mediator"));k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];e.insertBefore(h,e.firstChild)}h.appendChild(document.createTextNode("============ERROR MESSAGE on "+new Date()+"============"));h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.errorMessages.length;c++){l=INTERMediator.errorMessages[c].split("\n");for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}if(!INTERMediator.supressDebugMessageOnPage&&INTERMediator.debugMode&&INTERMediator.debugMessages.length>0){h=document.getElementById("_im_debug_panel_4873643897897");if(h===null){h=document.createElement("div");h.setAttribute("id","_im_debug_panel_4873643897897");h.style.backgroundColor="#DDDDDD";a=document.createElement("button");a.setAttribute("title","clear");INTERMediatorLib.addEvent(a,"click",function(){f=document.getElementById("_im_debug_panel_4873643897897");f.parentNode.removeChild(f)});d=document.createTextNode("clear");a.appendChild(d);k=document.createElement("h3");k.appendChild(document.createTextNode("Debug Info from INTER-Mediator"));k.appendChild(a);k.appendChild(document.createElement("hr"));h.appendChild(k);e=document.getElementsByTagName("body")[0];if(e){if(e.firstChild){e.insertBefore(h,e.firstChild)}else{e.appendChild(h)}}}h.appendChild(document.createTextNode("============DEBUG INFO on "+new Date()+"============ "));if(INTERMediatorOnPage.getEditorPath()){var g=document.createElement("a");g.setAttribute("href",INTERMediatorOnPage.getEditorPath());g.appendChild(document.createTextNode("Definition File Editor"));h.appendChild(g)}h.appendChild(document.createElement("hr"));for(c=0;c<INTERMediator.debugMessages.length;c++){l=INTERMediator.debugMessages[c].split("\n");for(b=0;b<l.length;b++){if(b>0){h.appendChild(document.createElement("br"))}h.appendChild(document.createTextNode(l[b]))}h.appendChild(document.createElement("hr"))}}INTERMediator.errorMessages=[];INTERMediator.debugMessages=[]},propertyIETridentSetup:function(){var d,a,e,b;d=navigator.userAgent;a=d.toLocaleUpperCase().indexOf("MSIE");if(a>=0){INTERMediator.isIE=true;for(b=a+4;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+4,b));break}}}a=d.indexOf("; Trident/");if(a>=0){INTERMediator.isTrident=true;for(b=a+10;b<d.length;b++){e=d.charAt(b);if(!(e==" "||e=="."||(e>="0"&&e<="9"))){INTERMediator.ieVersion=INTERMediatorLib.toNumber(d.substring(a+10,b))+4;break}}}},propertyW3CUserAgentSetup:function(){var a=window.navigator.userAgent.toLowerCase();INTERMediator.isTablet=(a.indexOf("windows")!=-1&&a.indexOf("touch")!=-1&&a.indexOf("tablet pc")==-1)||a.indexOf("ipad")!=-1||(a.indexOf("android")!=-1&&a.indexOf("mobile")==-1)||(a.indexOf("firefox")!=-1&&a.indexOf("tablet")!=-1)||a.indexOf("kindle")!=-1||a.indexOf("silk")!=-1||a.indexOf("playbook")!=-1;INTERMediator.isMobile=(a.indexOf("windows")!=-1&&a.indexOf("phone")!=-1)||a.indexOf("iphone")!=-1||a.indexOf("ipod")!=-1||(a.indexOf("android")!=-1&&a.indexOf("mobile")!=-1)||(a.indexOf("firefox")!=-1&&a.indexOf("mobile")!=-1)||a.indexOf("blackberry")!=-1},initialize:function(){INTERMediatorOnPage.removeCookie("_im_localcontext");INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};INTERMediator.startFrom=0;IMLibLocalContext.archive()},construct:function(b){var a;INTERMediatorOnPage.showProgress();if(b===true||b===undefined){a=function(){INTERMediator.constructMain(true)}}else{a=function(){INTERMediator.constructMain(b)}}setTimeout(a,0)},constructMain:function(O,o){var L,G,z=0,C=[],u=[],t,B=1,l=[],I=false,k,s,h,A;s=[];IMLibEventResponder.setup();INTERMediatorOnPage.retrieveAuthInfo();try{if(Pusher.VERSION){INTERMediator.pusherAvailable=true;if(!INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1039]);INTERMediator.pusherAvailable=false}}}catch(F){INTERMediator.pusherAvailable=false;if(INTERMediatorOnPage.clientNotificationKey){INTERMediator.setErrorMessage(Error("Pusher Configuration Error"),INTERMediatorOnPage.getMessages()[1038])}}try{if(O===true||O===undefined){IMLibPageNavigation.deleteInsertOnNavi=[];this.partialConstructing=false;INTERMediator.buttonIdNum=1;IMLibContextPool.clearAll();v()}else{IMLibPageNavigation.deleteInsertOnNavi=[];this.partialConstructing=true;t=false;C=[];try{if(!o){O.removeContext();k=O.original;for(L=0;L<k.length;L++){O.enclosureNode.appendChild(k[L].cloneNode(true))}c(O.enclosureNode,O.foreignValue,O.dependingParentObjectInfo,O)}else{d(O,O.enclosureNode,{recordset:o,targetTotalCount:1,targetCount:1})}}catch(F){if(F=="_im_requath_request_"){throw F}else{INTERMediator.setErrorMessage(F,"EXCEPTION-8")}}for(L=0;L<C.length;L++){document.getElementById(C[L]["id"]).value=C[L]["value"]}IMLibCalc.updateCalculationFields()}}catch(F){if(F=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){INTERMediator.constructMain(O)});return}}}else{INTERMediator.setErrorMessage(F,"EXCEPTION-7")}}for(L=0;L<l.length;L++){l[L].finish()}INTERMediatorOnPage.hideProgress();for(L=0;L<s.length;L++){G=s[L].targetNode;h=s[L].parentNode;A=s[L].siblingNode;if(G&&h){if(A){h.insertBefore(G,A)}else{h.appendChild(G)}}}for(L=0;L<u.length;L++){G=document.getElementById(u[L].id);if(G){INTERMediatorLib.addEvent(G,u[L].event,u[L].todo)}}if(INTERMediatorOnPage.doAfterConstruct){INTERMediatorOnPage.doAfterConstruct()}INTERMediator.flushMessage();function v(){var S,T,V;IMLibCalc.calculateRequiredObject={};INTERMediator.currentEncNumber=1;INTERMediator.elementIds=[];t=false;T=document.getElementsByTagName("BODY")[0];if(INTERMediator.rootEnclosure===null){INTERMediator.rootEnclosure=T.innerHTML}else{T.innerHTML=INTERMediator.rootEnclosure}C=[];try{c(T,null,null,null)}catch(R){if(R=="_im_requath_request_"){throw R}else{INTERMediator.setErrorMessage(R,"EXCEPTION-9")}}for(S=0;S<C.length;S++){if(C[S]["value"]===""&&document.getElementById(C[S]["id"]).tagName=="SELECT"){V=document.createElement("option");V.setAttribute("value","");document.getElementById(C[S]["id"]).insertBefore(V,document.getElementById(C[S]["id"]).firstChild)}document.getElementById(C[S]["id"]).value=C[S]["value"]}IMLibLocalContext.bindingDescendant(T);IMLibCalc.updateCalculationFields();IMLibPageNavigation.navigationSetup();if(I&&INTERMediator.pusherAvailable){var Q=INTERMediatorOnPage.clientNotificationIdentifier();var U=INTERMediatorOnPage.clientNotificationKey();if(U&&U!="_im_key_isnt_supplied"&&!INTERMediator.pusherObject){try{Pusher.log=function(W){if(window.console&&window.console.log){window.console.log(W)}};INTERMediator.pusherObject=new Pusher(U);INTERMediator.pusherChannel=INTERMediator.pusherObject.subscribe(Q);INTERMediator.pusherChannel.bind("update",function(W){IMLibContextPool.updateOnAnotherClient("update",W)});INTERMediator.pusherChannel.bind("create",function(W){IMLibContextPool.updateOnAnotherClient("create",W)});INTERMediator.pusherChannel.bind("delete",function(W){IMLibContextPool.updateOnAnotherClient("delete",W)})}catch(R){INTERMediator.setErrorMessage(R,"EXCEPTION-47")}}}e()}function c(T,Q,V,R){var S,Y,U,W;if(T.nodeType===1){try{if(INTERMediatorLib.isEnclosure(T,false)){Y=INTERMediatorLib.getClassAttributeFromNode(T);W=T.getAttribute("data-im-control");if((Y&&Y.match(/_im_post/))||(W&&W.indexOf("post")>=0)){n(T)}else{if(INTERMediator.isIE){try{K(T,Q,V,R)}catch(X){if(X=="_im_requath_request_"){throw X}}}else{K(T,Q,V,R)}}}else{S=T.childNodes;if(S){for(U=0;U<S.length;U++){if(S[U].nodeType===1){c(S[U],Q,V,R)}}}}}catch(X){if(X=="_im_requath_request_"){throw X}else{INTERMediator.setErrorMessage(X,"EXCEPTION-10")}}}}function n(T){var S,Q;Q=INTERMediatorLib.getElementsByClassNameOrDataAttr(T,"_im_post");for(L=0;L<Q.length;L++){if(Q[L].tagName==="BUTTON"||(Q[L].tagName==="INPUT"&&(Q[L].getAttribute("type").toLowerCase()==="button"||Q[L].getAttribute("type").toLowerCase()==="submit"))){INTERMediatorLib.addEvent(Q[L],"click",(function(){var U=Q[L];return function(){IMLibUI.clickPostOnlyButton(U)}})())}}S=T.childNodes;t=true;for(L=0;L<S.length;L++){R(S[L])}t=false;function R(Y){var X,W,V;if(Y.nodeType===1){try{if(Y.getAttribute("data-im")){if(!Y.id){Y.id="IMPOST-"+INTERMediator.postOnlyNumber;INTERMediator.postOnlyNumber++}INTERMediatorLib.addEvent(Y,"blur",function(aa){var Z=Y.id;IMLibUI.valueChange(Z,true)})}if(INTERMediatorLib.isWidgetElement(Y)){W=INTERMediatorLib.getWidgetInfo(Y);if(W[0]){IMParts_Catalog[W[0]].instanciate(Y);if(l.indexOf(IMParts_Catalog[W[0]])<0){l.push(IMParts_Catalog[W[0]])}}}else{if(INTERMediatorLib.isEnclosure(Y,false)){K(Y,null,null,null)}else{X=Y.childNodes;for(V=0;V<X.length;V++){R(X[V])}}}}catch(U){if(U=="_im_requath_request_"){throw U}else{INTERMediator.setErrorMessage(U,"EXCEPTION-11")}}}}}function K(aj,W,ac,ae){var U,aa,V,Z,ag,ah,af,aq,Y,ap,ai,ad,T,al,X,R,Q,ak,ao,S,ab,am;z++;aa=aj.tagName;Y=INTERMediatorLib.repeaterTagFromEncTag(aa);V=b(aj,Y);Z=r(V);U=INTERMediatorLib.seekLinkedAndWidgetNodes(Z,true).linkedNode;ag=y(U);ah=E(ag);af=ah.targettable;INTERMediator.currentEncNumber++;if(!aj.getAttribute("id")){aj.setAttribute("id",w())}if(!af){for(al=0;al<V.length;al++){Q=aj.appendChild(V[al]);if(V[al].getAttribute("selected")!==null){ao=Q}if(ao!==undefined){ao.selected=true}c(Q,null,aj,ae)}}else{am=new IMLibContext(af.name);am.enclosureNode=aj;am.repeaterNodes=Z;am.original=V;am.parentContext=ae;am.sequencing=true;aq=[];S=af.calculation;ab=[];for(X in S){ab.push(S[X]["field"])}for(al=0;al<ah.fieldlist.length;al++){if(!ab[ah.fieldlist[al]]){ab.push(ah.fieldlist[al])}}if(W){try{ai=af.relation;am.setOriginal(V);if(ai){for(ad in ai){if(Boolean(ai[ad].portal)===true){af.portal=true}ap=ai[ad]["join-field"];am.addForeignValue(ap,W[ap]);for(T in ac){if(T==ai[ad]["join-field"]){am.addDependingObject(ac[T]);am.dependingParentObjectInfo=JSON.parse(JSON.stringify(ac))}}}}}catch(an){if(an=="_im_requath_request_"){throw an}else{INTERMediator.setErrorMessage(an,"EXCEPTION-25")}}}if(Boolean(af.portal)===true){af.currentrecord=W;ak=W["-recid"]}R=x(af,aq,am.foreignValue);am.registeredId=R.registeredId;am.nullAcceptable=R.nullAcceptable;I|=!(INTERMediatorOnPage.notifySupport===false);d(am,aj,R);H(af,ak,aj,am.foreignValue);a(am,aj);P(af,aj);am.sequencing=false}z--}function d(ah,at,au){var ac,aP,ap,aQ,ax,an,Z,aF,aL,S,T,ad,aO,Y,av,aj,aJ,aK,aI,af,aa,R,X,aG,aB,aD,ai,az,aA,V,aM,U,ay,aE,ar,al,ag,Q,aq,aN,W,ak,aC,am,ao,ab;aE=at.tagName;ar=INTERMediatorLib.repeaterTagFromEncTag(aE);ak={};ag=ah.original;W=ah.getContextDef();Q=au.recordset;aq=au.totalCount;ax=g(ag);for(aN=0;aN<ax.length;aN++){ac=ax[aN];ap=ac.getAttribute("data-im-control");if(ap&&ap.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0){if(!am){at.appendChild(ac)}}}if(au.count===0){for(aN=0;aN<ag.length;aN++){ac=ag[aN].cloneNode(true);aP=INTERMediatorLib.getClassAttributeFromNode(ac);ap=ac.getAttribute("data-im-control");if((aP&&aP.indexOf(INTERMediator.noRecordClassName)>-1)||(ap&&ap.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>-1)){at.appendChild(ac);m(ac)}}}aQ=0;ao=false;ab=Q?Q.length:0;for(al=0;al<ab;al++){try{aQ++;ax=g(ag);an=INTERMediatorLib.seekLinkedAndWidgetNodes(ax,true);Z=an.widgetNode;aF=an.linkedNode;aL=[];for(aN=0;aN<ax.length;aN++){m(ax[aN]);aL.push(ax[aN].getAttribute("id"))}S=INTERMediatorOnPage.getDBSpecification();if(S["db-class"]!==null&&S["db-class"]=="FileMaker_FX"){T=W.key?W.key:"-recid"}else{T=W.key?W.key:"id"}if(W.relation){for(aN=0;aN<Object.keys(W.relation).length;aN++){if(W.relation[aN]["portal"]&&Number(W.relation[aN]["portal"])===1){ao=true}}}if(ao===true){T="-recid";ad=W.name+"::-recid";aO=Q[al][ad];Y=ad+"="+aO}else{Y="=";aO=null}av=Q[al][T];if(T&&!av){av=al}aj=T+"="+av;for(aJ=0;aJ<aF.length;aJ++){aK=aF[aJ].getAttribute("id");aI=m(aF[aJ]);aG=aI.getAttribute("type");if(aG=="checkbox"||aG=="radio"){af=aI.parentNode.childNodes;for(aN=0;aN<af.length;aN++){if(af[aN].nodeType===1&&af[aN].tagName=="LABEL"&&aK==af[aN].getAttribute("for")){af[aN].setAttribute("for",aI.getAttribute("id"));break}}}}for(aJ=0;aJ<Z.length;aJ++){aa=INTERMediatorLib.getWidgetInfo(Z[aJ]);if(aa[0]){IMParts_Catalog[aa[0]].instanciate(Z[aJ]);if(l.indexOf(IMParts_Catalog[aa[0]])<0){l.push(IMParts_Catalog[aa[0]])}}}}catch(aH){if(aH=="_im_requath_request_"){throw aH}else{INTERMediator.setErrorMessage(aH,"EXCEPTION-26")}}if(Boolean(W.portal)!==true||(Boolean(W.portal)===true&&aq>0)){R={};for(aJ=0;aJ<aF.length;aJ++){try{X=aF[aJ].tagName;aK=aF[aJ].getAttribute("id");if(INTERMediatorLib.isWidgetElement(aF[aJ])){aK=aF[aJ]._im_getComponentId()}aG=aF[aJ].getAttribute("type");aB=INTERMediatorLib.getLinkedElementInfo(aF[aJ]);if(aG=="radio"){aD=aB.join("|");if(!R[aD]){R[aD]=B;B++}ai=R[aD];az=aF[aJ].getAttribute("name");if(az){aF[aJ].setAttribute("name",az+"-"+ai)}else{aF[aJ].setAttribute("name","IM-R-"+ai)}}var aw=false;for(aM=0;aM<aB.length;aM++){aA=INTERMediatorLib.getNodeInfoArray(aB[aM]);V=Q[al][aA.field];if(!INTERMediator.isDBDataPreferable||V!==null){IMLibCalc.updateCalculationInfo(ah,aj,W,aK,aA,Q[al])}if(aA.table==W.name){aw=true;U=aA.target;if(V===null){if(IMLibElement.setValueToIMNode(aF[aJ],U,"")){C.push({id:aK,value:V})}}else{if((typeof V=="object"||V instanceof Object)){if(V&&V.length>0){if(IMLibElement.setValueToIMNode(aF[aJ],U,V[0])){C.push({id:aK,value:V[0]})}}}else{if(IMLibElement.setValueToIMNode(aF[aJ],U,V)){C.push({id:aK,value:V})}}}ah.setValue(aj,aA.field,V,aK,U,aO);ak[aA.field]=aK}}if(aw&&!t&&(X=="INPUT"||X=="SELECT"||X=="TEXTAREA")){var ae=function(aR){var aS=aR;return function(){IMLibUI.valueChange(aS)}};u.push({id:aK,event:"change",todo:ae(aK)});if(X!="SELECT"){u.push({id:aK,event:"keydown",todo:IMLibUI.keyDown});u.push({id:aK,event:"keyup",todo:IMLibUI.keyUp})}}}catch(aH){if(aH=="_im_requath_request_"){throw aH}else{INTERMediator.setErrorMessage(aH,"EXCEPTION-27")}}}}if(ao===true){T="-recid";ad=W.name+"::-recid";aO=Q[al][ad];Y=ad+"="+aO}else{ad="";aO="";Y="="}J(aE,ax,W,T,av,ad,aO,aL);N(aE,ax,W,T,av,ad,aO);p(aE,ar,ax,ah,Q[al]);if(Boolean(W.portal)!==true||(Boolean(W.portal)===true&&aq>0)){ay=[];am=null;if(!ah.sequencing){aC=ah.checkOrder(Q[al]);am=ah.getRepeaterEndNode(aC+1)}for(aN=0;aN<ax.length;aN++){ac=ax[aN];aP=INTERMediatorLib.getClassAttributeFromNode(ac);ap=ac.getAttribute("data-im-control");if(!(aP&&aP.indexOf(INTERMediator.noRecordClassName)>=0)&&!(ap&&ap.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)&&!(ap&&ap.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)&&!(ap&&ap.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)&&!(ap&&ap.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)){if(!am){at.appendChild(ac)}else{am.parentNode.insertBefore(ac,am)}ay.push(ac);if(!ac.id){m(ac)}ah.setValue(aj,"_im_repeater","",ac.id,"",aO);ak[aA.field]=aK;c(ac,Q[al],ak,ah)}}if(al+1!=ab){for(aN=0;aN<ax.length;aN++){ac=ax[aN];ap=ac.getAttribute("data-im-control");if(ap&&ap.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0){if(!am){at.appendChild(ac)}else{am.parentNode.insertBefore(ac,am)}}}}f(W,at,ay)}ah.rearrangePendingOrder()}ax=g(ag);for(aN=0;aN<ax.length;aN++){ac=ax[aN];ap=ac.getAttribute("data-im-control");if(ap&&ap.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0){if(!am){at.appendChild(ac)}}}}function x(Z,ai,aj){var V,S,R,aa,af,ab,X,U,ad,Y,ah,T=[],Q,ag,ac,W=[];if(Boolean(Z.cache)===true){try{if(!INTERMediatorOnPage.dbCache[Z.name]){INTERMediatorOnPage.dbCache[Z.name]=INTERMediator_DBAdapter.db_query({name:Z.name,records:null,paging:null,fields:ai,parentkeyvalue:null,conditions:null,useoffset:false})}if(aj===null){R=INTERMediatorOnPage.dbCache[Z.name]}else{R={recordset:[],count:0};aa=0;for(V in INTERMediatorOnPage.dbCache[Z.name].recordset){af=INTERMediatorOnPage.dbCache[Z.name].recordset[V];ab=true;X=0;for(S in aj){U=Z.relation[X]["foreign-key"];if(af[U]!=aj[S]){ab=false;break}X++}if(ab){Q=Z.paging?Z.paging:false;ag=Z.records?Z.records:10000000000;if(!Q||(Q&&(aa>=INTERMediator.startFrom))){R.recordset.push(af);R.count++;if(ag<=R.count){break}}aa++}}}}catch(ae){if(ae=="_im_requath_request_"){throw ae}else{INTERMediator.setErrorMessage(ae,"EXCEPTION-24")}}}else{try{if(Z.portal==true){for(ad in INTERMediator.additionalCondition){if(INTERMediator.additionalCondition.hasOwnProperty(ad)){T.push(INTERMediator.additionalCondition[ad]);break}}}ah=false;if(Z.records&&Z.paging){ah=true}if(Z["navi-control"]&&Z["navi-control"]==="detail"){Y=1}else{if(Z.maxrecords){if(parseInt(INTERMediator.pagedSize,10)===0){if(Z.records){Y=parseInt(Z.records,10)}else{Y=parseInt(Z.maxrecords,10)}}else{if(parseInt(Z.maxrecords,10)<parseInt(INTERMediator.pagedSize,10)){if(parseInt(Z.maxrecords,10)<parseInt(Z.records,10)){Y=parseInt(Z.records,10)}else{Y=parseInt(Z.maxrecords,10)}}else{if(Z.relation){Y=parseInt(Z.records,10)}else{Y=parseInt(INTERMediator.pagedSize,10)}}}}else{if(parseInt(INTERMediator.pagedSize,10)===0||(parseInt(Z.records,10)<parseInt(INTERMediator.pagedSize,10))){Y=parseInt(Z.records,10)}else{if(Z.relation){Y=parseInt(Z.records,10)}else{Y=parseInt(INTERMediator.pagedSize,10)}}}if(!Z.relation&&Z.paging&&Boolean(Z.paging)===true){INTERMediator.setLocalProperty("_im_pagedSize",Y)}}R={};if(Boolean(Z.portal)===true){for(ac=0;ac<Object.keys(Z.currentrecord).length;ac++){if(Z.currentrecord[ac]){W.push(Z.currentrecord[ac])}}R.recordset=W}else{R=INTERMediator_DBAdapter.db_query({name:Z.name,records:isNaN(Y)?100000000:Y,paging:Z.paging,fields:ai,parentkeyvalue:aj,conditions:T,useoffset:true,uselimit:ah})}}catch(ae){if(ae=="_im_requath_request_"){throw ae}else{INTERMediator.setErrorMessage(ae,"EXCEPTION-12")}}}return R}function m(U){var S,T,Q,R=true;if(U.getAttribute("id")===null){U.setAttribute("id",w())}else{if(INTERMediator.elementIds.indexOf(U.getAttribute("id"))>=0){T=INTERMediatorLib.getLinkedElementInfo(U);for(S=0;S<T.length;S++){Q=T[S].split(INTERMediator.separator);if(Q[2]=="#id"){R=false}}if(R){U.setAttribute("id",w())}}INTERMediator.elementIds.push(U.getAttribute("id"))}return U}function w(){INTERMediator.linkedElmCounter++;return D()}function D(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}function f(T,S,R){try{if(INTERMediatorOnPage.additionalExpandingRecordFinish[T.name]){INTERMediatorOnPage.additionalExpandingRecordFinish[T.name](S);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingRecordFinish["+T.name+"] with the context.",2)}}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-33: hint: post-repeater of "+T.name)}}try{if(INTERMediatorOnPage.expandingRecordFinish!=null){INTERMediatorOnPage.expandingRecordFinish(T.name,R);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingRecordFinish with the context: "+T.name,2)}if(T["post-repeater"]){INTERMediatorOnPage[T["post-repeater"]](R);INTERMediator.setDebugMessage("Call the post repeater method 'INTERMediatorOnPage."+T["post-repeater"]+"' with the context: "+T.name,2)}}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-23")}}}function P(S,R){try{if(INTERMediatorOnPage.additionalExpandingEnclosureFinish[S.name]){INTERMediatorOnPage.additionalExpandingEnclosureFinish[S.name](R);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage.additionalExpandingEnclosureFinish["+S.name+"] with the context.",2)}}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-32: hint: post-enclosure of "+S.name)}}try{if(INTERMediatorOnPage.expandingEnclosureFinish!=null){INTERMediatorOnPage.expandingEnclosureFinish(S.name,R);INTERMediator.setDebugMessage("Call INTERMediatorOnPage.expandingEnclosureFinish with the context: "+S.name,2)}}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-21")}}try{if(S["post-enclosure"]){INTERMediatorOnPage[S["post-enclosure"]](R);INTERMediator.setDebugMessage("Call the post enclosure method 'INTERMediatorOnPage."+S["post-enclosure"]+"' with the context: "+S.name,2)}}catch(Q){if(Q=="_im_requath_request_"){throw Q}else{INTERMediator.setErrorMessage(Q,"EXCEPTION-22: hint: post-enclosure of "+S.name)}}}function b(U,Q){var T,V=[],S,R;S=U.childNodes;for(T=0;T<S.length;T++){if(S[T].nodeType===1){if(S[T].tagName==Q){V.push(S[T])}else{if(Q==null&&(S[T].getAttribute("data-im-control"))){R=S[T].getAttribute("data-im-control");if(R.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>-1||R.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>-1||R.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>-1||R.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>-1||R.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>-1){V.push(S[T])}}else{if(Q==null&&INTERMediatorLib.getClassAttributeFromNode(S[T])&&INTERMediatorLib.getClassAttributeFromNode(S[T]).match(/_im_repeater/)){R=INTERMediatorLib.getClassAttributeFromNode(S[T]);if(R.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>-1){V.push(S[T])}}}}}}return V}function r(U){var S,V=[],T,Q,R;for(S=0;S<U.length;S++){T=U[S];Q=U[S].parentNode;R=U[S].cloneNode(true);V.push(R);R.setAttribute("id",w());Q.removeChild(T)}return V}function y(U){var S=[],T,R,Q;for(R=0;R<U.length;R++){T=INTERMediatorLib.getLinkedElementInfo(U[R]);if(T!==null){for(Q=0;Q<T.length;Q++){S.push(T[Q])}}}return S}function E(Z){var X,ab,S,U,T,V,aa,Q,R,W=[],Y=[];for(X=0;X<Z.length;X++){ab=INTERMediatorLib.getNodeInfoArray(Z[X]);S=ab.field;U=ab.table;Q=ab.tableindex;if(U!=IMLibLocalContext.contextName){if(S!=null&&S.length!=0&&U.length!=0&&U!=null){if(!Y[Q]){Y[Q]=[]}Y[Q].push(S);if(!W[Q]){W[Q]=1}else{++W[Q]}}else{INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1006,[Z[X]]))}}}T=-1;V="";for(aa in W){if(T<W[aa]){T=W[aa];V=aa.substring(10)}}R=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",V);return{targettable:R,fieldlist:Y["_im_index_"+V]}}function g(S){var R,Q=[];for(R=0;R<S.length;R++){Q.push(S[R].cloneNode(true))}return Q}function p(Y,aa,V,S,Q){var R,T,X,W,U,ab,Z;Z=S.getContextDef();if(!Z["repeat-control"]||!Z["repeat-control"].match(/copy/i)){return}if(Z.paging==true){IMLibPageNavigation.deleteInsertOnNavi.push({kind:"COPY",contextDef:Z,keyValue:Q[Z.key]})}else{R=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(R,"IM_Button_Copy");ab=INTERMediatorOnPage.getMessages()[14];if(Z["button-names"]&&Z["button-names"]["copy"]){ab=Z["button-names"]["copy"]}R.appendChild(document.createTextNode(ab));T="IM_Button_"+INTERMediator.buttonIdNum;R.setAttribute("id",T);INTERMediator.buttonIdNum++;X=function(ae,ac){var af=ae,ad=ac;return function(){IMLibUI.copyButton(af,ad)}};u.push({id:T,event:"click",todo:X(S,Q[Z.key])});switch(Y){case"TBODY":W=V[V.length-1].getElementsByTagName("TD");U=W[W.length-1];U.appendChild(R);break;case"SELECT":break;default:if(V[0]&&V[0].childNodes){V[V.length-1].appendChild(R)}else{V.push(R)}break}}}function J(ac,Z,ad,U,W,R,S,X){var Q,V,T,aa,Y,ae,ab;if(!ad["repeat-control"]||!ad["repeat-control"].match(/delete/i)){return}if(ad.relation||ad.records===undefined||(ad.records>1&&Number(INTERMediator.pagedSize)!=1)){Q=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(Q,"IM_Button_Delete");ae=INTERMediatorOnPage.getMessages()[6];if(ad["button-names"]&&ad["button-names"]["delete"]){ae=ad["button-names"]["delete"]}Q.appendChild(document.createTextNode(ae));V="IM_Button_"+INTERMediator.buttonIdNum;Q.setAttribute("id",V);INTERMediator.buttonIdNum++;T=function(ao,an,am,al,aj){var ag=ao,ah=an,ai=am,ak=al,af=aj;return function(){IMLibUI.deleteButton(ag,ah,ai,R,S,ak,af)}};u.push({id:V,event:"click",todo:T(ad.name,U,W,X,ad["repeat-control"].match(/confirm-delete/i))});switch(ac){case"TBODY":aa=Z[Z.length-1].getElementsByTagName("TD");Y=aa[aa.length-1];Y.appendChild(Q);break;case"SELECT":break;default:if(Z[0]&&Z[0].childNodes){Z[Z.length-1].appendChild(Q)}else{Z.push(Q)}break}}else{IMLibPageNavigation.deleteInsertOnNavi.push({kind:"DELETE",name:ad.name,key:U,value:W,confirm:ad["repeat-control"].match(/confirm-delete/i)})}}function H(Y,af,ae,am){var S,ah,ai,V,ab,aj,al,ad,W,ag,aa,ak,U,R,Q,X,T,Z,ac;T=ae.tagName;if(Y["repeat-control"]&&Y["repeat-control"].match(/insert/i)){if(am.length>0||!Y.paging||Y.paging===false){S=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(S,"IM_Button_Insert");Z=INTERMediatorOnPage.getMessages()[5];if(Y["button-names"]&&Y["button-names"]["insert"]){Z=Y["button-names"]["insert"]}S.appendChild(document.createTextNode(Z));X="IM_Button_"+INTERMediator.buttonIdNum;S.setAttribute("id",X);INTERMediator.buttonIdNum++;ah=[];switch(T){case"TBODY":ac=false;ak="TFOOT";if(Y["repeat-control"].match(/top/i)){ak="THEAD";ac=true}ai=ae.parentNode;aa=ai.childNodes;V=null;for(ag=0;ag<aa.length;ag++){if(aa[ag].tagName===ak){V=aa[ag];break}}if(V===null){V=document.createElement(ak);ai.appendChild(V)}U=INTERMediatorLib.getElementsByClassName(V,"IM_Button_Insert");if(U.length==0){ab=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(ab,"IM_Insert_TR");aj=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(aj,"IM_Insert_TD");m(ab);if(ac&&V.childNodes){V.insertBefore(ab,V.childNodes[0])}else{V.appendChild(ab)}ab.appendChild(aj);aj.appendChild(S);ah=[ab.getAttribute("id")]}break;case"UL":case"OL":al=document.createElement("LI");U=INTERMediatorLib.getElementsByClassName(al,"IM_Button_Insert");if(U.length==0){al.appendChild(S);if(Y["repeat-control"].match(/top/i)){ae.insertBefore(al,ae.firstChild)}else{ae.appendChild(al)}}break;case"SELECT":break;default:ad=document.createElement("DIV");U=INTERMediatorLib.getElementsByClassName(ad,"IM_Button_Insert");if(U.length==0){ad.appendChild(S);if(Y["repeat-control"].match(/top/i)){ae.insertBefore(ad,ae.firstChild)}else{ae.appendChild(ad)}}break}W=function(ax,aw,av,au,ar){var ap=ax,aq=aw,an=av,at=au,ao=ar;return function(){IMLibUI.insertButton(ap,af,aq,an,at,ao)}};INTERMediatorLib.addEvent(S,"click",W(Y.name,am,ae.getAttribute("id"),ah,Y["repeat-control"].match(/confirm-insert/i)))}else{Q=INTERMediatorOnPage.getDBSpecification();if(Q["db-class"]!=null&&Q["db-class"]=="FileMaker_FX"){R=Y.key?Y.key:"-recid"}else{R=Y.key?Y.key:"id"}IMLibPageNavigation.deleteInsertOnNavi.push({kind:"INSERT",name:Y.name,key:R,confirm:Y["repeat-control"].match(/confirm-insert/i)})}}}function N(X,W,aa,S,aj,ah,U){var T,Z,Q,ag,an,ab,am,ae,ak,ai,af,R,ad,al,V,Y;if(!aa["navi-control"]||!aa["navi-control"].match(/master/i)||X=="SELECT"){return}V=INTERMediator.isMobile||INTERMediator.isTablet;ae=aa["navi-control"].match(/hide/i);R=ae&&(aa.paging==true);if(INTERMediator.detailNodeOriginalDisplay){ai=IMLibContextPool.getDetailContext();if(ai){af=ai.enclosureNode;if(af.tagName=="TBODY"){af=af.parentNode}INTERMediator.detailNodeOriginalDisplay=af.style.display}}T=document.createElement("BUTTON");INTERMediatorLib.setClassAttributeToNode(T,"IM_Button_Master");ad=INTERMediatorOnPage.getMessages()[12];if(aa["button-names"]&&aa["button-names"]["navi-detail"]){ad=aa["button-names"]["navi-detail"]}T.appendChild(document.createTextNode(ad));Z="IM_Button_"+INTERMediator.buttonIdNum;T.setAttribute("id",Z);INTERMediator.buttonIdNum++;ak=IMLibContextPool.getMasterContext();ak.setValue(S+"="+aj,"_im_buttom_master_id",Z,Z);if(V){Y=ac(X,S,aj,ah,U,ae,R);for(al=0;al<W.length;al++){var ao=W[al].style.backgroundColor;u.push({id:W[al].id,event:"touchstart",todo:(function(){var ap=W[al];return function(){IMLibEventResponder.touchEventCancel=false;ap.style.backgroundColor=IMLibUI.mobileSelectionColor}})()});u.push({id:W[al].id,event:"touchend",todo:(function(){var aq=W[al];var ap=ao;return function(){aq.style.backgroundColor=ap;if(!IMLibEventResponder.touchEventCancel){IMLibEventResponder.touchEventCancel=false;Y()}}})()});u.push({id:W[al].id,event:"touchmove",todo:(function(){return function(){IMLibEventResponder.touchEventCancel=true}})()});u.push({id:W[al].id,event:"touchcancel",todo:(function(){return function(){IMLibEventResponder.touchEventCancel=true}})()})}}else{u.push({id:Z,event:"click",todo:ac(X,S,aj,ah,U,ae,R)});switch(X){case"TBODY":ag=W[W.length-1].getElementsByTagName("TD");an=ag[0];ab=an.childNodes[0];if(ab){an.insertBefore(T,ab)}else{an.appendChild(T)}break;case"SELECT":break;default:ab=W[W.length-1].childNodes[0];if(ab){W[W.length-1].insertBefore(T,ab)}else{W[W.length-1].appendChild(T)}break}}function ac(aA,av,ax,at,au,aq,aD){var ay=av,aC=ax,ap=at,aw=au;var ar={},az=aA,aB=aq,aE=aD;ar[ap]=aw;return function(){var aG,aF,aK,aJ,aL,aI,aH;aG=IMLibContextPool.getMasterContext();aF=IMLibContextPool.getDetailContext();if(aF){if(INTERMediatorOnPage.naviBeforeMoveToDetail){INTERMediatorOnPage.naviBeforeMoveToDetail(aG,aF)}am=aF.getContextDef();aK=am.name;aI=INTERMediator.additionalCondition;aI[aK]={field:ay,operator:"=",value:aC};INTERMediator.additionalCondition=aI;INTERMediator.constructMain(aF);if(aB){aJ=aG.enclosureNode;if(az=="TBODY"){aJ=aJ.parentNode}INTERMediator.masterNodeOriginalDisplay=aJ.style.display;aJ.style.display="none";aL=aF.enclosureNode;if(aL.tagName=="TBODY"){aL=aL.parentNode}aL.style.display=INTERMediator.detailNodeOriginalDisplay}if(aE){document.getElementById("IM_NAVIGATOR").style.display="none"}if(IMLibUI.mobileNaviBackButtonId){aH=document.getElementById(IMLibUI.mobileNaviBackButtonId);aH.style.display="inline-block"}if(INTERMediatorOnPage.naviAfterMoveToDetail){aG=IMLibContextPool.getMasterContext();aF=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToDetail(aG,aF)}}}}}function a(S,ab){var T,Z,ad,ac,ah,V,W,R,Y,U,ae,aa,af;V=S.getContextDef();if(!V["navi-control"]||!V["navi-control"].match(/detail/i)){return}ac=IMLibContextPool.getMasterContext();ah=ac.getContextDef()["navi-control"];if(!ah||(!ah.match(/hide/i))){return}R=ac.getContextDef()["paging"]==true;Y=V["navi-control"].match(/update/i);U=INTERMediator.isMobile||INTERMediator.isTablet;af=!(V["navi-control"].match(/bottom/i));W=S.enclosureNode;if(W.tagName=="TBODY"){W=W.parentNode}if(INTERMediator.detailNodeOriginalDisplay){INTERMediator.detailNodeOriginalDisplay=W.style.display}W.style.display="none";if(U){aa=document.getElementsByClassName("IM_Button_BackNavi");if(!aa||aa.length==0){ae=ag("DIV",V);IMLibUI.mobileNaviBackButtonId=ae.id;ae.style.display="none";aa=INTERMediatorLib.getElementsByAttributeValue(document.getElementsByTagName("BODY")[0],"data-role",af?"header":"footer");if(aa&&aa[0]){if(aa[0].firstChild){aa[0].insertBefore(ae,aa[0].firstChild)}else{aa[0].appendChild(ae)}}else{switch(ab.tagName){case"TBODY":X(ab,af,ae);break;case"UL":case"OL":ai(ab,af,"LI",ae);break;case"SELECT":break;default:ai(ab,af,"DIV",ae);break}}INTERMediatorLib.addEvent(ae,"click",Q(ac,S,R,Y))}}else{T=ag("BUTTON",V);switch(ab.tagName){case"TBODY":X(ab,af,T);break;case"UL":case"OL":ai(ab,af,"LI",T);break;case"SELECT":break;default:ai(ab,af,"DIV",T);break}INTERMediatorLib.addEvent(T,"click",Q(ac,S,R,Y))}function ag(al,am){var ak,aj;ak=document.createElement(al);INTERMediatorLib.setClassAttributeToNode(ak,"IM_Button_BackNavi");aj=INTERMediatorOnPage.getMessages()[13];if(am["button-names"]&&am["button-names"]["navi-back"]){aj=am["button-names"]["navi-back"]}ak.appendChild(document.createTextNode(aj));q(ak);return ak}function X(am,ar,ak){var aj,ao,aq,ap,at,al,an;aj=ar?"THEAD":"TFOOT";ao=am.parentNode;aq=ao.childNodes;ap=null;for(ad=0;ad<aq.length;ad++){if(aq[ad].tagName===aj){ap=aq[ad];break}}if(ap===null){ap=document.createElement(aj);s.push({targetNode:ap,parentNode:ao,siblingNode:(aj=="THEAD")?ao.firstChild:null})}at=INTERMediatorLib.getElementsByClassName(ap,"IM_Button_BackNavi");if(at.length==0){al=document.createElement("TR");INTERMediatorLib.setClassAttributeToNode(al,"IM_NaviBack_TR");an=document.createElement("TD");INTERMediatorLib.setClassAttributeToNode(an,"IM_NaviBack_TD");m(al);ap.appendChild(al);al.appendChild(an);an.appendChild(ak)}}function ai(an,ak,am,aj){var al,ao;al=document.createElement(am);ao=INTERMediatorLib.getElementsByClassName(Z,"IM_Button_BackNavi");if(ao.length==0){al.appendChild(aj);if(!ak){an.appendChild(al)}else{an.insertBefore(al,an.firstChild)}}}function Q(ar,aq,ao,am){var an=ar,al=aq,ap=ao,at=am,aj,ak;return function(){var au;if(INTERMediatorOnPage.naviBeforeMoveToMaster){INTERMediatorOnPage.naviBeforeMoveToMaster(an,al)}au=al.enclosureNode;if(au.tagName=="TBODY"){au=au.parentNode}au.style.display="none";au=an.enclosureNode;if(au.tagName=="TBODY"){au=au.parentNode}au.style.display=INTERMediator.masterNodeOriginalDisplay;if(ap){document.getElementById("IM_NAVIGATOR").style.display="block"}if(at){INTERMediator.constructMain(an)}if(IMLibUI.mobileNaviBackButtonId){aj=document.getElementById(IMLibUI.mobileNaviBackButtonId);aj.style.display="none"}if(INTERMediatorOnPage.naviAfterMoveToMaster){an=IMLibContextPool.getMasterContext();al=IMLibContextPool.getDetailContext();INTERMediatorOnPage.naviAfterMoveToMaster(an,al)}}}}function q(R){var Q;Q="IM_Button_"+INTERMediator.buttonIdNum;R.setAttribute("id",Q);INTERMediator.buttonIdNum++}function M(S,V,W){var U,T,X,Y,R,Q;if(S.nodeType==1){X=INTERMediatorLib.getLinkedElementInfo(S);for(T=0;T<X.length;T++){Y=INTERMediatorLib.getNodeInfoArray(X[T]);if(Y.table==V&&Y.field==W){return S}}}R=S.childNodes;for(U=0;U<R.length;U++){Q=M(R[U],V,W);if(Q!==null){return Q}}return null}function e(){var T,U,S,Q,R,V;if(document.getElementById("IM_CREDIT")===null){if(INTERMediatorOnPage.creditIncluding){T=document.getElementById(INTERMediatorOnPage.creditIncluding)}if(!T){T=document.getElementsByTagName("BODY")[0]}U=document.createElement("div");T.appendChild(U);U.setAttribute("id","IM_CREDIT");U.setAttribute("class","IM_CREDIT");S=document.createElement("div");U.appendChild(S);S.style.backgroundColor="#F6F7FF";S.style.height="2px";S.style.margin="0";S.style.padding="0";S=document.createElement("div");U.appendChild(S);S.style.backgroundColor="#EBF1FF";S.style.height="2px";S.style.margin="0";S.style.padding="0";S=document.createElement("div");U.appendChild(S);S.style.backgroundColor="#E1EAFF";S.style.height="2px";S.style.margin="0";S.style.padding="0";S=document.createElement("div");U.appendChild(S);S.setAttribute("align","right");S.style.backgroundColor="#D7E4FF";S.style.padding="2px";S.style.margin="0";S.style.padding="0";Q=document.createElement("span");S.appendChild(Q);S.style.color="#666666";S.style.fontSize="7pt";R=document.createElement("a");R.appendChild(document.createTextNode("INTER-Mediator"));R.setAttribute("href","http://inter-mediator.com/");R.setAttribute("target","_href");Q.appendChild(document.createTextNode("Generated by "));Q.appendChild(R);V=" Ver."+INTERMediatorOnPage.metadata.version+"("+INTERMediatorOnPage.metadata.releasedate+")";Q.appendChild(document.createTextNode(V))}}},getLocalProperty:function(b,a){var c;c=IMLibLocalContext.getValue(b);return c===null?a:c},setLocalProperty:function(a,b){IMLibLocalContext.setValue(a,b,true)},addCondition:function(e,f,a){var d,c,b;f.matching=!a;if(INTERMediator.additionalCondition){d=INTERMediator.additionalCondition;if(f){if(!d[e]){d[e]=[]}if(!f.matching){d[e].push(f)}else{b=false;for(c=0;c<d[e].length;c++){if(d[e][c].field==f.field&&d[e][c].operator==f.operator){b=true;d[e][c].value=f.value;break}}if(!b){d[e].push(f)}}}INTERMediator.additionalCondition=d}IMLibLocalContext.archive()},clearCondition:function(b){var a=INTERMediator.additionalCondition;if(a[b]){delete a[b];INTERMediator.additionalCondition=a;IMLibLocalContext.archive()}else{INTERMediator.additionalCondition={};IMLibLocalContext.archive()}},addSortKey:function(c,a){var b=INTERMediator.additionalSortKey;if(b[c]){b[c].push(a)}else{b[c]=[a]}INTERMediator.additionalSortKey=b;IMLibLocalContext.archive()},clearSortKey:function(b){var a=INTERMediator.additionalSortKey;if(a[b]){delete a[b];INTERMediator.additionalSortKey=a;IMLibLocalContext.archive()}}};if(!Object.keys){Object.keys=function(b){var a=[],c;if(b!==Object(b)){throw new TypeError("Object.keys called on a non-object")}for(c in b){if(Object.prototype.hasOwnProperty.call(b,c)){a.push(c)}}return a}}if(!Array.indexOf){var isWebkit="WebkitAppearance" in document.documentElement.style;if(!isWebkit){Array.prototype.indexOf=function(b){var a;for(a=0;a<this.length;a++){if(this[a]===b){return a}}return -1}}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var IMLibElement={setValueToIMNode:function(h,e,p,f){var b,o,q,k,d,a,c,l=false,n,m,g;if(p===undefined){return false}if(!h){return false}if(p===null||p===false){p=""}n=h.tagName;if(f===true&&e==""){switch(n){case"INPUT":switch(h.getAttribute("type")){case"text":h.value="";break;default:break}case"SELECT":break;default:while(h.childNodes.length>0){h.removeChild(h.childNodes[0])}break}}if(e!=null&&e.length>0){if(e.charAt(0)=="#"){e=e.substring(1);if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML+=p}else{if(e=="textNode"||e=="script"){c=document.createTextNode(p);if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}h.appendChild(c)}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{q=h.getAttribute(e);if(p.indexOf("/fmi/xml/cnt/")===0&&q.indexOf("?media=")===-1){p=INTERMediatorOnPage.getEntryPath()+"?media="+p}h.setAttribute(e,q+p)}}}}else{if(e.charAt(0)=="$"){e=e.substring(1);if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML=h.innerHTML.replace("$",p)}else{if(e=="textNode"||e=="script"){if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}h.innerHTML=h.innerHTML.replace("$",p)}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{q=h.getAttribute(e);p=String(p);if(p.indexOf("/fmi/xml/cnt/")===0&&q.indexOf("?media=")===-1){p=INTERMediatorOnPage.getEntryPath()+"?media="+p}h.setAttribute(e,q.replace("$",p))}}}}else{if(INTERMediatorLib.isWidgetElement(h)){h._im_setValue(p)}else{if(e=="innerHTML"){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br>")}h.innerHTML=p}else{if(e=="textNode"){if(n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}c=document.createTextNode(p);h.appendChild(c)}else{if(e=="script"){c=document.createTextNode(p);if(n=="SCRIPT"){h.appendChild(c)}else{k=document.createElement("script");k.type="text/javascript";k.appendChild(c);h.appendChild(k)}}else{if(e.indexOf("style.")==0){b=e.substring(6,e.length);h.style[b]=p}else{h.setAttribute(e,p)}}}}}}}}else{if(INTERMediatorLib.isWidgetElement(h)){h._im_setValue(p)}else{if(n=="INPUT"){d=h.getAttribute("type");if(d=="checkbox"||d=="radio"){a=h.value;m=p.toString().split("\n");if(d=="checkbox"&&m.length>1){for(g=0;g<m.length;g++){if(a==m[g]&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){h.setAttribute("checked","checked")}else{h.checked=true}}}}else{if(a==p&&!INTERMediator.dontSelectRadioCheck){if(INTERMediator.isIE){h.setAttribute("checked","checked")}else{h.checked=true}}else{h.checked=false}}}else{h.value=p}}else{if(n=="SELECT"){l=true;h.value=p}else{if(INTERMediator.defaultTargetInnerHTML){if(INTERMediator.isIE&&n=="TEXTAREA"){p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r").replace(/\r/g,"<br/>")}h.innerHTML=p}else{if(n=="TEXTAREA"){if(INTERMediator.isTrident&&INTERMediator.ieVersion>=11){p=p.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}else{p=p.replace(/\r\n/g,"\r").replace(/\n/g,"\r")}}c=document.createTextNode(p);h.appendChild(c)}}}}}if(n==="INPUT"||n==="SELECT"||n==="TEXTAREA"){INTERMediatorLib.addEvent(h,"blur",function(s){var r=h.id;if(!IMLibUI.valueChange(r,true)){h.focus()}})}return l},getValueFromIMNode:function(f){var g,d,b,a,h,l,e,c;if(f){g=f.tagName;d=f.getAttribute("type")}else{return""}if(INTERMediatorLib.isWidgetElement(f)||(INTERMediatorLib.isWidgetElement(f.parentNode))){b=f._im_getValue()}else{if(g=="INPUT"){if(d=="checkbox"){a=INTERMediatorOnPage.getDBSpecification();if(a["db-class"]!=null&&a["db-class"]=="FileMaker_FX"){h=[];l=f.parentNode.getElementsByTagName("INPUT");for(e=0;e<l.length;e++){if(l[e].checked){h.push(l[e].getAttribute("value"))}}b=h.join("\n")}else{c=f.getAttribute("value");if(f.checked){b=c}else{b=""}}}else{if(d=="radio"){b=f.value}else{b=f.value}}}else{if(g=="SELECT"){b=f.value}else{if(g=="TEXTAREA"){b=f.value}else{b=f.innerHTML}}}}return b},deleteNodes:function(n){var b,a,l,h,g,e,c,f,d,p,o;for(o=0;o<n.length;o++){b=document.getElementById(n[o]);if(b){a=INTERMediatorLib.getElementsByIMManaged(b);if(a){for(l=0;l<a.length;l++){e=a[l].id;if(e in IMLibCalc.calculateRequiredObject){delete IMLibCalc.calculateRequiredObject[e]}}for(l=0;l<a.length;l++){e=a[l].id;for(c in IMLibCalc.calculateRequiredObject){if(IMLibCalc.calculateRequiredObject.hasOwnProperty(c)){f=IMLibCalc.calculateRequiredObject[c];d={};p={};for(h in f.referes){if(f.referes.hasOwnProperty(h)){d[h]=[];p[h]=[];for(g=0;g<f.referes[h].length;g++){if(e!=f.referes[h][g]){d[h].push(f.referes[h][g]);p[h].push(f.values[h][g])}}}}f.referes=d;f.values=p}}}}try{b.parentNode.removeChild(b)}catch(m){}}}}};IMLibEventResponder={touchEventCancel:false,isSetup:false,setup:function(){var a;if(IMLibEventResponder.isSetup){return}IMLibEventResponder.isSetup=true;IMLibChangeEventDispatch=new IMLibEventDispatch();IMLibKeyEventDispatch=new IMLibEventDispatch();IMLibMouseEventDispatch=new IMLibEventDispatch();a=document.getElementsByTagName("BODY")[0];INTERMediatorLib.addEvent(a,"change",function(g){var d=g?g:window.event;if(!d){return}var f=d.target;if(!f){f=d.srcElement;if(!f){return}}var c=f.id;if(!c){return}var b=IMLibChangeEventDispatch.dispatchTable[c];if(!b){return}b(c)});INTERMediatorLib.addEvent(a,"keydown",function(h){var f,b,g,d;f=h?h:window.event;if(f.charCode){b=f.charCode}else{b=f.keyCode}if(!f){return}g=f.target;if(!g){g=f.srcElement;if(!g){return}}d=g.id;if(!d){return}if(!IMLibKeyEventDispatch.dispatchTable[d]){return}var c=IMLibKeyEventDispatch.dispatchTable[d][b];if(!c){return}c(f)});INTERMediatorLib.addEvent(a,"click",function(f){var b,g,c,m,h,d,l,k;b=f?f:window.event;if(!b){return}g=b.target;if(!g){g=b.srcElement;if(!g){return}}c=g.id;if(!c){return}m=IMLibMouseEventDispatch.dispatchTable[c];if(m){m(b);return}h=INTERMediatorLib.getLinkedElementInfo(g);for(d=0;d<h.length;d++){m=IMLibMouseEventDispatch.dispatchTableTarget[h[d]];if(m){l=INTERMediatorLib.getNodeInfoArray(h[d]);if(l.target){k=g.getAttribute(l.target)}else{k=IMLibElement.getValueFromIMNode(g)}m(k,g);return}}})}};var IMLibChangeEventDispatch;var IMLibKeyEventDispatch;var IMLibMouseEventDispatch;function IMLibEventDispatch(){this.dispatchTable={};this.dispatchTableTarget={};this.clearAll=function(){this.dispatchTable={};this.dispatchTableTarget={}};this.setExecute=function(b,a){if(b&&a){this.dispatchTable[b]=a}};this.setTargetExecute=function(b,a){if(b&&a){this.dispatchTableTarget[b]=a}};this.setExecuteByCode=function(c,b,a){if(c&&b){if(!this.dispatchTable[c]){this.dispatchTable[c]={}}this.dispatchTable[c][b]=a}}}IMLibContextPool={poolingContexts:null,clearAll:function(){this.poolingContexts=null},registerContext:function(a){if(this.poolingContexts==null){this.poolingContexts=[a]}else{this.poolingContexts.push(a)}},excludingNode:null,synchronize:function(a,c,n,m,g,k){var e,d,l,f,h,o=false,b;l=a.viewName;if(this.poolingContexts==null){return null}if(k){for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].binding[c][n][k]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined&&this.poolingContexts[e].store[c][n][k]!==undefined){this.poolingContexts[e].store[c][n][k]=m;h=this.poolingContexts[e].binding[c][n][k];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);if(f){IMLibElement.setValueToIMNode(f,h[d].target,m,true)}}}}}else{for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].viewName===l&&this.poolingContexts[e].binding[c]!==undefined&&this.poolingContexts[e].binding[c][n]!==undefined&&this.poolingContexts[e].store[c]!==undefined&&this.poolingContexts[e].store[c][n]!==undefined){this.poolingContexts[e].store[c][n]=m;h=this.poolingContexts[e].binding[c][n];for(d=0;d<h.length;d++){f=document.getElementById(h[d].id);b=h[d].id;if(h[d].target&&h[d].target.length>0){b+=INTERMediator.separator+h[d].target}if(f&&!(b in IMLibCalc.calculateRequiredObject)){IMLibElement.setValueToIMNode(f,h[d].target,m,true)}}}}}return o},getContextInfoFromId:function(a,g){var d,b,e,f,h,c,k=null;if(!a){return k}e=document.getElementById(a);if(!e){return k}f=INTERMediatorLib.getLinkedElementInfo(e);if(!f&&INTERMediatorLib.isWidgetElement(e.parentNode)){f=INTERMediatorLib.getLinkedElementInfo(e.parentNode)}h=INTERMediatorLib.getNodeInfoArray(f[0]);c=g===""?"_im_no_target":g;if(this.poolingContexts===null){return null}for(d=0;d<this.poolingContexts.length;d++){b=this.poolingContexts[d];if(b.contextInfo[a]&&b.contextInfo[a][c]&&b.contextInfo[a][c].context.contextName==h.table){k=b.contextInfo[a][c];return k}}return null},getKeyFieldValueFromId:function(a,d){var b=this.getContextInfoFromId(a,d);if(!b){return null}var f=b.context.contextName;var c=IMLibContextPool.getContextDef(f);if(!c){return null}var e=c.key?c.key:"id";return b.record.substr(e.length+1)},updateContext:function(a,d){var b,c;b=IMLibContextPool.getContextInfoFromId(a,d);c=IMLibElement.getValueFromIMNode(document.getElementById(a));if(b){b.context.setValue(b.record,b.field,c,false,d,b.portal)}},contextFromEnclosureId:function(a){var b,c;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){c=this.poolingContexts[b].enclosureNode;if(c.getAttribute("id")==a){return this.poolingContexts[b]}}return null},contextFromName:function(a){var b;if(!a){return false}for(b=0;b<this.poolingContexts.length;b++){if(this.poolingContexts[b].contextName==a){return this.poolingContexts[b]}}return null},getContextFromName:function(b){var c,a=[];if(!b){return false}for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].contextName==b){a.push(this.poolingContexts[c])}}return a},getContextsFromNameAndForeignValue:function(b,c,f){var e,d,a=[],f;if(!b){return false}for(e=0;e<this.poolingContexts.length;e++){if(this.poolingContexts[e].contextName==b&&this.poolingContexts[e].foreignValue[f]==c){a.push(this.poolingContexts[e])}}return a},dependingObjects:function(b){var d,c,a=[];if(!b){return false}for(d=0;d<this.poolingContexts.length;d++){for(c=0;c<this.poolingContexts[d].dependingObject.length;c++){if(this.poolingContexts[d].dependingObject[c]==b){a.push(this.poolingContexts[d])}}}return a.length==0?false:a},getChildContexts:function(b){var c,a=[];for(c=0;c<this.poolingContexts.length;c++){if(this.poolingContexts[c].parentContext==b){a.push(this.poolingContexts[c])}}return a},childContexts:null,removeContextsFromPool:function(d){var a,c=[],b=[];for(a=0;a<this.poolingContexts.length;a++){if(d.indexOf(this.poolingContexts[a])>-1){c.push(this.poolingContexts[a].registeredId);b.push(a)}}for(a=b.length-1;a>-1;a--){this.poolingContexts.splice(b[a],1)}return c},removeRecordFromPool:function(n){var e,d,l,h=[],b,f,c,m,a,k;a=g(n);if(a==null){return}k=this.getContextsWithSameOrigin(a.context.sourceName);k.push(a.context);b=a.key;for(e=0;e<k.length;e++){f=k[e].binding[b];for(l in f){if(f.hasOwnProperty(l)){for(d=0;d<f[l].length;d++){if(h.indexOf(f[l][d].id)<0){h.push(f[l][d].id)}}}}}m=[];for(e=0;e<k.length;e++){for(c in k[e].contextInfo){if(k[e].contextInfo.hasOwnProperty(c)){if(h.indexOf(c)>=0){delete a.context.contextInfo[c];m.push(c)}}}delete k[e].binding[b];delete k[e].store[b]}IMLibElement.deleteNodes(m);this.poolingContexts=this.poolingContexts.filter(function(o){return h.indexOf(o.enclosureNode.id)<0});function g(q){var p,r,o,s;for(p=0;p<IMLibContextPool.poolingContexts.length;p++){for(s in IMLibContextPool.poolingContexts[p].binding){if(IMLibContextPool.poolingContexts[p].binding.hasOwnProperty(s)){for(r in IMLibContextPool.poolingContexts[p].binding[s]){if(IMLibContextPool.poolingContexts[p].binding[s].hasOwnProperty(r)&&r=="_im_repeater"){for(o=0;o<IMLibContextPool.poolingContexts[p].binding[s][r].length;o++){if(q==IMLibContextPool.poolingContexts[p].binding[s][r][o].id){return({context:IMLibContextPool.poolingContexts[p],key:s})}}}}}}}return null}},getContextsWithSameOrigin:function(b){var a,c=[];for(a=0;a<IMLibContextPool.poolingContexts.length;a++){if(IMLibContextPool.poolingContexts[a].sourceName==b){c.push(IMLibContextPool.poolingContexts[a])}}return c},updateOnAnotherClient:function(l,a){var g,f,e,n=a.entity,h,o,d,b;if(l=="update"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){d=h.key;b=d+"="+a.pkvalue;this.poolingContexts[g].setValue(b,a.field[0],a.value[0]);var c=this.poolingContexts[g].binding[b][a.field[0]];for(f=0;f<c.length;f++){var m=IMLibContextPool.dependingObjects(c[f].id);for(e=0;e<m.length;e++){m[e].foreignValue={};m[e].foreignValue[a.field[0]]=a.value[0];if(m[e]){INTERMediator.constructMain(m[e])}}}}}IMLibCalc.recalculation()}else{if(l=="create"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){if(this.poolingContexts[g].isContaining(a.value[0])){INTERMediator.constructMain(this.poolingContexts[g],a.value)}}}IMLibCalc.recalculation()}else{if(l=="delete"){for(g=0;g<this.poolingContexts.length;g++){h=this.getContextDef(this.poolingContexts[g].contextName);o=h.view?h.view:h.name;if(o==n){this.poolingContexts[g].removeEntry(a.pkvalue)}}IMLibCalc.recalculation()}}}},getMasterContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/master/)){return this.poolingContexts[a]}}return null},getDetailContext:function(){var a,b;if(!this.poolingContexts){return null}for(a=0;a<this.poolingContexts.length;a++){b=this.poolingContexts[a].getContextDef();if(b["navi-control"]&&b["navi-control"].match(/detail/)){return this.poolingContexts[a]}}return null},getContextDef:function(a){return INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",a)}};IMLibContext=function(a){this.contextName=a;this.tableName=null;this.viewName=null;this.sourceName=null;this.store={};this.binding={};this.contextInfo={};this.modified={};this.recordOrder=[];this.pendingOrder=[];IMLibContextPool.registerContext(this);this.foreignValue={};this.enclosureNode=null;this.repeaterNodes=null;this.dependingObject=[];this.original=null;this.nullAcceptable=true;this.parentContext=null;this.registeredId=null;this.sequencing=false;this.dependingParentObjectInfo=null;this.getInsertOrder=function(c){var b,h=[],g,f,e=[],d=[];for(b in INTERMediator.additionalSortKey){if(b==this.contextName){h.push(INTERMediator.additionalSortKey[b])}}g=this.getContextDef();if(g.sort){h.push(g.sort)}for(f=0;f<h.length;f++){if(e.indexOf(h[f].field)<0){e.push(h[f].field);d.push(h[f].direction)}}};this.clearAll=function(){this.store={};this.binding={}};this.setContextName=function(b){this.contextName=b};this.setTableName=function(b){this.tableName=b};this.setViewName=function(b){this.viewName=b};this.addDependingObject=function(b){this.dependingObject.push(b)};this.addForeignValue=function(c,b){this.foreignValue[c]=b};this.setOriginal=function(c){var b;this.original=[];for(b=0;b<c.length;b++){this.original.push(c[b].cloneNode(true))}};this.setTable=function(b){var c;if(!b||!INTERMediatorOnPage.getDataSources){this.tableName=this.contextName;this.viewName=this.contextName;this.sourceName=this.contextName;return}c=this.getContextDef();if(c){this.viewName=c.view?c.view:c.name;this.tableName=c.table?c.table:c.name;this.sourceName=(c.source?c.source:(c.table?c.table:(c.view?c.view:c.name)))}};this.removeContext=function(){var d=[],c=[];b(this);d=IMLibContextPool.removeContextsFromPool(c);while(this.enclosureNode.firstChild){this.enclosureNode.removeChild(this.enclosureNode.firstChild)}INTERMediator_DBAdapter.unregister(d);function b(g){var f,e;c.push(g);d.push(g.registeredId);e=IMLibContextPool.getChildContexts(g);for(f=0;f<e.length;f++){b(e[f])}}};this.setModified=function(d,b,c){if(this.modified[d]===undefined){this.modified[d]={}}this.modified[d][b]=c};this.getModified=function(){return this.modified};this.clearModified=function(){this.modified={}};this.getContextDef=function(){var b;b=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",this.contextName);return b};this.checkOrder=function(l,p){var d,g=[],m=[],q,k,e,o,h,b,c,f,n;if(p!==true){if(INTERMediator&&INTERMediator.additionalSortKey[this.contextName]){for(d=0;d<INTERMediator.additionalSortKey[this.contextName].length;d++){q=INTERMediator.additionalSortKey[this.contextName][d];if(!q.field in g){g.push(q.field);m.push(q.direction)}}}k=this.getContextDef();if(k&&k.sort){for(d=0;d<k.sort.length;d++){q=k.sort[d];if(!q.field in g){g.push(q.field);m.push(q.direction)}}}}else{g=["field1","field2"]}e=0;o=this.recordOrder.length;for(d=0;d<g.length;d++){if(l[g[d]]){h=parseInt((o+e)/2);do{b=this.store[this.recordOrder[h]];c=b[g[d]];f=l[g[d]];if(c<f){e=h}else{if(c>f){o=h}else{e=o=h}}h=parseInt((o+e)/2)}while(o-e>1);b=this.store[this.recordOrder[h]];c=b[g[d]];if(c==f){e=o=h;n=false;do{b=this.store[this.recordOrder[e-1]];if(b&&b[g[d]]&&b[g[d]]==f){e--}else{n=true}}while(!n);n=false;do{b=this.store[this.recordOrder[o+1]];if(b&&b[g[d]]&&b[g[d]]==f){o++}else{n=true}}while(!n);if(e==o){break}o++}else{if(c<f){break}else{if(c>f){h--;break}}}}}if(p===true){console.log("#lower="+e+",upper="+o+",index="+h+",contextValue="+c+",checkingValue="+f)}return h};this.rearrangePendingOrder=function(e){var d,c,b;for(d=0;d<this.pendingOrder.length;d++){b=this.store[this.pendingOrder[d]];c=this.checkOrder(b,e);if(c>=-1){this.recordOrder.splice(c+1,0,this.pendingOrder[d])}else{}}this.pendingOrder=[]};this.getRepeaterEndNode=function(k){var c,m,h=[],l,e,f,n,g,b;var d=this.recordOrder[k];for(m in this.binding[d]){c=this.binding[d][m].nodeId;l=INTERMediatorLib.getParentRepeater(document.getElementById(c));if(!l in h){h.push(l)}}if(h.length<1){return null}e=h[0];g=INTERMediatorLib.getParentEnclosure(e);b=g.childNodes;for(f=0;f<b.length;f++){if(b[f] in h){e=h[f];break}}return e};this.setDataAtLastRecord=function(c,e){var b,d;var f=Object.keys(this.store);if(f.length>0){b=f[f.length-1];this.setValue(b,c,e);d=b.split("=");INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:d[0],operator:"=",value:d[1]}],dataset:[{field:c,value:e}]});IMLibCalc.recalculation();INTERMediator.flushMessage()}};this.setDataWithKey=function(e,d,h){var b,g,f,c;var k=Object.keys(this.store);g=this.getContextDef();if(!g){return}b=g.key+"="+e;c=this.store[b];if(c){this.setValue(b,d,h);INTERMediator_DBAdapter.db_update({name:this.contextName,conditions:[{field:g.key,operator:"=",value:e}],dataset:[{field:d,value:h}]});INTERMediator.flushMessage()}};this.setValue=function(g,c,d,f,e,b){if(g!=undefined&&g!=null){if(this.store[g]===undefined){this.store[g]={}}if(b&&this.store[g][c]===undefined){this.store[g][c]={}}if(this.binding[g]===undefined){this.binding[g]={};if(this.sequencing){this.recordOrder.push(g)}else{this.pendingOrder.push(g)}}if(this.binding[g][c]===undefined){this.binding[g][c]=[]}if(b&&this.binding[g][c][b]===undefined){if(this.binding[g][c].length<1){this.binding[g][c]={}}this.binding[g][c][b]=[]}if(c!=undefined&&c!=null){if(b){this.store[g][c][b]=d}else{this.store[g][c]=d}if(f){if(b){this.binding[g][c][b].push({id:f,target:e})}else{this.binding[g][c].push({id:f,target:e})}if(this.contextInfo[f]===undefined){this.contextInfo[f]={}}this.contextInfo[f][e==""?"_im_no_target":e]={context:this,record:g,field:c};if(b){this.contextInfo[f][e==""?"_im_no_target":e].portal=b}}else{IMLibContextPool.synchronize(this,g,c,d,e,b)}}}};this.getValue=function(f,d,b){var e;try{if(b){e=this.store[f][d][b]}else{e=this.store[f][d]}return e===undefined?null:e}catch(c){return null}};this.isValueUndefined=function(f,d,b){var e;try{if(b){e=this.store[f][d][b]}else{e=this.store[f][d]}return e===undefined?true:false}catch(c){return null}};this.getContextInfo=function(e,d){try{var c=this.contextInfo[e][d==""?"_im_no_target":d];return c===undefined?null:c}catch(b){return null}};this.getContextValue=function(f,e){try{var d=this.contextInfo[f][e==""?"_im_no_target":e];var c=d.context.getValue(d.record,d.field);return c===undefined?null:c}catch(b){return null}};this.getContextRecord=function(f){var e,d,c;try{e=this.contextInfo[f];d=Object.keys(e);for(c=0;c<d.length;c++){if(e[d[c]]){return this.store[e[d[c]].record]}}return null}catch(b){return null}};this.removeEntry=function(c){var d,h,b,g,k,m,e,f,l=[];g=this.getContextDef();d=g.key;h=d+"="+c;b=this.binding[h];if(b){m=b._im_repeater;if(m){for(e=0;e<m.length;e++){l.push(m[e].id)}}}if(l.length>0){for(e=0;e<l.length;e++){IMLibContextPool.removeRecordFromPool(l[e])}for(e=0;e<l.length;e++){k=document.getElementById(l[e]);if(k){f=INTERMediatorLib.getParentRepeater(k);if(f){f.parentNode.removeChild(k)}}}}};this.isContaining=function(k){var g,d,o=[],f,m,p,n,c,l,h,b;g=this.getContextDef();d=g.name;if(g.query){for(f in g.query){o.push(e(g.query[f],k))}}if(INTERMediator.additionalCondition[d]){for(f=0;f<INTERMediator.additionalCondition[d].length;f++){o.push(e(INTERMediator.additionalCondition[d][f],k))}}p=true;if(o.length!=0){n=o.indexOf("D");if(n>-1){c=o.slice(0,n);l=n.slice(n+1);if(l.length==0){p=(c.indexOf(false)<0)}else{h=(c.indexOf(false)<0);b=(l.indexOf(false)<0);p=h||b}}else{n=o.indexOf("EX");if(n>-1){c=o.slice(0,n);l=n.slice(n+1);if(l.length==0){p=(c.indexOf(true)>-1)}else{h=(c.indexOf(true)>-1);b=(l.indexOf(true)>-1);p=h&&b}}else{n=o.indexOf(false);if(n>-1){p=(o.indexOf(false)<0)}}}if(p==false){return false}}if(this.foreignValue){for(m in this.foreignValue){if(g.relation){for(f in g.relation){if(g.relation[f]["join-field"]==m){p&=(e({field:g.relation[f]["foreign-key"],operator:"=",value:this.foreignValue[m]},k))}}}}}return p;function e(r,q){var s;if(r.field=="__operation__"){return r.operator=="ex"?"EX":"D"}s=q[r.field];if(!s){return false}switch(r.operator){case"=":case"eq":return s==r.value;break;case">":case"gt":return s>r.value;break;case"<":case"lt":return s<r.value;break;case">=":case"gte":return s>=r.value;break;case"<=":case"lte":return s<=r.value;break;case"!=":case"neq":return s!=r.value;break;default:return false}}};this.insertEntry=function(g,b,c){var d,f,e;for(d=0;d<b.length;d++){f=b[d];e=c[d];this.setValue(g,f,e)}};this.setTable(this)};IMLibLocalContext={contextName:"_",store:{},binding:{},clearAll:function(){this.store={}},setValue:function(d,g,b){var c,f,a,e;f=false;if(d!=undefined&&d!=null){if(g===undefined||g===null){delete this.store[d]}else{this.store[d]=g;f=true;a=this.binding[d];if(a){for(c=0;c<a.length;c++){e=document.getElementById(a[c]);IMLibElement.setValueToIMNode(e,"",g,true)}}}}if(f&&!(b===true)){this.archive()}},getValue:function(a){var b=this.store[a];return b===undefined?null:b},archive:function(){var f,e,d,b,a;INTERMediatorOnPage.removeCookie("_im_localcontext");if(INTERMediator.isIE&&INTERMediator.ieVersion<9){this.store._im_additionalCondition=INTERMediator.additionalCondition;this.store._im_additionalSortKey=INTERMediator.additionalSortKey;this.store._im_startFrom=INTERMediator.startFrom;this.store._im_pagedSize=INTERMediator.pagedSize;f=JSON.stringify(this.store,function(h,g){return g===""?"":g})}else{f=JSON.stringify(this.store)}if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{d=location.search?location.search.length:0;b=location.hash?location.hash.length:0;a=d+b;e="_im_localcontext"+document.URL.toString();e=(a>0)?e.slice(0,-a):e;sessionStorage.setItem(e,f)}catch(c){INTERMediatorOnPage.setCookieWorker("_im_localcontext",f,false,0)}}else{INTERMediatorOnPage.setCookieWorker("_im_localcontext",f,false,0)}},unarchive:function(){var f="",e,b,d,a;if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{e=location.search?location.search.length:0;b=location.hash?location.hash.length:0;a=e+b;d="_im_localcontext"+document.URL.toString();d=(a>0)?d.slice(0,-a):d;f=sessionStorage.getItem(d)}catch(c){f=INTERMediatorOnPage.getCookie("_im_localcontext")}}else{f=INTERMediatorOnPage.getCookie("_im_localcontext")}if(f&&f.length>0){this.store=JSON.parse(f);if(INTERMediator.isIE&&INTERMediator.ieVersion<9){if(this.store._im_additionalCondition){INTERMediator.additionalCondition=this.store._im_additionalCondition}if(this.store._im_additionalSortKey){INTERMediator.additionalSortKey=this.store._im_additionalSortKey}if(this.store._im_startFrom){INTERMediator.startFrom=this.store._im_startFrom}if(this.store._im_pagedSize){INTERMediator.pagedSize=this.store._im_pagedSize}}this.updateAll()}},bindingNode:function(b){var n,l,a,e,d,h,c,m,k;if(b.nodeType!=1){return}n=INTERMediatorLib.getLinkedElementInfo(b);for(e=0;e<n.length;e++){l=INTERMediatorLib.getNodeInfoArray(n[e]);if(l.table==this.contextName){if(!b.id){b.id=g()}a=b.id;if(!this.binding[l.field]){this.binding[l.field]=[]}if(this.binding[l.field].indexOf(a)<0){this.binding[l.field].push(a)}k=-1;while(k>=0){for(d=0;d<this.binding[l.field].length;d++){if(!document.getElementById(this.binding[l.field][d])){k=d}}if(k>=0){delete this.binding[l.field][k]}}c=l.field.split(":");switch(c[0]){case"addorder":IMLibMouseEventDispatch.setExecute(a,IMLibUI.eventAddOrderHandler);break;case"update":IMLibMouseEventDispatch.setExecute(a,(function(){var o=c[1];return function(){IMLibUI.eventUpdateHandler(o)}})());break;case"condition":IMLibKeyEventDispatch.setExecuteByCode(a,13,(function(){var o=c[1];return function(){INTERMediator.startFrom=0;IMLibUI.eventUpdateHandler(o);IMLibPageNavigation.navigationSetup()}})());break;case"limitnumber":IMLibChangeEventDispatch.setExecute(a,(function(){var o=c[1];return function(){INTERMediator.pagedSize=document.getElementById(a).value;IMLibUI.eventUpdateHandler(o);IMLibPageNavigation.navigationSetup()}})());break;default:IMLibChangeEventDispatch.setExecute(a,IMLibLocalContext.update);break}h=this.store[l.field];IMLibElement.setValueToIMNode(b,l.target,h,true)}}function g(){INTERMediator.linkedElmCounter++;return f()}function f(){return"IM"+INTERMediator.currentEncNumber+"-"+INTERMediator.linkedElmCounter}},update:function(a){IMLibLocalContext.updateFromNodeValue(a)},updateFromNodeValue:function(a){var e,b,f,d,c;e=document.getElementById(a);b=IMLibElement.getValueFromIMNode(e);f=INTERMediatorLib.getLinkedElementInfo(e);for(c=0;c<f.length;c++){IMLibLocalContext.store[f[c]]=b;d=INTERMediatorLib.getNodeInfoArray(f[c]);if(d.table==IMLibLocalContext.contextName){IMLibLocalContext.setValue(d.field,b)}}},updateFromStore:function(b){var f,c,h,e,d,g,a;f=document.getElementById(b);g=f.getAttribute("data-im");a=g.split(INTERMediator.separator);if(a[1]){c=IMLibLocalContext.store[a[1]];h=INTERMediatorLib.getLinkedElementInfo(f);for(d=0;d<h.length;d++){IMLibLocalContext.store[h[d]]=c;e=INTERMediatorLib.getNodeInfoArray(h[d]);if(e.table==IMLibLocalContext.contextName){IMLibLocalContext.setValue(e.field,c)}}}},updateAll:function(e){var b,d,c,a,f;for(d in IMLibLocalContext.binding){c=IMLibLocalContext.binding[d];for(b=0;b<c.length;b++){a=c[b];f=document.getElementById(a);if(f&&(f.tagName=="INPUT"||f.tagName=="TEXTAREA"||f.tagName=="SELECT")){if(e===true){IMLibLocalContext.updateFromStore(a)}else{IMLibLocalContext.updateFromNodeValue(a)}break}}}},bindingDescendant:function(b){var a=this;c(b);function c(g){var f,e;if(g.nodeType===1){try{a.bindingNode(g);f=g.childNodes;if(f){for(e=0;e<f.length;e++){c(f[e])}}}catch(d){if(d=="_im_requath_request_"){throw d}else{INTERMediator.setErrorMessage(d,"EXCEPTION-31")}}}}}};var INTERMediatorLib={ignoreEnclosureRepeaterClassName:"_im_ignore_enc_rep",ignoreEnclosureRepeaterControlName:"ignore_enc_rep",roleAsRepeaterClassName:"_im_repeater",roleAsEnclosureClassName:"_im_enclosure",roleAsRepeaterDataControlName:"repeater",roleAsEnclosureDataControlName:"enclosure",roleAsSeparatorDataControlName:"separator",roleAsHeaderDataControlName:"header",roleAsFooterDataControlName:"footer",roleAsNoResultDataControlName:"noresult",cachedDigitSeparator:null,initialize:function(){var b,f,a,e,d;try{b=new Number(1000.1);f=b.toLocaleString();a=f.substr(-2,1);f=f.substring(0,f.length-2);e=f.match(/[^0-9]/)[0];d=f.length-f.indexOf(e)-1;INTERMediatorLib.cachedDigitSeparator=[a,e,d]}catch(c){INTERMediatorLib.cachedDigitSeparator=[".",",",3]}IMLibLocalContext.unarchive();return null},setup:function(){if(window.addEventListener){window.addEventListener("load",this.initialize,false)}else{if(window.attachEvent){window.attachEvent("onload",this.initialize)}else{window.onload=this.initialize}}return null},digitSeparator:function(){return this.cachedDigitSeparator},generatePasswordHash:function(d){var f,e,c,g,a,b;f=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];e="";c="";for(i=0;i<4;i++){g=Math.floor(Math.random()*(128-32)+32);a=g&15;b=(g>>4)&15;e+=String.fromCharCode(g);c+=f[b]+f[a]}return encodeURIComponent(SHA1(d+e)+c)},getParentRepeater:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isRepeater(a,true)){return a}a=a.parentNode}return null},getParentEnclosure:function(b){var a=b;while(a!=null){if(INTERMediatorLib.isEnclosure(a,true)){return a}a=a.parentNode}return null},isEnclosure:function(f,g){var c,e,b,a,d;if(!f||f.nodeType!==1){return false}e=INTERMediatorLib.getClassAttributeFromNode(f);if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}d=f.getAttribute("data-im-control");if(d&&d.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}c=f.tagName;if((c==="TBODY")||(c==="UL")||(c==="OL")||(c==="SELECT")||((c==="DIV"||c==="SPAN")&&e&&e.indexOf(INTERMediatorLib.roleAsEnclosureClassName)>=0)||(d&&d.indexOf(INTERMediatorLib.roleAsEnclosureDataControlName)>=0)){if(g){return true}else{b=f.childNodes;for(a=0;a<b.length;a++){if(INTERMediatorLib.isRepeater(b[a],true)){return true}}}}return false},isRepeater:function(g,h){var d,f,c,b,e;if(!g||g.nodeType!==1){return false}f=INTERMediatorLib.getClassAttributeFromNode(g);if(f&&f.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterClassName)>=0){return false}e=g.getAttribute("data-im-control");if(e&&e.indexOf(INTERMediatorLib.ignoreEnclosureRepeaterControlName)>=0){return false}d=g.tagName;if((d==="TR")||(d==="LI")||(d==="OPTION")||(f&&f.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)||(e&&e.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)){if(h){return true}else{return a(g)}}return false;function a(k){if(INTERMediatorLib.isLinkedElement(k)){return true}c=k.childNodes;for(b=0;b<c.length;b++){if(c[b].nodeType===1){if(INTERMediatorLib.isLinkedElement(c[b])){return true}else{if(a(c[b])){return true}}}}return false}},isLinkedElement:function(c){var d,b,a;if(c!=null){a=c.getAttribute("data-im");if(a){return true}if(INTERMediator.titleAsLinkInfo){if(c.getAttribute("TITLE")!=null&&c.getAttribute("TITLE").length>0){return true}}if(INTERMediator.classAsLinkInfo){d=INTERMediatorLib.getClassAttributeFromNode(c);if(d!=null){b=d.match(/IM\[.*\]/);if(b){return true}}}}return false},isWidgetElement:function(d){var e,c,b,a;if(!d){return false}if(INTERMediatorLib.getLinkedElementInfo(d)){b=d.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(d);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}else{a=d.parentNode;if(!a&&INTERMediatorLib.getLinkedElementInfo(a)){b=a.getAttribute("data-im-widget");if(b){return true}e=INTERMediatorLib.getClassAttributeFromNode(a);if(e!=null){c=e.match(/IM_WIDGET\[.*\]/);if(c){return true}}}}return false},isNamedElement:function(b){var c,a;if(b!=null){c=b.getAttribute("data-im-group");if(c){return true}c=b.getAttribute("name");if(c){a=c.match(/IM\[.*\]/);if(a){return true}}}return false},getEnclosureSimple:function(a){if(INTERMediatorLib.isEnclosure(a,true)){return a}return INTERMediatorLib.getEnclosureSimple(a.parentNode)},getEnclosure:function(d){var c,b;c=d;while(c!=null){if(INTERMediatorLib.isRepeater(c,true)){b=c}else{if(a(b,c)){b=null;return c}}c=c.parentNode}return null;function a(n,l){var m,f,g,e,h,k,o;if(!n||!l){return false}m=n.tagName;f=l.tagName;if((m==="TR"&&f==="TBODY")||(m==="OPTION"&&f==="SELECT")||(m==="LI"&&f==="OL")||(m==="LI"&&f==="UL")){return true}g=INTERMediatorLib.getClassAttributeFromNode(l);h=l.getAttribute("data-im-control");if((g&&g.indexOf(INTERMediatorLib.roleAsEnclosureClassName)>=0)||(h&&h.indexOf("enclosure")>=0)){e=INTERMediatorLib.getClassAttributeFromNode(n);k=n.getAttribute("data-im-control");if((e&&e.indexOf(INTERMediatorLib.roleAsRepeaterClassName)>=0)||(k&&k.indexOf(INTERMediatorLib.roleAsRepeaterDataControlName)>=0)||(k&&k.indexOf(INTERMediatorLib.roleAsSeparatorDataControlName)>=0)||(k&&k.indexOf(INTERMediatorLib.roleAsFooterDataControlName)>=0)||(k&&k.indexOf(INTERMediatorLib.roleAsHeaderDataControlName)>=0)||(k&&k.indexOf(INTERMediatorLib.roleAsNoResultDataControlName)>=0)){return true}else{if(m==="INPUT"){o=n.getAttribute("type");if(o&&((o.indexOf("radio")>=0||o.indexOf("check")>=0))){return true}}}}return false}},getLinkedElementInfo:function(h){var c=[],d,g,e,b,a;if(INTERMediatorLib.isLinkedElement(h)){b=h.getAttribute("data-im");if(b!==null&&b.length>0){g=new RegExp("[\\s"+INTERMediator.defDivider+"]+");d=b.split(g);for(e=0;e<d.length;e++){if(d[e]&&d[e].length>0){c.push(f(d[e]))}}return c}if(INTERMediator.titleAsLinkInfo&&h.getAttribute("TITLE")!=null){d=h.getAttribute("TITLE").split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}return c}if(INTERMediator.classAsLinkInfo){b=INTERMediatorLib.getClassAttributeFromNode(h);if(b!==null&&b.length>0){a=b.match(/IM\[([^\]]*)\]/);d=a[1].split(INTERMediator.defDivider);for(e=0;e<d.length;e++){c.push(f(d[e]))}}return c}}return false;function f(l){var k=INTERMediatorOnPage.getOptionsAliases();if(k!=null&&k[l]!=null){return k[l]}return l}},getWidgetInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isWidgetElement(g)){d=g.getAttribute("data-im-widget");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=INTERMediatorLib.getClassAttributeFromNode(g);if(d&&d.length>0){a=d.match(/IM_WIDGET\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},getNamedInfo:function(g){var b=[],c,e,d,a,f;if(INTERMediatorLib.isNamedElement(g)){d=g.getAttribute("data-im-group");if(d&&d.length>0){f=new RegExp("[\\s"+INTERMediator.defDivider+"]+");c=d.split(f);for(e=0;e<c.length;e++){if(c[e]&&c[e].length>0){b.push(c[e])}}return b}d=g.getAttribute("name");if(d&&d.length>0){a=d.match(/IM\[([^\]]*)\]/);c=a[1].split(INTERMediator.defDivider);for(e=0;e<c.length;e++){b.push(c[e])}return b}}return false},repeaterTagFromEncTag:function(a){if(a=="TBODY"){return"TR"}else{if(a=="SELECT"){return"OPTION"}else{if(a=="UL"){return"LI"}else{if(a=="OL"){return"LI"}}}}return null},getNodeInfoArray:function(b){var e,a,d,c;if(!b||!b.split){return{table:null,field:null,target:null,tableindex:null}}e=b.split(INTERMediator.separator);a="";d="";c="";if(e.length==3){a=e[0];d=e[1];c=e[2]}else{if(e.length==2){a=e[0];d=e[1]}else{d=b}}return{table:a,field:d,target:c,tableindex:"_im_index_"+a}},getCalcNodeInfoArray:function(b){var e,a,d,c;if(!b){return null}e=b.split(INTERMediator.separator);a="";d="";c="";if(e.length==3){a=e[0];d=e[1];c=e[2]}else{if(e.length==2){d=e[0];c=e[1]}else{d=b}}return{table:a,field:d,target:c,tableindex:"_im_index_"+a}},getClassAttributeFromNode:function(a){var b="";if(a===null){return""}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b=a.getAttribute("className")}else{b=a.getAttribute("class")}return b},setClassAttributeToNode:function(b,a){if(b===null){return}if(INTERMediator.isIE&&INTERMediator.ieVersion<8){b.setAttribute("className",a)}else{b.setAttribute("class",a)}},eventInfos:[],addEvent:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}else{if(c.attachEvent){c.attachEvent("on"+a,b);this.eventInfos.push({node:c,event:a,"function":b});return this.eventInfos.length-1}}return -1},removeEvent:function(a){if(eventInfos[a].node.removeEventListener){eventInfos[a].node.removeEventListener(eventInfos[a].evt,eventInfos[a].func,false)}else{if(eventInfos[a].node.detachEvent){eventInfos[a].node.detachEvent("on"+eventInfos[a].evt,eventInfos[a].func)}}},toNumber:function(d){var b="",a,e;d=(new String(d)).toString();for(a=0;a<d.length;a++){e=d.charAt(a);if((e>="0"&&e<="9")||e=="."||e=="-"||e==this.cachedDigitSeparator[0]){b+=e}}return parseFloat(b)},RoundHalfToEven:function(a,b){return a},Round:function(b,c){var a=Math.pow(10,c);return Math.round(b*a)/a},numberFormat:function(g,l){var o,c,d,a,m,h,f,k,b,e;c=this.toNumber(g);d="";if(c<0){d="-";c=-c}m=(l===undefined)?0:this.toNumber(l);a=Math.pow(10,m);k=Math.round(c*a);b=(m>0)?k%a:0;e=(k-b)/a;h=(m>0)?new String(b):"";while(h.length<m){h="0"+h}c=e;o=[];for(c=Math.floor(c);c>0;c=Math.floor(c/1000)){if(c>=1000){f="000"+(c%1000).toString();o.push(f.substr(f.length-3))}else{o.push(c)}}return d+o.reverse().join(this.cachedDigitSeparator[1])+(h==""?"":this.cachedDigitSeparator[0]+h)},objectToString:function(c){var d,b,a;if(c===null){return"null"}if(typeof c=="object"){d="";if(c.constractor===Array){for(b=0;b<c.length;b++){d+=INTERMediatorLib.objectToString(c[b])+", "}return"["+d+"]"}else{for(a in c){d+="'"+a+"':"+INTERMediatorLib.objectToString(c[a])+", "}return"{"+d+"}"}}else{return"'"+c+"'"}},getTargetTableForRetrieve:function(a){if(a.view!=null){return a.view}return a.name},getTargetTableForUpdate:function(a){if(a.table!=null){return a.table}return a.name},getInsertedString:function(b,a){var d,c;d=b;if(a!=null){for(c=1;c<=a.length;c++){d=d.replace("@"+c+"@",a[c-1])}}return d},getInsertedStringFromErrorNumber:function(b,a){var e,c,d;d=INTERMediatorOnPage.getMessages();e=d?d[b]:"Error:"+b;if(a){for(c=1;c<=a.length;c++){e=e.replace("@"+c+"@",a[c-1])}}return e},getNamedObject:function(d,c,a){var b;for(b in d){if(d[b][c]==a){return d[b]}}return null},getNamedObjectInObjectArray:function(b,d,a){var c;for(c=0;c<b.length;c++){if(b[c][d]==a){return b[c]}}return null},getNamedValueInObject:function(c,e,b,f){var a=[],d;for(d in c){if(c[d][e]==b){a.push(c[d][f])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},is_array:function(a){return a&&typeof a==="object"&&typeof a.length==="number"&&typeof a.splice==="function"&&!(a.propertyIsEnumerable("length"))},getNamedValuesInObject:function(c,g,e,f,b,h){var a=[],d;for(d in c){if(c.hasOwnProperty(d)&&c[d][g]==e&&c[d][f]==b){a.push(c[d][h])}}if(a.length===0){return null}else{if(a.length===1){return a[0]}else{return a}}},getRecordsetFromFieldValueObject:function(b){var c={},a;for(a in b){if(b.hasOwnProperty(a)){c[b[a]["field"]]=b[a]["value"]}}return c},getNodePath:function(a){var b="";if(a.tagName===null){return""}else{return INTERMediatorLib.getNodePath(a.parentNode)+"/"+a.tagName}},isPopupMenu:function(a){if(!a||!a.tagName){return false}if(a.tagName=="SELECT"){return true}return false},getElementsByClassNameOrDataAttr:function(d,a){var c=[],e;e=(a.match(/^_im_/))?a.substr(4):a;if(e){b(d)}return c;function b(k){var h,g,f;if(k===undefined||k.nodeType!==1){return}h=INTERMediatorLib.getClassAttributeFromNode(k);if(h){f=h.split("|");for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im-control");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}h=k.getAttribute("data-im");if(h){f=h.split(/[| ]/);for(g=0;g<f.length;g++){if(f[g]==e){c.push(k)}}}for(g=0;g<k.children.length;g++){b(k.children[g])}}},getElementsByAttributeValue:function(e,d,f){var b=[];var c=new RegExp(f);a(e);return b;function a(k){var h,g;if(k===undefined||k.nodeType!==1){return}h=k.getAttribute(d);if(h&&h.match(c)){b.push(k)}for(g=0;g<k.children.length;g++){a(k.children[g])}}},getElementsByClassName:function(e,a){var c=[];var d=new RegExp(a);b(e);return c;function b(h){var g,f;if(h===undefined||h.nodeType!==1){return}g=INTERMediatorLib.getClassAttributeFromNode(h);if(g&&g.match(d)){c.push(h)}for(f=0;f<h.children.length;f++){b(h.children[f])}}},getElementsByIMManaged:function(d){var b=[];var c=new RegExp(/^IM/);a(d);return b;function a(f){var g,e;if(f===undefined||f.nodeType!==1){return}g=f.getAttribute("id");if(g&&g.match(c)){b.push(f)}for(e=0;e<f.children.length;e++){a(f.children[e])}}},seekLinkedAndWidgetNodes:function(c,a){var g=[];var f=[];var e,d=a;if(a===undefined||a===null){d=false}for(e=0;e<c.length;e++){b(c[e])}return{linkedNode:g,widgetNode:f};function b(n){var h,o,m,k,l;h=n.nodeType;if(h===1){if(INTERMediatorLib.isLinkedElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){g.push(n)}else{return o}}if(INTERMediatorLib.isWidgetElement(n)){o=d?INTERMediatorLib.getEnclosure(n):null;if(o===null){f.push(n)}else{return o}}m=n.childNodes;for(l=0;l<m.length;l++){k=b(m[l])}}return null}},createErrorMessageNode:function(a,c){var b;b=document.createElement(a);INTERMediatorLib.setClassAttributeToNode(b,"_im_alertmessage");b.appendChild(document.createTextNode(c));return b},removeChildNodes:function(a){while(a.childNodes.length>0){a.removeChild(a.childNodes[0])}},clearErrorMessage:function(b){var c,a;c=INTERMediatorLib.getElementsByClassName(b.parentNode,"_im_alertmessage");for(a=0;a<c.length;a++){c[a].parentNode.removeChild(c[a])}},dateTimeStringISO:function(a){a=(!a)?new Date():a;return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).substr(-2,2)+"-"+("0"+a.getDate()).substr(-2,2)+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)},dateTimeStringFileMaker:function(a){a=(!a)?new Date():a;return("0"+(a.getMonth()+1)).substr(-2,2)+"/"+("0"+a.getDate()).substr(-2,2)+"/"+a.getFullYear()+" "+("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)},dateStringISO:function(a){a=(!a)?new Date():a;return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).substr(-2,2)+"-"+("0"+a.getDate()).substr(-2,2)},dateStringFileMaker:function(a){a=(!a)?new Date():a;return("0"+(a.getMonth()+1)).substr(-2,2)+"/"+("0"+a.getDate()).substr(-2,2)+"/"+a.getFullYear()},timeString:function(a){a=(!a)?new Date():a;return("0"+a.getHours()).substr(-2,2)+":"+("0"+a.getMinutes()).substr(-2,2)+":"+("0"+a.getSeconds()).substr(-2,2)}};INTERMediatorLib.initialize();var IMLibNodeGraph={nodes:[],edges:[],clear:function(){this.nodes=[];this.edges=[]},addNode:function(a){if(this.nodes.indexOf(a)<0){this.nodes.push(a)}},addEdge:function(b,a){if(this.nodes.indexOf(b)<0){this.addNode(b)}if(this.nodes.indexOf(a)<0){this.addNode(a)}this.edges.push({from:b,to:a})},getAllNodesInEdge:function(){var b,a=[];for(b=0;b<this.edges.length;b++){if(a.indexOf(this.edges[b].from)<0){a.push(this.edges[b].from)}if(a.indexOf(this.edges[b].to)<0){a.push(this.edges[b].to)}}return a},getLeafNodes:function(){var a,c=[],d=[],b=this.getAllNodesInEdge();for(a=0;a<this.edges.length;a++){c.push(this.edges[a].from)}for(a=0;a<this.edges.length;a++){if(c.indexOf(this.edges[a].to)<0&&d.indexOf(this.edges[a].to)<0){d.push(this.edges[a].to)}}for(a=0;a<this.nodes.length;a++){if(b.indexOf(this.nodes[a])<0){d.push(this.nodes[a])}}return d},getLeafNodesWithRemoving:function(){var b,a=[],c=this.getLeafNodes();for(b=0;b<this.edges.length;b++){if(c.indexOf(this.edges[b].to)<0){a.push(this.edges[b])}}this.edges=a;for(b=0;b<c.length;b++){this.nodes.splice(this.nodes.indexOf(c[b]),1)}return c},applyToAllNodes:function(b){var a;for(a=0;a<this.nodes.length;a++){b(this.nodes[a])}},decodeOpenIDToken:function(a){var e,d,b,c=a.split(".");if(c.length!=3){return false}e=Base64.decode(c[0]);d=Base64.decode(c[1]);b=Base64.decode(c[2])}};var IMLibCalc={calculateRequiredObject:null,updateCalculationInfo:function(s,k,e,m,v,d){var c,h,a,n,r,f,w,o,u,b,l,g,p,q;c=e.calculation;a=null;h=null;for(f in c){p=c[f]["field"].indexOf(INTERMediator.separator);q=c[f]["field"].length;g=c[f]["field"].substring(0,p>=0?p:q);if(g==v.field){try{h=c[f]["expression"];a=c[f]["field"];n=Parser.parse(h).variables();o=INTERMediatorLib.getCalcNodeInfoArray(a);w=m+(v.target.length>0?(INTERMediator.separator+v.target):"")}catch(t){INTERMediator.setErrorMessage(t,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1036],[a,h]))}if(n&&w){b={};l={};for(r=0;r<n.length;r++){u=n[r];if(u){b[u]=[d[u]];l[u]=[undefined]}s.setValue(k,u,d[u],m,v.target,null)}IMLibCalc.calculateRequiredObject[w]={field:a,expression:h,nodeInfo:v,values:b,referes:l}}}}},updateCalculationFields:function(){var h,e,r,f,k,m,c,t,l;var d,a,s,g,o,n,p,q,b;IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(h in IMLibCalc.calculateRequiredObject){m=IMLibCalc.calculateRequiredObject[h];q=h.match(IMLibCalc.regexpForSeparator)?h.split(IMLibCalc.regexpForSeparator)[0]:h;if(m){l=INTERMediatorLib.getCalcNodeInfoArray(q);d=document.getElementById(l.field);n=false;for(a in m.referes){for(c=0;c<m.referes[a].length;c++){IMLibNodeGraph.addEdge(h,m.referes[a][c]);n=false}}if(!n){IMLibNodeGraph.addEdge(h)}}}do{k=IMLibNodeGraph.getLeafNodesWithRemoving();for(o=0;o<k.length;o++){m=IMLibCalc.calculateRequiredObject[k[o]];l=INTERMediatorLib.getCalcNodeInfoArray(k[o]);if(m){q=k[o].match(IMLibCalc.regexpForSeparator)?k[o].split(IMLibCalc.regexpForSeparator)[0]:k[o];d=document.getElementById(l.field);e=m.expression;r=m.nodeInfo;f=m.values;t=m.referes;for(a in f){s=[];for(c=0;c<f[a].length;c++){if(f[a][c]==undefined){if(t[a][c]){g=document.getElementById(t[a][c]);s.push(IMLibElement.getValueFromIMNode(g))}else{g=document.getElementById(q);p=IMLibContextPool.getContextInfoFromId(q,r.target);b=p.context.getContextRecord(q);s.push(b[a])}}else{s.push(f[a][c])}}m.values[a]=s}IMLibElement.setValueToIMNode(d,r.target,Parser.evaluate(e,f),true)}else{}}}while(k.length>0);if(IMLibNodeGraph.nodes.length>0){INTERMediator.setErrorMessage(new Exception(),INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1037],[]))}},recalculation:function(r){var m,f,o,q,d,p,s,w=false;var e,n,a,u,g,x,b,k,y,h;var A,z,l,t,c,v;if(r===undefined){w=true;g=[];x=[]}else{n=IMLibElement.getValueFromIMNode(document.getElementById(r));g=[r];x=[n]}IMLibCalc.setUndefinedToAllValues();IMLibNodeGraph.clear();for(m in IMLibCalc.calculateRequiredObject){q=IMLibCalc.calculateRequiredObject[m];v=m.match(IMLibCalc.regexpForSeparator)?m.split(IMLibCalc.regexpForSeparator)[0]:m;p=INTERMediatorLib.getCalcNodeInfoArray(v);e=document.getElementById(p.field);for(a in q.referes){for(d=0;d<q.referes[a].length;d++){IMLibNodeGraph.addEdge(m,q.referes[a][d])}}}do{o=IMLibNodeGraph.getLeafNodesWithRemoving();for(u=0;u<o.length;u++){q=IMLibCalc.calculateRequiredObject[o[u]];p=INTERMediatorLib.getCalcNodeInfoArray(o[u]);if(q){v=o[u].match(IMLibCalc.regexpForSeparator)?o[u].split(IMLibCalc.regexpForSeparator)[0]:o[u];e=document.getElementById(p.field);k=q.expression;y=q.nodeInfo;h=q.values;A=q.referes;for(a in h){z=[];for(d=0;d<h[a].length;d++){if(h[a][d]==undefined){if(A[a][d]){l=document.getElementById(A[a][d]);z.push(IMLibElement.getValueFromIMNode(l))}else{l=document.getElementById(v);t=IMLibContextPool.getContextInfoFromId(v,y.target);c=t.context.getContextRecord(v);z.push(c[a])}}else{z.push(h[a][d])}}q.values[a]=z}if(w){f=true}else{f=false;for(a in q.referes){for(d=0;d<q.referes[a].length;d++){b=g.indexOf(q.referes[a][d]);if(b>=0){q.values[a][d]=x[b];f=true}}}}if(f){s=Parser.evaluate(q.expression,q.values);IMLibElement.setValueToIMNode(document.getElementById(p.field),y.target,s,true);g.push(p.field);x.push(s)}}else{}}}while(o.length>0);if(IMLibNodeGraph.nodes.length>0){}},setUndefinedToAllValues:function(){var c,g,e,f,k,l,h,d,a,b;do{a=false;for(c in IMLibCalc.calculateRequiredObject){b=c.match(IMLibCalc.regexpForSeparator)?c.split(IMLibCalc.regexpForSeparator)[0]:c;if(!document.getElementById(b)){delete IMLibCalc.calculateRequiredObject[c];a=true;break}}}while(a);for(c in IMLibCalc.calculateRequiredObject){g=IMLibCalc.calculateRequiredObject[c];f=INTERMediatorLib.getCalcNodeInfoArray(c);k=document.getElementById(f.field);for(l in g.values){if(l.indexOf(INTERMediator.separator)>-1){h=l}else{h=g.nodeInfo.table+INTERMediator.separator+l}do{d=INTERMediatorOnPage.getNodeIdsHavingTargetFromRepeater(k,h);if(d&&d.length>0){break}d=INTERMediatorOnPage.getNodeIdsHavingTargetFromEnclosure(k,h);if(d&&d.length>0){break}k=INTERMediatorLib.getParentRepeater(INTERMediatorLib.getParentEnclosure(k))}while(k);if(INTERMediatorLib.is_array(d)&&d.length>0){g.referes[l]=[];g.values[l]=[];for(e=0;e<d.length;e++){g.referes[l].push(d[e]);g.values[l].push(undefined)}}else{g.referes[l]=[undefined];g.values[l]=[undefined]}}}}};var INTERMediatorOnPage;INTERMediatorOnPage={authCountLimit:4,authCount:0,authUser:"",authHashedPassword:"",authCryptedPassword:"",authUserSalt:"",authUserHexSalt:"",authChallenge:"",requireAuthentication:false,clientId:null,authRequiredContext:null,authStoring:"cookie",authExpired:3600,isOnceAtStarting:true,publickey:null,isNativeAuth:false,httpuser:null,httppasswd:null,mediaToken:null,realm:"",dbCache:{},isEmailAsUsername:false,passwordPolicy:null,creditIncluding:null,isShowChangePassword:true,isSetDefaultStyle:true,authPanelTitle:null,isOAuthAvailable:false,oAuthClientID:null,oAuthClientSecret:null,oAuthBaseURL:null,oAuthRedirect:null,oAuthScope:null,additionalExpandingEnclosureFinish:{},additionalExpandingRecordFinish:{},clearCredentials:function(){INTERMediatorOnPage.authChallenge=null;INTERMediatorOnPage.authHashedPassword=null;INTERMediatorOnPage.authCryptedPassword=null},getMessages:function(){return null},getURLParametersAsArray:function(){var c,f,e,a,b,d;a={};f=location.search.substring(1).split("&");for(c=0;c<f.length;c++){e=f[c].indexOf("=");if(e>0){b=f[c].substring(0,e);d=f[c].substring(e+1);a[b]=decodeURIComponent(d)}}return a},getContextInfo:function(b){var c,a;c=INTERMediatorOnPage.getDataSources();for(a in c){if(c.hasOwnProperty(a)&&c[a].name==b){return c[a]}}return null},isComplementAuthData:function(){return INTERMediatorOnPage.authUser!==null&&INTERMediatorOnPage.authUser.length>0&&INTERMediatorOnPage.authHashedPassword!==null&&INTERMediatorOnPage.authHashedPassword.length>0&&INTERMediatorOnPage.authUserSalt!==null&&INTERMediatorOnPage.authUserSalt.length>0&&INTERMediatorOnPage.authChallenge!==null&&INTERMediatorOnPage.authChallenge.length>0},retrieveAuthInfo:function(){if(INTERMediatorOnPage.requireAuthentication){if(INTERMediatorOnPage.isOnceAtStarting){switch(INTERMediatorOnPage.authStoring){case"cookie":case"cookie-domainwide":INTERMediatorOnPage.authUser=INTERMediatorOnPage.getCookie("_im_username");INTERMediatorOnPage.authHashedPassword=INTERMediatorOnPage.getCookie("_im_credential");INTERMediatorOnPage.mediaToken=INTERMediatorOnPage.getCookie("_im_mediatoken");INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.getCookie("_im_crypted");break;case"session-storage":INTERMediatorOnPage.authUser=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_username");INTERMediatorOnPage.authHashedPassword=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_credential");INTERMediatorOnPage.mediaToken=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_mediatoken");INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.getSessionStorageWithFallDown("_im_crypted");break;default:INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");break}INTERMediatorOnPage.isOnceAtStarting=false}if(INTERMediatorOnPage.authUser.length>0){if(!INTERMediator_DBAdapter.getChallenge()){INTERMediator.flushMessage()}}}},logout:function(){INTERMediatorOnPage.authUser="";INTERMediatorOnPage.authHashedPassword="";INTERMediatorOnPage.authCryptedPassword="";INTERMediatorOnPage.authUserSalt="";INTERMediatorOnPage.authChallenge="";INTERMediatorOnPage.clientId="";INTERMediatorOnPage.removeCredencialsFromCookieOrStorage();INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_localcontext")},storeSessionStorageWithFallDown:function(b,c){if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.setItem(INTERMediatorOnPage.getKeyWithRealm(b),c)}catch(a){INTERMediatorOnPage.setCookie(b,c)}}else{INTERMediatorOnPage.setCookie(b,c)}},getSessionStorageWithFallDown:function(b){var c;if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{c=sessionStorage.getItem(INTERMediatorOnPage.getKeyWithRealm(b));c=c?c:""}catch(a){c=INTERMediatorOnPage.getCookie(b)}}else{c=INTERMediatorOnPage.getCookie(b)}return c},removeFromSessionStorageWithFallDown:function(b){if(INTERMediator.useSessionStorage===true&&typeof sessionStorage!=="undefined"&&sessionStorage!==null){try{sessionStorage.removeItem(INTERMediatorOnPage.getKeyWithRealm(b))}catch(a){INTERMediatorOnPage.removeCookie(b)}}else{INTERMediatorOnPage.removeCookie(b)}},removeCredencialsFromCookieOrStorage:function(){switch(INTERMediatorOnPage.authStoring){case"cookie":case"cookie-domainwide":INTERMediatorOnPage.removeCookie("_im_username");INTERMediatorOnPage.removeCookie("_im_credential");INTERMediatorOnPage.removeCookie("_im_mediatoken");INTERMediatorOnPage.removeCookie("_im_crypted");break;case"session-storage":INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_username");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_credential");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_mediatoken");INTERMediatorOnPage.removeFromSessionStorageWithFallDown("_im_crypted");break}},storeCredentialsToCookieOrStorage:function(){switch(INTERMediatorOnPage.authStoring){case"cookie":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookie("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookie("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookie("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookie("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break;case"cookie-domainwide":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.setCookieDomainWide("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.setCookieDomainWide("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.setCookieDomainWide("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break;case"session-storage":if(INTERMediatorOnPage.authUser){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_username",INTERMediatorOnPage.authUser)}if(INTERMediatorOnPage.authHashedPassword){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_credential",INTERMediatorOnPage.authHashedPassword)}if(INTERMediatorOnPage.mediaToken){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_mediatoken",INTERMediatorOnPage.mediaToken)}if(INTERMediatorOnPage.authCryptedPassword){INTERMediatorOnPage.storeSessionStorageWithFallDown("_im_crypted",INTERMediatorOnPage.authCryptedPassword)}break}},defaultBackgroundColor:null,loginPanelHTML:null,authenticating:function(h,x){var c,k,r,A,l,g,v,f,m,w,n,b,s,e,p,q,d,u,t,z,o,a,y;this.checkPasswordPolicy=function(I,H,J){var G,E,C,F=[],D;if(!J){return F}G=J.split(/[\s,]/);for(E=0;E<G.length;E++){switch(G[E].toUpperCase()){case"USEALPHABET":if(!I.match(/[A-Za-z]/)){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2015))}break;case"USENUMBER":if(!I.match(/[0-9]/)){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2016))}break;case"USEUPPER":if(!I.match(/[A-Z]/)){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2017))}break;case"USELOWER":if(!I.match(/[a-z]/)){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2018))}break;case"USEPUNCTUATION":if(!I.match(/[^A-Za-z0-9]/)){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2019))}break;case"NOTUSERNAME":if(I==H){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2020))}break;default:if(G[E].toUpperCase().indexOf("LENGTH")===0){D=G[E].match(/[0-9]+/)[0];if(I.length<D){C=false;F.push(INTERMediatorLib.getInsertedStringFromErrorNumber(2021,[D]))}}}}return F};if(x){return}if(INTERMediatorOnPage.authCount>INTERMediatorOnPage.authCountLimit){INTERMediatorOnPage.authenticationError();INTERMediatorOnPage.logout();INTERMediator.flushMessage();return}c=document.getElementsByTagName("BODY")[0];k=document.createElement("div");c.insertBefore(k,c.childNodes[0]);k.style.height="100%";k.style.width="100%";if(INTERMediatorOnPage.isSetDefaultStyle&&INTERMediatorOnPage.getIMRootPath!==undefined){k.style.backgroundImage="url("+INTERMediatorOnPage.getIMRootPath()+"/themes/default/images/background.gif)"}if(INTERMediatorOnPage.defaultBackgroundColor){k.style.backgroundColor=INTERMediatorOnPage.defaultBackgroundColor}k.style.position="absolute";k.style.padding=" 50px 0 0 0";k.style.top="0";k.style.left="0";k.style.zIndex="999998";if(INTERMediatorOnPage.loginPanelHTML){k.innerHTML=INTERMediatorOnPage.loginPanelHTML;n=document.getElementById("_im_password");v=document.getElementById("_im_username");e=document.getElementById("_im_authbutton");s=document.getElementById("_im_changebutton");y=document.getElementById("_im_oauthbutton")}else{r=document.createElement("div");if(INTERMediatorOnPage.isSetDefaultStyle){r.style.width="450px";r.style.backgroundColor="#333333";r.style.color="#DDDDAA";r.style.margin="50px auto 0 auto";r.style.padding="20px";r.style.borderRadius="10px";r.style.position="relative"}r.id="_im_authpanel";k.appendChild(r);p="";if(INTERMediatorOnPage.authPanelTitle&&INTERMediatorOnPage.authPanelTitle.length>0){p=INTERMediatorOnPage.authPanelTitle}else{if(INTERMediatorOnPage.realm&&INTERMediatorOnPage.realm.length>0){p=INTERMediatorOnPage.realm}}if(p&&p.length>0){z=document.createElement("DIV");z.appendChild(document.createTextNode(p));z.style.textAlign="left";r.appendChild(z);b=document.createElement("HR");r.appendChild(b)}A="100px";l=document.createElement("LABEL");r.appendChild(l);g=document.createElement("span");if(INTERMediatorOnPage.isSetDefaultStyle){g.style.minWidth=A;g.style.textAlign="right";g.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(g,"_im_authlabel");l.appendChild(g);f=INTERMediatorOnPage.isEmailAsUsername?2011:2002;g.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(f)));v=document.createElement("INPUT");v.type="text";v.id="_im_username";v.size="20";v.setAttribute("autocapitalize","off");l.appendChild(v);b=document.createElement("BR");b.clear="all";r.appendChild(b);m=document.createElement("LABEL");r.appendChild(m);w=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){w.style.minWidth=A;w.style.textAlign="right";w.style.cssFloat="left"}INTERMediatorLib.setClassAttributeToNode(w,"_im_authlabel");m.appendChild(w);w.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2003)));n=document.createElement("INPUT");n.type="password";n.id="_im_password";n.size="20";m.appendChild(n);e=document.createElement("BUTTON");e.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2004)));r.appendChild(e);b=document.createElement("BR");b.clear="all";r.appendChild(b);t=document.createElement("DIV");t.style.textAlign="center";t.style.textSize="10pt";t.style.color="#994433";t.id="_im_login_message";r.appendChild(t);if(this.isShowChangePassword&&!INTERMediatorOnPage.isNativeAuth){b=document.createElement("HR");r.appendChild(b);q=document.createElement("LABEL");r.appendChild(q);d=document.createElement("SPAN");if(INTERMediatorOnPage.isSetDefaultStyle){d.style.minWidth=A;d.style.textAlign="right";d.style.cssFloat="left";d.style.fontSize="0.7em";d.style.paddingTop="4px"}INTERMediatorLib.setClassAttributeToNode(d,"_im_authlabel");q.appendChild(d);d.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2006)));u=document.createElement("INPUT");u.type="password";u.id="_im_newpassword";u.size="12";q.appendChild(u);s=document.createElement("BUTTON");s.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2005)));r.appendChild(s);t=document.createElement("DIV");t.style.textAlign="center";t.style.textSize="10pt";t.style.color="#994433";t.id="_im_newpass_message";r.appendChild(t)}if(this.isOAuthAvailable){b=document.createElement("HR");r.appendChild(b);y=document.createElement("BUTTON");y.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2014)));r.appendChild(y)}}n.onkeydown=function(C){o=(window.event)?window.event.which:C.keyCode;if(o==13){e.onclick()}};v.value=INTERMediatorOnPage.authUser;v.onkeydown=function(C){o=(window.event)?window.event.which:C.keyCode;if(o==13){n.focus()}};e.onclick=function(){var F,C,E,D;D=document.getElementById("_im_newpass_message");if(D){INTERMediatorLib.removeChildNodes(D)}F=document.getElementById("_im_username").value;C=document.getElementById("_im_password").value;if(F===""||C===""){D=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(D);D.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2013)));return}INTERMediatorOnPage.authUser=F;c.removeChild(k);if(F!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";E=INTERMediator_DBAdapter.getChallenge();if(!E){INTERMediator.flushMessage();return}}INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(C);INTERMediatorOnPage.authHashedPassword=SHA1(C+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;if(INTERMediatorOnPage.authUser.length>0){INTERMediatorOnPage.storeCredentialsToCookieOrStorage()}h();INTERMediator.flushMessage()};if(s){var B=this.checkPasswordPolicy;s.onclick=function(){var J,D,E,H,I,C,F,G;F=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(F);F=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(F);J=document.getElementById("_im_username").value;D=document.getElementById("_im_password").value;E=document.getElementById("_im_newpassword").value;if(J===""||D===""||E===""){F=document.getElementById("_im_newpass_message");INTERMediatorLib.removeChildNodes(F);F.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2007)));return}G=B(E,J,INTERMediatorOnPage.passwordPolicy);if(G.length>0){F.appendChild(document.createTextNode(G.join(", ")));return}C=INTERMediator_DBAdapter.changePassword(J,D,E);F.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(C?2009:2010)));INTERMediator.flushMessage()}}if(this.isOAuthAvailable&&y){y.onclick=function(){var C;INTERMediatorOnPage.setCookieDomainWide("_im_oauth_backurl",location.href,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_realm",INTERMediatorOnPage.realm,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_expired",INTERMediatorOnPage.authExpired,true);INTERMediatorOnPage.setCookieDomainWide("_im_oauth_storing",INTERMediatorOnPage.authStoring,true);C=INTERMediatorOnPage.oAuthBaseURL+"?scope="+encodeURIComponent(INTERMediatorOnPage.oAuthScope)+"&redirect_uri="+encodeURIComponent(INTERMediatorOnPage.oAuthRedirect)+"&response_type=code&client_id="+encodeURIComponent(INTERMediatorOnPage.oAuthClientID);location.href=C}}if(INTERMediatorOnPage.authCount>0){a=document.getElementById("_im_login_message");INTERMediatorLib.removeChildNodes(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2012)))}window.scroll(0,0);v.focus();INTERMediatorOnPage.authCount++},authenticationError:function(){var c,b,a;INTERMediatorOnPage.hideProgress();c=document.getElementsByTagName("BODY")[0];b=document.createElement("div");c.insertBefore(b,c.childNodes[0]);b.style.height="100%";b.style.width="100%";if(INTERMediatorOnPage.isSetDefaultStyle&&INTERMediatorOnPage.getIMRootPath!==undefined){b.style.backgroundImage="url("+INTERMediatorOnPage.getIMRootPath()+"/themes/default/images/background-error.gif)"}b.style.position="absolute";b.style.padding=" 50px 0 0 0";b.style.top="0";b.style.left="0";b.style.zIndex="999999";a=document.createElement("div");a.style.width="240px";a.style.backgroundColor="#333333";a.style.color="#DD6666";a.style.fontSize="16pt";a.style.margin="50px auto 0 auto";a.style.padding="20px 4px 20px 4px";a.style.borderRadius="10px";a.style.position="relatvie";a.style.textAlign="Center";a.onclick=function(){c.removeChild(b)};b.appendChild(a);a.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2001)))},INTERMediatorCheckBrowser:function(l){var e,n,k,p,c,d,q=false,r,g,b=-1,m,a,o,s,h,f;e=INTERMediatorOnPage.browserCompatibility();n=false;k=false;if(e.edge&&navigator.userAgent.indexOf("Edge/")>-1){e={edge:e.edge}}else{if(e.trident&&navigator.userAgent.indexOf("Trident/")>-1){e={trident:e.trident}}else{if(e.msie&&navigator.userAgent.indexOf("MSIE ")>-1){e={msie:e.msie}}else{if(e.opera&&(navigator.userAgent.indexOf("Opera/")>-1||navigator.userAgent.indexOf("OPR/")>-1)){e={opera:e.opera,opr:e.opera}}}}}for(c in e){if(e.hasOwnProperty(c)){if(navigator.userAgent.toUpperCase().indexOf(c.toUpperCase())>-1){n=true;if(e[c] instanceof Object){for(d in e[c]){if(e[c].hasOwnProperty(d)&&navigator.platform.toUpperCase().indexOf(d.toUpperCase())>-1){k=true;p=e[c][d];break}}}else{k=true;p=e[c];break}}}}if(n&&k){r=parseInt(p,10);if(navigator.appVersion.indexOf("Edge/")>-1){b=navigator.appVersion.indexOf("Edge/")+5}else{if(navigator.appVersion.indexOf("Trident/")>-1){b=navigator.appVersion.indexOf("Trident/")+8}else{if(navigator.appVersion.indexOf("MSIE ")>-1){b=navigator.appVersion.indexOf("MSIE ")+5}else{if(navigator.appVersion.indexOf("OPR/")>-1){b=navigator.appVersion.indexOf("OPR/")+4}else{if(navigator.appVersion.indexOf("Opera/")>-1){b=navigator.appVersion.indexOf("Opera/")+6}else{if(navigator.appVersion.indexOf("Chrome/")>-1){b=navigator.appVersion.indexOf("Chrome/")+7}else{if(navigator.appVersion.indexOf("Safari/")>-1&&navigator.appVersion.indexOf("Version/")>-1){b=navigator.appVersion.indexOf("Version/")+8}else{if(navigator.userAgent.indexOf("Firefox/")>-1){b=navigator.userAgent.indexOf("Firefox/")+8}}}}}}}}if(b>-1){if(navigator.userAgent.indexOf("Firefox/")>-1){m=navigator.userAgent.indexOf(".",b);g=parseInt(navigator.userAgent.substring(b,m),10)}else{m=navigator.appVersion.indexOf(".",b);g=parseInt(navigator.appVersion.substring(b,m),10)}}else{m=navigator.appVersion.indexOf(".");g=parseInt(navigator.appVersion.substring(0,m),10)}if(INTERMediator.isTrident){r=r+4}if(p.indexOf("-")>-1){q=(r>=g);if(document.documentMode){q=(r>=document.documentMode)}}else{if(p.indexOf("+")>-1){q=(r<=g);if(document.documentMode){q=(r<=document.documentMode)}}else{q=(r==g);if(document.documentMode){q=(r==document.documentMode)}}}}if(q===true){if(l){l.parentNode.removeChild(l)}}else{a=document.getElementsByTagName("BODY")[0];o=document.createElement("div");o.setAttribute("align","center");s=document.createElement("font");s.setAttribute("color","gray");h=document.createElement("font");h.setAttribute("size","+2");h.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1022]));s.appendChild(h);s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[1023]));s.appendChild(document.createElement("br"));s.appendChild(document.createTextNode(navigator.userAgent));o.appendChild(s);for(f=a.childNodes.length-1;f>=0;f--){a.removeChild(a.childNodes[f])}a.appendChild(o)}return q},getNodeIdFromIMDefinition:function(c,e,a){var b;if(a){b=e}else{b=INTERMediatorLib.getParentRepeater(e)}return d(b,c);function d(l,f){var h,g,m,k;if(l.nodeType!=1){return null}h=l.childNodes;if(h){for(g=0;g<h.length;g++){if(h[g].nodeType==1){if(INTERMediatorLib.isLinkedElement(h[g])){m=INTERMediatorLib.getLinkedElementInfo(h[g]);if(m.indexOf(f)>-1){k=h[g].getAttribute("id");return k}}k=d(h[g],f);if(k!==null){return k}}}}return null}},getNodeIdFromIMDefinitionOnEnclosure:function(b,d){var a;a=INTERMediatorLib.getParentEnclosure(d);return c(a,b);function c(k,e){var g,f,l,h;if(k.nodeType!=1){return null}g=k.childNodes;if(g){for(f=0;f<g.length;f++){if(g[f].nodeType==1){if(INTERMediatorLib.isLinkedElement(g[f])){l=INTERMediatorLib.getLinkedElementInfo(g[f]);if(l.indexOf(e)>-1&&g[f].getAttribute){h=g[f].getAttribute("id");return h}}h=c(g[f],e);if(h!==null){return h}}}}return null}},getNodeIdsFromIMDefinition:function(c,g,a){var b,e,d;if(a===true){b=g}else{if(a===false){b=INTERMediatorLib.getParentEnclosure(g)}else{b=INTERMediatorLib.getParentRepeater(g)}}if(b!==null){e=[];if(Array.isArray(b)){for(d=0;d<b.length;d++){f(b[d],c)}}else{f(b,c)}}return e;function f(m,h){var l,k,n;if(m.nodeType!=1){return}l=m.childNodes;if(l){for(k=0;k<l.length;k++){if(l[k].nodeType==1){n=INTERMediatorLib.getLinkedElementInfo(l[k]);if(n&&n.indexOf(h)>-1){if(l[k].getAttribute("id")){e.push(l[k].getAttribute("id"))}else{e.push(l[k])}}}f(l[k],h)}}}},getNodeIdsHavingTargetFromNode:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,true)},getNodeIdsHavingTargetFromRepeater:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,"")},getNodeIdsHavingTargetFromEnclosure:function(b,a){return INTERMediatorOnPage.getNodeIdsFromIMDefinition(a,b,false)},getKeyWithRealm:function(a){if(INTERMediatorOnPage.realm.length>0){return a+"_"+INTERMediatorOnPage.realm}return a},getCookie:function(c){var d,b,a;d=document.cookie.split("; ");a=this.getKeyWithRealm(c);for(b=0;b<d.length;b++){if(d[b].indexOf(a+"=")===0){return decodeURIComponent(d[b].substring(d[b].indexOf("=")+1))}}return""},removeCookie:function(a){document.cookie=this.getKeyWithRealm(a)+"=; path=/; max-age=0; expires=Thu, 1-Jan-1900 00:00:00 GMT;";document.cookie=this.getKeyWithRealm(a)+"=; max-age=0;  expires=Thu, 1-Jan-1900 00:00:00 GMT;"},setCookie:function(a,b){this.setCookieWorker(this.getKeyWithRealm(a),b,false,INTERMediatorOnPage.authExpired)},setCookieDomainWide:function(a,d,c){var b;b=(c===true)?a:this.getKeyWithRealm(a);this.setCookieWorker(b,d,true,INTERMediatorOnPage.authExpired)},setCookieWorker:function(b,g,a,c){var e;var f=new Date();f.setTime(f.getTime()+c*1000);e=b+"="+encodeURIComponent(g)+(a?";path=/":"")+";";if(c>0){e+="max-age="+c+";expires="+f.toUTCString()+";"}if(document.URL.substring(0,8)=="https://"){e+="secure;"}document.cookie=e},hideProgress:function(){var a;a=document.getElementById("_im_progress");if(a){a.parentNode.removeChild(a)}},showProgress:function(){var d,g,f,c,a,b,e;c=document.getElementById("_im_progress");if(!c){d=INTERMediatorOnPage.getIMRootPath();g=document.getElementsByTagName("HEAD")[0];f=document.getElementsByTagName("BODY")[0];c=document.createElement("div");c.setAttribute("id","_im_progress");a=document.createElement("link");a.setAttribute("href",d+"/themes/default/css/style.css");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");g.appendChild(a);if(f.firstChild){f.insertBefore(c,f.firstChild)}else{f.appendChild(c)}e=document.createElement("img");e.setAttribute("id","_im_logo");e.setAttribute("src",d+"/themes/default/images/logo.gif");c.appendChild(e);b=document.createElement("img");b.setAttribute("src",d+"/themes/default/images/inprogress.gif");c.appendChild(b);c.appendChild(document.createElement("BR"));c.appendChild(document.createTextNode("INTER-Mediator working"))}}};var IMParts_Catalog={};IMParts_Catalog.fileupload={html5DDSuported:false,progressSupported:false,forceOldStyleForm:false,uploadId:"sign"+Math.random(),instanciate:function(k){var p,a,e,g;var f=k.getAttribute("id")+"-e";var r=document.createElement("DIV");IMLibLocalContext.setValue("uploadFileSelect","false");INTERMediatorLib.setClassAttributeToNode(r,"_im_fileupload");r.setAttribute("id",f);this.ids.push(f);if(this.forceOldStyleForm){this.html5DDSuported=false}else{this.html5DDSuported=true;try{var q=new FileReader();var o=new FormData()}catch(l){this.html5DDSuported=false}}g=("ontouchstart" in window);if(g){this.html5DDSuported=false}var t=(k.getAttribute("data-im-widget-reload")!==null)?k.getAttribute("data-im-widget-reload"):false;r.setAttribute("data-im-widget-reload",t);if(this.html5DDSuported){r.dropzone="copy";var s=(k.getAttribute("data-im-widget-style")==="false")?false:true;if(s){r.style.width="200px";r.style.height="100px";r.style.paddingTop="20px";r.style.backgroundColor="#AAAAAA";r.style.border="3px dotted #808080";r.style.textAlign="center";r.style.fontSize="75%";var d=INTERMediatorOnPage.getMessages()[3101].split(/\n/);for(var h=0;h<d.length;h++){if(h>0){r.appendChild(document.createElement("BR"))}r.appendChild(document.createTextNode(d[h]))}}}else{a=document.createElement("FORM");a.setAttribute("method","post");a.setAttribute("action",INTERMediatorOnPage.getEntryPath()+"?access=uploadfile");a.setAttribute("enctype","multipart/form-data");var n=document.createElement("DIV");n.className="form-wrapper";n.appendChild(a);r.appendChild(n);if(this.progressSupported){p=document.createElement("INPUT");p.setAttribute("type","hidden");p.setAttribute("name","APC_UPLOAD_PROGRESS");p.setAttribute("id","progress_key");p.setAttribute("value",this.uploadId+(this.ids.length-1));a.appendChild(p)}p=document.createElement("INPUT");p.setAttribute("type","hidden");p.setAttribute("name","_im_redirect");p.setAttribute("value",location.href);a.appendChild(p);p=document.createElement("INPUT");p.setAttribute("type","hidden");p.setAttribute("name","_im_contextnewrecord");p.setAttribute("value","uploadfile");a.appendChild(p);p=document.createElement("INPUT");p.setAttribute("type","hidden");p.setAttribute("name","access");p.setAttribute("value","uploadfile");a.appendChild(p);p=document.createElement("INPUT");p.setAttribute("type","file");p.setAttribute("accept","*/*");p.setAttribute("name","_im_uploadfile");a.appendChild(p);e=document.createElement("BUTTON");e.setAttribute("type","submit");e.appendChild(document.createTextNode(""));INTERMediatorLib.addEvent(r,"click",function(c){if(this.children[0].style.display==="none"||this.children[0].style.display===""){this.children[0].style.display="flex";this.children[0].style.display="-webkit-flex"}else{if(IMLibLocalContext.getValue("uploadFileSelect")==="false"){this.children[0].style.display="none"}}},false);INTERMediatorLib.addEvent(a,"click",function(c){IMLibLocalContext.setValue("uploadFileSelect","true")},false);a.appendChild(e);this.formFromId[f]=a}if(k.getAttribute("data-im-widget-inner")==="true"){var b=k.children;for(var m=b.length-1;m>=0;m--){r.appendChild(b[m])}}k.appendChild(r);r._im_getValue=function(){var c=r;return c.value};k._im_getValue=function(){var c=r;return c.value};k._im_getComponentId=function(){var c=f;return c};k._im_setValue=function(u){var c=r;if(this.html5DDSuported){}else{}}},ids:[],formFromId:{},finish:function(){var d,a;if(this.html5DDSuported){for(var f=0;f<this.ids.length;f++){var e=this.ids[f];var k=document.getElementById(e);var g=IMLibContextPool.getContextInfoFromId(e);if(k){INTERMediatorLib.addEvent(k,"dragleave",function(p){p.preventDefault();p.target.style.backgroundColor="#AAAAAA"});INTERMediatorLib.addEvent(k,"dragover",function(p){p.preventDefault();p.target.style.backgroundColor="#AADDFF"});var l=this.progressSupported;var n=this.ids.length;var c=this.uploadId;INTERMediatorLib.addEvent(k,"drop",(function(){var t=f;var q=l;var p=n;var s=c;var r=e;return function(y){var x,z;y.preventDefault();var A=y.currentTarget;if(q){var w=document.createElement("iframe");w.setAttribute("id","upload_frame"+p);w.setAttribute("name","upload_frame");w.setAttribute("frameborder","0");w.setAttribute("border","0");w.setAttribute("scrolling","no");w.setAttribute("scrollbar","no");w.style.width="100%";w.style.height="24px";A.appendChild(w)}for(var v=0;v<y.dataTransfer.files.length;v++){x=y.dataTransfer.files[v];z=document.createElement("DIV");z.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3102]+x.name));z.style.marginTop="20px";z.style.backgroundColor="#FFFFFF";z.style.textAlign="center";y.target.appendChild(z)}var u=IMLibContextPool.getContextInfoFromId(A.getAttribute("id"),"");if(q){w.style.display="block";setTimeout(function(){w.setAttribute("src","upload_frame.php?up_id="+s+t)})}INTERMediator_DBAdapter.uploadFile("&_im_contextname="+encodeURIComponent(u.context.contextName)+"&_im_field="+encodeURIComponent(u.field)+"&_im_keyfield="+encodeURIComponent(u.record.split("=")[0])+"&_im_keyvalue="+encodeURIComponent(u.record.split("=")[1])+"&_im_contextnewrecord="+encodeURIComponent("uploadfile")+(q?("&APC_UPLOAD_PROGRESS="+encodeURIComponent(s+t)):""),{fileName:x.name,content:x},function(E){var J,G,H=null,B,F,C;C=IMLibContextPool.getContextDef(u.context.contextName);if(C["file-upload"]){var D="";for(var I in C["file-upload"]){if(C["file-upload"][I]["field"]==u.field){D=C["file-upload"][I]["context"];break}}B=IMLibContextPool.getKeyFieldValueFromId(r,"");H=IMLibContextPool.getContextsFromNameAndForeignValue(D,B,C.key)}else{H=IMLibContextPool.getContextFromName(u.context.contextName)}G=IMLibContextPool.getContextInfoFromId(r,"");G.context.setValue(G.record,G.field,E);if(H){for(F=0;F<H.length;F++){J=H[F];INTERMediator.construct(J)}}INTERMediator.flushMessage();if(k.getAttribute("data-im-widget-reload")==="true"){INTERMediator.construct()}})}})())}}}else{for(var f=0;f<this.ids.length;f++){var k=document.getElementById(this.ids[f]);if(k){var h=IMLibContextPool.getContextInfoFromId(this.ids[f],"");var b=k.getElementsByTagName("FORM")[0];var m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_contextname");m.setAttribute("value",h.context.contextName);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_field");m.setAttribute("value",h.field);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_keyfield");m.setAttribute("value",h.record.split("=")[0]);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","_im_keyvalue");m.setAttribute("value",h.record.split("=")[1]);b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","clientid");if(INTERMediatorOnPage.authUser.length>0){m.value=INTERMediatorOnPage.clientId}b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","authuser");if(INTERMediatorOnPage.authUser.length>0){m.value=INTERMediatorOnPage.authUser}b.appendChild(m);m=document.createElement("INPUT");m.setAttribute("type","hidden");m.setAttribute("name","response");if(INTERMediatorOnPage.authUser.length>0){thisForm.elements.cresponse.value=INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+"\n"+INTERMediatorOnPage.authChallenge);if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){d=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=d.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");m.value=a}else{m.value="dummy"}}b.appendChild(m);if(this.progressSupported){m=document.createElement("iframe");m.setAttribute("id","upload_frame"+f);m.setAttribute("name","upload_frame");m.setAttribute("frameborder","0");m.setAttribute("border","0");m.setAttribute("scrolling","no");m.setAttribute("scrollbar","no");b.appendChild(m);INTERMediatorLib.addEvent(b,"submit",(function(){var p=f;return function(r){var q=document.getElementById("upload_frame"+p);q.style.display="block";setTimeout(function(){var s=o()+"?uploadprocess="+this.uploadId+p;q.setAttribute("src",s)});return true}})())}}}}this.ids=[];this.formFromId={};function o(){var q=document.getElementsByTagName("SCRIPT");for(var r=0;r<q.length;r++){var p=q[r].getAttribute("src");if(p.match(/\.php/)){return p}}return null}}};IMLibPageNavigation={deleteInsertOnNavi:[],navigationSetup:function(){var c,h,d,k,e,a,o,l,f,g,q,p,b,r,n,m;c=document.getElementById("IM_NAVIGATOR");if(c!==null){d=c.childNodes;for(h=0;h<d.length;h++){c.removeChild(d[h])}c.innerHTML="";c.setAttribute("class","IM_NAV_panel");k=INTERMediator.navigationLabel;if(k===null||k[8]!==false){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(((k===null||k[8]===null)?INTERMediatorOnPage.getMessages()[2]:k[8])));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",function(){INTERMediator.initialize();IMLibLocalContext.archive();location.reload()})}if(k===null||k[4]!==false){a=Number(INTERMediator.startFrom);o=Number(INTERMediator.pagedSize);l=Number(INTERMediator.pagedAllCount);f=" IM_NAV_disabled";e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(((k===null||k[4]===null)?INTERMediatorOnPage.getMessages()[1]:k[4])+(l===0?0:a+1)+((Math.min(a+o,l)-a>1)?(((k===null||k[5]===null)?"-":k[5])+Math.min(a+o,l)):"")+((k===null||k[6]===null)?" / ":k[6])+(l)+((k===null||k[7]===null)?"":k[7])));e.setAttribute("class","IM_NAV_info")}if((k===null||k[0]!==false)&&INTERMediator.pagination===true){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[0]===null)?"<<":k[0]));e.setAttribute("class","IM_NAV_button"+(a===0?f:""));INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=0;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[1]===null)?"<":k[1]));e.setAttribute("class","IM_NAV_button"+(a===0?f:""));q=(a-o>0)?a-o:0;INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=q;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[2]===null)?">":k[2]));e.setAttribute("class","IM_NAV_button"+(a+o>=l?f:""));p=(a+o<l)?a+o:((l-o>0)?a:0);INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=p;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[3]===null)?">>":k[3]));e.setAttribute("class","IM_NAV_button"+(a+o>=l?f:""));if(l%o===0){b=l-(l%o)-o}else{b=l-(l%o)}INTERMediatorLib.addEvent(e,"click",function(){INTERMediator_DBAdapter.unregister();INTERMediator.startFrom=(b>0)?b:0;INTERMediator.constructMain(true)});e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[10]));g=document.createElement("INPUT");g.setAttribute("class","IM_NAV_JUMP");g.setAttribute("type","text");g.setAttribute("value",Math.ceil(INTERMediator.startFrom/o+1));e.appendChild(g);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[11]));INTERMediatorLib.addEvent(g,"change",function(){if(g.value<1){g.value=1}var s=Math.ceil(l/o);if(s<g.value){g.value=s}INTERMediator.startFrom=(~~g.value-1)*o;INTERMediator.construct(true)})}if(k===null||k[9]!==false){for(h=0;h<IMLibPageNavigation.deleteInsertOnNavi.length;h++){switch(IMLibPageNavigation.deleteInsertOnNavi[h]["kind"]){case"INSERT":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[3]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["name"]));e.setAttribute("class","IM_NAV_button");r=function(t,s,x){var w=t,v=s,u=x;return function(){IMLibPageNavigation.insertRecordFromNavi(w,v,u)}};INTERMediatorLib.addEvent(e,"click",r(IMLibPageNavigation.deleteInsertOnNavi[h]["name"],IMLibPageNavigation.deleteInsertOnNavi[h]["key"],IMLibPageNavigation.deleteInsertOnNavi[h]["confirm"]?true:false));break;case"DELETE":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[4]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["name"]));e.setAttribute("class","IM_NAV_button");n=function(t,s,z,y){var x=t,v=s,w=z,u=y;return function(){IMLibPageNavigation.deleteRecordFromNavi(x,v,w,u)}};INTERMediatorLib.addEvent(e,"click",n(IMLibPageNavigation.deleteInsertOnNavi[h]["name"],IMLibPageNavigation.deleteInsertOnNavi[h]["key"],IMLibPageNavigation.deleteInsertOnNavi[h]["value"],IMLibPageNavigation.deleteInsertOnNavi[h]["confirm"]?true:false));break;case"COPY":e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[15]+": "+IMLibPageNavigation.deleteInsertOnNavi[h]["contextDef"]["name"]));e.setAttribute("class","IM_NAV_button");m=function(u,s){var v=u,t=s;return function(){IMLibPageNavigation.copyRecordFromNavi(v,t)}};INTERMediatorLib.addEvent(e,"click",m(IMLibPageNavigation.deleteInsertOnNavi[h]["contextDef"],IMLibPageNavigation.deleteInsertOnNavi[h]["keyValue"]));break}}}if(k===null||k[10]!==false){if(INTERMediatorOnPage.getOptionsTransaction()=="none"){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[10]===null)?INTERMediatorOnPage.getMessages()[7]:k[10]));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",IMLibPageNavigation.saveRecordFromNavi)}}if(k===null||k[11]!==false){if(INTERMediatorOnPage.requireAuthentication){e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode(INTERMediatorOnPage.getMessages()[8]+INTERMediatorOnPage.authUser));e.setAttribute("class","IM_NAV_info");e=document.createElement("SPAN");c.appendChild(e);e.appendChild(document.createTextNode((k===null||k[11]===null)?INTERMediatorOnPage.getMessages()[9]:k[11]));e.setAttribute("class","IM_NAV_button");INTERMediatorLib.addEvent(e,"click",function(){INTERMediatorOnPage.logout();location.reload()})}}}},insertRecordFromNavi:function(c,g,e){var f,b,d;if(e){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();d=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c);if(d===null){alert("no targetname :"+c);INTERMediatorOnPage.hideProgress();return}try{INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_createRecord_async({name:c,dataset:[]},function(h){var k=h.newRecordKeyValue;if(k>-1){b=INTERMediator.additionalCondition;if(d.records<=1){INTERMediator.startFrom=0;INTERMediator.pagedAllCount=1;f=INTERMediator.additionalCondition;f[c]={field:g,value:k};INTERMediator.additionalCondition=f;IMLibLocalContext.archive()}else{INTERMediator.pagedAllCount++}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=b;IMLibPageNavigation.navigationSetup()}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},null)}catch(a){if(a=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.insertRecordFromNavi(c,g,e)});INTERMediator.flushMessage();return}}}else{INTERMediator.setErrorMessage(a,"EXCEPTION-5")}}},deleteRecordFromNavi:function(b,e,d,c){if(c){if(!confirm(INTERMediatorOnPage.getMessages()[1025])){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_delete_async({name:b,conditions:[{field:e,operator:"=",value:d}]},function(){INTERMediator.pagedAllCount--;INTERMediator.totalRecordCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom--;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}INTERMediator.constructMain(true);INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},null)}catch(a){INTERMediator.setErrorMessage(a,"EXCEPTION-6")}},copyRecordFromNavi:function(f,d){var k,e,a,c,b,h;INTERMediatorOnPage.showProgress();if(f["repeat-control"].match(/confirm-copy/)){if(!confirm(INTERMediatorOnPage.getMessages()[1041])){return}}try{if(f.relation){for(index in f.relation){if(f.relation[index]["portal"]==true){f.portal=true}}}k=[];if(f["repeat-control"].match(/copy-/)){b=f["repeat-control"].indexOf("copy-");h=f["repeat-control"].substr(b+5);if((b=h.search(/\s/))>-1){h=h.substr(0,b)}c=h.split(",");for(e=0;e<c.length;e++){a=IMLibContextPool.getContextDef(c[e]);if(a.relation[0]["foreign-key"]){k.push({name:a.name,field:a.relation[0]["foreign-key"],value:d})}}}INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_copy_async({name:f.name,conditions:[{field:f.key,operator:"=",value:d}],associated:k.length>0?k:null},(function(){var l=f;return function(m){var o,p;var n=m.newRecordKeyValue;if(n>-1){o=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(l.records<=1){p=INTERMediator.additionalCondition;p[l.name]={field:l.key,value:n};INTERMediator.additionalCondition=p;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(true);INTERMediator.additionalCondition=o}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})(),null)}catch(g){INTERMediator.setErrorMessage(g,"EXCEPTION-43")}},saveRecordFromNavi:function(o){var e,n,g,p,q,h,d,s,a,r,m,c,f=true,b,l;INTERMediatorOnPage.showProgress();INTERMediatorOnPage.retrieveAuthInfo();for(d=0;d<IMLibContextPool.poolingContexts.length;d++){b=IMLibContextPool.poolingContexts[d];l=b.getModified();for(e in l){if(l.hasOwnProperty(e)){r=[];m=[];for(n in l[e]){if(l[e].hasOwnProperty(n)){r.push(n);m.push({field:n,value:l[e][n]})}}if(!INTERMediator.ignoreOptimisticLocking){g=e.split("=");p=g[0];g.shift();q=g.join("=");h={name:b.contextName,records:1,paging:false,fields:r,parentkeyvalue:null,conditions:[{field:p,operator:"=",value:q}],useoffset:false,primaryKeyOnly:true};try{a=INTERMediator_DBAdapter.db_query(h)}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating((function(){var t=h;return function(){INTERMediator.db_query(t)}})());return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-28")}}if(a.recordset===null||a.recordset[0]===null){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[r.join(",")]));return}if(a.count>1){response=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!response){return}}c=false;for(n in l[e]){if(l[e].hasOwnProperty(n)){s=b.getValue(e,n);if(s!=a.recordset[0][n]){c+=INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1035],[n,a.recordset[0][n],l[e][n]])}}}if(c!==false){if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1034],[c]))){return}INTERMediatorOnPage.retrieveAuthInfo()}}try{INTERMediator_DBAdapter.db_update({name:b.contextName,conditions:[{field:p,operator:"=",value:q}],dataset:m})}catch(k){if(k=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibPageNavigation.deleteRecordFromNavi(targetName,keyField,keyValue,isConfirm)});return}}else{INTERMediator.setErrorMessage(k,"EXCEPTION-29")}}b.clearModified()}}}if(f&&(o!==true)){INTERMediator.constructMain(true)}INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}};var IMLibUI={isShiftKeyDown:false,isControlKeyDown:false,mobileSelectionColor:"#BBBBBB",mobileNaviBackButtonId:null,keyDown:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=true}if(b==17){IMLibUI.isControlKeyDown=true}},keyUp:function(a){var b=(window.event)?a.which:a.keyCode;if(b==16){IMLibUI.isShiftKeyDown=false}if(b==17){IMLibUI.isControlKeyDown=false}},valueChange:function(c,d){var e,b,l,a,p,m,s,k,n,q,r,h,f,g;if(IMLibUI.isShiftKeyDown&&IMLibUI.isControlKeyDown){INTERMediator.setDebugMessage("Canceled to update the value with shift+control keys.");INTERMediator.flushMessage();IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;return true}IMLibUI.isShiftKeyDown=false;IMLibUI.isControlKeyDown=false;e=document.getElementById(c);if(!e){return false}if(e.readOnly){return true}m=INTERMediatorLib.getLinkedElementInfo(e);if(!m&&INTERMediatorLib.isWidgetElement(e.parentNode)){m=INTERMediatorLib.getLinkedElementInfo(e.parentNode)}s=INTERMediatorLib.getNodeInfoArray(m[0]);k=IMLibContextPool.getContextInfoFromId(c,s.target);if(!IMLibUI.validation(e)){e.focus();window.setTimeout((function(){var u=e;var t=k;return function(){if(t){u.value=t.context.getValue(t.record,t.field)}u.removeAttribute("data-im-validation-notification")}})(),0);return false}if(d===true){return true}b=e.getAttribute("type");if(b==="radio"&&!e.checked){INTERMediatorOnPage.hideProgress();return true}if(!k){return false}a=IMLibElement.getValueFromIMNode(e);if(k.context.isValueUndefined(k.record,k.field,k.portal)){INTERMediator.setErrorMessage("Error in updating.",INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1040],[k.context.contextName,k.field]));return false}if(INTERMediatorOnPage.getOptionsTransaction()=="none"){k.context.setModified(k.record,k.field,a);return false}INTERMediatorOnPage.showProgress();try{if(!e){throw"false_exit"}if(s.table==IMLibLocalContext.contextName){throw"false_exit"}c=e.getAttribute("id");k=IMLibContextPool.getContextInfoFromId(c,s.target);if(INTERMediator.ignoreOptimisticLocking){IMLibContextPool.updateContext(c,s.target);a=IMLibElement.getValueFromIMNode(e);if(a!==null){p=k.record.split("=");INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_update_async({name:k.context.contextName,conditions:[{field:p[0],operator:"=",value:p[1]}],dataset:[{field:k.field+(k.portal?("."+k.portal):""),value:a}]},(function(){var t=c;var u=k;var v=a;return function(x){var z,y,w;INTERMediatorOnPage.hideProgress();z=IMLibContextPool.dependingObjects(t);for(l=0;l<z.length;l++){z[l].foreignValue={};z[l].foreignValue[u.field]=v;if(z[l]){INTERMediator.constructMain(z[l]);w=z[l].enclosureNode;if(INTERMediatorLib.isPopupMenu(w)){y=k.context.getContextValue(w.id,"");IMLibElement.setValueToIMNode(w,"",y,false)}}}IMLibCalc.recalculation();INTERMediator.flushMessage()}})(),function(){INTERMediatorOnPage.hideProgress();INTERMediator.setErrorMessage("Error in valueChange method.","EXCEPTION-2")})}}else{f=k.context;h=k.field;n=k.record.split("=");q=n[0];n.shift();r=n.join("=");INTERMediator_DBAdapter.eliminateDuplicatedConditions=true;INTERMediator_DBAdapter.db_query_async({name:k.context.contextName,records:1,paging:false,fields:[h],parentkeyvalue:null,conditions:[{field:q,operator:"=",value:r}],useoffset:false,primaryKeyOnly:true},(function(){var x=h;var v=k;var y=f;var w=e;var u=s;var t=c;return function(I){var D,A,z,E,F,C,G,B;if(v.portal){F=false;C=k.context.contextName+"::-recid";if(I.dbresult&&I.dbresult[0]){for(G in I.dbresult[0]){var H=I.dbresult[0][G];if(H[C]&&H[x]!==undefined&&H[C]==k.portal){B=H[x];F=true}}}if(!F){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[x]));INTERMediatorOnPage.hideProgress();return}}else{if(!I.dbresult||!I.dbresult[0]||I.dbresult[0][x]===undefined){alert(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1003],[x]));INTERMediatorOnPage.hideProgress();return}if(I.resultCount>1){D=confirm(INTERMediatorOnPage.getMessages()[1024]);if(!D){INTERMediatorOnPage.hideProgress();return}}B=I.dbresult[0][x]}A=y.getValue(v.record,x,v.portal);switch(w.tagName){case"INPUT":switch(w.getAttribute("type")){case"checkbox":if(A==w.value){E=false}else{if(!parseInt(B)){E=false}else{E=true}}break;default:E=(A!=B);break}break;default:E=(A!=B);break}if(E){z=IMLibElement.getValueFromIMNode(w);if(!confirm(INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1001],[A,z,B]))){window.setTimeout(function(){w.focus()},0);INTERMediatorOnPage.hideProgress();return false}INTERMediatorOnPage.retrieveAuthInfo()}IMLibContextPool.updateContext(t,u.target);z=IMLibElement.getValueFromIMNode(w);if(z!=null){p=k.record.split("=");INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_update_async({name:k.context.contextName,conditions:[{field:p[0],operator:"=",value:p[1]}],dataset:[{field:k.field+(k.portal?("."+k.portal):""),value:z}]},(function(){var J=t;var K=k;var L=z;return function(N){var P,O,M;INTERMediatorOnPage.hideProgress();P=IMLibContextPool.dependingObjects(J);for(l=0;l<P.length;l++){P[l].foreignValue={};P[l].foreignValue[K.field]=L;if(P[l]){INTERMediator.constructMain(P[l]);M=P[l].enclosureNode;if(INTERMediatorLib.isPopupMenu(M)){O=k.context.getContextValue(M.id,"");IMLibElement.setValueToIMNode(M,"",O,false)}}}IMLibCalc.recalculation();INTERMediator.flushMessage()}})(),function(){INTERMediatorOnPage.hideProgress();INTERMediator.setErrorMessage("Error in valueChange method.","EXCEPTION-2")})}}})(),function(){INTERMediatorOnPage.hideProgress();INTERMediator.setErrorMessage("Error in valueChange method.","EXCEPTION-1")})}}catch(o){INTERMediatorOnPage.hideProgress()}return true},validation:function(d){var k,c,b,f,l,h,g,n,e=[],a;if(e){while(e.length>0){e[0].parentNode.removeChild(e[0]);delete e[0]}}if(!e){e=[]}try{k=INTERMediatorLib.getLinkedElementInfo(d);h=false;n=true;if(k.length>0){c=k[0].match(/([^@]+)/);if(c[1]!==IMLibLocalContext.contextName){b=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c[1]);if(b!=null&&b.validation!=null){for(f=0;f<k.length;f++){c=k[f].match(/([^@]+)@([^@]+)/);for(l in b.validation){if(b.validation[l].field===c[2]){h=true;n=Parser.evaluate(b.validation[l].rule,{value:d.value,target:d});if(!n){switch(b.validation[l].notify){case"inline":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("SPAN",b.validation[l].message);d.parentNode.insertBefore(a,d.nextSibling);e.push(a);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);a=INTERMediatorLib.createErrorMessageNode("DIV",b.validation[l].message);d.parentNode.appendChild(a);e.push(a);break;default:if(d.getAttribute("data-im-validation-notification")!=="alert"){alert(b.validation[l].message);d.setAttribute("data-im-validation-notification","alert")}break}g=IMLibContextPool.getContextInfoFromId(d,"");if(g){d.value=g.context.getValue(g.record,g.field);window.setTimeout(function(){d.focus()},0);if(INTERMediatorOnPage.doAfterValidationFailure!==null){INTERMediatorOnPage.doAfterValidationFailure(d,k[f])}}return n}else{switch(b.validation[l].notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(d);break}}}}}}}if(h){if(INTERMediatorOnPage.doAfterValidationSucceed!=null){n=INTERMediatorOnPage.doAfterValidationSucceed(d,k[f])}}}return n}catch(m){if(m==="_im_requath_request_"){throw m}else{INTERMediator.setErrorMessage(m,"EXCEPTION-32: on the validation process.")}return false}},copyButton:function(h,d){var f,l,e,a,c,b,k;INTERMediatorOnPage.showProgress();f=h.getContextDef();if(f["repeat-control"].match(/confirm-copy/)){if(!confirm(INTERMediatorOnPage.getMessages()[1041])){return}}try{if(f.relation){for(index in f.relation){if(f.relation[index]["portal"]==true){f.portal=true}}}l=[];if(f["repeat-control"].match(/copy-/)){b=f["repeat-control"].indexOf("copy-");k=f["repeat-control"].substr(b+5);if((b=k.search(/\s/))>-1){k=k.substr(0,b)}c=k.split(",");for(e=0;e<c.length;e++){a=IMLibContextPool.getContextDef(c[e]);if(a.relation[0]["foreign-key"]){l.push({name:a.name,field:a.relation[0]["foreign-key"],value:d})}}}INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.db_copy_async({name:f.name,conditions:[{field:f.key,operator:"=",value:d}],associated:l.length>0?l:null},(function(){var m=f;var n=h;return function(o){var r,s,p;var q=o.newRecordKeyValue;if(q>-1){r=INTERMediator.additionalCondition;INTERMediator.startFrom=0;if(m.records<=1){s=INTERMediator.additionalCondition;s[m.name]={field:m.key,value:q};INTERMediator.additionalCondition=s;IMLibLocalContext.archive()}INTERMediator_DBAdapter.unregister();INTERMediator.constructMain(n);p=IMLibContextPool.getContextsWithSameOrigin(n.viewName);for(e=0;e<p.length;e++){INTERMediator.constructMain(p[e],null)}INTERMediator.additionalCondition=r}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})(),null)}catch(g){INTERMediator.setErrorMessage(g,"EXCEPTION-43")}},deleteButton:function(h,f,g,d,e,o,l){var k,m,c,p,b,a;if(l){b=INTERMediatorOnPage.getMessages()[1025];if(!window.confirm(b)){return}}INTERMediatorOnPage.showProgress();try{INTERMediatorOnPage.retrieveAuthInfo();c=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",h);p=c.relation;if(p){for(m in p){if(p.hasOwnProperty(m)&&p[m]["portal"]==true){c.portal=true}}}a=function(){if(c.relation==true){INTERMediator.pagedAllCount--;if(INTERMediator.pagedAllCount-INTERMediator.startFrom<1){INTERMediator.startFrom=INTERMediator.startFrom-INTERMediator.pagedSize;if(INTERMediator.startFrom<0){INTERMediator.startFrom=0}}if(INTERMediator.pagedAllCount>=INTERMediator.pagedSize){INTERMediator.construct()}IMLibPageNavigation.navigationSetup()}};if(d!=""&&c.portal==true){INTERMediator_DBAdapter.db_update_async({name:h,conditions:[{field:f,operator:"=",value:g}],dataset:[{field:"-delete.related",operator:"=",value:d.replace("::-recid","")+"."+e}]},a,null)}else{INTERMediator_DBAdapter.db_delete_async({name:h,conditions:[{field:f,operator:"=",value:g}]},a,null)}}catch(n){if(n=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication&&!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){IMLibUI.deleteButton(h,f,g,d,e,o,false)});return}}else{INTERMediator.setErrorMessage(n,"EXCEPTION-3")}}for(k=0;k<o.length;k++){IMLibContextPool.removeRecordFromPool(o[k])}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()},insertButton:function(m,s,r,l,q,h){var e,n,g,w,p,t,v,k,b,o=false,c,f,d,u,a;if(h){if(!confirm(INTERMediatorOnPage.getMessages()[1026])){return}}INTERMediatorOnPage.showProgress();e=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",m);n=[];c=[];if(r!=null){for(g in e.relation){if(e.relation.hasOwnProperty(g)){n.push({field:e.relation[g]["foreign-key"],value:r[e.relation[g]["join-field"]]})}}}INTERMediatorOnPage.retrieveAuthInfo();p=e.relation;if(p){for(g in p){if(p.hasOwnProperty(g)&&p[g]["portal"]==true){e.portal=true}}}if(e.portal==true){c=[];for(g in e["default-values"]){if(e["default-values"].hasOwnProperty(g)){c.push({field:m+"::"+e["default-values"][g]["field"]+".0",value:e["default-values"][g]["value"]})}}if(c.length==0){b="";t=INTERMediator_DBAdapter.db_query({name:m,records:1,conditions:[{field:e.key?e.key:"-recid",operator:"=",value:s}]});for(v in t.recordset[0][0]){if(v.indexOf(m+"::")>-1&&v!==m+"::-recid"){o=true;k=v;if(v==m+"::"+n[0]["field"]){b=n[0]["value"];break}if(v!=m+"::id"&&v!=m+"::"+n[0]["field"]){break}}}if(o==false){t=INTERMediator_DBAdapter.db_query({name:m,records:0,conditions:[{field:e.key?e.key:"-recid",operator:"=",value:s}]});for(v in t.recordset){if(v.indexOf(m+"::")>-1&&v!==m+"::-recid"){k=v;if(v==m+"::"+n[0]["field"]){b=n[0]["value"];break}if(v!=m+"::id"&&v!=m+"::"+n[0]["field"]){break}}}}c.push({field:k+".0",value:b})}INTERMediator_DBAdapter.db_update({name:m,conditions:[{field:e.key?e.key:"-recid",operator:"=",value:s}],dataset:c});t=INTERMediator_DBAdapter.db_query({name:m,records:1,conditions:[{field:e.key?e.key:"-recid",operator:"=",value:s}]});f={};a=-1;for(d in t.recordset[0]){if(d==Number(d)&&t.recordset[0][d][m+"::-recid"]){u=parseInt(t.recordset[0][d][m+"::-recid"],10);if(u>a){a=u;f.recordset=[];f.recordset.push(t.recordset[0][d])}}}}else{INTERMediator_DBAdapter.db_createRecord_async({name:m,dataset:n},(function(){var z=e;var B=l;var x=r;var y=o;var A=s;return function(C){var H,J,E,G,I,F,D;J=C.newRecordKeyValue;H=z.key?z.key:"-recid";E=IMLibContextPool.contextFromEnclosureId(B);if(E){E.foreignValue=x;if(z.portal==true&&y==false){G=INTERMediator.additionalCondition;G[m]={field:H,operator:"=",value:A};INTERMediator.additionalCondition=G}I=[{}];I[0][H]=J;INTERMediator.constructMain(E,C.dbresult);D=IMLibContextPool.getContextsWithSameOrigin(E.viewName);for(F=0;F<D.length;F++){INTERMediator.constructMain(D[F],null)}}IMLibCalc.recalculation();INTERMediatorOnPage.hideProgress();INTERMediator.flushMessage()}})(),function(){INTERMediator.setErrorMessage("Insert Error","EXCEPTION-4")})}},clickPostOnlyButton:function(s){var w,v,e,l,y,r,g,x,B;var n,A,d,u,c,o,q;var f,t,m,a;var h=s.parentNode;while(!INTERMediatorLib.isEnclosure(h,true)){h=h.parentNode;if(!h){return}}if(INTERMediatorOnPage.processingBeforePostOnlyContext){if(!INTERMediatorOnPage.processingBeforePostOnlyContext(h)){return}}f=[];t=[];for(w=0;w<h.childNodes.length;w++){b(h.childNodes[w])}r={};for(w=0;w<f.length;w++){l=INTERMediatorLib.getLinkedElementInfo(f[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(!r[y[v]]){r[y[v]]=0}r[y[v]]++}}if(r.length<1){return}var p=-100;for(var z in r){if(p<r[z]){p=r[z];g=z;x=INTERMediatorOnPage.getContextInfo(z)}}q="";e=[];a=false;for(w=0;w<f.length;w++){l=INTERMediatorLib.getLinkedElementInfo(f[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(y[0]==g){if(x.validation){for(m in x.validation){B=x.validation[m];if(B&&B.field==y[1]){switch(B.notify){case"inline":case"end-of-sibling":INTERMediatorLib.clearErrorMessage(f[w]);break}}}for(m in x.validation){B=x.validation[m];if(B.field==y[1]){if(B){o=Parser.evaluate(B.rule,{value:f[w].value,target:f[w]});if(!o){a=true;switch(B.notify){case"inline":INTERMediatorLib.clearErrorMessage(f[w]);c=INTERMediatorLib.createErrorMessageNode("SPAN",B.message);f[w].parentNode.insertBefore(c,f[w].nextSibling);break;case"end-of-sibling":INTERMediatorLib.clearErrorMessage(f[w]);c=INTERMediatorLib.createErrorMessageNode("DIV",B.message);f[w].parentNode.appendChild(c);break;default:q+=B.message+"\n"}if(INTERMediatorOnPage.doAfterValidationFailure!=null){INTERMediatorOnPage.doAfterValidationFailure(f[w])}}}}}}if(INTERMediatorLib.isWidgetElement(f[w])){e.push({field:y[1],value:f[w]._im_getValue()})}else{if(f[w].tagName=="SELECT"){e.push({field:y[1],value:f[w].value})}else{if(f[w].tagName=="TEXTAREA"){e.push({field:y[1],value:f[w].value})}else{if(f[w].tagName=="INPUT"){if((f[w].getAttribute("type")=="radio")||(f[w].getAttribute("type")=="checkbox")){if(f[w].checked){e.push({field:y[1],value:f[w].value})}}else{e.push({field:y[1],value:f[w].value})}}}}}}}}for(w=0;w<t.length;w++){l=INTERMediatorLib.getNamedInfo(t[w]);for(v=0;v<l.length;v++){y=l[v].split(INTERMediator.separator);if(y[0]==g){n=[];A=t[w].getElementsByTagName("INPUT");for(u=0;u<A.length;u++){d=A[u].getAttribute("type");if(d=="radio"||d=="checkbox"){if(A[u].checked){n.push(A[u].value)}}else{n.push(A[u].value)}}e.push({field:y[1],value:n.join("\n")+"\n"})}}}if(q.length>0){window.alert(q);return}if(a){return}x=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",g);INTERMediator_DBAdapter.db_createRecord_async({name:g,dataset:e},function(k){var D,G,F=s,E=x,C=false;INTERMediator.flushMessage();if(INTERMediatorOnPage.processingAfterPostOnlyContext){INTERMediatorOnPage.processingAfterPostOnlyContext(F,k.newRecordKeyValue)}if(E["post-dismiss-message"]){G=F.parentNode;G.removeChild(F);D=document.createElement("SPAN");INTERMediatorLib.setClassAttributeToNode(D,"IM_POSTMESSAGE");D.appendChild(document.createTextNode(E["post-dismiss-message"]));G.appendChild(D);C=true}if(E["post-reconstruct"]){setTimeout(function(){INTERMediator.construct(true)},C?INTERMediator.waitSecondsAfterPostMessage*1000:0)}if(E["post-move-url"]){setTimeout(function(){location.href=E["post-move-url"]},C?INTERMediator.waitSecondsAfterPostMessage*1000:0)}},null);function b(D){var C,k;if(D.nodeType===1){if(INTERMediatorLib.isLinkedElement(D)){f.push(D)}else{if(INTERMediatorLib.isWidgetElement(D)){f.push(D)}else{if(INTERMediatorLib.isNamedElement(D)){t.push(D)}else{C=D.childNodes;for(k=0;k<C.length;k++){b(C[k])}}}}}}},eventUpdateHandler:function(b){IMLibLocalContext.updateAll();var a=IMLibContextPool.getContextFromName(b);INTERMediator.constructMain(a[0])},eventAddOrderHandler:function(g){var a,c,d,f,b;if(g.target){a=g.target.getAttribute("data-im")}else{a=g.srcElement.getAttribute("data-im")}c=a.split(":");if(c[0]!="_@addorder"||c.length<3){return}for(d in IMLibLocalContext.store){f=d.split(":");if(f.length>3&&f[0]=="valueofaddorder"&&f[1]==c[1]){b=IMLibLocalContext.getValue(d);if(b){IMLibLocalContext.store[d]++}}}IMLibLocalContext.setValue("valueof"+a.substring(2),1);IMLibUI.eventUpdateHandler(c[1])}};function SHA1(d){function c(h,g,k){while(0<k--){h.push(g)}}function b(h,g){return(h<<g)|(h>>>(32-g))}function e(h,g,k){return h^g^k}function a(h,g){var l=(g&65535)+(h&65535),k=(g>>>16)+(h>>>16)+(l>>>16);return((k&65535)<<16)|(l&65535)}var f="0123456789abcdef";return(function(g){var m=[],l=g.length*4,k;for(var h=0;h<l;h++){k=g[h>>2]>>((3-(h%4))*8);m.push(f.charAt((k>>4)&15)+f.charAt(k&15))}return m.join("")}((function(H,G){var F,E,D,C,B,A=H.length,r=1732584193,q=4023233417,p=2562383102,o=271733878,n=3285377520,m=[];c(m,1518500249,20);c(m,1859775393,20);c(m,2400959708,20);c(m,3395469782,20);H[G>>5]|=128<<(24-(G%32));H[(((G+65)>>9)<<4)+15]=G;for(var u=0;u<A;u+=16){F=r;E=q;D=p;C=o;B=n;for(var t=0,l=[];t<80;t++){l[t]=t<16?H[t+u]:b(l[t-3]^l[t-8]^l[t-14]^l[t-16],1);var s=(function(k,h,z,y,x){var w=(x&65535)+(k&65535)+(h&65535)+(z&65535)+(y&65535),v=(x>>>16)+(k>>>16)+(h>>>16)+(z>>>16)+(y>>>16)+(w>>>16);return((v&65535)<<16)|(w&65535)})(t<20?(function(k,h,g){return(k&h)^(~k&g)}(E,D,C)):t<40?e(E,D,C):t<60?(function(k,h,g){return(k&h)^(k&g)^(h&g)}(E,D,C)):e(E,D,C),B,m[t],l[t],b(F,5));B=C;C=D;D=b(E,30);E=F;F=s}r=a(r,F);q=a(q,E);p=a(p,D);o=a(o,C);n=a(n,B)}return[r,q,p,o,n]}((function(l){var h=[],g=255,m=l.length*8;for(var k=0;k<m;k+=8){h[k>>5]|=(l.charCodeAt(k/8)&g)<<(24-(k%32))}return h}(d)).slice(),d.length*8))))}(function(){var q=8,t="",r=0,s=function(y){var w=[],x=(1<<q)-1,A=y.length*q,z;for(z=0;z<A;z+=q){w[z>>5]|=(y.charCodeAt(z/q)&x)<<(32-q-(z%32))}return w},d=function(x){var w=[],A=x.length,z,y;for(z=0;z<A;z+=2){y=parseInt(x.substr(z,2),16);if(!isNaN(y)){w[z>>3]|=y<<(24-(4*(z%8)))}else{return"INVALID HEX STRING"}}return w},g=function(x){var w=(r)?"0123456789ABCDEF":"0123456789abcdef",B="",A=x.length*4,z,y;for(z=0;z<A;z+=1){y=x[z>>2]>>((3-(z%4))*8);B+=w.charAt((y>>4)&15)+w.charAt(y&15)}return B},m=function(x){var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C="",A=x.length*4,z,y,B;for(z=0;z<A;z+=3){B=(((x[z>>2]>>8*(3-z%4))&255)<<16)|(((x[z+1>>2]>>8*(3-(z+1)%4))&255)<<8)|((x[z+2>>2]>>8*(3-(z+2)%4))&255);for(y=0;y<4;y+=1){if(z*8+y*6<=x.length*32){C+=w.charAt((B>>6*(3-y))&63)}else{C+=t}}}return C},h=function(w,y){return(w>>>y)|(w<<(32-y))},p=function(w,y){return w>>>y},k=function(w,B,A){return(w&B)^(~w&A)},b=function(w,B,A){return(w&B)^(w&A)^(B&A)},n=function(w){return h(w,2)^h(w,13)^h(w,22)},l=function(w){return h(w,6)^h(w,11)^h(w,25)},v=function(w){return h(w,7)^h(w,18)^p(w,3)},u=function(w){return h(w,17)^h(w,19)^p(w,10)},e=function(w,B){var z=(w&65535)+(B&65535),A=(w>>>16)+(B>>>16)+(z>>>16);return((A&65535)<<16)|(z&65535)},c=function(x,w,B,A){var z=(x&65535)+(w&65535)+(B&65535)+(A&65535),y=(x>>>16)+(w>>>16)+(B>>>16)+(A>>>16)+(z>>>16);return((y&65535)<<16)|(z&65535)},a=function(x,w,C,B,A){var z=(x&65535)+(w&65535)+(C&65535)+(B&65535)+(A&65535),y=(x>>>16)+(w>>>16)+(C>>>16)+(B>>>16)+(A>>>16)+(z>>>16);return((y&65535)<<16)|(z&65535)},f=function(F,E,D){var R,Q,P,O,N,M,L,I,C,A,y,J,G,z,x,w=[],B;if(D==="SHA-224"||D==="SHA-256"){J=(((E+65)>>9)<<4)+15;x=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(D==="SHA-224"){y=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}else{y=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]}}F[E>>5]|=128<<(24-E%32);F[J]=E;B=F.length;for(G=0;G<B;G+=16){R=y[0];Q=y[1];P=y[2];O=y[3];N=y[4];M=y[5];L=y[6];I=y[7];for(z=0;z<64;z+=1){if(z<16){w[z]=F[z+G]}else{w[z]=c(u(w[z-2]),w[z-7],v(w[z-15]),w[z-16])}C=a(I,l(N),k(N,M,L),x[z],w[z]);A=e(n(R),b(R,Q,P));I=L;L=M;M=N;N=e(O,C);O=P;P=Q;Q=R;R=e(C,A)}y[0]=e(R,y[0]);y[1]=e(Q,y[1]);y[2]=e(P,y[2]);y[3]=e(O,y[3]);y[4]=e(N,y[4]);y[5]=e(M,y[5]);y[6]=e(L,y[6]);y[7]=e(I,y[7])}switch(D){case"SHA-224":return[y[0],y[1],y[2],y[3],y[4],y[5],y[6]];case"SHA-256":return y;default:return[]}},o=function(x,w){this.sha224=null;this.sha256=null;this.strBinLen=null;this.strToHash=null;if("HEX"===w){if(0!==(x.length%2)){return"TEXT MUST BE IN BYTE INCREMENTS"}this.strBinLen=x.length*4;this.strToHash=d(x)}else{if(("ASCII"===w)||("undefined"===typeof(w))){this.strBinLen=x.length*q;this.strToHash=s(x)}else{return"UNKNOWN TEXT INPUT TYPE"}}};o.prototype={getHash:function(x,w){var z=null,y=this.strToHash.slice();switch(w){case"HEX":z=g;break;case"B64":z=m;break;default:return"FORMAT NOT RECOGNIZED"}switch(x){case"SHA-224":if(null===this.sha224){this.sha224=f(y,this.strBinLen,x)}return z(this.sha224);case"SHA-256":if(null===this.sha256){this.sha256=f(y,this.strBinLen,x)}return z(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(F,E,D,B){var A,z,y,w,C,H,G=[],x=[];switch(B){case"HEX":A=g;break;case"B64":A=m;break;default:return"FORMAT NOT RECOGNIZED"}switch(D){case"SHA-224":H=224;break;case"SHA-256":H=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===E){if(0!==(F.length%2)){return"KEY MUST BE IN BYTE INCREMENTS"}z=d(F);C=F.length*4}else{if("ASCII"===E){z=s(F);C=F.length*q}else{return"UNKNOWN KEY INPUT TYPE"}}if(64<(C/8)){z=f(z,C,D);z[15]&=4294967040}else{if(64>(C/8)){z[15]&=4294967040}}for(y=0;y<=15;y+=1){G[y]=z[y]^909522486;x[y]=z[y]^1549556828}w=f(G.concat(this.strToHash),512+this.strBinLen,D);w=f(x.concat(w),512+H,D);return(A(w))}};window.jsSHA=o}());var biRadixBits=16;biRadixBits=biRadixBits-biRadixBits%4;var bitsPerDigit=biRadixBits;var biRadix=1<<biRadixBits;var biHalfRadix=biRadix>>>1;var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=4294967295;var biHexPerDigit=biRadixBits/4;var bigZero=biFromNumber(0);var bigOne=biFromNumber(1);function BigInt(a){this.isNeg=false;if(a==-1){return}if(a){this.digits=new Array(a);while(a){this.digits[--a]=0}}else{this.digits=[0]}}BigInt.prototype.isZero=function(){return this.digits[0]==0&&biNormalize(this).digits.length==1};BigInt.prototype.isOne=function(){return this.digits[0]==1&&!this.isNeg&&biNormalize(this).digits.length==1};BigInt.prototype.isEqual=function(b){var a;if(this.isNeg!=b.isNeg){return false}if(this.digits.length!=b.digits.length){return false}for(a=this.digits.length-1;a>-1;a--){if(this.digits[a]!=b.digits[a]){return false}}return true};BigInt.prototype.blankZero=function(){this.digits.length=1;this.digits[0]=0};BigInt.prototype.blankOne=function(){this.digits.length=1;this.digits[0]=1};BigInt.prototype.blankEmpty=function(){this.digits.length=0};function biCopy(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=b.isNeg;return a}function biAbs(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=false;return a}function biMinus(b){var a=new BigInt(-1);a.digits=b.digits.slice(0);a.isNeg=!b.isNeg;return a}function biFromNumber(c){var a,b;if(Math.abs(c)>maxInteger){return(biFromFloat(c))}a=new BigInt();if(a.isNeg=c<0){c=-c}b=0;while(c>0){a.digits[b++]=c&maxDigitVal;c>>>=biRadixBits}return a}function biFromFloat(d){var a,b,e;a=new BigInt();if(a.isNeg=d<0){d=-d}b=0;while(d>0){e=Math.floor(d/biRadix);a.digits[b++]=d-e*biRadix;d=e}return a}function biFromString(l,k){var a,e,m,b,d,f,g,h;if(k==16){return biFromHex(l)}a=l.charAt(0)=="-";e=(a?1:0)-1;m=new BigInt();b=biCopy(bigOne);for(d=l.length-1;d>e;d--){f=l.charCodeAt(d);g=charToHex(f);h=biMultiplyDigit(b,g);m=biAdd(m,h);b=biMultiplyDigit(b,k)}m.isNeg=a;return biNormalize(m)}function biFromDecimal(a){return biFromString(a,10)}function biFromHex(d){var b,a,c;b=new BigInt();if(d.charAt(0)=="-"){b.isNeg=true;d=substr(d,1)}else{b.isNeg=false}a=d.length;for(c=a,j=0;c>0;c-=biHexPerDigit,j++){b.digits[j]=hexToDigit(d.substr(Math.max(c-biHexPerDigit,0),Math.min(c,biHexPerDigit)))}return biNormalize(b)}function reverseStr(c){var a="",b;for(b=c.length-1;b>-1;b--){a+=c.charAt(b)}return a}var hexatrigesimalToChar=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];function biToString(d,f){var c,e,a;if(f==16){return biToHex(d)}c=biFromNumber(f);e=biDivideModulo(biAbs(d),c);a=hexatrigesimalToChar[e[1].digits[0]];while(!e[0].isZero()){e=biDivideModulo(e[0],c);a+=hexatrigesimalToChar[e[1].digits[0]]}return(d.isNeg?"-":"")+reverseStr(a)}function biToDecimal(a){return biToString(a,10)}var hexToChar=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function digitToHex(d){var b,a,c;b=15;a="";for(c=0;c<biHexPerDigit;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function digitToHexTrunk(d){var b,a,c;if(d==0){return"0"}b=15;a="";for(c=0;c<biHexPerDigit&&d>0;c++){a+=hexToChar[d&b];d>>>=4}return reverseStr(a)}function biToHex(b){var c,a;a=b.isNeg?"-":"";c=biHighIndex(b);a+=digitToHexTrunk(b.digits[c--]);while(c>-1){a+=digitToHex(b.digits[c--])}return a}function biToNumber(b){var a=0,d=1,c;c=biHighIndex(b)+1;for(var e=0;e<c;e++){a+=b.digits[e]*d;d*=biRadix}return b.isNeg?-a:a}function charToHex(k){var d=48;var b=d+9;var e=97;var h=e+25;var g=65;var f=65+25;var a;if(k>=d&&k<=b){a=k-d}else{if(k>=g&&k<=f){a=10+k-g}else{if(k>=e&&k<=h){a=10+k-e}else{a=0}}}return a}function hexToDigit(d){var b=0,a,c;a=Math.min(d.length,biHexPerDigit);for(c=0;c<a;c++){b<<=4;b|=charToHex(d.charCodeAt(c))}return b}function biDump(a){return(a.isNeg?"minus ":"plus ")+a.digits.join(" ")}function biNormalize(a){var b,c;b=a.digits.length;if(a.digits[b-1]!=0&&!isNaN(a.digits[b-1])){return a}for(c=b-1;c>0;c--){if(a.digits[c]==0||isNaN(a.digits[c])){a.digits.pop()}else{return a}}if(a.digits.length==1&&a.digits[0]==0){a.isNeg=false}if(isNaN(a.digits[0])){throw new Error("Undefined BigInt: "+biDump(a))}return a}function biHighIndex(a){biNormalize(a);return a.digits.length-1}function biNumBits(c){var f,e,b,a;f=biHighIndex(c);e=c.digits[f];b=(f+1)*bitsPerDigit;for(a=b;a>b-bitsPerDigit;a--){if((e&biHalfRadix)!=0){break}e<<=1}return a}function biCompareAbs(c,b){var a=biHighIndex(c);var e=biHighIndex(b);if(a!=e){return 1-2*((a<e)?1:0)}for(var d=c.digits.length-1;d>-1;d--){if(c.digits[d]!=b.digits[d]){return 1-2*((c.digits[d]<b.digits[d])?1:0)}}return 0}function biCompare(b,a){if(b.isNeg!=a.isNeg){return 1-2*(b.isNeg?1:0)}return b.isNeg?-biCompareAbs(b,a):biCompareAbs(b,a)}function biAddNatural(h,g){var f,e,d,l,m,a,b;f=biHighIndex(h)+1;e=biHighIndex(g)+1;d=0;l=0;if(f>e){m=biAbs(h);a=g;b=e}else{m=biAbs(g);a=h;b=f}while(d<b){m.digits[d]+=a.digits[d]+l;if(m.digits[d]<biRadix){l=0}else{m.digits[d]&=maxDigitVal;l=1}d++}while(l>0){m.digits[d]=(m.digits[d]||0)+l;if(m.digits[d]<biRadix){l=0}else{m.digits[d]&=maxDigitVal;l=1}d++}return m}function biSubtractNatural(h,g){var f,e,m,a,b,l,k,d;f=biHighIndex(h)+1;e=biHighIndex(g)+1;m=biAbs(h);a=m.digits;b=h.digits;l=g.digits;k=0;for(d=0;d<e;d++){if(b[d]>=l[d]-k){a[d]=b[d]-l[d]+k;k=0}else{a[d]=biRadix+b[d]-l[d]+k;k=-1}}while(k<0&&d<f){if(b[d]>=-k){a[d]=b[d]+k;k=0}else{a[d]=biRadix+b[d]+k;k=-1}d++}return biNormalize(m)}function biAdd(c,b){var a,d;if(!c.isNeg&&!b.isNeg){return biAddNatural(c,b)}if(c.isNeg&&b.isNeg){a=biAddNatural(c,b);a.isNeg=true;return a}d=biCompareAbs(c,b);if(d==0){return biFromNumber(0)}if(d>0){a=biSubtractNatural(c,b);a.isNeg=c.isNeg}if(d<0){a=biSubtractNatural(b,c);a.isNeg=b.isNeg}return a}function biSubtract(c,b){var a,d;if(!c.isNeg&&b.isNeg){return biAddNatural(c,b)}if(c.isNeg&&!b.isNeg){a=biAddNatural(c,b);a.isNeg=true;return a}d=biCompareAbs(c,b);if(d==0){return biCopy(bigZero)}if(d>0){a=biSubtractNatural(c,b);a.isNeg=c.isNeg}if(d<0){a=biSubtractNatural(b,c);a.isNeg=!c.isNeg}return a}function biMultiply(m,l){var o,e,q,r,a,b,p,h,g,d,f;e=biHighIndex(m)+1;q=biHighIndex(l)+1;if(e==1&&m.digits[0]==0||q==1&&l.digits[0]==0){return new BigInt()}r=new BigInt(e+q);a=r.digits;b=m.digits;p=l.digits;for(h=0;h<q;h++){o=0;f=h;for(g=0;g<e;g++,f++){d=a[f]+b[g]*p[h]+o;a[f]=d&maxDigitVal;o=d>>>biRadixBits}a[h+e]=o}r.isNeg=m.isNeg!=l.isNeg;return biNormalize(r)}function biMultiplyDigit(e,b){var h,a,g,d,f;h=biHighIndex(e)+1;a=new BigInt(h);g=0;for(d=0;d<h;d++){f=a.digits[d]+e.digits[d]*b+g;a.digits[d]=f&maxDigitVal;g=f>>>biRadixBits}a.digits[h]=g;return a}function arrayCopy(e,g,b,f,d){var c,a;if(g>=e.length){if(b.length==0){b[0]=0}return}for(c=0;c<f;c++){b[c]=0}a=Math.min(g+d,e.length);for(c=g,j=f;c<a;c++,j++){b[j]=e[c]}}function biShiftLeft(b,g){var d,a,f,c,e;d=Math.floor(g/bitsPerDigit);a=new BigInt();arrayCopy(b.digits,0,a.digits,d,b.digits.length);f=g%bitsPerDigit;c=bitsPerDigit-f;a.digits[a.digits.length]=a.digits[a.digits.length]>>>c;for(e=a.digits.length-1;e>0;e--){a.digits[e]=((a.digits[e]<<f)&maxDigitVal)|(a.digits[e-1]>>>c)}a.digits[0]=(a.digits[0]<<f)&maxDigitVal;a.isNeg=b.isNeg;return biNormalize(a)}function biShiftRight(b,g){var c,a,e,f,d;c=Math.floor(g/bitsPerDigit);a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);e=g%bitsPerDigit;f=bitsPerDigit-e;for(d=0;d<a.digits.length-1;d++){a.digits[d]=(a.digits[d]>>>e)|((a.digits[d+1]<<f)&maxDigitVal)}a.digits[a.digits.length-1]>>>=e;a.isNeg=b.isNeg;return biNormalize(a)}function biMultiplyByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,c,b.digits.length);return a}function biDivideByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);return a}function biModuloByRadixPower(b,c){var a=new BigInt();arrayCopy(b.digits,0,a.digits,0,c);return a}function biMultiplyModByRadixPower(q,o,d){var m,f,s,e,g,u,a,b,r,l,h;f=biHighIndex(q)+1;s=biHighIndex(o)+1;if(f==1&&q.digits[0]==0||s==1&&o.digits[0]==0){return new BigInt()}u=new BigInt(d);a=u.digits;b=q.digits;r=o.digits;for(l=0;l<s&&l<d;l++){m=0;g=l;for(h=0;h<f&&g<d;h++,g++){e=a[g]+b[h]*r[l]+m;a[g]=e&maxDigitVal;m=e>>>biRadixBits}a[l+f]=m}u=biModuloByRadixPower(u,d);u.isNeg=q.isNeg!=o.isNeg;return biNormalize(u)}function biDivideModuloNatural(l,h){var f,e,b,a,k,c,m,g;f=biHighIndex(l);e=biHighIndex(h);b=new BigInt(-1);b.digits=[];a=new BigInt();for(var d=f;d>-1;d--){a.digits.unshift(l.digits[d]);g=biCompareAbs(h,a);if(g>0){b.digits.unshift(0);continue}if(g==0){b.digits.unshift(1);a.blankZero();continue}k=biHighIndex(a);if(k==e){c=Math.floor((a.digits[k]*biRadix+(a.digits[k-1]||0))/(h.digits[e]*biRadix+(h.digits[e-1]||0)+1))}else{c=Math.floor((a.digits[k]*biRadixSquared+(a.digits[k-1]||0)*biRadix+(a.digits[k-2]||0))/(h.digits[e]*biRadix+(h.digits[e-1]||0)+1))}c=Math.max(0,Math.min(c,maxDigitVal));m=biMultiplyDigit(h,c);a=biSubtract(a,m);if(a.isNeg){while(a.isNeg){a=biAdd(a,h);c--}}else{while(biCompare(a,h)>=0){a=biSubtract(a,h);c++}}b.digits.unshift(c)}return[biNormalize(b),biNormalize(a)]}function biDivideModulo(c,g){var f,e,d,b,a;if(biCompareAbs(c,g)<0){if((c.isNeg&&g.isNeg)||(!c.isNeg&&!g.isNeg)){f=biFromNumber(0);e=biCopy(c)}else{f=biFromNumber(-1);e=biAdd(g,c)}return[f,e]}d=c.isNeg;b=g.isNeg;a=biDivideModuloNatural(biAbs(c),biAbs(g));f=a[0];e=a[1];if(!d&&!b){return[f,e]}else{if(d&&b){e.isNeg=true;return[f,e]}else{f.isNeg=true;f=biSubtract(f,bigOne);e.isNeg=d;e=biAdd(e,g)}}if(e.digits[0]==0&&biHighIndex(e)==0){e.isNeg=false}return[f,e]}function biDivide(a,b){return biDivideModulo(a,b)[0]}function biModulo(a,b){return biDivideModulo(a,b)[1]}function biMultiplyMod(b,c,a){return biModulo(biMultiply(b,c),a)}function biPow(c,e){var b=biCopy(bigOne);var d=c;while(true){if((e&1)!=0){b=biMultiply(b,d)}e>>>=1;if(e==0){break}d=biMultiply(d,d)}return b}function biPowMod(d,g,c){var b=biCopy(bigOne);var e=d;var f=g;while(true){if((f.digits[0]&1)!=0){b=biMultiplyMod(b,e,c)}f=biShiftRight(f,1);if(f.digits[0]==0&&biHighIndex(f)==0){break}e=biMultiplyMod(e,e,c)}return b}function biRandom(b){var a=new BigInt();while(b--){a.digits[b]=Math.floor(Math.random()*maxDigitVal)}return a}function biModularInverse(c,b){var a;c=biModulo(c,b);a=biExtendedEuclid(b,c);if(!a[2].isOne()){return null}return biModulo(a[1],b)}function biExtendedEuclid(e,d){var c;if(biCompare(e,d)>=0){return biExtendedEuclidNatural(e,d)}c=biExtendedEuclidNatural(d,e);return[c[1],c[0],c[2]]}function biExtendedEuclidNatural(o,l){var k,d,c,f,e,n,h,m,g;if(l.isZero()){return[biFromNumber(1),biFromNumber(0),o]}f=biFromNumber(0);e=biFromNumber(1);n=biFromNumber(1);h=biFromNumber(0);while(!l.isZero()){k=biDivideModulo(o,l);d=k[0];c=k[1];m=biSubtract(e,biMultiply(d,f));g=biSubtract(h,biMultiply(d,n));o=l;l=c;e=f;f=m;h=n;n=g}return[e,h,o]}function biMontgomeryPowMod(c,e,f){var b=biFromNumber(1);var a=biModulo(biMultiply(c,f.R),f);for(var d=e.bin.length-1;d>-1;d--){if(e.bin.charAt(d)=="1"){b=biMultiply(b,a);b=biMontgomeryModulo(b,f)}a=biMultiply(a,a);a=biMontgomeryModulo(a,f)}return b}function biMontgomeryModulo(b,c){var a=biModuloByRadixPower(b,c.nN);a=biMultiplyModByRadixPower(a,c.Ninv,c.nN);a=biMultiply(a,c);a=biAdd(b,a);a=biDivideByRadixPower(a,c.nN);while(biCompare(a,c)>=0){a=biSubtract(a,c)}return a}function biRSAKeyPair(b,c,a){this.e=biFromHex(b);this.d=biFromHex(c);this.m=biFromHex(a);this.chunkSize=2*biHighIndex(this.m);this.m.nN=biHighIndex(this.m)+1;this.m.R=biMultiplyByRadixPower(biFromNumber(1),this.m.nN);this.m.EGCD=biExtendedEuclid(this.m.R,this.m);this.m.Ri=this.m.EGCD[0];this.m.Rinv=biModulo(this.m.EGCD[0],this.m);this.m.Ni=biMinus(this.m.EGCD[1]);this.m.Ninv=biModulo(biMinus(this.m.EGCD[1]),this.m.R);this.e.bin=biToString(this.e,2);this.d.bin=biToString(this.d,2)}biRSAKeyPair.prototype.biEncryptedString=biEncryptedString;biRSAKeyPair.prototype.biDecryptedString=biDecryptedString;function biEncryptedString(h){var e,d,c,b,a,l;h=biUTF8Encode(h);h=h.replace(/[\x00]/gm,String.fromCharCode(255));h=h+String.fromCharCode(254);a=h.length;h=h+biRandomPadding(this.chunkSize-a%this.chunkSize);a=h.length;l="";b=new BigInt();for(e=0;e<a;e+=this.chunkSize){b.blankZero();d=0;for(c=e;c<e+this.chunkSize&&c<a;++d){b.digits[d]=h.charCodeAt(c++);b.digits[d]+=(h.charCodeAt(c++)||0)<<8}var g=biMontgomeryPowMod(b,this.e,this.m);var f=biToHex(g);l+=f+","}return l.substring(0,l.length-1)}function biDecryptedString(e){var g=e.split(",");var a="";var d,c,f;for(d=0;d<g.length;++d){var b;b=biFromHex(g[d],10);f=biMontgomeryPowMod(b,this.d,this.m);for(c=0;c<=biHighIndex(f);++c){a+=String.fromCharCode(f.digits[c]&255,f.digits[c]>>8)}}a=a.replace(/\xff/gm,String.fromCharCode(0));a=a.substr(0,a.lastIndexOf(String.fromCharCode(254)));return biUTF8Decode(a)}function biUTF8Encode(d){var b="";var a=d.length;for(var f=0;f<a;f++){var e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b}function biUTF8Decode(e){var d="";var a=e.length;var b;for(var g=0;g<a;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f);b=0}else{if((f>191)&&(f<224)){b=((f&31)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}else{b=((f&15)<<12);f=e.charCodeAt(++g);b+=((f&63)<<6);f=e.charCodeAt(++g);b+=(f&63);d+=String.fromCharCode(b)}}}return d}function biRandomPadding(c){var a="";for(var b=0;b<c;b++){a=a+String.fromCharCode(Math.floor(Math.random()*126)+1)}return a}var INTERMediator_DBAdapter;INTERMediator_DBAdapter={eliminateDuplicatedConditions:false,debugMessage:false,generate_authParams:function(){var b="",c,a;if(INTERMediatorOnPage.authUser.length>0){b="&clientid="+encodeURIComponent(INTERMediatorOnPage.clientId);b+="&authuser="+encodeURIComponent(INTERMediatorOnPage.authUser);if(INTERMediatorOnPage.isNativeAuth||INTERMediatorOnPage.isLDAP){if(INTERMediatorOnPage.authCryptedPassword&&INTERMediatorOnPage.authChallenge){b+="&cresponse="+encodeURIComponent(INTERMediatorOnPage.publickey.biEncryptedString(INTERMediatorOnPage.authCryptedPassword+"\n"+INTERMediatorOnPage.authChallenge));if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("generate_authParams/authCryptedPassword="+INTERMediatorOnPage.authCryptedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&cresponse=dummy"}}if(INTERMediatorOnPage.authHashedPassword&&INTERMediatorOnPage.authChallenge){c=new jsSHA(INTERMediatorOnPage.authHashedPassword,"ASCII");a=c.getHMAC(INTERMediatorOnPage.authChallenge,"ASCII","SHA-256","HEX");b+="&response="+encodeURIComponent(a);if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("generate_authParams/authHashedPassword="+INTERMediatorOnPage.authHashedPassword);INTERMediator.setDebugMessage("generate_authParams/authChallenge="+INTERMediatorOnPage.authChallenge)}}else{b+="&response=dummy"}}b+="&notifyid=";b+=encodeURIComponent(INTERMediatorOnPage.clientNotificationIdentifier());b+=("&pusher="+(INTERMediator.pusherAvailable?"yes":""));return b},store_challenge:function(a){if(a!==null){INTERMediatorOnPage.authChallenge=a.substr(0,24);INTERMediatorOnPage.authUserHexSalt=a.substr(24,32);INTERMediatorOnPage.authUserSalt=String.fromCharCode(parseInt(a.substr(24,2),16),parseInt(a.substr(26,2),16),parseInt(a.substr(28,2),16),parseInt(a.substr(30,2),16));if(INTERMediator_DBAdapter.debugMessage){INTERMediator.setDebugMessage("store_challenge/authChallenge="+INTERMediatorOnPage.authChallenge);INTERMediator.setDebugMessage("store_challenge/authUserHexSalt="+INTERMediatorOnPage.authUserHexSalt);INTERMediator.setDebugMessage("store_challenge/authUserSalt="+INTERMediatorOnPage.authUserSalt)}}},logging_comAction:function(a,d,c,b){INTERMediator.setDebugMessage(INTERMediatorOnPage.getMessages()[a]+"Accessing:"+decodeURI(d)+", Parameters:"+decodeURI(c+b))},logging_comResult:function(c,k,a,d,h,l,b,f,e){var g;if(INTERMediator.debugMode>1){if(c.responseText.length>1000){g=c.responseText.substr(0,1000)+" ...[trancated]"}else{g=c.responseText}INTERMediator.setDebugMessage("myRequest.responseText="+g);INTERMediator.setDebugMessage("Return: resultCount="+k+", dbresult="+INTERMediatorLib.objectToString(a)+"\nReturn: requireAuth="+d+", challenge="+h+", clientid="+l+"\nReturn: newRecordKeyValue="+b+", changePasswordResult="+f+", mediatoken="+e)}},server_access:function(h,d,f){var m="",c="",r=0,u=null,w=null,t=null,o=false,n=null,x=null,l=null,k,b,g,s,q=false,p=false,a="";k=INTERMediatorOnPage.getEntryPath();b=INTERMediator_DBAdapter.generate_authParams();INTERMediator_DBAdapter.logging_comAction(d,k,h,b);INTERMediatorOnPage.notifySupport=q;try{n=new XMLHttpRequest();n.open("POST",k,false,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);n.setRequestHeader("charset","utf-8");n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("X-From",location.href);n.send(h+b);g=JSON.parse(n.responseText);r=g.resultCount?g.resultCount:0;u=g.totalCount?g.totalCount:null;c=g.dbresult?g.dbresult:null;o=g.requireAuth?g.requireAuth:false;w=g.challenge?g.challenge:null;t=g.clientid?g.clientid:null;m=g.newRecordKeyValue?g.newRecordKeyValue:"";x=g.changePasswordResult?g.changePasswordResult:null;l=g.mediatoken?g.mediatoken:null;q=g.notifySupport;for(s=0;s<g.errorMessages.length;s++){INTERMediator.setErrorMessage(g.errorMessages[s])}for(s=0;s<g.debugMessages.length;s++){INTERMediator.setDebugMessage(g.debugMessages[s])}p=g.usenull;a=g.hasOwnProperty("registeredid")?g.registeredid:"";INTERMediator_DBAdapter.logging_comResult(n,r,c,o,w,t,m,x,l);INTERMediator_DBAdapter.store_challenge(w);if(t!==null){INTERMediatorOnPage.clientId=t}if(l!==null){INTERMediatorOnPage.mediaToken=l}if(INTERMediatorOnPage.isLDAP===true&&INTERMediatorOnPage.authUserHexSalt!=INTERMediatorOnPage.authHashedPassword.substr(-8,8)){if(h!="access=challenge"){o=true}}}catch(v){INTERMediator.setErrorMessage(v,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[f],[v,n.responseText]))}if(h.indexOf("access=changepassword&newpass=")===0){return x}if(o){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();throw"_im_requath_request_"}if(!h.match(/access=challenge/)){INTERMediatorOnPage.authCount=0}INTERMediatorOnPage.storeCredentialsToCookieOrStorage();INTERMediatorOnPage.notifySupport=q;return{dbresult:c,resultCount:r,totalCount:u,newRecordKeyValue:m,newPasswordResult:x,registeredId:a,nullAcceptable:p}},server_access_async:function(l,f,h,r,c,g){var o="",d="",v=0,x=null,z=null,w=null,q=false,p=null,A=null,n=null,m,b,k,u,t=false,s=false,a="";m=INTERMediatorOnPage.getEntryPath();b=INTERMediator_DBAdapter.generate_authParams();INTERMediator_DBAdapter.logging_comAction(f,m,l,b);INTERMediatorOnPage.notifySupport=t;try{p=new XMLHttpRequest();p.open("POST",m,true,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);p.setRequestHeader("charset","utf-8");p.setRequestHeader("Content-Type","application/x-www-form-urlencoded");p.setRequestHeader("X-Requested-With","XMLHttpRequest");p.setRequestHeader("X-From",location.href);p.onreadystatechange=function(){switch(p.readyState){case 0:break;case 1:break;case 2:break;case 3:break;case 4:k=JSON.parse(p.responseText);v=k.resultCount?k.resultCount:0;x=k.totalCount?k.totalCount:null;d=k.dbresult?k.dbresult:null;q=k.requireAuth?k.requireAuth:false;z=k.challenge?k.challenge:null;w=k.clientid?k.clientid:null;o=k.newRecordKeyValue?k.newRecordKeyValue:"";A=k.changePasswordResult?k.changePasswordResult:null;n=k.mediatoken?k.mediatoken:null;t=k.notifySupport;for(u=0;u<k.errorMessages.length;u++){INTERMediator.setErrorMessage(k.errorMessages[u])}for(u=0;u<k.debugMessages.length;u++){INTERMediator.setDebugMessage(k.debugMessages[u])}s=k.usenull;a=k.hasOwnProperty("registeredid")?k.registeredid:"";if(k.errorMessages.length>0){throw"Communication Error"}INTERMediator_DBAdapter.logging_comResult(p,v,d,q,z,w,o,A,n);INTERMediator_DBAdapter.store_challenge(z);if(w!==null){INTERMediatorOnPage.clientId=w}if(n!==null){INTERMediatorOnPage.mediaToken=n}if(INTERMediatorOnPage.authUserHexSalt!=INTERMediatorOnPage.authHashedPassword.substr(-8,8)){if(l!="access=challenge"){q=true}}if(l.indexOf("access=changepassword&newpass=")===0){if(r){r({dbresult:d,resultCount:v,totalCount:x,newRecordKeyValue:o,newPasswordResult:A,registeredId:a,nullAcceptable:s})}return}if(q){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();if(g){g()}return}if(!l.match(/access=challenge/)){INTERMediatorOnPage.authCount=0}INTERMediatorOnPage.storeCredentialsToCookieOrStorage();INTERMediatorOnPage.notifySupport=t;if(r){r({dbresult:d,resultCount:v,totalCount:x,newRecordKeyValue:o,newPasswordResult:A,registeredId:a,nullAcceptable:s})}break}};p.send(l+b)}catch(y){INTERMediator.setErrorMessage(y,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[h],[y,p.responseText]));if(c){c()}}},changePassword:function(k,d,g){var c,h,a,b;if(k&&d){INTERMediatorOnPage.authUser=k;if(k!==""&&(INTERMediatorOnPage.authChallenge===null||INTERMediatorOnPage.authChallenge.length<24)){INTERMediatorOnPage.authHashedPassword="need-hash-pls";c=INTERMediator_DBAdapter.getChallenge();if(!c){b=document.getElementById("_im_newpass_message");if(b){INTERMediatorLib.removeChildNodes(b);b.appendChild(document.createTextNode(INTERMediatorLib.getInsertedStringFromErrorNumber(2008)))}else{alert(INTERMediatorLib.getInsertedStringFromErrorNumber(2008))}INTERMediator.flushMessage();return}}INTERMediatorOnPage.authHashedPassword=SHA1(d+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt}else{INTERMediatorOnPage.retrieveAuthInfo()}h="access=changepassword&newpass="+INTERMediatorLib.generatePasswordHash(g);try{a=INTERMediator_DBAdapter.server_access(h,1029,1030);if(a){INTERMediatorOnPage.authCryptedPassword=INTERMediatorOnPage.publickey.biEncryptedString(g);INTERMediatorOnPage.authHashedPassword=SHA1(g+INTERMediatorOnPage.authUserSalt)+INTERMediatorOnPage.authUserHexSalt;INTERMediatorOnPage.storeCredentialsToCookieOrStorage()}}catch(f){return false}return a},getChallenge:function(){try{this.server_access("access=challenge",1027,1028)}catch(a){if(a=="_im_requath_request_"){throw a}else{INTERMediator.setErrorMessage(a,"EXCEPTION-19")}}if(INTERMediatorOnPage.authChallenge===null){return false}return true},uploadFile:function(c,o,n,h){var l="",b="",t=0,x=null,u=null,q=false,p=null,y=null,k=null,g,a,f,d,s;g=INTERMediatorOnPage.getEntryPath();a=INTERMediator_DBAdapter.generate_authParams();f="access=uploadfile"+c;INTERMediator_DBAdapter.logging_comAction(1031,g,f,a);try{p=new XMLHttpRequest();p.open("POST",g,true,INTERMediatorOnPage.httpuser,INTERMediatorOnPage.httppasswd);p.setRequestHeader("charset","utf-8");var w=(f+a).split("&");var m=new FormData();for(s=0;s<w.length;s++){var r=w[s].split("=");m.append(r[0],decodeURIComponent(r[1]))}m.append("_im_uploadfile",o.content);p.onreadystatechange=function(){switch(p.readyState){case 3:break;case 4:try{d=JSON.parse(p.responseText)}catch(e){INTERMediator.setErrorMessage(e,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],["",""]));INTERMediator.flushMessage();h();break}t=d.resultCount?d.resultCount:0;b=d.dbresult?d.dbresult:null;q=d.requireAuth?d.requireAuth:false;x=d.challenge?d.challenge:null;u=d.clientid?d.clientid:null;l=d.newRecordKeyValue?d.newRecordKeyValue:"";y=d.changePasswordResult?d.changePasswordResult:null;k=d.mediatoken?d.mediatoken:null;for(s=0;s<d.errorMessages.length;s++){INTERMediator.setErrorMessage(d.errorMessages[s])}for(s=0;s<d.debugMessages.length;s++){INTERMediator.setDebugMessage(d.debugMessages[s])}INTERMediator_DBAdapter.logging_comResult(p,t,b,q,x,u,l,y,k);INTERMediator_DBAdapter.store_challenge(x);if(u!==null){INTERMediatorOnPage.clientId=u}if(k!==null){INTERMediatorOnPage.mediaToken=k}if(q){INTERMediator.setDebugMessage("Authentication Required, user/password panel should be show.");INTERMediatorOnPage.clearCredentials();h()}INTERMediatorOnPage.authCount=0;INTERMediatorOnPage.storeCredentialsToCookieOrStorage();n(b);break}};p.send(m)}catch(v){INTERMediator.setErrorMessage(v,INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[1032],[v,p.responseText]));h()}},db_query:function(c){var g,e,a,b,f;if(!INTERMediator_DBAdapter.db_queryChecking(c)){return}g=INTERMediator_DBAdapter.db_queryParameters(c);INTERMediator_DBAdapter.eliminateDuplicatedConditions=false;e={};try{a=this.server_access(g,1012,1004);e.recordset=a.dbresult;e.totalCount=a.resultCount;e.count=0;e.registeredId=a.registeredId;e.nullAcceptable=a.nullAcceptable;for(b in a.dbresult){e.count++}f=INTERMediatorLib.getNamedObject(INTERMediatorOnPage.getDataSources(),"name",c.name);if(!f.relation&&c.paging&&Boolean(c.paging)===true){INTERMediator.pagedAllCount=parseInt(a.resultCount,10);if(a.totalCount){INTERMediator.totalRecordCount=parseInt(a.totalCount,10)}}if((c.paging!==null)&&(Boolean(c.paging)===true)){INTERMediator.pagination=true;if(!(Number(c.records)>=Number(INTERMediator.pagedSize)&&Number(INTERMediator.pagedSize)>0)){INTERMediator.pagedSize=parseInt(c.records,10)}}}catch(d){if(d=="_im_requath_request_"){throw d}else{INTERMediator.setErrorMessage(d,"EXCEPTION-17")}e.recordset=null;e.totalCount=0;e.count=0;e.registeredid=null;e.nullAcceptable=null}return e},db_queryWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_query(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_queryWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-16")}}a(d)},db_query_async:function(c,b,a){var e;if(!INTERMediator_DBAdapter.db_queryChecking(c)){return}e=INTERMediator_DBAdapter.db_queryParameters(c);INTERMediator_DBAdapter.eliminateDuplicatedConditions=false;try{this.server_access_async(e,1012,1004,(function(){var f,h;var l=c.name;var g=Number(c.records);var k=b;return function(m){m.count=0;for(f in m.dbresult){m.count++}h=IMLibContextPool.getContextDef(l);if(!h.relation&&c.paging&&Boolean(c.paging)===true){INTERMediator.pagedAllCount=parseInt(m.resultCount,10);if(m.totalCount){INTERMediator.totalRecordCount=parseInt(m.totalCount,10)}}if((c.paging!==null)&&(Boolean(c.paging)===true)){INTERMediator.pagination=true;if(!(g>=Number(INTERMediator.pagedSize)&&Number(INTERMediator.pagedSize)>0)){INTERMediator.pagedSize=parseInt(g,10)}}k(m)}})(),null,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var g=c;var h=b;var f=a;return function(){INTERMediator_DBAdapter.db_query_async(g,h,f)}})()))}catch(d){INTERMediator.setErrorMessage(d,"EXCEPTION-17")}},db_queryChecking:function(b){var a=true;if(b.name===null||b.name===""){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1005));a=false}return a},db_queryParameters:function(c){var r,f,t,b,l,u,k,e,a,q=10000000,g,m,d,v,s,p,o,h,n;if(c.records===null){t="access=read&name="+encodeURIComponent(c.name)}else{b=INTERMediatorOnPage.getDBSpecification();if(parseInt(c.records,10)===0&&b["db-class"]!==null&&b["db-class"]==="FileMaker_FX"){t="access=describe&name="+encodeURIComponent(c.name)}else{t="access=read&name="+encodeURIComponent(c.name)}if(Boolean(c.uselimit)===true&&parseInt(c.records,10)>=INTERMediator.pagedSize&&parseInt(INTERMediator.pagedSize,10)>0){q=INTERMediator.pagedSize}else{q=c.records}}if(c.primaryKeyOnly){t+="&pkeyonly=true"}if(c.fields){for(r=0;r<c.fields.length;r++){t+="&field_"+r+"="+encodeURIComponent(c.fields[r])}}l=0;if(c.parentkeyvalue){for(f in c.parentkeyvalue){if(c.parentkeyvalue.hasOwnProperty(f)){t+="&foreign"+l+"field="+encodeURIComponent(f);t+="&foreign"+l+"value="+encodeURIComponent(c.parentkeyvalue[f]);l++}}}if(c.useoffset&&INTERMediator.startFrom!==null){t+="&start="+encodeURIComponent(INTERMediator.startFrom)}u=0;g=[];while(c.conditions&&c.conditions[u]){m=c.conditions[u]["field"]+"#"+c.conditions[u]["operator"]+"#"+c.conditions[u]["value"];if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){t+="&condition"+u;t+="field="+encodeURIComponent(c.conditions[u]["field"]);t+="&condition"+u;t+="operator="+encodeURIComponent(c.conditions[u]["operator"]);t+="&condition"+u;t+="value="+encodeURIComponent(c.conditions[u]["value"]);g.push(m)}u++}k=INTERMediator.additionalCondition[c.name];if(k){if(k.field){k=[k]}for(f=0;f<k.length;f++){if(k[f]&&k[f]["field"]){if(k[f]["value"]||k[f]["field"]=="__operation__"){m=k[f]["field"]+"#"+((k[f]["operator"]!==undefined)?k[f]["operator"]:"")+"#"+((k[f]["value"]!==undefined)?k[f]["value"]:"");if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){t+="&condition"+u;t+="field="+encodeURIComponent(k[f]["field"]);if(k[f]["operator"]!==undefined){t+="&condition"+u;t+="operator="+encodeURIComponent(k[f]["operator"])}if(k[f]["value"]!==undefined){t+="&condition"+u;t+="value="+encodeURIComponent(k[f]["value"])}if(k[f]["field"]!="__operation__"){g.push(m)}else{}}u++}}}}a=0;e=INTERMediator.additionalSortKey[c.name];if(e){if(e.field){e=[e]}for(f=0;f<e.length;f++){t+="&sortkey"+a;t+="field="+encodeURIComponent(e[f]["field"]);t+="&sortkey"+a;t+="direction="+encodeURIComponent(e[f]["direction"]);a++}}d={};for(v in IMLibLocalContext.store){if(IMLibLocalContext.store.hasOwnProperty(v)){p=new String(IMLibLocalContext.store[v]);s=v.split(":");if(s&&s.length>1&&s[1].trim()==c.name&&p.length>0){if(s[0].trim()=="condition"&&s.length>=4){o=s[2].split(",");h=s[3].trim();if(o.length>1){t+="&condition"+u+"field=__operation__";t+="&condition"+u+"operator=ex";u++}for(f=0;f<o.length;f++){m=o[f].trim()+"#"+h+"#"+p;if(!INTERMediator_DBAdapter.eliminateDuplicatedConditions||g.indexOf(m)<0){t+="&condition"+u+"field="+encodeURIComponent(o[f].trim());t+="&condition"+u+"operator="+encodeURIComponent(h);t+="&condition"+u+"value="+encodeURIComponent(p);g.push(m)}u++}}else{if(s[0].trim()=="valueofaddorder"&&s.length>=4){d[parseInt(p)]=[s[2].trim(),s[3].trim()]}else{if(s[0].trim()=="limitnumber"&&s.length>=4){q=parseInt(p)}}}}}}t+="&records="+encodeURIComponent(q);n=Object.keys(d);for(r=0;r<n.length;r++){t+="&sortkey"+a+"field="+encodeURIComponent(d[n[r]][0]);t+="&sortkey"+a+"direction="+encodeURIComponent(d[n[r]][1]);a++}return t},db_update:function(b){var c,a;if(!INTERMediator_DBAdapter.db_updateChecking(b)){return}c=INTERMediator_DBAdapter.db_updateParameters(b);a=this.server_access(c,1013,1014);return a.dbresult},db_updateWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_update(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_updateWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-15")}}a(d)},db_updateChecking:function(b){var a=true,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1007));a=false}c=IMLibContextPool.getContextDef(b.name);if(!c.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[b.name]));a=false}if(b.dataset===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1011));a=false}return a},db_updateParameters:function(d){var g,b,a,c,f;g="access=update&name="+encodeURIComponent(d.name);a=0;if(INTERMediator.additionalFieldValueOnUpdate&&INTERMediator.additionalFieldValueOnUpdate[d.name]){f=INTERMediator.additionalFieldValueOnUpdate[d.name];if(f.field){f=[f]}for(c in f){if(f.hasOwnProperty(c)){var e=f[c];g+="&field_"+a+"="+encodeURIComponent(e.field);g+="&value_"+a+"="+encodeURIComponent(e.value);a++}}}if(d.conditions!=null){for(b=0;b<d.conditions.length;b++){g+="&condition"+b+"field=";g+=encodeURIComponent(d.conditions[b]["field"]);g+="&condition"+b+"operator=";g+=encodeURIComponent(d.conditions[b]["operator"]);if(d.conditions[b]["value"]){g+="&condition"+b+"value=";g+=encodeURIComponent(d.conditions[b]["value"])}}}for(b=0;b<d.dataset.length;b++){g+="&field_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["field"]);if(INTERMediator.isTrident&&INTERMediator.ieVersion==8){g+="&value_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["value"].replace(/\n/g,""))}else{g+="&value_"+(a+b)+"="+encodeURIComponent(d.dataset[b]["value"])}}return g},db_update_async:function(c,b,a){var d;if(!INTERMediator_DBAdapter.db_updateChecking(c)){return}d=INTERMediator_DBAdapter.db_updateParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1017,1015,b,null,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_update_async(f,g,e)}})()))}},db_delete:function(b){var c,a;if(!INTERMediator_DBAdapter.db_deleteChecking(b)){return}c=INTERMediator_DBAdapter.db_deleteParameters(b);a=this.server_access(c,1017,1015);INTERMediator.flushMessage();return a},db_deleteWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_delete(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_deleteWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},db_deleteChecking:function(b){var a=true,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));a=false}c=IMLibContextPool.getContextDef(b.name);if(!c.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[b.name]));a=false}if(b.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));a=false}return a},db_deleteParameters:function(c){var g,d,a,b,f;g="access=delete&name="+encodeURIComponent(c.name);a=0;if(INTERMediator.additionalFieldValueOnDelete&&INTERMediator.additionalFieldValueOnDelete[c.name]){f=INTERMediator.additionalFieldValueOnDelete[c.name];if(f.field){f=[f]}for(b in f){if(f.hasOwnProperty(b)){var e=f[b];g+="&field_"+a+"="+encodeURIComponent(e.field);g+="&value_"+a+"="+encodeURIComponent(e.value);a++}}}for(d=0;d<c.conditions.length;d++){g+="&condition"+d+"field="+encodeURIComponent(c.conditions[d]["field"]);g+="&condition"+d+"operator="+encodeURIComponent(c.conditions[d]["operator"]);g+="&condition"+d+"value="+encodeURIComponent(c.conditions[d]["value"])}return g},db_delete_async:function(c,b,a){var d;if(!INTERMediator_DBAdapter.db_deleteChecking(c)){return}d=INTERMediator_DBAdapter.db_deleteParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1017,1015,b,null,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_delete_async(f,g,e)}})()))}},db_createRecord:function(b){var c,a;c=INTERMediator_DBAdapter.db_createParameters(b);if(c){a=INTERMediator_DBAdapter.server_access(c,1018,1016);INTERMediator.flushMessage();return{newKeyValue:a.newRecordKeyValue,recordset:a.dbresult}}return false},db_createRecordWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_createRecord(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_createRecordWithAuth(b,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-13")}}if(a){a(d.newKeyValue)}},db_createRecord_async:function(c,b,a){var d=INTERMediator_DBAdapter.db_createParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1018,1016,b,null,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_createRecord_async(f,g,e)}})()))}},db_createParameters:function(l){var e,f,k,h,a,b,d,m,g;if(l.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1021));return false}g=IMLibContextPool.getContextDef(l.name);if(!g.key){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1045,[l.name]));return false}d=INTERMediatorOnPage.getDataSources();b=null;for(m in d){if(d.hasOwnProperty(m)&&d[m]["name"]==l.name){b=m;break}}if(b===null){INTERMediator.setErrorMessage("no targetname :"+l.name);return false}e="access=create&name="+encodeURIComponent(l.name);a=0;if(INTERMediator.additionalFieldValueOnNewRecord&&INTERMediator.additionalFieldValueOnNewRecord[l.name]){h=INTERMediator.additionalFieldValueOnNewRecord[l.name];if(h.field){h=[h]}for(k in h){if(h.hasOwnProperty(k)){var c=h[k];e+="&field_"+a+"="+encodeURIComponent(c.field);e+="&value_"+a+"="+encodeURIComponent(c.value);a++}}}for(f=0;f<l.dataset.length;f++){e+="&field_"+a+"="+encodeURIComponent(l.dataset[f]["field"]);e+="&value_"+a+"="+encodeURIComponent(l.dataset[f]["value"]);a++}return e},db_copy:function(b){var c,a;c=INTERMediator_DBAdapter.db_copyParameters(b);if(c){a=INTERMediator_DBAdapter.server_access(c,1017,1015);INTERMediator.flushMessage();return{newKeyValue:a.newRecordKeyValue,recordset:a.dbresult}}return false},db_copyWithAuth:function(b,a){var d=false;INTERMediatorOnPage.retrieveAuthInfo();try{d=INTERMediator_DBAdapter.db_copy(b)}catch(c){if(c=="_im_requath_request_"){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(function(){d=INTERMediator_DBAdapter.db_copyWithAuth(arg,a)});return}}}else{INTERMediator.setErrorMessage(c,"EXCEPTION-14")}}a(d)},db_copy_async:function(c,b,a){var d=INTERMediator_DBAdapter.db_copyParameters(c);if(d){INTERMediatorOnPage.retrieveAuthInfo();INTERMediator_DBAdapter.server_access_async(d,1017,1015,b,null,INTERMediator_DBAdapter.createExceptionFunc(1016,(function(){var f=c;var g=b;var e=a;return function(){INTERMediator_DBAdapter.db_copy_async(f,g,e)}})()))}},db_copyParameters:function(b){var a=true,d,c;if(b.name===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1019));a=false}if(b.conditions===null){INTERMediator.setErrorMessage(INTERMediatorLib.getInsertedStringFromErrorNumber(1020));a=false}if(!a){return false}d="access=copy&name="+encodeURIComponent(b.name);for(c=0;c<b.conditions.length;c++){d+="&condition"+c+"field="+encodeURIComponent(b.conditions[c]["field"]);d+="&condition"+c+"operator="+encodeURIComponent(b.conditions[c]["operator"]);d+="&condition"+c+"value="+encodeURIComponent(b.conditions[c]["value"])}if(b.associated){for(c=0;c<b.associated.length;c++){d+="&assoc"+c+"="+encodeURIComponent(b.associated[c]["name"]);d+="&asfield"+c+"="+encodeURIComponent(b.associated[c]["field"]);d+="&asvalue"+c+"="+encodeURIComponent(b.associated[c]["value"])}}return d},createExceptionFunc:function(c,a){var b=c;return function(){if(INTERMediatorOnPage.requireAuthentication){if(!INTERMediatorOnPage.isComplementAuthData()){INTERMediatorOnPage.clearCredentials();INTERMediatorOnPage.authenticating(a)}}else{INTERMediator.setErrorMessage("Communication Error",INTERMediatorLib.getInsertedString(INTERMediatorOnPage.getMessages()[b],["Communication Error",myRequest.responseText]))}}},unregister:function(b){var a=null,c;if(INTERMediatorOnPage.clientNotificationKey){var d=INTERMediatorOnPage.clientNotificationKey();if(d&&d!="_im_key_isnt_supplied"){c="access=unregister";if(b){c+="&pks="+encodeURIComponent(JSON.stringify(b))}a=this.server_access(c,1018,1016);return a}}}};var Parser=(function(aO){var aj=0;var ae=1;var ad=2;var ac=5;var aU=65;var ak=3;var D=4;aq.regFirstVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_]");aq.regRestVarChar=new RegExp("[\u00A0-\u1FFF\u2C00-\uDFFFa-zA-Z@_0-9]");function aR(bk,bm,bl,bn){this.type_=bk;this.index_=bm||0;this.prio_=bl||0;this.number_=(bn!==undefined&&bn!==null)?bn:0;this.toString=function(){switch(this.type_){case aj:return this.number_;case ae:case ad:case ac:case ak:return this.index_;case D:return"CALL";case aU:return"SEPARATOR";default:return"Invalid Token"}}}function aZ(bo,bm,bl,bn,bk,bp){this.tokens=bo}var aV=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var R={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function ah(bk){if(typeof bk==="string"){aV.lastIndex=0;return aV.test(bk)?"'"+bk.replace(aV,function(bl){var bm=R[bl];return typeof bm==="string"?bm:"\\u"+("0000"+bl.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+bk+"'"}return bk}aZ.prototype={simplify:function(bt){bt=bt||{};var bn=[];var bm=[];var br;var bq;var bo;var bp;var bs=this.tokens.length;var bu;var bl=0;for(bl=0;bl<bs;bl++){bu=this.tokens[bl];var bk=bu.type_;if(bk===aj){bn.push(bu)}else{if(bk===ak&&(bu.index_ in bt)){bu=new aR(aj,0,0,bt[bu.index_]);bn.push(bu)}else{if(bk===ac&&bn.length>2){bo=bn.pop();bq=bn.pop();br=bn.pop();bp=aq.ops3[bu.index_];bu=new aR(aj,0,0,bp(br.number_,bq.number_,bo.number_));bn.push(bu)}else{if(bk===ad&&bn.length>1){bq=bn.pop();br=bn.pop();bp=aq.ops2[bu.index_];bu=new aR(aj,0,0,bp(br.number_,bq.number_));bn.push(bu)}else{if(bk===ae&&bn.length>0){br=bn.pop();bp=aq.ops1[bu.index_];bu=new aR(aj,0,0,bp(br.number_));bn.push(bu)}else{while(bn.length>0){bm.push(bn.shift())}bm.push(bu)}}}}}}while(bn.length>0){bm.push(bn.shift())}return new aZ(bm)},substitute:function(bl,bs){if(!(bs instanceof aZ)){bs=new aq().parse(String(bs))}var bq=[];var br=this.tokens.length;var bt;var bn=0;for(bn=0;bn<br;bn++){bt=this.tokens[bn];var bo=bt.type_;if(bo===ak&&bt.index_===bl){for(var bm=0;bm<bs.tokens.length;bm++){var bp=bs.tokens[bm];var bk=new aR(bp.type_,bp.index_,bp.prio_,bp.number_);bq.push(bk)}}else{bq.push(bt)}}return new aZ(bq)},evaluate:function(bs){bs=bs||{};var bm=[];var bq;var bp;var bn;var bo;var br=this.tokens.length;var bt;var bl=0;for(bl=0;bl<br;bl++){bt=this.tokens[bl];var bk=bt.type_;if(bk===aj){bm.push(bt.number_)}else{if(bk===ac){bn=bm.pop();bp=bm.pop();bq=bm.pop();bo=aq.ops3Trail[bt.index_];bm.push(bo(bq,bp,bn))}else{if(bk===ad){bp=bm.pop();bq=bm.pop();bo=aq.ops2[bt.index_];bm.push(bo(bq,bp))}else{if(bk===ak){if(bt.index_ in bs){bm.push(bs[bt.index_])}else{if(bt.index_ in aq.functions){bm.push(aq.functions[bt.index_])}else{throw new Error("undefined variable: "+bt.index_)}}}else{if(bk===ae){bq=bm.pop();bo=aq.ops1[bt.index_];bm.push(bo(bq))}else{if(bk===aU){bp=bm.pop();bq=bm.pop();bm.push([bq,bp])}else{if(bk===D){bq=bm.pop();bo=bm.pop();if(bo.apply&&bo.call){if(Object.prototype.toString.call(bq)=="[object Array]"){bm.push(bo.apply(undefined,bq))}else{bm.push(bo.call(undefined,bq))}}else{throw new Error(bo+" is not a function")}}else{throw new Error("invalid Expression")}}}}}}}}if(bm.length>1){throw new Error("invalid Expression (parity)")}return bm[0]},variables:function(){var bk=this.tokens.length;var bn=[];for(var bl=0;bl<bk;bl++){var bm=this.tokens[bl];if(bm.type_===ak&&(bn.indexOf(bm.index_)==-1)&&!(bm.index_ in aq.functions)){bn.push(bm.index_)}}return bn}};function aA(bm,bk,bp){var bo,bn,bl;bo=(bm instanceof Array)?arguments[0][0]:arguments[0];bn=(bk instanceof Array)?arguments[1][0]:arguments[1];bl=(bk instanceof Array)?arguments[2][0]:arguments[2];return bo?bn:bl}function aw(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)>Number(bm)}return bl>bk}function r(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)<Number(bm)}return bl<bk}function P(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)>=Number(bm)}return bl>=bk}function g(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)<=Number(bm)}return bl<=bk}function a9(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)==Number(bm)}return bl==bk}function ax(bl,bk){var bn,bm;bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bn)){return Number(bn)!=Number(bm)}return bl!=bk}function ar(bk){return bk!==bk}function z(bl,bk){var bn,bm;if(ar(bl)||ar(bk)){return NaN}bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bm)){return Number(bn)+Number(bm)}return bl+bk}function aE(bl,bk){return String(bl)+String(bk)}function a3(bl,bk){var bn,bm,bo,bp;if(ar(bl)||ar(bk)){return NaN}bn=y(bl);bm=y(bk);if(!isNaN(bn)&&!isNaN(bm)){return bn-bm}bo=String(bl);do{bp=bo.indexOf(bk);if(bp>-1){bo=bo.substr(0,bp)+bo.substr(bp+bk.length)}}while(bp>-1);return bo}function b(bl,bk){if(ar(bl)||ar(bk)){return NaN}bl=y(bl);bk=y(bk);return bl*bk}function x(bl,bk){if(ar(bl)||ar(bk)){return NaN}bl=y(bl);bk=y(bk);return bl/bk}function c(bl,bk){if(ar(bl)||ar(bk)){return NaN}bl=y(bl);bk=y(bk);return bl%bk}function aB(bk){if(ar(bk)){return NaN}bk=y(bk);return -bk}function aF(bk){bk=y(bk);return Math.random()*(bk||1)}function an(bl){if(ar(bl)){return NaN}bl=y(bl);bl=Math.floor(bl);var bk=bl;while(bl>1){bk=bk*(--bl)}return bk}function O(bk){bk=y(bk);return !bk}function bj(bl,bk){bl=y(bl);bk=y(bk);return bl&&bk}function I(bl,bk){bl=y(bl);bk=y(bk);return bl||bk}function aS(bm,bl,bq,bp,bo){var bk=0,bn;for(bn=0;bn<arguments.length;bn++){bk+=y(arguments[bn])}return bk}function ap(bm,bl,br,bq,bp){var bk=0,bn,bo=0;for(bn=0;bn<arguments.length;bn++){bk+=y(arguments[bn]);bo++}return bk/bo}function V(bm,bl,bq,bp,bo){var bk="",bn;for(bn=0;bn<arguments.length;bn++){bk+=String(arguments[bn]);bk+="\n"}return bk}function Q(bl,bk){if(bk==undefined){return Math.round(bl)}else{bl=(bl instanceof Array)?bl.join():bl;bk=(bk instanceof Array)?bk.join():bk;return INTERMediatorLib.Round(bl,bk)}}function l(bk){if(bk==undefined||bk==null){return 0}else{bk=(bk instanceof Array)?bk.join():bk;return(new String(bk)).length}}function y(bl){var bk;if(bl===undefined){return NaN}if(bl===true){return true}if(bl===false){return false}if(bl==""){return 0}bk=bl;if(INTERMediatorLib.is_array(bl)){if(bl.length<1){return 0}else{bk=bl[0]}}bk=C(bk);return bk}function E(bl,bk){return Math.sqrt(bl*bl+bk*bk)}function W(bl,bk){if(Object.prototype.toString.call(bl)!="[object Array]"){return[bl,bk]}bl=bl.slice();bl.push(bk);return bl}function av(bm,bl){var bo,bn,bp,bk="";bo=(bm instanceof Array)?bm.join():bm;bn=(bl instanceof Array)?bl.join():bl;for(bp=0;bp<bo.length;bp++){if(bn.indexOf(bo.substr(bp,1))>-1){bk+=bo.substr(bp,1)}}return bk}function q(bm,bl){var bo,bn,bp,bk="";bo=(bm instanceof Array)?bm.join():bm;bn=(bl instanceof Array)?bl.join():bl;for(bp=0;bp<bn.length;bp++){if(bo.indexOf(bn.substr(bp,1))<0){bk+=bn.substr(bp,1)}}return bo+bk}function am(bm,bl){var bo,bn,bp,bk="";bo=(bm instanceof Array)?bm.join():bm;bn=(bl instanceof Array)?bl.join():bl;for(bp=0;bp<bo.length;bp++){if(bn.indexOf(bo.substr(bp,1))<0){bk+=bo.substr(bp,1)}}return bk}function aJ(bq,bp){var bm,bl,bs,br,bo,bn,bk="\n";bm=(bq instanceof Array)?bq.join():bq;bn=[bm.indexOf("\r\n"),bm.indexOf("\r"),bm.indexOf("\n")];for(bo=0;bo<bn.length;bo++){bn[bo]=(bn[bo]<0)?bm.length:bn[bo]}if(bn[0]<bm.length&&bn[0]<=bn[1]&&bn[0]<bn[2]){bk="\r\n"}else{if(bn[1]<bm.length&&bn[1]<bn[0]&&bn[1]<bn[2]){bk="\r"}}bs=bm.replace("\r\n","\n").replace("\r","\n").split("\n");bl=(bp instanceof Array)?bp.join():bp;br=bl.replace("\r\n","\n").replace("\r","\n").split("\n");return[bs,br,bk]}function k(bn,bl){var br,bp,bo,bm,bq,bk="";br=aJ(bn,bl);bp=br[0];bo=br[1];bm=br[2];for(bq=0;bq<bp.length;bq++){if(bo.indexOf(bp[bq])>-1&&bp[bq].length>0){bk+=bp[bq]+bm}}return bk}function bh(bn,bl){var br,bp,bo,bm,bq,bk="";br=aJ(bn,bl);bp=br[0];bo=br[1];bm=br[2];for(bq=0;bq<bp.length;bq++){if(bp[bq].length>0){bk+=bp[bq]+bm}}for(bq=0;bq<bo.length;bq++){if(bp.indexOf(bo[bq])<0&&bo[bq].length>0){bk+=bo[bq]+bm}}return bk}function ab(bn,bl){var br,bp,bo,bm,bq,bk="";br=aJ(bn,bl);bp=br[0];bo=br[1];bm=br[2];for(bq=0;bq<bp.length;bq++){if(bo.indexOf(bp[bq])<0&&bp[bq].length>0){bk+=bp[bq]+bm}}return bk}function aP(bn,br,bm){var bq,bo,bl,bp,bk="";bq=aJ(bn,"");bo=bq[0];bl=bq[2];bm=(bm==undefined)?bo.length:bm;for(bp=br;(bp<br+bm)&&(bp<bo.length);bp++){bk+=bo[bp]+bl}return bk}function Z(bn,bo){if(!bn){return -1}var bl=bn.replace("\r\n","\n").replace("\r","\n");var bk=0;var bm,bp;while(bl.length>0){bp=bl.indexOf("\n");if(bp>-1){bm=bl.substr(0,bp);bl=bl.substr(bp+1)}else{bm=bl;bl=""}if(bm==bo){return bk}bk++}return -1}function p(bm,bn){var bl,bk;bl=(bm instanceof Array)?bm.join():bm;bk=(bn instanceof Array)?bn.join():bn;return INTERMediatorLib.numberFormat(bl,bk)}function aa(bo,bp,bk){var bm,bn,bl;bm=(bo instanceof Array)?bo.join():bo;bn=(bp instanceof Array)?bp.join():bp;bl=(bk instanceof Array)?bk.join():bk;return bm.substr(bn,bl)}function S(bo,bp,bk){var bl,bm,bn;bl=(bo instanceof Array)?bo.join():bo;bm=(bp instanceof Array)?bp.join():bp;bn=(bk instanceof Array)?bk.join():bk;return bl.substring(bm,bn)}function aM(bn,bo,bk){var bl,bm;bl=String((bn instanceof Array)?bn.join():bn);bm=parseInt((bo instanceof Array)?bo.join():bo);return bl.substring(0,bm)}function az(bo,bp,bk){var bl,bm,bn;bl=String((bo instanceof Array)?bo.join():bo);bm=parseInt((bp instanceof Array)?bp.join():bp);bn=parseInt((bk instanceof Array)?bk.join():bk);return bl.substr(bm,bn)}function bi(bm,bn){var bk,bl;bk=String((bm instanceof Array)?bm.join():bm);bl=parseInt((bn instanceof Array)?bn.join():bn);return bk.substring(bk.length-bl)}function bb(bn,bl){var bk,bm;bk=(bn instanceof Array)?bn.join():bn;bm=(bl instanceof Array)?bl.join():bl;return bk.indexOf(bm)}function af(bq,br,bk,bo){var bl,bm,bp,bn;bl=(bq instanceof Array)?bq.join():bq;bm=(br instanceof Array)?br.join():br;bp=(bk instanceof Array)?bk.join():bk;bn=(bo instanceof Array)?bo.join():bo;return bl.substr(0,bm)+bn+bl.substr(bp)}function w(bq,bl,bp){var bk,bn,bo,bm;bk=(bq instanceof Array)?bq.join():bq;bn=(bl instanceof Array)?bl.join():bl;bo=(bp instanceof Array)?bp.join():bp;bm=new RegExp(bn,"g");return bk.replace(bm,bo)}function aQ(bn,bl){var bk,bm;bk=(bn instanceof Array)?bn.join():bn;bm=(bl instanceof Array)?bl.join():bl;return bk.match(new RegExp(bm))}function ay(bn,bl){var bk,bm;bk=(bn instanceof Array)?bn.join():bn;bm=(bl instanceof Array)?bl.join():bl;return(new RegExp(bm)).test(bk)}aq.timeOffset=(new Date()).getTimezoneOffset();function a(bl){var bk;if(bl===undefined){bk=Date.now()}else{bk=Date.parse(bl.replace(/-/g,"/"));bk-=aq.timeOffset*60000}return parseInt(bk/86400000)}function a0(bl){var bk;if(bl===undefined){bk=Date.now()}else{bk=Date.parse(bl.replace(/-/g,"/"))}return parseInt(bk/1000)}function bg(bk){if(parseInt(bk).length==bk.length){return bk}else{return a(bk)}}function aI(bk){if(parseInt(bk).length==bk.length){return bk}else{return a0(bk)}}function n(bn,bk,bm){var bl=[];bl.push(aT(bn));bl.push(a6(bn));bl.push(Y(bn));bl[bm]+=bk;return aC(bl[0],bl[1],bl[2])}function aN(bn,bk,bm){var bl=[];bl.push(be(bn));bl.push(f(bn));bl.push(d(bn));bl.push(ba(bn));bl.push(G(bn));bl.push(e(bn));bl[bm]+=bk;return a1(bl[0],bl[1],bl[2],bl[3],bl[4],bl[5])}function aC(bo,bk,bn){var bl=bk-1;if(bl<0||bl>11){bo+=parseInt(bl/12);bk=bl%12+1}var bm=parseInt(Date.UTC(bo,bk-1,bn,0,0,0)/86400000);return bm}function a1(br,bk,bq,bo,bm,bn){if(bn<0||bn>59){bm+=parseInt(bn/60);bn=bn%60}if(bm<0||bm>59){bo+=parseInt(bm/60);bm=bm%60}if(bo<0||bo>23){bq+=parseInt(bo/24);bo=bo%24}var bl=bk-1;if(bl<0||bl>11){br+=parseInt(bl/12);bk=bl%12+1}var bp=Date.UTC(br,bk-1,bq,bo,bm,bn)/1000;return bp}function aH(bk){return INTERMediator.dateTimeFunction?be(bk):aT(bk)}function bc(bk){return INTERMediator.dateTimeFunction?f(bk):a6(bk)}function K(bk){return INTERMediator.dateTimeFunction?d(bk):Y(bk)}function aD(bk){return INTERMediator.dateTimeFunction?au(bk):ao(bk)}function ai(bk){return INTERMediator.dateTimeFunction?ba(bk):0}function L(bk){return INTERMediator.dateTimeFunction?G(bk):0}function X(bk){return INTERMediator.dateTimeFunction?e(bk):0}function aT(bk){return new Date(bg(bk)*86400000).getFullYear()}function a6(bk){return new Date(bg(bk)*86400000).getMonth()+1}function Y(bk){return new Date(bg(bk)*86400000).getDate()}function ao(bk){return new Date(bg(bk)*86400000).getDay()}function be(bk){return new Date(aI(bk)*1000).getFullYear()}function f(bk){return new Date(aI(bk)*1000).getMonth()+1}function d(bk){return new Date(aI(bk)*1000).getDate()}function au(bk){return new Date(aI(bk)*1000).getDay()}function ba(bk){return new Date(aI(bk)*1000).getHours()}function G(bk){return new Date(aI(bk)*1000).getMinutes()}function e(bk){return new Date(aI(bk)*1000).getSeconds()}function o(bl,bk){return INTERMediator.dateTimeFunction?F(bl,bk):aW(bl,bk)}function at(bl,bk){return INTERMediator.dateTimeFunction?a7(bl,bk):u(bl,bk)}function U(bl,bk){return INTERMediator.dateTimeFunction?h(bl,bk):a2(bl,bk)}function m(bl,bk){return INTERMediator.dateTimeFunction?B(bl,bk):NaN}function N(bl,bk){return INTERMediator.dateTimeFunction?T(bl,bk):NaN}function a5(bl,bk){return INTERMediator.dateTimeFunction?s(bl,bk):NaN}function aW(bl,bk){return n(bl,bk,0)}function u(bl,bk){return n(bl,bk,1)}function a2(bl,bk){return n(bl,bk,2)}function F(bl,bk){return aN(bl,bk,0)}function a7(bl,bk){return aN(bl,bk,1)}function h(bl,bk){return aN(bl,bk,2)}function B(bl,bk){return aN(bl,bk,3)}function T(bl,bk){return aN(bl,bk,4)}function s(bl,bk){return aN(bl,bk,5)}function J(bk){return INTERMediator.dateTimeFunction?v(bk):ag(bk)}function ag(bk){return a2(u(aY(bk),1),-1)}function v(bk){return s(a7(a4(bk),1),-1)}function aX(bk){return INTERMediator.dateTimeFunction?a4(bk):aY(bk)}function aY(bm){var bl=aT(bm)+"/"+("0"+a6(bm)).substr(-2,2)+"/01";var bk=a(bl);return bk}function a4(bk){var bl=be(bk)+"/"+("0"+f(bk)).substr(-2,2)+"/01 00:00:00";console.log(bl);return a0(bl)}function al(){return parseInt(Date.now()/86400)}function M(){return parseInt(Date.now()/1000)}function C(bn){var bk,bm,bl,bo;bk=String(bn);bm="";for(bl=0;bl<bk.length;bl++){bo=bk.substr(bl,1);if(bo>="0"&&bo<="9"){bm+=bo}else{if(bo>=""&&bo<=""){bm+=bo}else{if(bo=="."||bo=="-"){bm+=bo}}}}return parseFloat(bm)}function aq(){this.success=false;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;aq.functions={random:aF,fac:an,min:Math.min,max:Math.max,pyt:E,pow:Math.pow,atan2:Math.atan2,"if":aA,sum:aS,average:ap,list:V,format:p,substr:aa,substring:S,indexof:bb,replace:af,substitute:w,match:aQ,test:ay,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Q,exp:Math.exp,items:aP,length:l,datetime:a0,date:a,datecomponents:aC,datetimecomponents:a1,year:aH,month:bc,day:K,weekday:aD,hour:ai,minute:L,second:X,yeard:aT,monthd:a6,dayd:Y,weekdayd:ao,yeardt:be,monthdt:f,daydt:d,weekdaydt:au,hourdt:ba,minutedt:G,seconddt:e,addyear:o,addmonth:at,addday:U,addhour:m,addminute:N,addsecond:a5,addyeard:aW,addmonthd:u,adddayd:a2,addyeardt:F,addmonthdt:a7,adddaydt:h,addhourdt:B,addminutedt:T,addseconddt:s,endofmonth:J,startofmonth:aX,endofmonthd:ag,startofmonthd:aY,endofmonthdt:v,startofmonthdt:a4,today:al,now:M,right:bi,mid:az,left:aM,itemIndexOf:Z};this.consts={E:Math.E,PI:Math.PI};aq.operators={"!":[1,O,2],"+":[2,z,4],"":[2,aE,4],"-":[2,a3,4],"*":[2,b,3],"/":[2,x,3],"%":[2,c,3],"^":[2,Math.pow,1],",":[2,W,15],">":[2,aw,6],"<":[2,r,6],">=":[2,P,6],"<=":[2,g,6],"==":[2,a9,7],"=":[2,a9,7],"!=":[2,ax,7],"<>":[2,ax,7],"&&":[2,bj,11],"||":[2,I,12],"":[2,av,3],"":[2,q,4],"":[2,am,4],"":[2,k,3],"":[2,bh,4],"":[2,ab,4],"?":[2,aA,13],":":[4,aA,13]};aq.ops1={"-":aB};aq.ops2={};aq.ops3={};aq.ops3Trail={};for(var bk in aq.operators){switch(aq.operators[bk][0]){case 1:aq.ops1[bk]=aq.operators[bk][1];break;case 2:aq.ops2[bk]=aq.operators[bk][1];break;case 3:aq.ops3[bk]=aq.operators[bk][1];break;case 4:aq.ops3Trail[bk]=aq.operators[bk][1];break}}}aq.parse=function(bk){return new aq().parse(bk)};aq.evaluate=function(bl,bm){var bk;bk=aq.parse(bl).evaluate(bm);return bk};aq.Expression=aZ;var a8=1<<0;var aK=1<<1;var aG=1<<2;var H=1<<3;var A=1<<4;var t=1<<5;var bd=1<<6;var bf=1<<7;var aL=1<<8;aq.prototype={parse:function(bs){this.errormsg="";this.success=true;var bm=[];var bu=[];this.tmpprio=0;var bo=(a8|H|aG|bd);var bp=0;this.expression=bs;this.pos=0;var br=[];while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&(bo&bd)){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";bp++;this.addfunc(bu,bm,ae)}bo=(a8|H|aG|bd)}else{if(this.isComment()){}else{if((bo&aK)===0){this.error_parsing(this.pos,"unexpected operator")}if(this.tokenindex=="?"){this.tmpprio-=40;this.tokenindex="if";this.addfunc(bu,bm,ad);this.tmpprio+=40;this.tokenindex=",";bp+=3;this.addfunc(bu,bm,ad)}else{if(this.tokenindex==":"){this.tokenindex=",";bp+=2;this.addfunc(bu,bm,ad)}else{bp+=2;this.addfunc(bu,bm,ad)}}bo=(a8|H|aG|bd)}}}else{if(this.isNumber()){if((bo&a8)===0){this.error_parsing(this.pos,"unexpected number")}var bl=new aR(aj,0,0,this.tokennumber);bu.push(bl);bo=(aK|A|t)}else{if(this.isString()){if((bo&a8)===0){this.error_parsing(this.pos,"unexpected string")}var bl=new aR(aj,0,0,this.tokennumber);bu.push(bl);bo=(aK|A|t)}else{if(this.isLeftParenth()){if((bo&H)===0){this.error_parsing(this.pos,'unexpected "("')}if(bo&bf){br.push(true)}else{br.push(false)}bo=(a8|H|aG|bd|aL)}else{if(this.isRightParenth()){var bt=br.pop();if(bt){bp+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(bu,bm,D)}if(bo&aL){var bl=new aR(aj,0,0,[]);bu.push(bl)}else{if((bo&A)===0){this.error_parsing(this.pos,'unexpected ")"')}}bo=(aK|A|t|H|bf)}else{if(this.isConst()){if((bo&a8)===0){this.error_parsing(this.pos,"unexpected constant")}var bk=new aR(aj,0,0,this.tokennumber);bu.push(bk);bo=(aK|A|t)}else{if(this.isVar()){if((bo&a8)===0){this.error_parsing(this.pos,"unexpected variable")}var bq=new aR(ak,this.tokenindex,0,0);bu.push(bq);bo=(aK|A|t|H|bf)}else{if(this.isWhite()){}else{if(this.errormsg===""){this.error_parsing(this.pos,"unknown character")}else{this.error_parsing(this.pos,this.errormsg)}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"')}while(bm.length>0){var bn=bm.pop();bu.push(bn)}return new aZ(bu)},evaluate:function(bl,bm){var bk;this.parse(bl).evaluate(bm);return bk},error_parsing:function(bk,bl){this.success=false;this.errormsg="parse error [column "+(bk)+"]: "+bl;throw new Error(this.errormsg)},addfunc:function(bn,bk,bm){var bl=new aR(bm,this.tokenindex,this.tokenprio+this.tmpprio,0);while(bk.length>0){if(bl.prio_>=bk[bk.length-1].prio_){bn.push(bk.pop())}else{break}}bk.push(bl)},isNumber:function(){var bl=false;var bm="";while(this.pos<this.expression.length){var bk=this.expression.charCodeAt(this.pos);if((bk>=48&&bk<=57)||bk===46){bm+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(bm);bl=true}else{break}}return bl},unescape:function(bl,bq){var bk=[];var bp=false;for(var bn=0;bn<bl.length;bn++){var bo=bl.charAt(bn);if(bp){switch(bo){case"'":bk.push("'");break;case"\\":bk.push("\\");break;case"/":bk.push("/");break;case"b":bk.push("\b");break;case"f":bk.push("\f");break;case"n":bk.push("\n");break;case"r":bk.push("\r");break;case"t":bk.push("\t");break;case"u":var bm=parseInt(bl.substring(bn+1,bn+5),16);bk.push(String.fromCharCode(bm));bn+=4;break;default:throw this.error_parsing(bq+bn,"Illegal escape sequence: '\\"+bo+"'")}bp=false}else{if(bo=="\\"){bp=true}else{bk.push(bo)}}}return bk.join("")},isString:function(){var bl=false;var bn="";var bm=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'"){this.pos++;while(this.pos<this.expression.length){var bk=this.expression.charAt(this.pos);if(bk!="'"||bn.slice(-1)=="\\"){bn+=this.expression.charAt(this.pos);this.pos++}else{this.pos++;this.tokennumber=this.unescape(bn,bm);bl=true;break}}}return bl},isConst:function(){var bm;for(var bl in this.consts){if(true){var bk=bl.length;bm=this.expression.substr(this.pos,bk);if(bl===bm){this.tokennumber=this.consts[bl];this.pos+=bk;return true}}}return false},isOperator:function(){var bk;if(this.pos+1<this.expression.length){bk=this.expression.substr(this.pos,2);if(aq.operators[bk]){this.tokenprio=aq.operators[bk][2];this.tokenindex=bk;this.pos+=2;return true}}bk=this.expression.substr(this.pos,1);if(aq.operators[bk]){this.tokenprio=aq.operators[bk][2];this.tokenindex=bk;this.pos++;return true}return false},isSign:function(){var bk=this.expression.charCodeAt(this.pos-1);if(bk===45||bk===43){return true}return false},isPositiveSign:function(){var bk=this.expression.charCodeAt(this.pos-1);if(bk===43){return true}return false},isNegativeSign:function(){var bk=this.expression.charCodeAt(this.pos-1);if(bk===45){return true}return false},isLeftParenth:function(){var bk=this.expression.charCodeAt(this.pos);if(bk===40){this.pos++;this.tmpprio-=20;return true}return false},isRightParenth:function(){var bk=this.expression.charCodeAt(this.pos);if(bk===41){this.pos++;this.tmpprio+=20;return true}return false},isComma:function(){var bk=this.expression.charCodeAt(this.pos);if(bk===44){this.pos++;this.tokenprio=15;this.tokenindex=",";return true}return false},isWhite:function(){var bk=this.expression.charCodeAt(this.pos);if(bk===32||bk===9||bk===10||bk===13){this.pos++;return true}return false},isVar:function(){var bl="";for(var bk=this.pos;bk<this.expression.length;bk++){var bm=this.expression.charAt(bk);if(bk===this.pos){if(!bm.match(aq.regFirstVarChar)){break}}else{if(!bm.match(aq.regRestVarChar)){break}}bl+=bm}if(bl.length>0){this.tokenindex=bl;this.tokenprio=0;this.pos+=bl.length;return true}return false},isComment:function(){var bk=this.expression.charCodeAt(this.pos-1);if(bk===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length}return true}return false}};aO.Parser=aq;return aq})(typeof exports==="undefined"?{}:exports);INTERMediator.propertyIETridentSetup();INTERMediator.propertyW3CUserAgentSetup();if(INTERMediator.isIE&&INTERMediator.ieVersion<9){INTERMediator.startFrom=0;INTERMediator.pagedSize=0;INTERMediator.pagination=false;INTERMediator.additionalCondition={};INTERMediator.additionalSortKey={};IMLibCalc.regexpForSeparator=INTERMediator.separator}else{Object.defineProperty(INTERMediator,"startFrom",{get:function(){return INTERMediator.getLocalProperty("_im_startFrom",0)},set:function(a){INTERMediator.setLocalProperty("_im_startFrom",a)}});Object.defineProperty(INTERMediator,"pagedSize",{get:function(){return INTERMediator.getLocalProperty("_im_pagedSize",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagedSize",a)}});Object.defineProperty(INTERMediator,"pagination",{get:function(){return INTERMediator.getLocalProperty("_im_pagination",0)},set:function(a){INTERMediator.setLocalProperty("_im_pagination",a)}});Object.defineProperty(INTERMediator,"additionalCondition",{get:function(){return INTERMediator.getLocalProperty("_im_additionalCondition",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalCondition",a)}});Object.defineProperty(INTERMediator,"additionalSortKey",{get:function(){return INTERMediator.getLocalProperty("_im_additionalSortKey",{})},set:function(a){INTERMediator.setLocalProperty("_im_additionalSortKey",a)}});Object.defineProperty(IMLibCalc,"regexpForSeparator",{get:function(){if(INTERMediator){return new RegExp(INTERMediator.separator)}return new RegExp("@")}})}if(!INTERMediator.additionalCondition){INTERMediator.additionalCondition={}}if(!INTERMediator.additionalSortKey){INTERMediator.additionalSortKey={}}INTERMediatorLib.addEvent(window,"beforeunload",function(a){});INTERMediatorLib.addEvent(window,"unload",function(a){INTERMediator_DBAdapter.unregister()});
